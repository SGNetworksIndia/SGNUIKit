/*
 * Copyright (c) 2022-2023 SGNetworks. All rights reserved.
 *
 * The software is an exclusive copyright of "SGNetworks" and is provided as is exclusively with only "USAGE" access. "Modification",  "Alteration", "Re-distribution" is completely prohibited.
 * VIOLATING THE ABOVE TERMS IS A PUNISHABLE OFFENSE WHICH MAY LEAD TO LEGAL CONSEQUENCES.
 */

Date.prototype.toUnixTime = function() { return this.getTime() / 1000 | 0; };
Date.time = function() { return new Date().toUnixTime(); };

const argv = process.argv,
      info = require("../package.json");
const args    = {},
      cdn_dir = "E:\\home\\sgn\\public_html\\cdn\\jquery\\plugins\\SGNetworks\\SGNUIKit\\";

for(let i = 2; i < argv.length; i++) {
	const v = argv[i].replace("--", "");
	i++;
	args[v] = argv[i];
}

const v = info.version.split(".");
const version = {
	"major": v[0] | 0,
	"minor": v[1] | 0,
	"patch": v[2] | 0,
};


const SGNUIKitLoader = "LyoNCiAqIENvcHlyaWdodCAoYykgMjAyMiBTR05ldHdvcmtzLiBBbGwgcmlnaHRzIHJlc2VydmVkLg0KICoNCiAqIFRoZSBzb2Z0d2FyZSBpcyBhbiBleGNsdXNpdmUgY29weXJpZ2h0IG9mICJTR05ldHdvcmtzIiBhbmQgaXMgcHJvdmlkZWQgYXMgaXMgZXhjbHVzaXZlbHkgd2l0aCBvbmx5ICJVU0FHRSIgYWNjZXNzLiAiTW9kaWZpY2F0aW9uIiwgICJBbHRlcmF0aW9uIiwgIlJlLWRpc3RyaWJ1dGlvbiIgaXMgY29tcGxldGVseSBwcm9oaWJpdGVkLg0KICogVklPTEFUSU5HIFRIRSBBQk9WRSBURVJNUyBJUyBBIFBVTklTSEFCTEUgT0ZGRU5TRSBXSElDSCBNQVkgTEVBRCBUTyBMRUdBTCBDT05TRVFVRU5DRVMuDQogKi8NCg0KY29uc3QgU0dOVUlLaXQgPSB7DQoJaXNSZWFkeTogZmFsc2UsDQoJaXNQcmVsb2FkZXJIZWxkOiBmYWxzZSwNCgljb21wb25lbnRzOiB7fSwNCglvbkNoYW5nZUxpc3RlbmVyOiBbXSwNCglvblJlYWR5TGlzdGVuZXI6IFtdLA0KDQoJLyoqDQoJICogVGhpcyBjYWxsYmFjayBpcyBjYWxsZWQgd2hlbiBhIGNvbXBvbmVudCBpcyBsb2FkZWQvcmVtb3ZlZCBvciB0aGUgc3RhdHVzIG9mIHJlYWRpbmVzcyBpcyBjaGFuZ2VkLg0KCSAqDQoJICogQGNhbGxiYWNrIFNHTlVJS2l0Q2hhbmdlQ2FsbGJhY2sNCgkgKiBAcGFyYW0ge3N0cmluZ30gc3RhdGUgVGhlIG5hbWUgb2YgdGhlIHN0YXRlIHdoaWNoIGlzIGNoYW5nZWQuDQoJICogQHBhcmFtIHtib29sZWFufEpTT059IHZhbHVlIFRoZSB2YWx1ZSBvZiB0aGUgc3RhdGUgd2hpY2ggaXMgY2hhbmdlZC4NCgkgKiBAcGFyYW0ge0pTT059IGNvbXBvbmVudHMgVGhlIDxiPjxpPkpTT048L2k+PC9iPiBvYmplY3Qgb2YgbG9hZGVkIDxiPlNHTlVJS2l0PC9iPiBjb21wb25lbnRzLCBvciBhbiBlbXB0eSA8Yj48aT5KU09OPC9pPjwvYj4gb2JqZWN0IGlmIG5vIGNvbXBvbmVudHMgbG9hZGVkLg0KCSAqLw0KCS8qKg0KCSAqIFRoaXMgY2FsbGJhY2sgaXMgY2FsbGVkIHdoZW4gPGI+U0dOVUlLaXQ8L2I+IGlzIHJlYWR5Lg0KCSAqDQoJICogQGNhbGxiYWNrIFNHTlVJS2l0UmVhZHlDYWxsYmFjaw0KCSAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNSZWFkeSB0aGUgc3RhdHVzIG9mIHJlYWRpbmVzcyBvZiA8Yj5TR05VSUtpdDwvYj4uDQoJICovDQoNCgkvKioNCgkgKiBBZGQgYSBsb2FkZWQgPGI+U0dOVUlLaXQ8L2I+IGNvbXBvbmVudC4NCgkgKg0KCSAqIEBwYXJhbSB7SlNPTn0gdmFsdWUgVGhlIDxiPjxpPkpTT048L2k+PC9iPiBvYmplY3Qgb2YgdGhlIGxvYWRlZCA8Yj5TR05VSUtpdDwvYj4gY29tcG9uZW50Lg0KCSAqLw0KCXNldCBjb21wb25lbnQodmFsdWUpIHsNCgkJaWYodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gIiIpDQoJCQl2YWx1ZSA9IHt9Ow0KCQlPYmplY3QuYXNzaWduKHRoaXMuY29tcG9uZW50cywgdmFsdWUpOw0KDQoJCXRoaXMub25DaGFuZ2VMaXN0ZW5lci5mb3JFYWNoKChsaXN0ZW5lcikgPT4gbGlzdGVuZXIoImNvbXBvbmVudHMiLCB2YWx1ZSwgdGhpcy5jb21wb25lbnRzKSk7DQoJfSwNCg0KCS8qKg0KCSAqIEdldCB0aGUgbGlzdCBvZiBsb2FkZWQgPGI+U0dOVUlLaXQ8L2I+IGNvbXBvbmVudHMuDQoJICoNCgkgKiBAcmV0dXJuIHtvYmplY3R9IFRoZSA8Yj48aT5KU09OPC9pPjwvYj4gb2JqZWN0IG9mIGxvYWRlZCA8Yj5TR05VSUtpdDwvYj4gY29tcG9uZW50cywgb3IgYW4gZW1wdHkgPGI+PGk+SlNPTjwvaT48L2I+IG9iamVjdCBpZiBubyBjb21wb25lbnRzIGxvYWRlZC4NCgkgKi8NCglnZXQgY29tcG9uZW50KCkgew0KCQlyZXR1cm4gdGhpcy5jb21wb25lbnRzOw0KCX0sDQoNCgkvKioNCgkgKiBTZXQgdGhlIHN0YXR1cyBvZiByZWFkaW5lc3Mgb2YgPGI+U0dOVUlLaXQ8L2I+Lg0KCSAqDQoJICogQHBhcmFtIHtib29sZWFufSBpc1JlYWR5IFRoZSB0aGUgc3RhdHVzIG9mIHJlYWRpbmVzcyBvZiA8Yj5TR05VSUtpdDwvYj4uDQoJICovDQoJc2V0IHJlYWR5KGlzUmVhZHkpIHsNCgkJdGhpcy5pc1JlYWR5ID0gaXNSZWFkeTsNCgkJdGhpcy5vbkNoYW5nZUxpc3RlbmVyLmZvckVhY2goKGxpc3RlbmVyKSA9PiBsaXN0ZW5lcigicmVhZHkiLCB0aGlzLmlzUmVhZHkpKTsNCg0KCQlpZihpc1JlYWR5KQ0KCQkJdGhpcy5vblJlYWR5TGlzdGVuZXIuZm9yRWFjaCgobGlzdGVuZXIpID0+IGxpc3RlbmVyKGlzUmVhZHkpKTsNCgl9LA0KDQoJLyoqDQoJICogR2V0IHRoZSBzdGF0dXMgb2YgcmVhZGluZXNzIG9mIDxiPlNHTlVJS2l0PC9iPi4NCgkgKg0KCSAqIEByZXR1cm4ge2Jvb2xlYW59IDxiPjxpPlRSVUU8L2k+PC9iPiBpZiA8Yj5TR05VSUtpdDwvYj4gaXMgcmVhZHksIDxiPjxpPkZBTFNFPC9pPjwvYj4gb3RoZXJ3aXNlLg0KCSAqLw0KCWdldCByZWFkeSgpIHsNCgkJcmV0dXJuIHRoaXMuaXNSZWFkeTsNCgl9LA0KDQoJLyoqDQoJICogSG9sZCB0aGUgPGI+U0dOVUlLaXQ8L2I+IHByZWxvYWRlciBldmVuIGFmdGVyICA8Yj5TR05VSUtpdDwvYj4gaGFzIGZpbmlzaGVkIGxvYWRpbmcgdGhlIGNvbXBvbmVudHMuDQoJICoNCgkgKiBAcGFyYW0ge2Jvb2xlYW59IGhvbGQgVGhlIHRoZSBzdGF0dXMgb2YgcmVhZGluZXNzIG9mIDxiPlNHTlVJS2l0PC9iPi4NCgkgKi8NCglzZXQgaG9sZFByZWxvYWRlcihob2xkKSB7DQoJCXRoaXMuaXNQcmVsb2FkZXJIZWxkID0gaG9sZDsNCgkJdGhpcy5vbkNoYW5nZUxpc3RlbmVyLmZvckVhY2goKGxpc3RlbmVyKSA9PiBsaXN0ZW5lcigiaG9sZFByZWxvYWRlciIsIHRoaXMuaXNQcmVsb2FkZXJIZWxkKSk7DQoJfSwNCg0KCS8qKg0KCSAqIEdldCB0aGUgc3RhdHVzIG9mIHJlYWRpbmVzcyBvZiA8Yj5TR05VSUtpdDwvYj4uDQoJICoNCgkgKiBAcmV0dXJuIHtib29sZWFufSA8Yj48aT5UUlVFPC9pPjwvYj4gaWYgPGI+U0dOVUlLaXQ8L2I+IGlzIHJlYWR5LCA8Yj48aT5GQUxTRTwvaT48L2I+IG90aGVyd2lzZS4NCgkgKi8NCglnZXQgaG9sZFByZWxvYWRlcigpIHsNCgkJcmV0dXJuIHRoaXMuaXNQcmVsb2FkZXJIZWxkOw0KCX0sDQoNCgkvKioNCgkgKiBTZXQgdGhlIGhhbmRsZXIgZm9yIDxiPlNHTlVJS2l0PC9iPiA8Yj48aT5PbkNoYW5nZTwvaT48L2I+IGV2ZW50LCB3aGljaCB3aWxsIGJlIHRyaWdnZXJlZCB3aGVuIGEgY29tcG9uZW50IGlzIGxvYWRlZC9yZW1vdmVkIG9yIHRoZSBzdGF0dXMgb2YgcmVhZGluZXNzIGlzIGNoYW5nZWQuDQoJICoNCgkgKiBAcGFyYW0ge1NHTlVJS2l0Q2hhbmdlQ2FsbGJhY2t9bGlzdGVuZXINCgkgKi8NCglzZXRPbkNoYW5nZUxpc3RlbmVyOiBmdW5jdGlvbihsaXN0ZW5lcikgew0KCQl0aGlzLm9uQ2hhbmdlTGlzdGVuZXIucHVzaChsaXN0ZW5lcik7DQoJfSwNCg0KCS8qKg0KCSAqIFNldCB0aGUgaGFuZGxlciBmb3IgPGI+U0dOVUlLaXQ8L2I+IDxiPjxpPk9uUmVhZHk8L2k+PC9iPiBldmVudCwgd2hpY2ggd2lsbCBiZSB0cmlnZ2VyZWQgd2hlbiB0aGUgPGI+U0dOVUlLaXQ8L2I+IGlzIHJlYWR5Lg0KCSAqDQoJICogQHBhcmFtIHtTR05VSUtpdFJlYWR5Q2FsbGJhY2t9bGlzdGVuZXINCgkgKi8NCglzZXRPblJlYWR5TGlzdGVuZXI6IGZ1bmN0aW9uKGxpc3RlbmVyKSB7DQoJCXRoaXMub25SZWFkeUxpc3RlbmVyLnB1c2gobGlzdGVuZXIpOw0KDQoJCWlmKHRoaXMucmVhZHkpDQoJCQl0aGlzLm9uUmVhZHlMaXN0ZW5lci5mb3JFYWNoKChsaXN0ZW5lcikgPT4gbGlzdGVuZXIodGhpcy5yZWFkeSkpOw0KCX0sDQp9Ow0Kd2luZG93LlNHTlVJS2l0ID0gU0dOVUlLaXQ7DQoNCmlmKHR5cGVvZiBqUXVlcnkgPT09ICd1bmRlZmluZWQnKSB7DQoJLyohIGpRdWVyeSB2My42LjMgfCAoYykgT3BlbkpTIEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycyB8IGpxdWVyeS5vcmcvbGljZW5zZSAqLw0KCSFmdW5jdGlvbihlLCB0KSB7DQoJCSJ1c2Ugc3RyaWN0IjsNCgkJIm9iamVjdCIgPT0gdHlwZW9mIG1vZHVsZSAmJiAib2JqZWN0IiA9PSB0eXBlb2YgbW9kdWxlLmV4cG9ydHMgPyBtb2R1bGUuZXhwb3J0cyA9IGUuZG9jdW1lbnQgPyB0KGUsICEwKSA6IGZ1bmN0aW9uKGUpIHsNCgkJCWlmKCFlLmRvY3VtZW50KSB0aHJvdyBuZXcgRXJyb3IoImpRdWVyeSByZXF1aXJlcyBhIHdpbmRvdyB3aXRoIGEgZG9jdW1lbnQiKTsNCgkJCXJldHVybiB0KGUpDQoJCX0gOiB0KGUpDQoJfSgidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ID8gd2luZG93IDogdGhpcywgZnVuY3Rpb24oQywgZSkgew0KCQkidXNlIHN0cmljdCI7DQoJCXZhciB0ID0gW10sDQoJCSAgICByID0gT2JqZWN0LmdldFByb3RvdHlwZU9mLA0KCQkgICAgcyA9IHQuc2xpY2UsDQoJCSAgICBnID0gdC5mbGF0ID8gZnVuY3Rpb24oZSkge3JldHVybiB0LmZsYXQuY2FsbChlKX0gOiBmdW5jdGlvbihlKSB7cmV0dXJuIHQuY29uY2F0LmFwcGx5KFtdLCBlKX0sDQoJCSAgICB1ID0gdC5wdXNoLA0KCQkgICAgaSA9IHQuaW5kZXhPZiwNCgkJICAgIG4gPSB7fSwNCgkJICAgIG8gPSBuLnRvU3RyaW5nLA0KCQkgICAgeSA9IG4uaGFzT3duUHJvcGVydHksDQoJCSAgICBhID0geS50b1N0cmluZywNCgkJICAgIGwgPSBhLmNhbGwoT2JqZWN0KSwNCgkJICAgIHYgPSB7fSwNCgkJICAgIG0gPSBmdW5jdGlvbihlKSB7cmV0dXJuICJmdW5jdGlvbiIgPT0gdHlwZW9mIGUgJiYgIm51bWJlciIgIT0gdHlwZW9mIGUubm9kZVR5cGUgJiYgImZ1bmN0aW9uIiAhPSB0eXBlb2YgZS5pdGVtfSwNCgkJICAgIHggPSBmdW5jdGlvbihlKSB7cmV0dXJuIG51bGwgIT0gZSAmJiBlID09PSBlLndpbmRvd30sDQoJCSAgICBTID0gQy5kb2N1bWVudCwNCgkJICAgIGMgPSB7dHlwZTogITAsIHNyYzogITAsIG5vbmNlOiAhMCwgbm9Nb2R1bGU6ICEwfTsNCg0KCQlmdW5jdGlvbiBiKGUsIHQsIG4pIHsNCgkJCXZhciByLCBpLCBvID0gKG4gPSBuIHx8IFMpLmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOw0KCQkJaWYoby50ZXh0ID0gZSwgdCkgZm9yKHIgaW4gYykgKGkgPSB0W3JdIHx8IHQuZ2V0QXR0cmlidXRlICYmIHQuZ2V0QXR0cmlidXRlKHIpKSAmJiBvLnNldEF0dHJpYnV0ZShyLCBpKTsNCgkJCW4uaGVhZC5hcHBlbmRDaGlsZChvKS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG8pDQoJCX0NCg0KCQlmdW5jdGlvbiB3KGUpIHtyZXR1cm4gbnVsbCA9PSBlID8gZSArICIiIDogIm9iamVjdCIgPT0gdHlwZW9mIGUgfHwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgZSA/IG5bby5jYWxsKGUpXSB8fCAib2JqZWN0IiA6IHR5cGVvZiBlfQ0KDQoJCXZhciBmID0gIjMuNi4zIiwgRSA9IGZ1bmN0aW9uKGUsIHQpIHtyZXR1cm4gbmV3IEUuZm4uaW5pdChlLCB0KX07DQoNCgkJZnVuY3Rpb24gcChlKSB7DQoJCQl2YXIgdCA9ICEhZSAmJiAibGVuZ3RoIiBpbiBlICYmIGUubGVuZ3RoLCBuID0gdyhlKTsNCgkJCXJldHVybiAhbShlKSAmJiAheChlKSAmJiAoImFycmF5IiA9PT0gbiB8fCAwID09PSB0IHx8ICJudW1iZXIiID09IHR5cGVvZiB0ICYmIDAgPCB0ICYmIHQgLSAxIGluIGUpDQoJCX0NCg0KCQlFLmZuID0gRS5wcm90b3R5cGUgPSB7DQoJCQlqcXVlcnk6IGYsDQoJCQljb25zdHJ1Y3RvcjogRSwNCgkJCWxlbmd0aDogMCwNCgkJCXRvQXJyYXk6IGZ1bmN0aW9uKCkge3JldHVybiBzLmNhbGwodGhpcyl9LA0KCQkJZ2V0OiBmdW5jdGlvbihlKSB7cmV0dXJuIG51bGwgPT0gZSA/IHMuY2FsbCh0aGlzKSA6IGUgPCAwID8gdGhpc1tlICsgdGhpcy5sZW5ndGhdIDogdGhpc1tlXX0sDQoJCQlwdXNoU3RhY2s6IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCA9IEUubWVyZ2UodGhpcy5jb25zdHJ1Y3RvcigpLCBlKTsNCgkJCQlyZXR1cm4gdC5wcmV2T2JqZWN0ID0gdGhpcywgdA0KCQkJfSwNCgkJCWVhY2g6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gRS5lYWNoKHRoaXMsIGUpfSwNCgkJCW1hcDogZnVuY3Rpb24obikge3JldHVybiB0aGlzLnB1c2hTdGFjayhFLm1hcCh0aGlzLCBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIG4uY2FsbChlLCB0LCBlKX0pKX0sDQoJCQlzbGljZTogZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMucHVzaFN0YWNrKHMuYXBwbHkodGhpcywgYXJndW1lbnRzKSl9LA0KCQkJZmlyc3Q6IGZ1bmN0aW9uKCkge3JldHVybiB0aGlzLmVxKDApfSwNCgkJCWxhc3Q6IGZ1bmN0aW9uKCkge3JldHVybiB0aGlzLmVxKC0xKX0sDQoJCQlldmVuOiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5wdXNoU3RhY2soRS5ncmVwKHRoaXMsIGZ1bmN0aW9uKGUsIHQpIHtyZXR1cm4gKHQgKyAxKSAlIDJ9KSl9LA0KCQkJb2RkOiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5wdXNoU3RhY2soRS5ncmVwKHRoaXMsIGZ1bmN0aW9uKGUsIHQpIHtyZXR1cm4gdCAlIDJ9KSl9LA0KCQkJZXE6IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCA9IHRoaXMubGVuZ3RoLCBuID0gK2UgKyAoZSA8IDAgPyB0IDogMCk7DQoJCQkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKDAgPD0gbiAmJiBuIDwgdCA/IFt0aGlzW25dXSA6IFtdKQ0KCQkJfSwNCgkJCWVuZDogZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMucHJldk9iamVjdCB8fCB0aGlzLmNvbnN0cnVjdG9yKCl9LA0KCQkJcHVzaDogdSwNCgkJCXNvcnQ6IHQuc29ydCwNCgkJCXNwbGljZTogdC5zcGxpY2UNCgkJfSwgRS5leHRlbmQgPSBFLmZuLmV4dGVuZCA9IGZ1bmN0aW9uKCkgew0KCQkJdmFyIGUsIHQsIG4sIHIsIGksIG8sIGEgPSBhcmd1bWVudHNbMF0gfHwge30sIHMgPSAxLCB1ID0gYXJndW1lbnRzLmxlbmd0aCwgbCA9ICExOw0KCQkJZm9yKCJib29sZWFuIiA9PSB0eXBlb2YgYSAmJiAobCA9IGEsIGEgPSBhcmd1bWVudHNbc10gfHwge30sIHMrKyksICJvYmplY3QiID09IHR5cGVvZiBhIHx8IG0oYSkgfHwgKGEgPSB7fSksIHMgPT09IHUgJiYgKGEgPSB0aGlzLCBzLS0pOyBzIDwgdTsgcysrKSBpZihudWxsICE9IChlID0gYXJndW1lbnRzW3NdKSkgZm9yKHQgaW4gZSkgciA9IGVbdF0sICJfX3Byb3RvX18iICE9PSB0ICYmIGEgIT09IHIgJiYgKGwgJiYgciAmJiAoRS5pc1BsYWluT2JqZWN0KHIpIHx8IChpID0gQXJyYXkuaXNBcnJheShyKSkpID8gKG4gPSBhW3RdLCBvID0gaSAmJiAhQXJyYXkuaXNBcnJheShuKSA/IFtdIDogaSB8fCBFLmlzUGxhaW5PYmplY3QobikgPyBuIDoge30sIGkgPSAhMSwgYVt0XSA9IEUuZXh0ZW5kKGwsIG8sIHIpKSA6IHZvaWQgMCAhPT0gciAmJiAoYVt0XSA9IHIpKTsNCgkJCXJldHVybiBhDQoJCX0sIEUuZXh0ZW5kKHsNCgkJCWV4cGFuZG86ICJqUXVlcnkiICsgKGYgKyBNYXRoLnJhbmRvbSgpKS5yZXBsYWNlKC9cRC9nLCAiIiksIGlzUmVhZHk6ICEwLCBlcnJvcjogZnVuY3Rpb24oZSkge3Rocm93IG5ldyBFcnJvcihlKX0sIG5vb3A6IGZ1bmN0aW9uKCkge30sIGlzUGxhaW5PYmplY3Q6IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCwgbjsNCgkJCQlyZXR1cm4gISghZSB8fCAiW29iamVjdCBPYmplY3RdIiAhPT0gby5jYWxsKGUpKSAmJiAoISh0ID0gcihlKSkgfHwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgKG4gPSB5LmNhbGwodCwgImNvbnN0cnVjdG9yIikgJiYgdC5jb25zdHJ1Y3RvcikgJiYgYS5jYWxsKG4pID09PSBsKQ0KCQkJfSwgaXNFbXB0eU9iamVjdDogZnVuY3Rpb24oZSkgew0KCQkJCXZhciB0Ow0KCQkJCWZvcih0IGluIGUpIHJldHVybiAhMTsNCgkJCQlyZXR1cm4gITANCgkJCX0sIGdsb2JhbEV2YWw6IGZ1bmN0aW9uKGUsIHQsIG4pIHtiKGUsIHtub25jZTogdCAmJiB0Lm5vbmNlfSwgbil9LCBlYWNoOiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4sIHIgPSAwOw0KCQkJCWlmKHAoZSkpIHtmb3IobiA9IGUubGVuZ3RoOyByIDwgbjsgcisrKSBpZighMSA9PT0gdC5jYWxsKGVbcl0sIHIsIGVbcl0pKSBicmVha30gZWxzZSBmb3IociBpbiBlKSBpZighMSA9PT0gdC5jYWxsKGVbcl0sIHIsIGVbcl0pKSBicmVhazsNCgkJCQlyZXR1cm4gZQ0KCQkJfSwgbWFrZUFycmF5OiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4gPSB0IHx8IFtdOw0KCQkJCXJldHVybiBudWxsICE9IGUgJiYgKHAoT2JqZWN0KGUpKSA/IEUubWVyZ2UobiwgInN0cmluZyIgPT0gdHlwZW9mIGUgPyBbZV0gOiBlKSA6IHUuY2FsbChuLCBlKSksIG4NCgkJCX0sIGluQXJyYXk6IGZ1bmN0aW9uKGUsIHQsIG4pIHtyZXR1cm4gbnVsbCA9PSB0ID8gLTEgOiBpLmNhbGwodCwgZSwgbil9LCBtZXJnZTogZnVuY3Rpb24oZSwgdCkgew0KCQkJCWZvcih2YXIgbiA9ICt0Lmxlbmd0aCwgciA9IDAsIGkgPSBlLmxlbmd0aDsgciA8IG47IHIrKykgZVtpKytdID0gdFtyXTsNCgkJCQlyZXR1cm4gZS5sZW5ndGggPSBpLCBlDQoJCQl9LCBncmVwOiBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJZm9yKHZhciByID0gW10sIGkgPSAwLCBvID0gZS5sZW5ndGgsIGEgPSAhbjsgaSA8IG87IGkrKykgIXQoZVtpXSwgaSkgIT09IGEgJiYgci5wdXNoKGVbaV0pOw0KCQkJCXJldHVybiByDQoJCQl9LCBtYXA6IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQl2YXIgciwgaSwgbyA9IDAsIGEgPSBbXTsNCgkJCQlpZihwKGUpKSBmb3IociA9IGUubGVuZ3RoOyBvIDwgcjsgbysrKSBudWxsICE9IChpID0gdChlW29dLCBvLCBuKSkgJiYgYS5wdXNoKGkpOyBlbHNlIGZvcihvIGluIGUpIG51bGwgIT0gKGkgPSB0KGVbb10sIG8sIG4pKSAmJiBhLnB1c2goaSk7DQoJCQkJcmV0dXJuIGcoYSkNCgkJCX0sIGd1aWQ6IDEsIHN1cHBvcnQ6IHYNCgkJfSksICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiAoRS5mbltTeW1ib2wuaXRlcmF0b3JdID0gdFtTeW1ib2wuaXRlcmF0b3JdKSwgRS5lYWNoKCJCb29sZWFuIE51bWJlciBTdHJpbmcgRnVuY3Rpb24gQXJyYXkgRGF0ZSBSZWdFeHAgT2JqZWN0IEVycm9yIFN5bWJvbCIuc3BsaXQoIiAiKSwgZnVuY3Rpb24oZSwgdCkge25bIltvYmplY3QgIiArIHQgKyAiXSJdID0gdC50b0xvd2VyQ2FzZSgpfSk7DQoJCXZhciBkID0gZnVuY3Rpb24obikgew0KCQkJdmFyIGUsDQoJCQkgICAgZCwNCgkJCSAgICBiLA0KCQkJICAgIG8sDQoJCQkgICAgaSwNCgkJCSAgICBoLA0KCQkJICAgIGYsDQoJCQkgICAgZywNCgkJCSAgICB3LA0KCQkJICAgIHUsDQoJCQkgICAgbCwNCgkJCSAgICBULA0KCQkJICAgIEMsDQoJCQkgICAgYSwNCgkJCSAgICBTLA0KCQkJICAgIHksDQoJCQkgICAgcywNCgkJCSAgICBjLA0KCQkJICAgIHYsDQoJCQkgICAgRSA9ICJzaXp6bGUiICsgMSAqIG5ldyBEYXRlLA0KCQkJICAgIHAgPSBuLmRvY3VtZW50LA0KCQkJICAgIGsgPSAwLA0KCQkJICAgIHIgPSAwLA0KCQkJICAgIG0gPSB1ZSgpLA0KCQkJICAgIHggPSB1ZSgpLA0KCQkJICAgIEEgPSB1ZSgpLA0KCQkJICAgIE4gPSB1ZSgpLA0KCQkJICAgIGogPSBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIGUgPT09IHQgJiYgKGwgPSAhMCksIDB9LA0KCQkJICAgIEQgPSB7fS5oYXNPd25Qcm9wZXJ0eSwNCgkJCSAgICB0ID0gW10sDQoJCQkgICAgcSA9IHQucG9wLA0KCQkJICAgIEwgPSB0LnB1c2gsDQoJCQkgICAgSCA9IHQucHVzaCwNCgkJCSAgICBPID0gdC5zbGljZSwNCgkJCSAgICBQID0gZnVuY3Rpb24oZSwgdCkgew0KCQkJCSAgICBmb3IodmFyIG4gPSAwLCByID0gZS5sZW5ndGg7IG4gPCByOyBuKyspIGlmKGVbbl0gPT09IHQpIHJldHVybiBuOw0KCQkJCSAgICByZXR1cm4gLTENCgkJCSAgICB9LA0KCQkJICAgIFIgPSAiY2hlY2tlZHxzZWxlY3RlZHxhc3luY3xhdXRvZm9jdXN8YXV0b3BsYXl8Y29udHJvbHN8ZGVmZXJ8ZGlzYWJsZWR8aGlkZGVufGlzbWFwfGxvb3B8bXVsdGlwbGV8b3BlbnxyZWFkb25seXxyZXF1aXJlZHxzY29wZWQiLA0KCQkJICAgIE0gPSAiW1xceDIwXFx0XFxyXFxuXFxmXSIsDQoJCQkgICAgSSA9ICIoPzpcXFxcW1xcZGEtZkEtRl17MSw2fSIgKyBNICsgIj98XFxcXFteXFxyXFxuXFxmXXxbXFx3LV18W15cMC1cXHg3Zl0pKyIsDQoJCQkgICAgVyA9ICJcXFsiICsgTSArICIqKCIgKyBJICsgIikoPzoiICsgTSArICIqKFsqXiR8IX5dPz0pIiArIE0gKyAiKig/OicoKD86XFxcXC58W15cXFxcJ10pKiknfFwiKCg/OlxcXFwufFteXFxcXFwiXSkqKVwifCgiICsgSSArICIpKXwpIiArIE0gKyAiKlxcXSIsDQoJCQkgICAgRiA9ICI6KCIgKyBJICsgIikoPzpcXCgoKCcoKD86XFxcXC58W15cXFxcJ10pKiknfFwiKCg/OlxcXFwufFteXFxcXFwiXSkqKVwiKXwoKD86XFxcXC58W15cXFxcKClbXFxdXXwiICsgVyArICIpKil8LiopXFwpfCkiLA0KCQkJICAgICQgPSBuZXcgUmVnRXhwKE0gKyAiKyIsICJnIiksDQoJCQkgICAgQiA9IG5ldyBSZWdFeHAoIl4iICsgTSArICIrfCgoPzpefFteXFxcXF0pKD86XFxcXC4pKikiICsgTSArICIrJCIsICJnIiksDQoJCQkgICAgXyA9IG5ldyBSZWdFeHAoIl4iICsgTSArICIqLCIgKyBNICsgIioiKSwNCgkJCSAgICB6ID0gbmV3IFJlZ0V4cCgiXiIgKyBNICsgIiooWz4rfl18IiArIE0gKyAiKSIgKyBNICsgIioiKSwNCgkJCSAgICBVID0gbmV3IFJlZ0V4cChNICsgInw+IiksDQoJCQkgICAgWCA9IG5ldyBSZWdFeHAoRiksDQoJCQkgICAgViA9IG5ldyBSZWdFeHAoIl4iICsgSSArICIkIiksDQoJCQkgICAgRyA9IHsNCgkJCQkgICAgSUQ6IG5ldyBSZWdFeHAoIl4jKCIgKyBJICsgIikiKSwNCgkJCQkgICAgQ0xBU1M6IG5ldyBSZWdFeHAoIl5cXC4oIiArIEkgKyAiKSIpLA0KCQkJCSAgICBUQUc6IG5ldyBSZWdFeHAoIl4oIiArIEkgKyAifFsqXSkiKSwNCgkJCQkgICAgQVRUUjogbmV3IFJlZ0V4cCgiXiIgKyBXKSwNCgkJCQkgICAgUFNFVURPOiBuZXcgUmVnRXhwKCJeIiArIEYpLA0KCQkJCSAgICBDSElMRDogbmV3IFJlZ0V4cCgiXjoob25seXxmaXJzdHxsYXN0fG50aHxudGgtbGFzdCktKGNoaWxkfG9mLXR5cGUpKD86XFwoIiArIE0gKyAiKihldmVufG9kZHwoKFsrLV18KShcXGQqKW58KSIgKyBNICsgIiooPzooWystXXwpIiArIE0gKyAiKihcXGQrKXwpKSIgKyBNICsgIipcXCl8KSIsICJpIiksDQoJCQkJICAgIGJvb2w6IG5ldyBSZWdFeHAoIl4oPzoiICsgUiArICIpJCIsICJpIiksDQoJCQkJICAgIG5lZWRzQ29udGV4dDogbmV3IFJlZ0V4cCgiXiIgKyBNICsgIipbPit+XXw6KGV2ZW58b2RkfGVxfGd0fGx0fG50aHxmaXJzdHxsYXN0KSg/OlxcKCIgKyBNICsgIiooKD86LVxcZCk/XFxkKikiICsgTSArICIqXFwpfCkoPz1bXi1dfCQpIiwgImkiKQ0KCQkJICAgIH0sDQoJCQkgICAgWSA9IC9IVE1MJC9pLA0KCQkJICAgIFEgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b24pJC9pLA0KCQkJICAgIEogPSAvXmhcZCQvaSwNCgkJCSAgICBLID0gL15bXntdK1x7XHMqXFtuYXRpdmUgXHcvLA0KCQkJICAgIFogPSAvXig/OiMoW1x3LV0rKXwoXHcrKXxcLihbXHctXSspKSQvLA0KCQkJICAgIGVlID0gL1srfl0vLA0KCQkJICAgIHRlID0gbmV3IFJlZ0V4cCgiXFxcXFtcXGRhLWZBLUZdezEsNn0iICsgTSArICI/fFxcXFwoW15cXHJcXG5cXGZdKSIsICJnIiksDQoJCQkgICAgbmUgPSBmdW5jdGlvbihlLCB0KSB7DQoJCQkJICAgIHZhciBuID0gIjB4IiArIGUuc2xpY2UoMSkgLSA2NTUzNjsNCgkJCQkgICAgcmV0dXJuIHQgfHwgKG4gPCAwID8gU3RyaW5nLmZyb21DaGFyQ29kZShuICsgNjU1MzYpIDogU3RyaW5nLmZyb21DaGFyQ29kZShuID4+IDEwIHwgNTUyOTYsIDEwMjMgJiBuIHwgNTYzMjApKQ0KCQkJICAgIH0sDQoJCQkgICAgcmUgPSAvKFtcMC1ceDFmXHg3Zl18Xi0/XGQpfF4tJHxbXlwwLVx4MWZceDdmLVx1RkZGRlx3LV0vZywNCgkJCSAgICBpZSA9IGZ1bmN0aW9uKGUsIHQpIHtyZXR1cm4gdCA/ICJcMCIgPT09IGUgPyAiXHVmZmZkIiA6IGUuc2xpY2UoMCwgLTEpICsgIlxcIiArIGUuY2hhckNvZGVBdChlLmxlbmd0aCAtIDEpLnRvU3RyaW5nKDE2KSArICIgIiA6ICJcXCIgKyBlfSwNCgkJCSAgICBvZSA9IGZ1bmN0aW9uKCkge1QoKX0sDQoJCQkgICAgYWUgPSBiZShmdW5jdGlvbihlKSB7cmV0dXJuICEwID09PSBlLmRpc2FibGVkICYmICJmaWVsZHNldCIgPT09IGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKX0sIHtkaXI6ICJwYXJlbnROb2RlIiwgbmV4dDogImxlZ2VuZCJ9KTsNCgkJCXRyeSB7SC5hcHBseSh0ID0gTy5jYWxsKHAuY2hpbGROb2RlcyksIHAuY2hpbGROb2RlcyksIHRbcC5jaGlsZE5vZGVzLmxlbmd0aF0ubm9kZVR5cGV9IGNhdGNoKGUpIHsNCgkJCQlIID0gew0KCQkJCQlhcHBseTogdC5sZW5ndGggPyBmdW5jdGlvbihlLCB0KSB7TC5hcHBseShlLCBPLmNhbGwodCkpfSA6IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJCXZhciBuID0gZS5sZW5ndGgsIHIgPSAwOw0KCQkJCQkJd2hpbGUoZVtuKytdID0gdFtyKytdKSA7DQoJCQkJCQllLmxlbmd0aCA9IG4gLSAxDQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHNlKHQsIGUsIG4sIHIpIHsNCgkJCQl2YXIgaSwgbywgYSwgcywgdSwgbCwgYywgZiA9IGUgJiYgZS5vd25lckRvY3VtZW50LCBwID0gZSA/IGUubm9kZVR5cGUgOiA5Ow0KCQkJCWlmKG4gPSBuIHx8IFtdLCAic3RyaW5nIiAhPSB0eXBlb2YgdCB8fCAhdCB8fCAxICE9PSBwICYmIDkgIT09IHAgJiYgMTEgIT09IHApIHJldHVybiBuOw0KCQkJCWlmKCFyICYmIChUKGUpLCBlID0gZSB8fCBDLCBTKSkgew0KCQkJCQlpZigxMSAhPT0gcCAmJiAodSA9IFouZXhlYyh0KSkpIGlmKGkgPSB1WzFdKSB7DQoJCQkJCQlpZig5ID09PSBwKSB7DQoJCQkJCQkJaWYoIShhID0gZS5nZXRFbGVtZW50QnlJZChpKSkpIHJldHVybiBuOw0KCQkJCQkJCWlmKGEuaWQgPT09IGkpIHJldHVybiBuLnB1c2goYSksIG4NCgkJCQkJCX0gZWxzZSBpZihmICYmIChhID0gZi5nZXRFbGVtZW50QnlJZChpKSkgJiYgdihlLCBhKSAmJiBhLmlkID09PSBpKSByZXR1cm4gbi5wdXNoKGEpLCBuDQoJCQkJCX0gZWxzZSB7DQoJCQkJCQlpZih1WzJdKSByZXR1cm4gSC5hcHBseShuLCBlLmdldEVsZW1lbnRzQnlUYWdOYW1lKHQpKSwgbjsNCgkJCQkJCWlmKChpID0gdVszXSkgJiYgZC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICYmIGUuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSkgcmV0dXJuIEguYXBwbHkobiwgZS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGkpKSwgbg0KCQkJCQl9DQoJCQkJCWlmKGQucXNhICYmICFOW3QgKyAiICJdICYmICgheSB8fCAheS50ZXN0KHQpKSAmJiAoMSAhPT0gcCB8fCAib2JqZWN0IiAhPT0gZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKSkgew0KCQkJCQkJaWYoYyA9IHQsIGYgPSBlLCAxID09PSBwICYmIChVLnRlc3QodCkgfHwgei50ZXN0KHQpKSkgew0KCQkJCQkJCShmID0gZWUudGVzdCh0KSAmJiB2ZShlLnBhcmVudE5vZGUpIHx8IGUpID09PSBlICYmIGQuc2NvcGUgfHwgKChzID0gZS5nZXRBdHRyaWJ1dGUoImlkIikpID8gcyA9IHMucmVwbGFjZShyZSwgaWUpIDogZS5zZXRBdHRyaWJ1dGUoImlkIiwgcyA9IEUpKSwgbyA9IChsID0gaCh0KSkubGVuZ3RoOw0KCQkJCQkJCXdoaWxlKG8tLSkgbFtvXSA9IChzID8gIiMiICsgcyA6ICI6c2NvcGUiKSArICIgIiArIHhlKGxbb10pOw0KCQkJCQkJCWMgPSBsLmpvaW4oIiwiKQ0KCQkJCQkJfQ0KCQkJCQkJdHJ5IHsNCgkJCQkJCQlpZihkLmNzc1N1cHBvcnRzU2VsZWN0b3IgJiYgIUNTUy5zdXBwb3J0cygic2VsZWN0b3IoOmlzKCIgKyBjICsgIikpIikpIHRocm93IG5ldyBFcnJvcjsNCgkJCQkJCQlyZXR1cm4gSC5hcHBseShuLCBmLnF1ZXJ5U2VsZWN0b3JBbGwoYykpLCBuDQoJCQkJCQl9IGNhdGNoKGUpIHtOKHQsICEwKX0gZmluYWxseSB7cyA9PT0gRSAmJiBlLnJlbW92ZUF0dHJpYnV0ZSgiaWQiKX0NCgkJCQkJfQ0KCQkJCX0NCgkJCQlyZXR1cm4gZyh0LnJlcGxhY2UoQiwgIiQxIiksIGUsIG4sIHIpDQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHVlKCkgew0KCQkJCXZhciByID0gW107DQoJCQkJcmV0dXJuIGZ1bmN0aW9uIGUodCwgbikge3JldHVybiByLnB1c2godCArICIgIikgPiBiLmNhY2hlTGVuZ3RoICYmIGRlbGV0ZSBlW3Iuc2hpZnQoKV0sIGVbdCArICIgIl0gPSBufQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBsZShlKSB7cmV0dXJuIGVbRV0gPSAhMCwgZX0NCg0KCQkJZnVuY3Rpb24gY2UoZSkgew0KCQkJCXZhciB0ID0gQy5jcmVhdGVFbGVtZW50KCJmaWVsZHNldCIpOw0KCQkJCXRyeSB7cmV0dXJuICEhZSh0KX0gY2F0Y2goZSkge3JldHVybiAhMX0gZmluYWxseSB7dC5wYXJlbnROb2RlICYmIHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0KSwgdCA9IG51bGx9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGZlKGUsIHQpIHsNCgkJCQl2YXIgbiA9IGUuc3BsaXQoInwiKSwgciA9IG4ubGVuZ3RoOw0KCQkJCXdoaWxlKHItLSkgYi5hdHRySGFuZGxlW25bcl1dID0gdA0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBwZShlLCB0KSB7DQoJCQkJdmFyIG4gPSB0ICYmIGUsIHIgPSBuICYmIDEgPT09IGUubm9kZVR5cGUgJiYgMSA9PT0gdC5ub2RlVHlwZSAmJiBlLnNvdXJjZUluZGV4IC0gdC5zb3VyY2VJbmRleDsNCgkJCQlpZihyKSByZXR1cm4gcjsNCgkJCQlpZihuKSB3aGlsZShuID0gbi5uZXh0U2libGluZykgaWYobiA9PT0gdCkgcmV0dXJuIC0xOw0KCQkJCXJldHVybiBlID8gMSA6IC0xDQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGRlKHQpIHtyZXR1cm4gZnVuY3Rpb24oZSkge3JldHVybiAiaW5wdXQiID09PSBlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgJiYgZS50eXBlID09PSB0fX0NCg0KCQkJZnVuY3Rpb24gaGUobikgew0KCQkJCXJldHVybiBmdW5jdGlvbihlKSB7DQoJCQkJCXZhciB0ID0gZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOw0KCQkJCQlyZXR1cm4gKCJpbnB1dCIgPT09IHQgfHwgImJ1dHRvbiIgPT09IHQpICYmIGUudHlwZSA9PT0gbg0KCQkJCX0NCgkJCX0NCg0KCQkJZnVuY3Rpb24gZ2UodCkge3JldHVybiBmdW5jdGlvbihlKSB7cmV0dXJuICJmb3JtIiBpbiBlID8gZS5wYXJlbnROb2RlICYmICExID09PSBlLmRpc2FibGVkID8gImxhYmVsIiBpbiBlID8gImxhYmVsIiBpbiBlLnBhcmVudE5vZGUgPyBlLnBhcmVudE5vZGUuZGlzYWJsZWQgPT09IHQgOiBlLmRpc2FibGVkID09PSB0IDogZS5pc0Rpc2FibGVkID09PSB0IHx8IGUuaXNEaXNhYmxlZCAhPT0gIXQgJiYgYWUoZSkgPT09IHQgOiBlLmRpc2FibGVkID09PSB0IDogImxhYmVsIiBpbiBlICYmIGUuZGlzYWJsZWQgPT09IHR9fQ0KDQoJCQlmdW5jdGlvbiB5ZShhKSB7DQoJCQkJcmV0dXJuIGxlKGZ1bmN0aW9uKG8pIHsNCgkJCQkJcmV0dXJuIG8gPSArbywgbGUoZnVuY3Rpb24oZSwgdCkgew0KCQkJCQkJdmFyIG4sIHIgPSBhKFtdLCBlLmxlbmd0aCwgbyksIGkgPSByLmxlbmd0aDsNCgkJCQkJCXdoaWxlKGktLSkgZVtuID0gcltpXV0gJiYgKGVbbl0gPSAhKHRbbl0gPSBlW25dKSkNCgkJCQkJfSkNCgkJCQl9KQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiB2ZShlKSB7cmV0dXJuIGUgJiYgInVuZGVmaW5lZCIgIT0gdHlwZW9mIGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUgJiYgZX0NCg0KCQkJZm9yKGUgaW4gZCA9IHNlLnN1cHBvcnQgPSB7fSwgaSA9IHNlLmlzWE1MID0gZnVuY3Rpb24oZSkgew0KCQkJCXZhciB0ID0gZSAmJiBlLm5hbWVzcGFjZVVSSSwgbiA9IGUgJiYgKGUub3duZXJEb2N1bWVudCB8fCBlKS5kb2N1bWVudEVsZW1lbnQ7DQoJCQkJcmV0dXJuICFZLnRlc3QodCB8fCBuICYmIG4ubm9kZU5hbWUgfHwgIkhUTUwiKQ0KCQkJfSwgVCA9IHNlLnNldERvY3VtZW50ID0gZnVuY3Rpb24oZSkgew0KCQkJCXZhciB0LCBuLCByID0gZSA/IGUub3duZXJEb2N1bWVudCB8fCBlIDogcDsNCgkJCQlyZXR1cm4gciAhPSBDICYmIDkgPT09IHIubm9kZVR5cGUgJiYgci5kb2N1bWVudEVsZW1lbnQgJiYgKGEgPSAoQyA9IHIpLmRvY3VtZW50RWxlbWVudCwgUyA9ICFpKEMpLCBwICE9IEMgJiYgKG4gPSBDLmRlZmF1bHRWaWV3KSAmJiBuLnRvcCAhPT0gbiAmJiAobi5hZGRFdmVudExpc3RlbmVyID8gbi5hZGRFdmVudExpc3RlbmVyKCJ1bmxvYWQiLCBvZSwgITEpIDogbi5hdHRhY2hFdmVudCAmJiBuLmF0dGFjaEV2ZW50KCJvbnVubG9hZCIsIG9lKSksIGQuc2NvcGUgPSBjZShmdW5jdGlvbihlKSB7cmV0dXJuIGEuYXBwZW5kQ2hpbGQoZSkuYXBwZW5kQ2hpbGQoQy5jcmVhdGVFbGVtZW50KCJkaXYiKSksICJ1bmRlZmluZWQiICE9IHR5cGVvZiBlLnF1ZXJ5U2VsZWN0b3JBbGwgJiYgIWUucXVlcnlTZWxlY3RvckFsbCgiOnNjb3BlIGZpZWxkc2V0IGRpdiIpLmxlbmd0aH0pLCBkLmNzc1N1cHBvcnRzU2VsZWN0b3IgPSBjZShmdW5jdGlvbigpIHtyZXR1cm4gQ1NTLnN1cHBvcnRzKCJzZWxlY3RvcigqKSIpICYmIEMucXVlcnlTZWxlY3RvckFsbCgiOmlzKDpqcWZha2UpIikgJiYgIUNTUy5zdXBwb3J0cygic2VsZWN0b3IoOmlzKCosOmpxZmFrZSkpIil9KSwgZC5hdHRyaWJ1dGVzID0gY2UoZnVuY3Rpb24oZSkge3JldHVybiBlLmNsYXNzTmFtZSA9ICJpIiwgIWUuZ2V0QXR0cmlidXRlKCJjbGFzc05hbWUiKX0pLCBkLmdldEVsZW1lbnRzQnlUYWdOYW1lID0gY2UoZnVuY3Rpb24oZSkge3JldHVybiBlLmFwcGVuZENoaWxkKEMuY3JlYXRlQ29tbWVudCgiIikpLCAhZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLmxlbmd0aH0pLCBkLmdldEVsZW1lbnRzQnlDbGFzc05hbWUgPSBLLnRlc3QoQy5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKSwgZC5nZXRCeUlkID0gY2UoZnVuY3Rpb24oZSkge3JldHVybiBhLmFwcGVuZENoaWxkKGUpLmlkID0gRSwgIUMuZ2V0RWxlbWVudHNCeU5hbWUgfHwgIUMuZ2V0RWxlbWVudHNCeU5hbWUoRSkubGVuZ3RofSksIGQuZ2V0QnlJZCA/IChiLmZpbHRlci5JRCA9IGZ1bmN0aW9uKGUpIHsNCgkJCQkJdmFyIHQgPSBlLnJlcGxhY2UodGUsIG5lKTsNCgkJCQkJcmV0dXJuIGZ1bmN0aW9uKGUpIHtyZXR1cm4gZS5nZXRBdHRyaWJ1dGUoImlkIikgPT09IHR9DQoJCQkJfSwgYi5maW5kLklEID0gZnVuY3Rpb24oZSwgdCkgew0KCQkJCQlpZigidW5kZWZpbmVkIiAhPSB0eXBlb2YgdC5nZXRFbGVtZW50QnlJZCAmJiBTKSB7DQoJCQkJCQl2YXIgbiA9IHQuZ2V0RWxlbWVudEJ5SWQoZSk7DQoJCQkJCQlyZXR1cm4gbiA/IFtuXSA6IFtdDQoJCQkJCX0NCgkJCQl9KSA6IChiLmZpbHRlci5JRCA9IGZ1bmN0aW9uKGUpIHsNCgkJCQkJdmFyIG4gPSBlLnJlcGxhY2UodGUsIG5lKTsNCgkJCQkJcmV0dXJuIGZ1bmN0aW9uKGUpIHsNCgkJCQkJCXZhciB0ID0gInVuZGVmaW5lZCIgIT0gdHlwZW9mIGUuZ2V0QXR0cmlidXRlTm9kZSAmJiBlLmdldEF0dHJpYnV0ZU5vZGUoImlkIik7DQoJCQkJCQlyZXR1cm4gdCAmJiB0LnZhbHVlID09PSBuDQoJCQkJCX0NCgkJCQl9LCBiLmZpbmQuSUQgPSBmdW5jdGlvbihlLCB0KSB7DQoJCQkJCWlmKCJ1bmRlZmluZWQiICE9IHR5cGVvZiB0LmdldEVsZW1lbnRCeUlkICYmIFMpIHsNCgkJCQkJCXZhciBuLCByLCBpLCBvID0gdC5nZXRFbGVtZW50QnlJZChlKTsNCgkJCQkJCWlmKG8pIHsNCgkJCQkJCQlpZigobiA9IG8uZ2V0QXR0cmlidXRlTm9kZSgiaWQiKSkgJiYgbi52YWx1ZSA9PT0gZSkgcmV0dXJuIFtvXTsNCgkJCQkJCQlpID0gdC5nZXRFbGVtZW50c0J5TmFtZShlKSwgciA9IDA7DQoJCQkJCQkJd2hpbGUobyA9IGlbcisrXSkgaWYoKG4gPSBvLmdldEF0dHJpYnV0ZU5vZGUoImlkIikpICYmIG4udmFsdWUgPT09IGUpIHJldHVybiBbb10NCgkJCQkJCX0NCgkJCQkJCXJldHVybiBbXQ0KCQkJCQl9DQoJCQkJfSksIGIuZmluZC5UQUcgPSBkLmdldEVsZW1lbnRzQnlUYWdOYW1lID8gZnVuY3Rpb24oZSwgdCkge3JldHVybiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgdC5nZXRFbGVtZW50c0J5VGFnTmFtZSA/IHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoZSkgOiBkLnFzYSA/IHQucXVlcnlTZWxlY3RvckFsbChlKSA6IHZvaWQgMH0gOiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJCXZhciBuLCByID0gW10sIGkgPSAwLCBvID0gdC5nZXRFbGVtZW50c0J5VGFnTmFtZShlKTsNCgkJCQkJaWYoIioiID09PSBlKSB7DQoJCQkJCQl3aGlsZShuID0gb1tpKytdKSAxID09PSBuLm5vZGVUeXBlICYmIHIucHVzaChuKTsNCgkJCQkJCXJldHVybiByDQoJCQkJCX0NCgkJCQkJcmV0dXJuIG8NCgkJCQl9LCBiLmZpbmQuQ0xBU1MgPSBkLmdldEVsZW1lbnRzQnlDbGFzc05hbWUgJiYgZnVuY3Rpb24oZSwgdCkge2lmKCJ1bmRlZmluZWQiICE9IHR5cGVvZiB0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgJiYgUykgcmV0dXJuIHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShlKX0sIHMgPSBbXSwgeSA9IFtdLCAoZC5xc2EgPSBLLnRlc3QoQy5xdWVyeVNlbGVjdG9yQWxsKSkgJiYgKGNlKGZ1bmN0aW9uKGUpIHsNCgkJCQkJdmFyIHQ7DQoJCQkJCWEuYXBwZW5kQ2hpbGQoZSkuaW5uZXJIVE1MID0gIjxhIGlkPSciICsgRSArICInPjwvYT48c2VsZWN0IGlkPSciICsgRSArICItXHJcXCcgbXNhbGxvd2NhcHR1cmU9Jyc+PG9wdGlvbiBzZWxlY3RlZD0nJz48L29wdGlvbj48L3NlbGVjdD4iLCBlLnF1ZXJ5U2VsZWN0b3JBbGwoIlttc2FsbG93Y2FwdHVyZV49JyddIikubGVuZ3RoICYmIHkucHVzaCgiWypeJF09IiArIE0gKyAiKig/OicnfFwiXCIpIiksIGUucXVlcnlTZWxlY3RvckFsbCgiW3NlbGVjdGVkXSIpLmxlbmd0aCB8fCB5LnB1c2goIlxcWyIgKyBNICsgIiooPzp2YWx1ZXwiICsgUiArICIpIiksIGUucXVlcnlTZWxlY3RvckFsbCgiW2lkfj0iICsgRSArICItXSIpLmxlbmd0aCB8fCB5LnB1c2goIn49IiksICh0ID0gQy5jcmVhdGVFbGVtZW50KCJpbnB1dCIpKS5zZXRBdHRyaWJ1dGUoIm5hbWUiLCAiIiksIGUuYXBwZW5kQ2hpbGQodCksIGUucXVlcnlTZWxlY3RvckFsbCgiW25hbWU9JyddIikubGVuZ3RoIHx8IHkucHVzaCgiXFxbIiArIE0gKyAiKm5hbWUiICsgTSArICIqPSIgKyBNICsgIiooPzonJ3xcIlwiKSIpLCBlLnF1ZXJ5U2VsZWN0b3JBbGwoIjpjaGVja2VkIikubGVuZ3RoIHx8IHkucHVzaCgiOmNoZWNrZWQiKSwgZS5xdWVyeVNlbGVjdG9yQWxsKCJhIyIgKyBFICsgIisqIikubGVuZ3RoIHx8IHkucHVzaCgiLiMuK1srfl0iKSwgZS5xdWVyeVNlbGVjdG9yQWxsKCJcXFxmIiksIHkucHVzaCgiW1xcclxcblxcZl0iKQ0KCQkJCX0pLCBjZShmdW5jdGlvbihlKSB7DQoJCQkJCWUuaW5uZXJIVE1MID0gIjxhIGhyZWY9JycgZGlzYWJsZWQ9J2Rpc2FibGVkJz48L2E+PHNlbGVjdCBkaXNhYmxlZD0nZGlzYWJsZWQnPjxvcHRpb24vPjwvc2VsZWN0PiI7DQoJCQkJCXZhciB0ID0gQy5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOw0KCQkJCQl0LnNldEF0dHJpYnV0ZSgidHlwZSIsICJoaWRkZW4iKSwgZS5hcHBlbmRDaGlsZCh0KS5zZXRBdHRyaWJ1dGUoIm5hbWUiLCAiRCIpLCBlLnF1ZXJ5U2VsZWN0b3JBbGwoIltuYW1lPWRdIikubGVuZ3RoICYmIHkucHVzaCgibmFtZSIgKyBNICsgIipbKl4kfCF+XT89IiksIDIgIT09IGUucXVlcnlTZWxlY3RvckFsbCgiOmVuYWJsZWQiKS5sZW5ndGggJiYgeS5wdXNoKCI6ZW5hYmxlZCIsICI6ZGlzYWJsZWQiKSwgYS5hcHBlbmRDaGlsZChlKS5kaXNhYmxlZCA9ICEwLCAyICE9PSBlLnF1ZXJ5U2VsZWN0b3JBbGwoIjpkaXNhYmxlZCIpLmxlbmd0aCAmJiB5LnB1c2goIjplbmFibGVkIiwgIjpkaXNhYmxlZCIpLCBlLnF1ZXJ5U2VsZWN0b3JBbGwoIiosOngiKSwgeS5wdXNoKCIsLio6IikNCgkJCQl9KSksIChkLm1hdGNoZXNTZWxlY3RvciA9IEsudGVzdChjID0gYS5tYXRjaGVzIHx8IGEud2Via2l0TWF0Y2hlc1NlbGVjdG9yIHx8IGEubW96TWF0Y2hlc1NlbGVjdG9yIHx8IGEub01hdGNoZXNTZWxlY3RvciB8fCBhLm1zTWF0Y2hlc1NlbGVjdG9yKSkgJiYgY2UoZnVuY3Rpb24oZSkge2QuZGlzY29ubmVjdGVkTWF0Y2ggPSBjLmNhbGwoZSwgIioiKSwgYy5jYWxsKGUsICJbcyE9JyddOngiKSwgcy5wdXNoKCIhPSIsIEYpfSksIGQuY3NzU3VwcG9ydHNTZWxlY3RvciB8fCB5LnB1c2goIjpoYXMiKSwgeSA9IHkubGVuZ3RoICYmIG5ldyBSZWdFeHAoeS5qb2luKCJ8IikpLCBzID0gcy5sZW5ndGggJiYgbmV3IFJlZ0V4cChzLmpvaW4oInwiKSksIHQgPSBLLnRlc3QoYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiksIHYgPSB0IHx8IEsudGVzdChhLmNvbnRhaW5zKSA/IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJdmFyIG4gPSA5ID09PSBlLm5vZGVUeXBlICYmIGUuZG9jdW1lbnRFbGVtZW50IHx8IGUsDQoJCQkJCSAgICByID0gdCAmJiB0LnBhcmVudE5vZGU7DQoJCQkJCXJldHVybiBlID09PSByIHx8ICEoIXIgfHwgMSAhPT0gci5ub2RlVHlwZSB8fCAhKG4uY29udGFpbnMgPyBuLmNvbnRhaW5zKHIpIDogZS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAmJiAxNiAmIGUuY29tcGFyZURvY3VtZW50UG9zaXRpb24ocikpKQ0KCQkJCX0gOiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJCWlmKHQpIHdoaWxlKHQgPSB0LnBhcmVudE5vZGUpIGlmKHQgPT09IGUpIHJldHVybiAhMDsNCgkJCQkJcmV0dXJuICExDQoJCQkJfSwgaiA9IHQgPyBmdW5jdGlvbihlLCB0KSB7DQoJCQkJCWlmKGUgPT09IHQpIHJldHVybiBsID0gITAsIDA7DQoJCQkJCXZhciBuID0gIWUuY29tcGFyZURvY3VtZW50UG9zaXRpb24gLSAhdC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbjsNCgkJCQkJcmV0dXJuIG4gfHwgKDEgJiAobiA9IChlLm93bmVyRG9jdW1lbnQgfHwgZSkgPT0gKHQub3duZXJEb2N1bWVudCB8fCB0KSA/IGUuY29tcGFyZURvY3VtZW50UG9zaXRpb24odCkgOiAxKSB8fCAhZC5zb3J0RGV0YWNoZWQgJiYgdC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihlKSA9PT0gbiA/IGUgPT0gQyB8fCBlLm93bmVyRG9jdW1lbnQgPT0gcCAmJiB2KHAsIGUpID8gLTEgOiB0ID09IEMgfHwgdC5vd25lckRvY3VtZW50ID09IHAgJiYgdihwLCB0KSA/IDEgOiB1ID8gUCh1LCBlKSAtIFAodSwgdCkgOiAwIDogNCAmIG4gPyAtMSA6IDEpDQoJCQkJfSA6IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJaWYoZSA9PT0gdCkgcmV0dXJuIGwgPSAhMCwgMDsNCgkJCQkJdmFyIG4sIHIgPSAwLCBpID0gZS5wYXJlbnROb2RlLCBvID0gdC5wYXJlbnROb2RlLCBhID0gW2VdLCBzID0gW3RdOw0KCQkJCQlpZighaSB8fCAhbykgcmV0dXJuIGUgPT0gQyA/IC0xIDogdCA9PSBDID8gMSA6IGkgPyAtMSA6IG8gPyAxIDogdSA/IFAodSwgZSkgLSBQKHUsIHQpIDogMDsNCgkJCQkJaWYoaSA9PT0gbykgcmV0dXJuIHBlKGUsIHQpOw0KCQkJCQluID0gZTsNCgkJCQkJd2hpbGUobiA9IG4ucGFyZW50Tm9kZSkgYS51bnNoaWZ0KG4pOw0KCQkJCQluID0gdDsNCgkJCQkJd2hpbGUobiA9IG4ucGFyZW50Tm9kZSkgcy51bnNoaWZ0KG4pOw0KCQkJCQl3aGlsZShhW3JdID09PSBzW3JdKSByKys7DQoJCQkJCXJldHVybiByID8gcGUoYVtyXSwgc1tyXSkgOiBhW3JdID09IHAgPyAtMSA6IHNbcl0gPT0gcCA/IDEgOiAwDQoJCQkJfSksIEMNCgkJCX0sIHNlLm1hdGNoZXMgPSBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIHNlKGUsIG51bGwsIG51bGwsIHQpfSwgc2UubWF0Y2hlc1NlbGVjdG9yID0gZnVuY3Rpb24oZSwgdCkgew0KCQkJCWlmKFQoZSksIGQubWF0Y2hlc1NlbGVjdG9yICYmIFMgJiYgIU5bdCArICIgIl0gJiYgKCFzIHx8ICFzLnRlc3QodCkpICYmICgheSB8fCAheS50ZXN0KHQpKSkgdHJ5IHsNCgkJCQkJdmFyIG4gPSBjLmNhbGwoZSwgdCk7DQoJCQkJCWlmKG4gfHwgZC5kaXNjb25uZWN0ZWRNYXRjaCB8fCBlLmRvY3VtZW50ICYmIDExICE9PSBlLmRvY3VtZW50Lm5vZGVUeXBlKSByZXR1cm4gbg0KCQkJCX0gY2F0Y2goZSkge04odCwgITApfQ0KCQkJCXJldHVybiAwIDwgc2UodCwgQywgbnVsbCwgW2VdKS5sZW5ndGgNCgkJCX0sIHNlLmNvbnRhaW5zID0gZnVuY3Rpb24oZSwgdCkge3JldHVybiAoZS5vd25lckRvY3VtZW50IHx8IGUpICE9IEMgJiYgVChlKSwgdihlLCB0KX0sIHNlLmF0dHIgPSBmdW5jdGlvbihlLCB0KSB7DQoJCQkJKGUub3duZXJEb2N1bWVudCB8fCBlKSAhPSBDICYmIFQoZSk7DQoJCQkJdmFyIG4gPSBiLmF0dHJIYW5kbGVbdC50b0xvd2VyQ2FzZSgpXSwgciA9IG4gJiYgRC5jYWxsKGIuYXR0ckhhbmRsZSwgdC50b0xvd2VyQ2FzZSgpKSA/IG4oZSwgdCwgIVMpIDogdm9pZCAwOw0KCQkJCXJldHVybiB2b2lkIDAgIT09IHIgPyByIDogZC5hdHRyaWJ1dGVzIHx8ICFTID8gZS5nZXRBdHRyaWJ1dGUodCkgOiAociA9IGUuZ2V0QXR0cmlidXRlTm9kZSh0KSkgJiYgci5zcGVjaWZpZWQgPyByLnZhbHVlIDogbnVsbA0KCQkJfSwgc2UuZXNjYXBlID0gZnVuY3Rpb24oZSkge3JldHVybiAoZSArICIiKS5yZXBsYWNlKHJlLCBpZSl9LCBzZS5lcnJvciA9IGZ1bmN0aW9uKGUpIHt0aHJvdyBuZXcgRXJyb3IoIlN5bnRheCBlcnJvciwgdW5yZWNvZ25pemVkIGV4cHJlc3Npb246ICIgKyBlKX0sIHNlLnVuaXF1ZVNvcnQgPSBmdW5jdGlvbihlKSB7DQoJCQkJdmFyIHQsIG4gPSBbXSwgciA9IDAsIGkgPSAwOw0KCQkJCWlmKGwgPSAhZC5kZXRlY3REdXBsaWNhdGVzLCB1ID0gIWQuc29ydFN0YWJsZSAmJiBlLnNsaWNlKDApLCBlLnNvcnQoaiksIGwpIHsNCgkJCQkJd2hpbGUodCA9IGVbaSsrXSkgdCA9PT0gZVtpXSAmJiAociA9IG4ucHVzaChpKSk7DQoJCQkJCXdoaWxlKHItLSkgZS5zcGxpY2UobltyXSwgMSkNCgkJCQl9DQoJCQkJcmV0dXJuIHUgPSBudWxsLCBlDQoJCQl9LCBvID0gc2UuZ2V0VGV4dCA9IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCwgbiA9ICIiLCByID0gMCwgaSA9IGUubm9kZVR5cGU7DQoJCQkJaWYoaSkgew0KCQkJCQlpZigxID09PSBpIHx8IDkgPT09IGkgfHwgMTEgPT09IGkpIHsNCgkJCQkJCWlmKCJzdHJpbmciID09IHR5cGVvZiBlLnRleHRDb250ZW50KSByZXR1cm4gZS50ZXh0Q29udGVudDsNCgkJCQkJCWZvcihlID0gZS5maXJzdENoaWxkOyBlOyBlID0gZS5uZXh0U2libGluZykgbiArPSBvKGUpDQoJCQkJCX0gZWxzZSBpZigzID09PSBpIHx8IDQgPT09IGkpIHJldHVybiBlLm5vZGVWYWx1ZQ0KCQkJCX0gZWxzZSB3aGlsZSh0ID0gZVtyKytdKSBuICs9IG8odCk7DQoJCQkJcmV0dXJuIG4NCgkJCX0sIChiID0gc2Uuc2VsZWN0b3JzID0gew0KCQkJCWNhY2hlTGVuZ3RoOiA1MCwNCgkJCQljcmVhdGVQc2V1ZG86IGxlLA0KCQkJCW1hdGNoOiBHLA0KCQkJCWF0dHJIYW5kbGU6IHt9LA0KCQkJCWZpbmQ6IHt9LA0KCQkJCXJlbGF0aXZlOiB7Ij4iOiB7ZGlyOiAicGFyZW50Tm9kZSIsIGZpcnN0OiAhMH0sICIgIjoge2RpcjogInBhcmVudE5vZGUifSwgIisiOiB7ZGlyOiAicHJldmlvdXNTaWJsaW5nIiwgZmlyc3Q6ICEwfSwgIn4iOiB7ZGlyOiAicHJldmlvdXNTaWJsaW5nIn19LA0KCQkJCXByZUZpbHRlcjogew0KCQkJCQlBVFRSOiBmdW5jdGlvbihlKSB7cmV0dXJuIGVbMV0gPSBlWzFdLnJlcGxhY2UodGUsIG5lKSwgZVszXSA9IChlWzNdIHx8IGVbNF0gfHwgZVs1XSB8fCAiIikucmVwbGFjZSh0ZSwgbmUpLCAifj0iID09PSBlWzJdICYmIChlWzNdID0gIiAiICsgZVszXSArICIgIiksIGUuc2xpY2UoMCwgNCl9LA0KCQkJCQlDSElMRDogZnVuY3Rpb24oZSkge3JldHVybiBlWzFdID0gZVsxXS50b0xvd2VyQ2FzZSgpLCAibnRoIiA9PT0gZVsxXS5zbGljZSgwLCAzKSA/IChlWzNdIHx8IHNlLmVycm9yKGVbMF0pLCBlWzRdID0gKyhlWzRdID8gZVs1XSArIChlWzZdIHx8IDEpIDogMiAqICgiZXZlbiIgPT09IGVbM10gfHwgIm9kZCIgPT09IGVbM10pKSwgZVs1XSA9ICsoZVs3XSArIGVbOF0gfHwgIm9kZCIgPT09IGVbM10pKSA6IGVbM10gJiYgc2UuZXJyb3IoZVswXSksIGV9LA0KCQkJCQlQU0VVRE86IGZ1bmN0aW9uKGUpIHsNCgkJCQkJCXZhciB0LCBuID0gIWVbNl0gJiYgZVsyXTsNCgkJCQkJCXJldHVybiBHLkNISUxELnRlc3QoZVswXSkgPyBudWxsIDogKGVbM10gPyBlWzJdID0gZVs0XSB8fCBlWzVdIHx8ICIiIDogbiAmJiBYLnRlc3QobikgJiYgKHQgPSBoKG4sICEwKSkgJiYgKHQgPSBuLmluZGV4T2YoIikiLCBuLmxlbmd0aCAtIHQpIC0gbi5sZW5ndGgpICYmIChlWzBdID0gZVswXS5zbGljZSgwLCB0KSwgZVsyXSA9IG4uc2xpY2UoMCwgdCkpLCBlLnNsaWNlKDAsIDMpKQ0KCQkJCQl9DQoJCQkJfSwNCgkJCQlmaWx0ZXI6IHsNCgkJCQkJVEFHOiBmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgdCA9IGUucmVwbGFjZSh0ZSwgbmUpLnRvTG93ZXJDYXNlKCk7DQoJCQkJCQlyZXR1cm4gIioiID09PSBlID8gZnVuY3Rpb24oKSB7cmV0dXJuICEwfSA6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gZS5ub2RlTmFtZSAmJiBlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IHR9DQoJCQkJCX0sIENMQVNTOiBmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgdCA9IG1bZSArICIgIl07DQoJCQkJCQlyZXR1cm4gdCB8fCAodCA9IG5ldyBSZWdFeHAoIihefCIgKyBNICsgIikiICsgZSArICIoIiArIE0gKyAifCQpIikpICYmIG0oZSwgZnVuY3Rpb24oZSkge3JldHVybiB0LnRlc3QoInN0cmluZyIgPT0gdHlwZW9mIGUuY2xhc3NOYW1lICYmIGUuY2xhc3NOYW1lIHx8ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBlLmdldEF0dHJpYnV0ZSAmJiBlLmdldEF0dHJpYnV0ZSgiY2xhc3MiKSB8fCAiIil9KQ0KCQkJCQl9LCBBVFRSOiBmdW5jdGlvbihuLCByLCBpKSB7DQoJCQkJCQlyZXR1cm4gZnVuY3Rpb24oZSkgew0KCQkJCQkJCXZhciB0ID0gc2UuYXR0cihlLCBuKTsNCgkJCQkJCQlyZXR1cm4gbnVsbCA9PSB0ID8gIiE9IiA9PT0gciA6ICFyIHx8ICh0ICs9ICIiLCAiPSIgPT09IHIgPyB0ID09PSBpIDogIiE9IiA9PT0gciA/IHQgIT09IGkgOiAiXj0iID09PSByID8gaSAmJiAwID09PSB0LmluZGV4T2YoaSkgOiAiKj0iID09PSByID8gaSAmJiAtMSA8IHQuaW5kZXhPZihpKSA6ICIkPSIgPT09IHIgPyBpICYmIHQuc2xpY2UoLWkubGVuZ3RoKSA9PT0gaSA6ICJ+PSIgPT09IHIgPyAtMSA8ICgiICIgKyB0LnJlcGxhY2UoJCwgIiAiKSArICIgIikuaW5kZXhPZihpKSA6ICJ8PSIgPT09IHIgJiYgKHQgPT09IGkgfHwgdC5zbGljZSgwLCBpLmxlbmd0aCArIDEpID09PSBpICsgIi0iKSkNCgkJCQkJCX0NCgkJCQkJfSwgQ0hJTEQ6IGZ1bmN0aW9uKGgsIGUsIHQsIGcsIHkpIHsNCgkJCQkJCXZhciB2ID0gIm50aCIgIT09IGguc2xpY2UoMCwgMyksIG0gPSAibGFzdCIgIT09IGguc2xpY2UoLTQpLCB4ID0gIm9mLXR5cGUiID09PSBlOw0KCQkJCQkJcmV0dXJuIDEgPT09IGcgJiYgMCA9PT0geSA/IGZ1bmN0aW9uKGUpIHtyZXR1cm4gISFlLnBhcmVudE5vZGV9IDogZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCQkJCXZhciByLCBpLCBvLCBhLCBzLCB1LCBsID0gdiAhPT0gbSA/ICJuZXh0U2libGluZyIgOiAicHJldmlvdXNTaWJsaW5nIiwgYyA9IGUucGFyZW50Tm9kZSwgZiA9IHggJiYgZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLCBwID0gIW4gJiYgIXgsIGQgPSAhMTsNCgkJCQkJCQlpZihjKSB7DQoJCQkJCQkJCWlmKHYpIHsNCgkJCQkJCQkJCXdoaWxlKGwpIHsNCgkJCQkJCQkJCQlhID0gZTsNCgkJCQkJCQkJCQl3aGlsZShhID0gYVtsXSkgaWYoeCA/IGEubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gZiA6IDEgPT09IGEubm9kZVR5cGUpIHJldHVybiAhMTsNCgkJCQkJCQkJCQl1ID0gbCA9ICJvbmx5IiA9PT0gaCAmJiAhdSAmJiAibmV4dFNpYmxpbmciDQoJCQkJCQkJCQl9DQoJCQkJCQkJCQlyZXR1cm4gITANCgkJCQkJCQkJfQ0KCQkJCQkJCQlpZih1ID0gW20gPyBjLmZpcnN0Q2hpbGQgOiBjLmxhc3RDaGlsZF0sIG0gJiYgcCkgew0KCQkJCQkJCQkJZCA9IChzID0gKHIgPSAoaSA9IChvID0gKGEgPSBjKVtFXSB8fCAoYVtFXSA9IHt9KSlbYS51bmlxdWVJRF0gfHwgKG9bYS51bmlxdWVJRF0gPSB7fSkpW2hdIHx8IFtdKVswXSA9PT0gayAmJiByWzFdKSAmJiByWzJdLCBhID0gcyAmJiBjLmNoaWxkTm9kZXNbc107DQoJCQkJCQkJCQl3aGlsZShhID0gKytzICYmIGEgJiYgYVtsXSB8fCAoZCA9IHMgPSAwKSB8fCB1LnBvcCgpKSBpZigxID09PSBhLm5vZGVUeXBlICYmICsrZCAmJiBhID09PSBlKSB7DQoJCQkJCQkJCQkJaVtoXSA9IFtrLCBzLCBkXTsNCgkJCQkJCQkJCQlicmVhaw0KCQkJCQkJCQkJfQ0KCQkJCQkJCQl9IGVsc2UgaWYocCAmJiAoZCA9IHMgPSAociA9IChpID0gKG8gPSAoYSA9IGUpW0VdIHx8IChhW0VdID0ge30pKVthLnVuaXF1ZUlEXSB8fCAob1thLnVuaXF1ZUlEXSA9IHt9KSlbaF0gfHwgW10pWzBdID09PSBrICYmIHJbMV0pLCAhMSA9PT0gZCkgd2hpbGUoYSA9ICsrcyAmJiBhICYmIGFbbF0gfHwgKGQgPSBzID0gMCkgfHwgdS5wb3AoKSkgaWYoKHggPyBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IGYgOiAxID09PSBhLm5vZGVUeXBlKSAmJiArK2QgJiYgKHAgJiYgKChpID0gKG8gPSBhW0VdIHx8IChhW0VdID0ge30pKVthLnVuaXF1ZUlEXSB8fCAob1thLnVuaXF1ZUlEXSA9IHt9KSlbaF0gPSBbaywgZF0pLCBhID09PSBlKSkgYnJlYWs7DQoJCQkJCQkJCXJldHVybiAoZCAtPSB5KSA9PT0gZyB8fCBkICUgZyA9PSAwICYmIDAgPD0gZCAvIGcNCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJCX0sIFBTRVVETzogZnVuY3Rpb24oZSwgbykgew0KCQkJCQkJdmFyIHQsIGEgPSBiLnBzZXVkb3NbZV0gfHwgYi5zZXRGaWx0ZXJzW2UudG9Mb3dlckNhc2UoKV0gfHwgc2UuZXJyb3IoInVuc3VwcG9ydGVkIHBzZXVkbzogIiArIGUpOw0KCQkJCQkJcmV0dXJuIGFbRV0gPyBhKG8pIDogMSA8IGEubGVuZ3RoID8gKHQgPSBbZSwgZSwgIiIsIG9dLCBiLnNldEZpbHRlcnMuaGFzT3duUHJvcGVydHkoZS50b0xvd2VyQ2FzZSgpKSA/IGxlKGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJCQl2YXIgbiwgciA9IGEoZSwgbyksIGkgPSByLmxlbmd0aDsNCgkJCQkJCQl3aGlsZShpLS0pIGVbbiA9IFAoZSwgcltpXSldID0gISh0W25dID0gcltpXSkNCgkJCQkJCX0pIDogZnVuY3Rpb24oZSkge3JldHVybiBhKGUsIDAsIHQpfSkgOiBhDQoJCQkJCX0NCgkJCQl9LA0KCQkJCXBzZXVkb3M6IHsNCgkJCQkJbm90OiBsZShmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgciA9IFtdLCBpID0gW10sIHMgPSBmKGUucmVwbGFjZShCLCAiJDEiKSk7DQoJCQkJCQlyZXR1cm4gc1tFXSA/IGxlKGZ1bmN0aW9uKGUsIHQsIG4sIHIpIHsNCgkJCQkJCQl2YXIgaSwgbyA9IHMoZSwgbnVsbCwgciwgW10pLCBhID0gZS5sZW5ndGg7DQoJCQkJCQkJd2hpbGUoYS0tKSAoaSA9IG9bYV0pICYmIChlW2FdID0gISh0W2FdID0gaSkpDQoJCQkJCQl9KSA6IGZ1bmN0aW9uKGUsIHQsIG4pIHtyZXR1cm4gclswXSA9IGUsIHMociwgbnVsbCwgbiwgaSksIHJbMF0gPSBudWxsLCAhaS5wb3AoKX0NCgkJCQkJfSksDQoJCQkJCWhhczogbGUoZnVuY3Rpb24odCkge3JldHVybiBmdW5jdGlvbihlKSB7cmV0dXJuIDAgPCBzZSh0LCBlKS5sZW5ndGh9fSksDQoJCQkJCWNvbnRhaW5zOiBsZShmdW5jdGlvbih0KSB7cmV0dXJuIHQgPSB0LnJlcGxhY2UodGUsIG5lKSwgZnVuY3Rpb24oZSkge3JldHVybiAtMSA8IChlLnRleHRDb250ZW50IHx8IG8oZSkpLmluZGV4T2YodCl9fSksDQoJCQkJCWxhbmc6IGxlKGZ1bmN0aW9uKG4pIHsNCgkJCQkJCXJldHVybiBWLnRlc3QobiB8fCAiIikgfHwgc2UuZXJyb3IoInVuc3VwcG9ydGVkIGxhbmc6ICIgKyBuKSwgbiA9IG4ucmVwbGFjZSh0ZSwgbmUpLnRvTG93ZXJDYXNlKCksIGZ1bmN0aW9uKGUpIHsNCgkJCQkJCQl2YXIgdDsNCgkJCQkJCQlkbyB7aWYodCA9IFMgPyBlLmxhbmcgOiBlLmdldEF0dHJpYnV0ZSgieG1sOmxhbmciKSB8fCBlLmdldEF0dHJpYnV0ZSgibGFuZyIpKSByZXR1cm4gKHQgPSB0LnRvTG93ZXJDYXNlKCkpID09PSBuIHx8IDAgPT09IHQuaW5kZXhPZihuICsgIi0iKX0gd2hpbGUoKGUgPSBlLnBhcmVudE5vZGUpICYmIDEgPT09IGUubm9kZVR5cGUpOw0KCQkJCQkJCXJldHVybiAhMQ0KCQkJCQkJfQ0KCQkJCQl9KSwNCgkJCQkJdGFyZ2V0OiBmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgdCA9IG4ubG9jYXRpb24gJiYgbi5sb2NhdGlvbi5oYXNoOw0KCQkJCQkJcmV0dXJuIHQgJiYgdC5zbGljZSgxKSA9PT0gZS5pZA0KCQkJCQl9LA0KCQkJCQlyb290OiBmdW5jdGlvbihlKSB7cmV0dXJuIGUgPT09IGF9LA0KCQkJCQlmb2N1czogZnVuY3Rpb24oZSkge3JldHVybiBlID09PSBDLmFjdGl2ZUVsZW1lbnQgJiYgKCFDLmhhc0ZvY3VzIHx8IEMuaGFzRm9jdXMoKSkgJiYgISEoZS50eXBlIHx8IGUuaHJlZiB8fCB+ZS50YWJJbmRleCl9LA0KCQkJCQllbmFibGVkOiBnZSghMSksDQoJCQkJCWRpc2FibGVkOiBnZSghMCksDQoJCQkJCWNoZWNrZWQ6IGZ1bmN0aW9uKGUpIHsNCgkJCQkJCXZhciB0ID0gZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOw0KCQkJCQkJcmV0dXJuICJpbnB1dCIgPT09IHQgJiYgISFlLmNoZWNrZWQgfHwgIm9wdGlvbiIgPT09IHQgJiYgISFlLnNlbGVjdGVkDQoJCQkJCX0sDQoJCQkJCXNlbGVjdGVkOiBmdW5jdGlvbihlKSB7cmV0dXJuIGUucGFyZW50Tm9kZSAmJiBlLnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleCwgITAgPT09IGUuc2VsZWN0ZWR9LA0KCQkJCQllbXB0eTogZnVuY3Rpb24oZSkgew0KCQkJCQkJZm9yKGUgPSBlLmZpcnN0Q2hpbGQ7IGU7IGUgPSBlLm5leHRTaWJsaW5nKSBpZihlLm5vZGVUeXBlIDwgNikgcmV0dXJuICExOw0KCQkJCQkJcmV0dXJuICEwDQoJCQkJCX0sDQoJCQkJCXBhcmVudDogZnVuY3Rpb24oZSkge3JldHVybiAhYi5wc2V1ZG9zLmVtcHR5KGUpfSwNCgkJCQkJaGVhZGVyOiBmdW5jdGlvbihlKSB7cmV0dXJuIEoudGVzdChlLm5vZGVOYW1lKX0sDQoJCQkJCWlucHV0OiBmdW5jdGlvbihlKSB7cmV0dXJuIFEudGVzdChlLm5vZGVOYW1lKX0sDQoJCQkJCWJ1dHRvbjogZnVuY3Rpb24oZSkgew0KCQkJCQkJdmFyIHQgPSBlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7DQoJCQkJCQlyZXR1cm4gImlucHV0IiA9PT0gdCAmJiAiYnV0dG9uIiA9PT0gZS50eXBlIHx8ICJidXR0b24iID09PSB0DQoJCQkJCX0sDQoJCQkJCXRleHQ6IGZ1bmN0aW9uKGUpIHsNCgkJCQkJCXZhciB0Ow0KCQkJCQkJcmV0dXJuICJpbnB1dCIgPT09IGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAmJiAidGV4dCIgPT09IGUudHlwZSAmJiAobnVsbCA9PSAodCA9IGUuZ2V0QXR0cmlidXRlKCJ0eXBlIikpIHx8ICJ0ZXh0IiA9PT0gdC50b0xvd2VyQ2FzZSgpKQ0KCQkJCQl9LA0KCQkJCQlmaXJzdDogeWUoZnVuY3Rpb24oKSB7cmV0dXJuIFswXX0pLA0KCQkJCQlsYXN0OiB5ZShmdW5jdGlvbihlLCB0KSB7cmV0dXJuIFt0IC0gMV19KSwNCgkJCQkJZXE6IHllKGZ1bmN0aW9uKGUsIHQsIG4pIHtyZXR1cm4gW24gPCAwID8gbiArIHQgOiBuXX0pLA0KCQkJCQlldmVuOiB5ZShmdW5jdGlvbihlLCB0KSB7DQoJCQkJCQlmb3IodmFyIG4gPSAwOyBuIDwgdDsgbiArPSAyKSBlLnB1c2gobik7DQoJCQkJCQlyZXR1cm4gZQ0KCQkJCQl9KSwNCgkJCQkJb2RkOiB5ZShmdW5jdGlvbihlLCB0KSB7DQoJCQkJCQlmb3IodmFyIG4gPSAxOyBuIDwgdDsgbiArPSAyKSBlLnB1c2gobik7DQoJCQkJCQlyZXR1cm4gZQ0KCQkJCQl9KSwNCgkJCQkJbHQ6IHllKGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQkJCWZvcih2YXIgciA9IG4gPCAwID8gbiArIHQgOiB0IDwgbiA/IHQgOiBuOyAwIDw9IC0tcjspIGUucHVzaChyKTsNCgkJCQkJCXJldHVybiBlDQoJCQkJCX0pLA0KCQkJCQlndDogeWUoZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCQkJZm9yKHZhciByID0gbiA8IDAgPyBuICsgdCA6IG47ICsrciA8IHQ7KSBlLnB1c2gocik7DQoJCQkJCQlyZXR1cm4gZQ0KCQkJCQl9KQ0KCQkJCX0NCgkJCX0pLnBzZXVkb3MubnRoID0gYi5wc2V1ZG9zLmVxLCB7cmFkaW86ICEwLCBjaGVja2JveDogITAsIGZpbGU6ICEwLCBwYXNzd29yZDogITAsIGltYWdlOiAhMH0pIGIucHNldWRvc1tlXSA9IGRlKGUpOw0KCQkJZm9yKGUgaW4ge3N1Ym1pdDogITAsIHJlc2V0OiAhMH0pIGIucHNldWRvc1tlXSA9IGhlKGUpOw0KDQoJCQlmdW5jdGlvbiBtZSgpIHt9DQoNCgkJCWZ1bmN0aW9uIHhlKGUpIHsNCgkJCQlmb3IodmFyIHQgPSAwLCBuID0gZS5sZW5ndGgsIHIgPSAiIjsgdCA8IG47IHQrKykgciArPSBlW3RdLnZhbHVlOw0KCQkJCXJldHVybiByDQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGJlKHMsIGUsIHQpIHsNCgkJCQl2YXIgdSA9IGUuZGlyLCBsID0gZS5uZXh0LCBjID0gbCB8fCB1LCBmID0gdCAmJiAicGFyZW50Tm9kZSIgPT09IGMsIHAgPSByKys7DQoJCQkJcmV0dXJuIGUuZmlyc3QgPyBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJCXdoaWxlKGUgPSBlW3VdKSBpZigxID09PSBlLm5vZGVUeXBlIHx8IGYpIHJldHVybiBzKGUsIHQsIG4pOw0KCQkJCQlyZXR1cm4gITENCgkJCQl9IDogZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCQl2YXIgciwgaSwgbywgYSA9IFtrLCBwXTsNCgkJCQkJaWYobikge3doaWxlKGUgPSBlW3VdKSBpZigoMSA9PT0gZS5ub2RlVHlwZSB8fCBmKSAmJiBzKGUsIHQsIG4pKSByZXR1cm4gITB9IGVsc2Ugd2hpbGUoZSA9IGVbdV0pIGlmKDEgPT09IGUubm9kZVR5cGUgfHwgZikgaWYoaSA9IChvID0gZVtFXSB8fCAoZVtFXSA9IHt9KSlbZS51bmlxdWVJRF0gfHwgKG9bZS51bmlxdWVJRF0gPSB7fSksIGwgJiYgbCA9PT0gZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKSBlID0gZVt1XSB8fCBlOyBlbHNlIHsNCgkJCQkJCWlmKChyID0gaVtjXSkgJiYgclswXSA9PT0gayAmJiByWzFdID09PSBwKSByZXR1cm4gYVsyXSA9IHJbMl07DQoJCQkJCQlpZigoaVtjXSA9IGEpWzJdID0gcyhlLCB0LCBuKSkgcmV0dXJuICEwDQoJCQkJCX0NCgkJCQkJcmV0dXJuICExDQoJCQkJfQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiB3ZShpKSB7DQoJCQkJcmV0dXJuIDEgPCBpLmxlbmd0aCA/IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQkJdmFyIHIgPSBpLmxlbmd0aDsNCgkJCQkJd2hpbGUoci0tKSBpZighaVtyXShlLCB0LCBuKSkgcmV0dXJuICExOw0KCQkJCQlyZXR1cm4gITANCgkJCQl9IDogaVswXQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBUZShlLCB0LCBuLCByLCBpKSB7DQoJCQkJZm9yKHZhciBvLCBhID0gW10sIHMgPSAwLCB1ID0gZS5sZW5ndGgsIGwgPSBudWxsICE9IHQ7IHMgPCB1OyBzKyspIChvID0gZVtzXSkgJiYgKG4gJiYgIW4obywgciwgaSkgfHwgKGEucHVzaChvKSwgbCAmJiB0LnB1c2gocykpKTsNCgkJCQlyZXR1cm4gYQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBDZShkLCBoLCBnLCB5LCB2LCBlKSB7DQoJCQkJcmV0dXJuIHkgJiYgIXlbRV0gJiYgKHkgPSBDZSh5KSksIHYgJiYgIXZbRV0gJiYgKHYgPSBDZSh2LCBlKSksIGxlKGZ1bmN0aW9uKGUsIHQsIG4sIHIpIHsNCgkJCQkJdmFyIGksIG8sIGEsIHMgICAgICAgICAgICAgICAgICAgICAgICAgICA9IFtdLCB1ID0gW10sIGwgPSB0Lmxlbmd0aCwgYyA9IGUgfHwgZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCQkJZm9yKHZhciByID0gMCwgaSA9IHQubGVuZ3RoOyByIDwgaTsgcisrKSBzZShlLCB0W3JdLCBuKTsNCgkJCQkJCXJldHVybiBuDQoJCQkJCX0oaCB8fCAiKiIsIG4ubm9kZVR5cGUgPyBbbl0gOiBuLCBbXSksIGYgPSAhZCB8fCAhZSAmJiBoID8gYyA6IFRlKGMsIHMsIGQsIG4sIHIpLCBwID0gZyA/IHYgfHwgKGUgPyBkIDogbCB8fCB5KSA/IFtdIDogdCA6IGY7DQoJCQkJCWlmKGcgJiYgZyhmLCBwLCBuLCByKSwgeSkgew0KCQkJCQkJaSA9IFRlKHAsIHUpLCB5KGksIFtdLCBuLCByKSwgbyA9IGkubGVuZ3RoOw0KCQkJCQkJd2hpbGUoby0tKSAoYSA9IGlbb10pICYmIChwW3Vbb11dID0gIShmW3Vbb11dID0gYSkpDQoJCQkJCX0NCgkJCQkJaWYoZSkgew0KCQkJCQkJaWYodiB8fCBkKSB7DQoJCQkJCQkJaWYodikgew0KCQkJCQkJCQlpID0gW10sIG8gPSBwLmxlbmd0aDsNCgkJCQkJCQkJd2hpbGUoby0tKSAoYSA9IHBbb10pICYmIGkucHVzaChmW29dID0gYSk7DQoJCQkJCQkJCXYobnVsbCwgcCA9IFtdLCBpLCByKQ0KCQkJCQkJCX0NCgkJCQkJCQlvID0gcC5sZW5ndGg7DQoJCQkJCQkJd2hpbGUoby0tKSAoYSA9IHBbb10pICYmIC0xIDwgKGkgPSB2ID8gUChlLCBhKSA6IHNbb10pICYmIChlW2ldID0gISh0W2ldID0gYSkpDQoJCQkJCQl9DQoJCQkJCX0gZWxzZSBwID0gVGUocCA9PT0gdCA/IHAuc3BsaWNlKGwsIHAubGVuZ3RoKSA6IHApLCB2ID8gdihudWxsLCB0LCBwLCByKSA6IEguYXBwbHkodCwgcCkNCgkJCQl9KQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBTZShlKSB7DQoJCQkJZm9yKHZhciBpLCB0LCBuLCByID0gZS5sZW5ndGgsIG8gPSBiLnJlbGF0aXZlW2VbMF0udHlwZV0sIGEgPSBvIHx8IGIucmVsYXRpdmVbIiAiXSwgcyA9IG8gPyAxIDogMCwgdSA9IGJlKGZ1bmN0aW9uKGUpIHtyZXR1cm4gZSA9PT0gaX0sIGEsICEwKSwgbCA9IGJlKGZ1bmN0aW9uKGUpIHtyZXR1cm4gLTEgPCBQKGksIGUpfSwgYSwgITApLCBjID0gW2Z1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQkJdmFyIHIgPSAhbyAmJiAobiB8fCB0ICE9PSB3KSB8fCAoKGkgPSB0KS5ub2RlVHlwZSA/IHUoZSwgdCwgbikgOiBsKGUsIHQsIG4pKTsNCgkJCQkJcmV0dXJuIGkgPSBudWxsLCByDQoJCQkJfV07IHMgPCByOyBzKyspIGlmKHQgPSBiLnJlbGF0aXZlW2Vbc10udHlwZV0pIGMgPSBbYmUod2UoYyksIHQpXTsgZWxzZSB7DQoJCQkJCWlmKCh0ID0gYi5maWx0ZXJbZVtzXS50eXBlXS5hcHBseShudWxsLCBlW3NdLm1hdGNoZXMpKVtFXSkgew0KCQkJCQkJZm9yKG4gPSArK3M7IG4gPCByOyBuKyspIGlmKGIucmVsYXRpdmVbZVtuXS50eXBlXSkgYnJlYWs7DQoJCQkJCQlyZXR1cm4gQ2UoMSA8IHMgJiYgd2UoYyksIDEgPCBzICYmIHhlKGUuc2xpY2UoMCwgcyAtIDEpLmNvbmNhdCh7dmFsdWU6ICIgIiA9PT0gZVtzIC0gMl0udHlwZSA/ICIqIiA6ICIifSkpLnJlcGxhY2UoQiwgIiQxIiksIHQsIHMgPCBuICYmIFNlKGUuc2xpY2UocywgbikpLCBuIDwgciAmJiBTZShlID0gZS5zbGljZShuKSksIG4gPCByICYmIHhlKGUpKQ0KCQkJCQl9DQoJCQkJCWMucHVzaCh0KQ0KCQkJCX0NCgkJCQlyZXR1cm4gd2UoYykNCgkJCX0NCg0KCQkJcmV0dXJuIG1lLnByb3RvdHlwZSA9IGIuZmlsdGVycyA9IGIucHNldWRvcywgYi5zZXRGaWx0ZXJzID0gbmV3IG1lLCBoID0gc2UudG9rZW5pemUgPSBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4sIHIsIGksIG8sIGEsIHMsIHUsIGwgPSB4W2UgKyAiICJdOw0KCQkJCWlmKGwpIHJldHVybiB0ID8gMCA6IGwuc2xpY2UoMCk7DQoJCQkJYSA9IGUsIHMgPSBbXSwgdSA9IGIucHJlRmlsdGVyOw0KCQkJCXdoaWxlKGEpIHsNCgkJCQkJZm9yKG8gaW4gbiAmJiAhKHIgPSBfLmV4ZWMoYSkpIHx8IChyICYmIChhID0gYS5zbGljZShyWzBdLmxlbmd0aCkgfHwgYSksIHMucHVzaChpID0gW10pKSwgbiA9ICExLCAociA9IHouZXhlYyhhKSkgJiYgKG4gPSByLnNoaWZ0KCksIGkucHVzaCh7DQoJCQkJCQl2YWx1ZTogbiwNCgkJCQkJCXR5cGU6IHJbMF0ucmVwbGFjZShCLCAiICIpDQoJCQkJCX0pLCBhID0gYS5zbGljZShuLmxlbmd0aCkpLCBiLmZpbHRlcikgIShyID0gR1tvXS5leGVjKGEpKSB8fCB1W29dICYmICEociA9IHVbb10ocikpIHx8IChuID0gci5zaGlmdCgpLCBpLnB1c2goe3ZhbHVlOiBuLCB0eXBlOiBvLCBtYXRjaGVzOiByfSksIGEgPSBhLnNsaWNlKG4ubGVuZ3RoKSk7DQoJCQkJCWlmKCFuKSBicmVhaw0KCQkJCX0NCgkJCQlyZXR1cm4gdCA/IGEubGVuZ3RoIDogYSA/IHNlLmVycm9yKGUpIDogeChlLCBzKS5zbGljZSgwKQ0KCQkJfSwgZiA9IHNlLmNvbXBpbGUgPSBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4sIHksIHYsIG0sIHgsIHIsIGkgPSBbXSwgbyA9IFtdLCBhID0gQVtlICsgIiAiXTsNCgkJCQlpZighYSkgew0KCQkJCQl0IHx8ICh0ID0gaChlKSksIG4gPSB0Lmxlbmd0aDsNCgkJCQkJd2hpbGUobi0tKSAoYSA9IFNlKHRbbl0pKVtFXSA/IGkucHVzaChhKSA6IG8ucHVzaChhKTsNCgkJCQkJKGEgPSBBKGUsICh5ID0gbywgbSA9IDAgPCAodiA9IGkpLmxlbmd0aCwgeCA9IDAgPCB5Lmxlbmd0aCwgciA9IGZ1bmN0aW9uKGUsIHQsIG4sIHIsIGkpIHsNCgkJCQkJCXZhciBvLCBhLCBzLCB1ID0gMCwgbCA9ICIwIiwgYyA9IGUgJiYgW10sIGYgPSBbXSwgcCA9IHcsIGQgPSBlIHx8IHggJiYgYi5maW5kLlRBRygiKiIsIGkpLCBoID0gayArPSBudWxsID09IHAgPyAxIDogTWF0aC5yYW5kb20oKSB8fCAuMSwgZyA9IGQubGVuZ3RoOw0KCQkJCQkJZm9yKGkgJiYgKHcgPSB0ID09IEMgfHwgdCB8fCBpKTsgbCAhPT0gZyAmJiBudWxsICE9IChvID0gZFtsXSk7IGwrKykgew0KCQkJCQkJCWlmKHggJiYgbykgew0KCQkJCQkJCQlhID0gMCwgdCB8fCBvLm93bmVyRG9jdW1lbnQgPT0gQyB8fCAoVChvKSwgbiA9ICFTKTsNCgkJCQkJCQkJd2hpbGUocyA9IHlbYSsrXSkgaWYocyhvLCB0IHx8IEMsIG4pKSB7DQoJCQkJCQkJCQlyLnB1c2gobyk7DQoJCQkJCQkJCQlicmVhaw0KCQkJCQkJCQl9DQoJCQkJCQkJCWkgJiYgKGsgPSBoKQ0KCQkJCQkJCX0NCgkJCQkJCQltICYmICgobyA9ICFzICYmIG8pICYmIHUtLSwgZSAmJiBjLnB1c2gobykpDQoJCQkJCQl9DQoJCQkJCQlpZih1ICs9IGwsIG0gJiYgbCAhPT0gdSkgew0KCQkJCQkJCWEgPSAwOw0KCQkJCQkJCXdoaWxlKHMgPSB2W2ErK10pIHMoYywgZiwgdCwgbik7DQoJCQkJCQkJaWYoZSkgew0KCQkJCQkJCQlpZigwIDwgdSkgd2hpbGUobC0tKSBjW2xdIHx8IGZbbF0gfHwgKGZbbF0gPSBxLmNhbGwocikpOw0KCQkJCQkJCQlmID0gVGUoZikNCgkJCQkJCQl9DQoJCQkJCQkJSC5hcHBseShyLCBmKSwgaSAmJiAhZSAmJiAwIDwgZi5sZW5ndGggJiYgMSA8IHUgKyB2Lmxlbmd0aCAmJiBzZS51bmlxdWVTb3J0KHIpDQoJCQkJCQl9DQoJCQkJCQlyZXR1cm4gaSAmJiAoayA9IGgsIHcgPSBwKSwgYw0KCQkJCQl9LCBtID8gbGUocikgOiByKSkpLnNlbGVjdG9yID0gZQ0KCQkJCX0NCgkJCQlyZXR1cm4gYQ0KCQkJfSwgZyA9IHNlLnNlbGVjdCA9IGZ1bmN0aW9uKGUsIHQsIG4sIHIpIHsNCgkJCQl2YXIgaSwgbywgYSwgcywgdSwgbCA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGUgJiYgZSwgYyA9ICFyICYmIGgoZSA9IGwuc2VsZWN0b3IgfHwgZSk7DQoJCQkJaWYobiA9IG4gfHwgW10sIDEgPT09IGMubGVuZ3RoKSB7DQoJCQkJCWlmKDIgPCAobyA9IGNbMF0gPSBjWzBdLnNsaWNlKDApKS5sZW5ndGggJiYgIklEIiA9PT0gKGEgPSBvWzBdKS50eXBlICYmIDkgPT09IHQubm9kZVR5cGUgJiYgUyAmJiBiLnJlbGF0aXZlW29bMV0udHlwZV0pIHsNCgkJCQkJCWlmKCEodCA9IChiLmZpbmQuSUQoYS5tYXRjaGVzWzBdLnJlcGxhY2UodGUsIG5lKSwgdCkgfHwgW10pWzBdKSkgcmV0dXJuIG47DQoJCQkJCQlsICYmICh0ID0gdC5wYXJlbnROb2RlKSwgZSA9IGUuc2xpY2Uoby5zaGlmdCgpLnZhbHVlLmxlbmd0aCkNCgkJCQkJfQ0KCQkJCQlpID0gRy5uZWVkc0NvbnRleHQudGVzdChlKSA/IDAgOiBvLmxlbmd0aDsNCgkJCQkJd2hpbGUoaS0tKSB7DQoJCQkJCQlpZihhID0gb1tpXSwgYi5yZWxhdGl2ZVtzID0gYS50eXBlXSkgYnJlYWs7DQoJCQkJCQlpZigodSA9IGIuZmluZFtzXSkgJiYgKHIgPSB1KGEubWF0Y2hlc1swXS5yZXBsYWNlKHRlLCBuZSksIGVlLnRlc3Qob1swXS50eXBlKSAmJiB2ZSh0LnBhcmVudE5vZGUpIHx8IHQpKSkgew0KCQkJCQkJCWlmKG8uc3BsaWNlKGksIDEpLCAhKGUgPSByLmxlbmd0aCAmJiB4ZShvKSkpIHJldHVybiBILmFwcGx5KG4sIHIpLCBuOw0KCQkJCQkJCWJyZWFrDQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9DQoJCQkJcmV0dXJuIChsIHx8IGYoZSwgYykpKHIsIHQsICFTLCBuLCAhdCB8fCBlZS50ZXN0KGUpICYmIHZlKHQucGFyZW50Tm9kZSkgfHwgdCksIG4NCgkJCX0sIGQuc29ydFN0YWJsZSA9IEUuc3BsaXQoIiIpLnNvcnQoaikuam9pbigiIikgPT09IEUsIGQuZGV0ZWN0RHVwbGljYXRlcyA9ICEhbCwgVCgpLCBkLnNvcnREZXRhY2hlZCA9IGNlKGZ1bmN0aW9uKGUpIHtyZXR1cm4gMSAmIGUuY29tcGFyZURvY3VtZW50UG9zaXRpb24oQy5jcmVhdGVFbGVtZW50KCJmaWVsZHNldCIpKX0pLCBjZShmdW5jdGlvbihlKSB7cmV0dXJuIGUuaW5uZXJIVE1MID0gIjxhIGhyZWY9JyMnPjwvYT4iLCAiIyIgPT09IGUuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoImhyZWYiKX0pIHx8IGZlKCJ0eXBlfGhyZWZ8aGVpZ2h0fHdpZHRoIiwgZnVuY3Rpb24oZSwgdCwgbikge2lmKCFuKSByZXR1cm4gZS5nZXRBdHRyaWJ1dGUodCwgInR5cGUiID09PSB0LnRvTG93ZXJDYXNlKCkgPyAxIDogMil9KSwgZC5hdHRyaWJ1dGVzICYmIGNlKGZ1bmN0aW9uKGUpIHtyZXR1cm4gZS5pbm5lckhUTUwgPSAiPGlucHV0Lz4iLCBlLmZpcnN0Q2hpbGQuc2V0QXR0cmlidXRlKCJ2YWx1ZSIsICIiKSwgIiIgPT09IGUuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoInZhbHVlIil9KSB8fCBmZSgidmFsdWUiLCBmdW5jdGlvbihlLCB0LCBuKSB7aWYoIW4gJiYgImlucHV0IiA9PT0gZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKSByZXR1cm4gZS5kZWZhdWx0VmFsdWV9KSwgY2UoZnVuY3Rpb24oZSkge3JldHVybiBudWxsID09IGUuZ2V0QXR0cmlidXRlKCJkaXNhYmxlZCIpfSkgfHwgZmUoUiwgZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCXZhciByOw0KCQkJCWlmKCFuKSByZXR1cm4gITAgPT09IGVbdF0gPyB0LnRvTG93ZXJDYXNlKCkgOiAociA9IGUuZ2V0QXR0cmlidXRlTm9kZSh0KSkgJiYgci5zcGVjaWZpZWQgPyByLnZhbHVlIDogbnVsbA0KCQkJfSksIHNlDQoJCX0oQyk7DQoJCUUuZmluZCA9IGQsIEUuZXhwciA9IGQuc2VsZWN0b3JzLCBFLmV4cHJbIjoiXSA9IEUuZXhwci5wc2V1ZG9zLCBFLnVuaXF1ZVNvcnQgPSBFLnVuaXF1ZSA9IGQudW5pcXVlU29ydCwgRS50ZXh0ID0gZC5nZXRUZXh0LCBFLmlzWE1MRG9jID0gZC5pc1hNTCwgRS5jb250YWlucyA9IGQuY29udGFpbnMsIEUuZXNjYXBlU2VsZWN0b3IgPSBkLmVzY2FwZTsNCgkJdmFyIGggPSBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQl2YXIgciA9IFtdLCBpID0gdm9pZCAwICE9PSBuOw0KCQkJd2hpbGUoKGUgPSBlW3RdKSAmJiA5ICE9PSBlLm5vZGVUeXBlKSBpZigxID09PSBlLm5vZGVUeXBlKSB7DQoJCQkJaWYoaSAmJiBFKGUpLmlzKG4pKSBicmVhazsNCgkJCQlyLnB1c2goZSkNCgkJCX0NCgkJCXJldHVybiByDQoJCX0sIFQgID0gZnVuY3Rpb24oZSwgdCkgew0KCQkJZm9yKHZhciBuID0gW107IGU7IGUgPSBlLm5leHRTaWJsaW5nKSAxID09PSBlLm5vZGVUeXBlICYmIGUgIT09IHQgJiYgbi5wdXNoKGUpOw0KCQkJcmV0dXJuIG4NCgkJfSwgayAgPSBFLmV4cHIubWF0Y2gubmVlZHNDb250ZXh0Ow0KDQoJCWZ1bmN0aW9uIEEoZSwgdCkge3JldHVybiBlLm5vZGVOYW1lICYmIGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gdC50b0xvd2VyQ2FzZSgpfQ0KDQoJCXZhciBOID0gL148KFthLXpdW15cL1wwPjpceDIwXHRcclxuXGZdKilbXHgyMFx0XHJcblxmXSpcLz8+KD86PFwvXDE+fCkkL2k7DQoNCgkJZnVuY3Rpb24gaihlLCBuLCByKSB7cmV0dXJuIG0obikgPyBFLmdyZXAoZSwgZnVuY3Rpb24oZSwgdCkge3JldHVybiAhIW4uY2FsbChlLCB0LCBlKSAhPT0gcn0pIDogbi5ub2RlVHlwZSA/IEUuZ3JlcChlLCBmdW5jdGlvbihlKSB7cmV0dXJuIGUgPT09IG4gIT09IHJ9KSA6ICJzdHJpbmciICE9IHR5cGVvZiBuID8gRS5ncmVwKGUsIGZ1bmN0aW9uKGUpIHtyZXR1cm4gLTEgPCBpLmNhbGwobiwgZSkgIT09IHJ9KSA6IEUuZmlsdGVyKG4sIGUsIHIpfQ0KDQoJCUUuZmlsdGVyID0gZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJdmFyIHIgPSB0WzBdOw0KCQkJcmV0dXJuIG4gJiYgKGUgPSAiOm5vdCgiICsgZSArICIpIiksIDEgPT09IHQubGVuZ3RoICYmIDEgPT09IHIubm9kZVR5cGUgPyBFLmZpbmQubWF0Y2hlc1NlbGVjdG9yKHIsIGUpID8gW3JdIDogW10gOiBFLmZpbmQubWF0Y2hlcyhlLCBFLmdyZXAodCwgZnVuY3Rpb24oZSkge3JldHVybiAxID09PSBlLm5vZGVUeXBlfSkpDQoJCX0sIEUuZm4uZXh0ZW5kKHsNCgkJCWZpbmQ6IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCwgbiwgciA9IHRoaXMubGVuZ3RoLCBpID0gdGhpczsNCgkJCQlpZigic3RyaW5nIiAhPSB0eXBlb2YgZSkgcmV0dXJuIHRoaXMucHVzaFN0YWNrKEUoZSkuZmlsdGVyKGZ1bmN0aW9uKCkge2Zvcih0ID0gMDsgdCA8IHI7IHQrKykgaWYoRS5jb250YWlucyhpW3RdLCB0aGlzKSkgcmV0dXJuICEwfSkpOw0KCQkJCWZvcihuID0gdGhpcy5wdXNoU3RhY2soW10pLCB0ID0gMDsgdCA8IHI7IHQrKykgRS5maW5kKGUsIGlbdF0sIG4pOw0KCQkJCXJldHVybiAxIDwgciA/IEUudW5pcXVlU29ydChuKSA6IG4NCgkJCX0sIGZpbHRlcjogZnVuY3Rpb24oZSkge3JldHVybiB0aGlzLnB1c2hTdGFjayhqKHRoaXMsIGUgfHwgW10sICExKSl9LCBub3Q6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gdGhpcy5wdXNoU3RhY2soaih0aGlzLCBlIHx8IFtdLCAhMCkpfSwgaXM6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gISFqKHRoaXMsICJzdHJpbmciID09IHR5cGVvZiBlICYmIGsudGVzdChlKSA/IEUoZSkgOiBlIHx8IFtdLCAhMSkubGVuZ3RofQ0KCQl9KTsNCgkJdmFyIEQsIHEgPSAvXig/OlxzKig8W1x3XFddKz4pW14+XSp8IyhbXHctXSspKSQvOw0KCQkoRS5mbi5pbml0ID0gZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJdmFyIHIsIGk7DQoJCQlpZighZSkgcmV0dXJuIHRoaXM7DQoJCQlpZihuID0gbiB8fCBELCAic3RyaW5nIiA9PSB0eXBlb2YgZSkgew0KCQkJCWlmKCEociA9ICI8IiA9PT0gZVswXSAmJiAiPiIgPT09IGVbZS5sZW5ndGggLSAxXSAmJiAzIDw9IGUubGVuZ3RoID8gW251bGwsIGUsIG51bGxdIDogcS5leGVjKGUpKSB8fCAhclsxXSAmJiB0KSByZXR1cm4gIXQgfHwgdC5qcXVlcnkgPyAodCB8fCBuKS5maW5kKGUpIDogdGhpcy5jb25zdHJ1Y3Rvcih0KS5maW5kKGUpOw0KCQkJCWlmKHJbMV0pIHsNCgkJCQkJaWYodCA9IHQgaW5zdGFuY2VvZiBFID8gdFswXSA6IHQsIEUubWVyZ2UodGhpcywgRS5wYXJzZUhUTUwoclsxXSwgdCAmJiB0Lm5vZGVUeXBlID8gdC5vd25lckRvY3VtZW50IHx8IHQgOiBTLCAhMCkpLCBOLnRlc3QoclsxXSkgJiYgRS5pc1BsYWluT2JqZWN0KHQpKSBmb3IociBpbiB0KSBtKHRoaXNbcl0pID8gdGhpc1tyXSh0W3JdKSA6IHRoaXMuYXR0cihyLCB0W3JdKTsNCgkJCQkJcmV0dXJuIHRoaXMNCgkJCQl9DQoJCQkJcmV0dXJuIChpID0gUy5nZXRFbGVtZW50QnlJZChyWzJdKSkgJiYgKHRoaXNbMF0gPSBpLCB0aGlzLmxlbmd0aCA9IDEpLCB0aGlzDQoJCQl9DQoJCQlyZXR1cm4gZS5ub2RlVHlwZSA/ICh0aGlzWzBdID0gZSwgdGhpcy5sZW5ndGggPSAxLCB0aGlzKSA6IG0oZSkgPyB2b2lkIDAgIT09IG4ucmVhZHkgPyBuLnJlYWR5KGUpIDogZShFKSA6IEUubWFrZUFycmF5KGUsIHRoaXMpDQoJCX0pLnByb3RvdHlwZSA9IEUuZm4sIEQgPSBFKFMpOw0KCQl2YXIgTCA9IC9eKD86cGFyZW50c3xwcmV2KD86VW50aWx8QWxsKSkvLCBIID0ge2NoaWxkcmVuOiAhMCwgY29udGVudHM6ICEwLCBuZXh0OiAhMCwgcHJldjogITB9Ow0KDQoJCWZ1bmN0aW9uIE8oZSwgdCkgew0KCQkJd2hpbGUoKGUgPSBlW3RdKSAmJiAxICE9PSBlLm5vZGVUeXBlKSA7DQoJCQlyZXR1cm4gZQ0KCQl9DQoNCgkJRS5mbi5leHRlbmQoew0KCQkJaGFzOiBmdW5jdGlvbihlKSB7DQoJCQkJdmFyIHQgPSBFKGUsIHRoaXMpLCBuID0gdC5sZW5ndGg7DQoJCQkJcmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uKCkge2Zvcih2YXIgZSA9IDA7IGUgPCBuOyBlKyspIGlmKEUuY29udGFpbnModGhpcywgdFtlXSkpIHJldHVybiAhMH0pDQoJCQl9LA0KCQkJY2xvc2VzdDogZnVuY3Rpb24oZSwgdCkgew0KCQkJCXZhciBuLCByID0gMCwgaSA9IHRoaXMubGVuZ3RoLCBvID0gW10sIGEgPSAic3RyaW5nIiAhPSB0eXBlb2YgZSAmJiBFKGUpOw0KCQkJCWlmKCFrLnRlc3QoZSkpIGZvcig7IHIgPCBpOyByKyspIGZvcihuID0gdGhpc1tyXTsgbiAmJiBuICE9PSB0OyBuID0gbi5wYXJlbnROb2RlKSBpZihuLm5vZGVUeXBlIDwgMTEgJiYgKGEgPyAtMSA8IGEuaW5kZXgobikgOiAxID09PSBuLm5vZGVUeXBlICYmIEUuZmluZC5tYXRjaGVzU2VsZWN0b3IobiwgZSkpKSB7DQoJCQkJCW8ucHVzaChuKTsNCgkJCQkJYnJlYWsNCgkJCQl9DQoJCQkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKDEgPCBvLmxlbmd0aCA/IEUudW5pcXVlU29ydChvKSA6IG8pDQoJCQl9LA0KCQkJaW5kZXg6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gZSA/ICJzdHJpbmciID09IHR5cGVvZiBlID8gaS5jYWxsKEUoZSksIHRoaXNbMF0pIDogaS5jYWxsKHRoaXMsIGUuanF1ZXJ5ID8gZVswXSA6IGUpIDogdGhpc1swXSAmJiB0aGlzWzBdLnBhcmVudE5vZGUgPyB0aGlzLmZpcnN0KCkucHJldkFsbCgpLmxlbmd0aCA6IC0xfSwNCgkJCWFkZDogZnVuY3Rpb24oZSwgdCkge3JldHVybiB0aGlzLnB1c2hTdGFjayhFLnVuaXF1ZVNvcnQoRS5tZXJnZSh0aGlzLmdldCgpLCBFKGUsIHQpKSkpfSwNCgkJCWFkZEJhY2s6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gdGhpcy5hZGQobnVsbCA9PSBlID8gdGhpcy5wcmV2T2JqZWN0IDogdGhpcy5wcmV2T2JqZWN0LmZpbHRlcihlKSl9DQoJCX0pLCBFLmVhY2goew0KCQkJcGFyZW50OiBmdW5jdGlvbihlKSB7DQoJCQkJdmFyIHQgPSBlLnBhcmVudE5vZGU7DQoJCQkJcmV0dXJuIHQgJiYgMTEgIT09IHQubm9kZVR5cGUgPyB0IDogbnVsbA0KCQkJfSwNCgkJCXBhcmVudHM6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gaChlLCAicGFyZW50Tm9kZSIpfSwNCgkJCXBhcmVudHNVbnRpbDogZnVuY3Rpb24oZSwgdCwgbikge3JldHVybiBoKGUsICJwYXJlbnROb2RlIiwgbil9LA0KCQkJbmV4dDogZnVuY3Rpb24oZSkge3JldHVybiBPKGUsICJuZXh0U2libGluZyIpfSwNCgkJCXByZXY6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gTyhlLCAicHJldmlvdXNTaWJsaW5nIil9LA0KCQkJbmV4dEFsbDogZnVuY3Rpb24oZSkge3JldHVybiBoKGUsICJuZXh0U2libGluZyIpfSwNCgkJCXByZXZBbGw6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gaChlLCAicHJldmlvdXNTaWJsaW5nIil9LA0KCQkJbmV4dFVudGlsOiBmdW5jdGlvbihlLCB0LCBuKSB7cmV0dXJuIGgoZSwgIm5leHRTaWJsaW5nIiwgbil9LA0KCQkJcHJldlVudGlsOiBmdW5jdGlvbihlLCB0LCBuKSB7cmV0dXJuIGgoZSwgInByZXZpb3VzU2libGluZyIsIG4pfSwNCgkJCXNpYmxpbmdzOiBmdW5jdGlvbihlKSB7cmV0dXJuIFQoKGUucGFyZW50Tm9kZSB8fCB7fSkuZmlyc3RDaGlsZCwgZSl9LA0KCQkJY2hpbGRyZW46IGZ1bmN0aW9uKGUpIHtyZXR1cm4gVChlLmZpcnN0Q2hpbGQpfSwNCgkJCWNvbnRlbnRzOiBmdW5jdGlvbihlKSB7cmV0dXJuIG51bGwgIT0gZS5jb250ZW50RG9jdW1lbnQgJiYgcihlLmNvbnRlbnREb2N1bWVudCkgPyBlLmNvbnRlbnREb2N1bWVudCA6IChBKGUsICJ0ZW1wbGF0ZSIpICYmIChlID0gZS5jb250ZW50IHx8IGUpLCBFLm1lcmdlKFtdLCBlLmNoaWxkTm9kZXMpKX0NCgkJfSwgZnVuY3Rpb24ociwgaSkgew0KCQkJRS5mbltyXSA9IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQl2YXIgbiA9IEUubWFwKHRoaXMsIGksIGUpOw0KCQkJCXJldHVybiAiVW50aWwiICE9PSByLnNsaWNlKC01KSAmJiAodCA9IGUpLCB0ICYmICJzdHJpbmciID09IHR5cGVvZiB0ICYmIChuID0gRS5maWx0ZXIodCwgbikpLCAxIDwgdGhpcy5sZW5ndGggJiYgKEhbcl0gfHwgRS51bmlxdWVTb3J0KG4pLCBMLnRlc3QocikgJiYgbi5yZXZlcnNlKCkpLCB0aGlzLnB1c2hTdGFjayhuKQ0KCQkJfQ0KCQl9KTsNCgkJdmFyIFAgPSAvW15ceDIwXHRcclxuXGZdKy9nOw0KDQoJCWZ1bmN0aW9uIFIoZSkge3JldHVybiBlfQ0KDQoJCWZ1bmN0aW9uIE0oZSkge3Rocm93IGV9DQoNCgkJZnVuY3Rpb24gSShlLCB0LCBuLCByKSB7DQoJCQl2YXIgaTsNCgkJCXRyeSB7ZSAmJiBtKGkgPSBlLnByb21pc2UpID8gaS5jYWxsKGUpLmRvbmUodCkuZmFpbChuKSA6IGUgJiYgbShpID0gZS50aGVuKSA/IGkuY2FsbChlLCB0LCBuKSA6IHQuYXBwbHkodm9pZCAwLCBbZV0uc2xpY2UocikpfSBjYXRjaChlKSB7bi5hcHBseSh2b2lkIDAsIFtlXSl9DQoJCX0NCg0KCQlFLkNhbGxiYWNrcyA9IGZ1bmN0aW9uKHIpIHsNCgkJCXZhciBlLCBuOw0KCQkJciA9ICJzdHJpbmciID09IHR5cGVvZiByID8gKGUgPSByLCBuID0ge30sIEUuZWFjaChlLm1hdGNoKFApIHx8IFtdLCBmdW5jdGlvbihlLCB0KSB7blt0XSA9ICEwfSksIG4pIDogRS5leHRlbmQoe30sIHIpOw0KCQkJdmFyIGksDQoJCQkgICAgdCwNCgkJCSAgICBvLA0KCQkJICAgIGEsDQoJCQkgICAgcyA9IFtdLA0KCQkJICAgIHUgPSBbXSwNCgkJCSAgICBsID0gLTEsDQoJCQkgICAgYyA9IGZ1bmN0aW9uKCkgew0KCQkJCSAgICBmb3IoYSA9IGEgfHwgci5vbmNlLCBvID0gaSA9ICEwOyB1Lmxlbmd0aDsgbCA9IC0xKSB7DQoJCQkJCSAgICB0ID0gdS5zaGlmdCgpOw0KCQkJCQkgICAgd2hpbGUoKytsIDwgcy5sZW5ndGgpICExID09PSBzW2xdLmFwcGx5KHRbMF0sIHRbMV0pICYmIHIuc3RvcE9uRmFsc2UgJiYgKGwgPSBzLmxlbmd0aCwgdCA9ICExKQ0KCQkJCSAgICB9DQoJCQkJICAgIHIubWVtb3J5IHx8ICh0ID0gITEpLCBpID0gITEsIGEgJiYgKHMgPSB0ID8gW10gOiAiIikNCgkJCSAgICB9LA0KCQkJICAgIGYgPSB7DQoJCQkJICAgIGFkZDogZnVuY3Rpb24oKSB7cmV0dXJuIHMgJiYgKHQgJiYgIWkgJiYgKGwgPSBzLmxlbmd0aCAtIDEsIHUucHVzaCh0KSksIGZ1bmN0aW9uIG4oZSkge0UuZWFjaChlLCBmdW5jdGlvbihlLCB0KSB7bSh0KSA/IHIudW5pcXVlICYmIGYuaGFzKHQpIHx8IHMucHVzaCh0KSA6IHQgJiYgdC5sZW5ndGggJiYgInN0cmluZyIgIT09IHcodCkgJiYgbih0KX0pfShhcmd1bWVudHMpLCB0ICYmICFpICYmIGMoKSksIHRoaXN9LA0KCQkJCSAgICByZW1vdmU6IGZ1bmN0aW9uKCkgew0KCQkJCQkgICAgcmV0dXJuIEUuZWFjaChhcmd1bWVudHMsIGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJCSAgICB2YXIgbjsNCgkJCQkJCSAgICB3aGlsZSgtMSA8IChuID0gRS5pbkFycmF5KHQsIHMsIG4pKSkgcy5zcGxpY2UobiwgMSksIG4gPD0gbCAmJiBsLS0NCgkJCQkJICAgIH0pLCB0aGlzDQoJCQkJICAgIH0sDQoJCQkJICAgIGhhczogZnVuY3Rpb24oZSkge3JldHVybiBlID8gLTEgPCBFLmluQXJyYXkoZSwgcykgOiAwIDwgcy5sZW5ndGh9LA0KCQkJCSAgICBlbXB0eTogZnVuY3Rpb24oKSB7cmV0dXJuIHMgJiYgKHMgPSBbXSksIHRoaXN9LA0KCQkJCSAgICBkaXNhYmxlOiBmdW5jdGlvbigpIHtyZXR1cm4gYSA9IHUgPSBbXSwgcyA9IHQgPSAiIiwgdGhpc30sDQoJCQkJICAgIGRpc2FibGVkOiBmdW5jdGlvbigpIHtyZXR1cm4gIXN9LA0KCQkJCSAgICBsb2NrOiBmdW5jdGlvbigpIHtyZXR1cm4gYSA9IHUgPSBbXSwgdCB8fCBpIHx8IChzID0gdCA9ICIiKSwgdGhpc30sDQoJCQkJICAgIGxvY2tlZDogZnVuY3Rpb24oKSB7cmV0dXJuICEhYX0sDQoJCQkJICAgIGZpcmVXaXRoOiBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIGEgfHwgKHQgPSBbZSwgKHQgPSB0IHx8IFtdKS5zbGljZSA/IHQuc2xpY2UoKSA6IHRdLCB1LnB1c2godCksIGkgfHwgYygpKSwgdGhpc30sDQoJCQkJICAgIGZpcmU6IGZ1bmN0aW9uKCkge3JldHVybiBmLmZpcmVXaXRoKHRoaXMsIGFyZ3VtZW50cyksIHRoaXN9LA0KCQkJCSAgICBmaXJlZDogZnVuY3Rpb24oKSB7cmV0dXJuICEhb30NCgkJCSAgICB9Ow0KCQkJcmV0dXJuIGYNCgkJfSwgRS5leHRlbmQoew0KCQkJRGVmZXJyZWQ6IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgbyA9IFtbIm5vdGlmeSIsICJwcm9ncmVzcyIsIEUuQ2FsbGJhY2tzKCJtZW1vcnkiKSwgRS5DYWxsYmFja3MoIm1lbW9yeSIpLCAyXSwgWyJyZXNvbHZlIiwgImRvbmUiLCBFLkNhbGxiYWNrcygib25jZSBtZW1vcnkiKSwgRS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksIDAsICJyZXNvbHZlZCJdLCBbInJlamVjdCIsICJmYWlsIiwgRS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksIEUuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLCAxLCAicmVqZWN0ZWQiXV0sDQoJCQkJICAgIGkgPSAicGVuZGluZyIsDQoJCQkJICAgIGEgPSB7DQoJCQkJCSAgICBzdGF0ZTogZnVuY3Rpb24oKSB7cmV0dXJuIGl9LCBhbHdheXM6IGZ1bmN0aW9uKCkge3JldHVybiBzLmRvbmUoYXJndW1lbnRzKS5mYWlsKGFyZ3VtZW50cyksIHRoaXN9LCAiY2F0Y2giOiBmdW5jdGlvbihlKSB7cmV0dXJuIGEudGhlbihudWxsLCBlKX0sIHBpcGU6IGZ1bmN0aW9uKCkgew0KCQkJCQkJICAgIHZhciBpID0gYXJndW1lbnRzOw0KCQkJCQkJICAgIHJldHVybiBFLkRlZmVycmVkKGZ1bmN0aW9uKHIpIHsNCgkJCQkJCQkgICAgRS5lYWNoKG8sIGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJCQkJICAgIHZhciBuID0gbShpW3RbNF1dKSAmJiBpW3RbNF1dOw0KCQkJCQkJCQkgICAgc1t0WzFdXShmdW5jdGlvbigpIHsNCgkJCQkJCQkJCSAgICB2YXIgZSA9IG4gJiYgbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOw0KCQkJCQkJCQkJICAgIGUgJiYgbShlLnByb21pc2UpID8gZS5wcm9taXNlKCkucHJvZ3Jlc3Moci5ub3RpZnkpLmRvbmUoci5yZXNvbHZlKS5mYWlsKHIucmVqZWN0KSA6IHJbdFswXSArICJXaXRoIl0odGhpcywgbiA/IFtlXSA6IGFyZ3VtZW50cykNCgkJCQkJCQkJICAgIH0pDQoJCQkJCQkJICAgIH0pLCBpID0gbnVsbA0KCQkJCQkJICAgIH0pLnByb21pc2UoKQ0KCQkJCQkgICAgfSwgdGhlbjogZnVuY3Rpb24odCwgbiwgcikgew0KCQkJCQkJICAgIHZhciB1ID0gMDsNCg0KCQkJCQkJICAgIGZ1bmN0aW9uIGwoaSwgbywgYSwgcykgew0KCQkJCQkJCSAgICByZXR1cm4gZnVuY3Rpb24oKSB7DQoJCQkJCQkJCSAgICB2YXIgbiA9IHRoaXMsIHIgPSBhcmd1bWVudHMsIGUgPSBmdW5jdGlvbigpIHsNCgkJCQkJCQkJCSAgICB2YXIgZSwgdDsNCgkJCQkJCQkJCSAgICBpZighKGkgPCB1KSkgew0KCQkJCQkJCQkJCSAgICBpZigoZSA9IGEuYXBwbHkobiwgcikpID09PSBvLnByb21pc2UoKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiVGhlbmFibGUgc2VsZi1yZXNvbHV0aW9uIik7DQoJCQkJCQkJCQkJICAgIHQgPSBlICYmICgib2JqZWN0IiA9PSB0eXBlb2YgZSB8fCAiZnVuY3Rpb24iID09IHR5cGVvZiBlKSAmJiBlLnRoZW4sIG0odCkgPyBzID8gdC5jYWxsKGUsIGwodSwgbywgUiwgcyksIGwodSwgbywgTSwgcykpIDogKHUrKywgdC5jYWxsKGUsIGwodSwgbywgUiwgcyksIGwodSwgbywgTSwgcyksIGwodSwgbywgUiwgby5ub3RpZnlXaXRoKSkpIDogKGEgIT09IFIgJiYgKG4gPSB2b2lkIDAsIHIgPSBbZV0pLCAocyB8fCBvLnJlc29sdmVXaXRoKShuLCByKSkNCgkJCQkJCQkJCSAgICB9DQoJCQkJCQkJCSAgICB9LCB0ID0gcyA/IGUgOiBmdW5jdGlvbigpIHt0cnkge2UoKX0gY2F0Y2goZSkge0UuRGVmZXJyZWQuZXhjZXB0aW9uSG9vayAmJiBFLkRlZmVycmVkLmV4Y2VwdGlvbkhvb2soZSwgdC5zdGFja1RyYWNlKSwgdSA8PSBpICsgMSAmJiAoYSAhPT0gTSAmJiAobiA9IHZvaWQgMCwgciA9IFtlXSksIG8ucmVqZWN0V2l0aChuLCByKSl9fTsNCgkJCQkJCQkJICAgIGkgPyB0KCkgOiAoRS5EZWZlcnJlZC5nZXRTdGFja0hvb2sgJiYgKHQuc3RhY2tUcmFjZSA9IEUuRGVmZXJyZWQuZ2V0U3RhY2tIb29rKCkpLCBDLnNldFRpbWVvdXQodCkpDQoJCQkJCQkJICAgIH0NCgkJCQkJCSAgICB9DQoNCgkJCQkJCSAgICByZXR1cm4gRS5EZWZlcnJlZChmdW5jdGlvbihlKSB7b1swXVszXS5hZGQobCgwLCBlLCBtKHIpID8gciA6IFIsIGUubm90aWZ5V2l0aCkpLCBvWzFdWzNdLmFkZChsKDAsIGUsIG0odCkgPyB0IDogUikpLCBvWzJdWzNdLmFkZChsKDAsIGUsIG0obikgPyBuIDogTSkpfSkucHJvbWlzZSgpDQoJCQkJCSAgICB9LCBwcm9taXNlOiBmdW5jdGlvbihlKSB7cmV0dXJuIG51bGwgIT0gZSA/IEUuZXh0ZW5kKGUsIGEpIDogYX0NCgkJCQkgICAgfSwNCgkJCQkgICAgcyA9IHt9Ow0KCQkJCXJldHVybiBFLmVhY2gobywgZnVuY3Rpb24oZSwgdCkgew0KCQkJCQl2YXIgbiA9IHRbMl0sIHIgPSB0WzVdOw0KCQkJCQlhW3RbMV1dID0gbi5hZGQsIHIgJiYgbi5hZGQoZnVuY3Rpb24oKSB7aSA9IHJ9LCBvWzMgLSBlXVsyXS5kaXNhYmxlLCBvWzMgLSBlXVszXS5kaXNhYmxlLCBvWzBdWzJdLmxvY2ssIG9bMF1bM10ubG9jayksIG4uYWRkKHRbM10uZmlyZSksIHNbdFswXV0gPSBmdW5jdGlvbigpIHtyZXR1cm4gc1t0WzBdICsgIldpdGgiXSh0aGlzID09PSBzID8gdm9pZCAwIDogdGhpcywgYXJndW1lbnRzKSwgdGhpc30sIHNbdFswXSArICJXaXRoIl0gPSBuLmZpcmVXaXRoDQoJCQkJfSksIGEucHJvbWlzZShzKSwgZSAmJiBlLmNhbGwocywgcyksIHMNCgkJCX0sIHdoZW46IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgbiA9IGFyZ3VtZW50cy5sZW5ndGgsIHQgPSBuLCByID0gQXJyYXkodCksIGkgPSBzLmNhbGwoYXJndW1lbnRzKSwgbyA9IEUuRGVmZXJyZWQoKSwgYSA9IGZ1bmN0aW9uKHQpIHtyZXR1cm4gZnVuY3Rpb24oZSkge3JbdF0gPSB0aGlzLCBpW3RdID0gMSA8IGFyZ3VtZW50cy5sZW5ndGggPyBzLmNhbGwoYXJndW1lbnRzKSA6IGUsIC0tbiB8fCBvLnJlc29sdmVXaXRoKHIsIGkpfX07DQoJCQkJaWYobiA8PSAxICYmIChJKGUsIG8uZG9uZShhKHQpKS5yZXNvbHZlLCBvLnJlamVjdCwgIW4pLCAicGVuZGluZyIgPT09IG8uc3RhdGUoKSB8fCBtKGlbdF0gJiYgaVt0XS50aGVuKSkpIHJldHVybiBvLnRoZW4oKTsNCgkJCQl3aGlsZSh0LS0pIEkoaVt0XSwgYSh0KSwgby5yZWplY3QpOw0KCQkJCXJldHVybiBvLnByb21pc2UoKQ0KCQkJfQ0KCQl9KTsNCgkJdmFyIFcgPSAvXihFdmFsfEludGVybmFsfFJhbmdlfFJlZmVyZW5jZXxTeW50YXh8VHlwZXxVUkkpRXJyb3IkLzsNCgkJRS5EZWZlcnJlZC5leGNlcHRpb25Ib29rID0gZnVuY3Rpb24oZSwgdCkge0MuY29uc29sZSAmJiBDLmNvbnNvbGUud2FybiAmJiBlICYmIFcudGVzdChlLm5hbWUpICYmIEMuY29uc29sZS53YXJuKCJqUXVlcnkuRGVmZXJyZWQgZXhjZXB0aW9uOiAiICsgZS5tZXNzYWdlLCBlLnN0YWNrLCB0KX0sIEUucmVhZHlFeGNlcHRpb24gPSBmdW5jdGlvbihlKSB7Qy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkge3Rocm93IGV9KX07DQoJCXZhciBGID0gRS5EZWZlcnJlZCgpOw0KDQoJCWZ1bmN0aW9uICQoKSB7Uy5yZW1vdmVFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgJCksIEMucmVtb3ZlRXZlbnRMaXN0ZW5lcigibG9hZCIsICQpLCBFLnJlYWR5KCl9DQoNCgkJRS5mbi5yZWFkeSA9IGZ1bmN0aW9uKGUpIHtyZXR1cm4gRi50aGVuKGUpWyJjYXRjaCJdKGZ1bmN0aW9uKGUpIHtFLnJlYWR5RXhjZXB0aW9uKGUpfSksIHRoaXN9LCBFLmV4dGVuZCh7DQoJCQlpc1JlYWR5OiAhMSwNCgkJCXJlYWR5V2FpdDogMSwNCgkJCXJlYWR5OiBmdW5jdGlvbihlKSB7KCEwID09PSBlID8gLS1FLnJlYWR5V2FpdCA6IEUuaXNSZWFkeSkgfHwgKEUuaXNSZWFkeSA9ICEwKSAhPT0gZSAmJiAwIDwgLS1FLnJlYWR5V2FpdCB8fCBGLnJlc29sdmVXaXRoKFMsIFtFXSl9DQoJCX0pLCBFLnJlYWR5LnRoZW4gPSBGLnRoZW4sICJjb21wbGV0ZSIgPT09IFMucmVhZHlTdGF0ZSB8fCAibG9hZGluZyIgIT09IFMucmVhZHlTdGF0ZSAmJiAhUy5kb2N1bWVudEVsZW1lbnQuZG9TY3JvbGwgPyBDLnNldFRpbWVvdXQoRS5yZWFkeSkgOiAoUy5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgJCksIEMuYWRkRXZlbnRMaXN0ZW5lcigibG9hZCIsICQpKTsNCgkJdmFyIEIgPSBmdW5jdGlvbihlLCB0LCBuLCByLCBpLCBvLCBhKSB7DQoJCQl2YXIgcyA9IDAsIHUgPSBlLmxlbmd0aCwgbCA9IG51bGwgPT0gbjsNCgkJCWlmKCJvYmplY3QiID09PSB3KG4pKSBmb3IocyBpbiBpID0gITAsIG4pIEIoZSwgdCwgcywgbltzXSwgITAsIG8sIGEpOyBlbHNlIGlmKHZvaWQgMCAhPT0gciAmJiAoaSA9ICEwLCBtKHIpIHx8IChhID0gITApLCBsICYmIChhID8gKHQuY2FsbChlLCByKSwgdCA9IG51bGwpIDogKGwgPSB0LCB0ID0gZnVuY3Rpb24oZSwgdCwgbikge3JldHVybiBsLmNhbGwoRShlKSwgbil9KSksIHQpKSBmb3IoOyBzIDwgdTsgcysrKSB0KGVbc10sIG4sIGEgPyByIDogci5jYWxsKGVbc10sIHMsIHQoZVtzXSwgbikpKTsNCgkJCXJldHVybiBpID8gZSA6IGwgPyB0LmNhbGwoZSkgOiB1ID8gdChlWzBdLCBuKSA6IG8NCgkJfSwgXyAgPSAvXi1tcy0vLCB6ID0gLy0oW2Etel0pL2c7DQoNCgkJZnVuY3Rpb24gVShlLCB0KSB7cmV0dXJuIHQudG9VcHBlckNhc2UoKX0NCg0KCQlmdW5jdGlvbiBYKGUpIHtyZXR1cm4gZS5yZXBsYWNlKF8sICJtcy0iKS5yZXBsYWNlKHosIFUpfQ0KDQoJCXZhciBWID0gZnVuY3Rpb24oZSkge3JldHVybiAxID09PSBlLm5vZGVUeXBlIHx8IDkgPT09IGUubm9kZVR5cGUgfHwgIStlLm5vZGVUeXBlfTsNCg0KCQlmdW5jdGlvbiBHKCkge3RoaXMuZXhwYW5kbyA9IEUuZXhwYW5kbyArIEcudWlkKyt9DQoNCgkJRy51aWQgPSAxLCBHLnByb3RvdHlwZSA9IHsNCgkJCWNhY2hlOiBmdW5jdGlvbihlKSB7DQoJCQkJdmFyIHQgPSBlW3RoaXMuZXhwYW5kb107DQoJCQkJcmV0dXJuIHQgfHwgKHQgPSB7fSwgVihlKSAmJiAoZS5ub2RlVHlwZSA/IGVbdGhpcy5leHBhbmRvXSA9IHQgOiBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgdGhpcy5leHBhbmRvLCB7dmFsdWU6IHQsIGNvbmZpZ3VyYWJsZTogITB9KSkpLCB0DQoJCQl9LA0KCQkJc2V0OiBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJdmFyIHIsIGkgPSB0aGlzLmNhY2hlKGUpOw0KCQkJCWlmKCJzdHJpbmciID09IHR5cGVvZiB0KSBpW1godCldID0gbjsgZWxzZSBmb3IociBpbiB0KSBpW1gocildID0gdFtyXTsNCgkJCQlyZXR1cm4gaQ0KCQkJfSwNCgkJCWdldDogZnVuY3Rpb24oZSwgdCkge3JldHVybiB2b2lkIDAgPT09IHQgPyB0aGlzLmNhY2hlKGUpIDogZVt0aGlzLmV4cGFuZG9dICYmIGVbdGhpcy5leHBhbmRvXVtYKHQpXX0sDQoJCQlhY2Nlc3M6IGZ1bmN0aW9uKGUsIHQsIG4pIHtyZXR1cm4gdm9pZCAwID09PSB0IHx8IHQgJiYgInN0cmluZyIgPT0gdHlwZW9mIHQgJiYgdm9pZCAwID09PSBuID8gdGhpcy5nZXQoZSwgdCkgOiAodGhpcy5zZXQoZSwgdCwgbiksIHZvaWQgMCAhPT0gbiA/IG4gOiB0KX0sDQoJCQlyZW1vdmU6IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQl2YXIgbiwgciA9IGVbdGhpcy5leHBhbmRvXTsNCgkJCQlpZih2b2lkIDAgIT09IHIpIHsNCgkJCQkJaWYodm9pZCAwICE9PSB0KSB7DQoJCQkJCQluID0gKHQgPSBBcnJheS5pc0FycmF5KHQpID8gdC5tYXAoWCkgOiAodCA9IFgodCkpIGluIHIgPyBbdF0gOiB0Lm1hdGNoKFApIHx8IFtdKS5sZW5ndGg7DQoJCQkJCQl3aGlsZShuLS0pIGRlbGV0ZSByW3Rbbl1dDQoJCQkJCX0NCgkJCQkJKHZvaWQgMCA9PT0gdCB8fCBFLmlzRW1wdHlPYmplY3QocikpICYmIChlLm5vZGVUeXBlID8gZVt0aGlzLmV4cGFuZG9dID0gdm9pZCAwIDogZGVsZXRlIGVbdGhpcy5leHBhbmRvXSkNCgkJCQl9DQoJCQl9LA0KCQkJaGFzRGF0YTogZnVuY3Rpb24oZSkgew0KCQkJCXZhciB0ID0gZVt0aGlzLmV4cGFuZG9dOw0KCQkJCXJldHVybiB2b2lkIDAgIT09IHQgJiYgIUUuaXNFbXB0eU9iamVjdCh0KQ0KCQkJfQ0KCQl9Ow0KCQl2YXIgWSA9IG5ldyBHLCBRID0gbmV3IEcsIEogPSAvXig/Olx7W1x3XFddKlx9fFxbW1x3XFddKlxdKSQvLCBLID0gL1tBLVpdL2c7DQoNCgkJZnVuY3Rpb24gWihlLCB0LCBuKSB7DQoJCQl2YXIgciwgaTsNCgkJCWlmKHZvaWQgMCA9PT0gbiAmJiAxID09PSBlLm5vZGVUeXBlKSBpZihyID0gImRhdGEtIiArIHQucmVwbGFjZShLLCAiLSQmIikudG9Mb3dlckNhc2UoKSwgInN0cmluZyIgPT0gdHlwZW9mIChuID0gZS5nZXRBdHRyaWJ1dGUocikpKSB7DQoJCQkJdHJ5IHtuID0gInRydWUiID09PSAoaSA9IG4pIHx8ICJmYWxzZSIgIT09IGkgJiYgKCJudWxsIiA9PT0gaSA/IG51bGwgOiBpID09PSAraSArICIiID8gK2kgOiBKLnRlc3QoaSkgPyBKU09OLnBhcnNlKGkpIDogaSl9IGNhdGNoKGUpIHt9DQoJCQkJUS5zZXQoZSwgdCwgbikNCgkJCX0gZWxzZSBuID0gdm9pZCAwOw0KCQkJcmV0dXJuIG4NCgkJfQ0KDQoJCUUuZXh0ZW5kKHsNCgkJCWhhc0RhdGE6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gUS5oYXNEYXRhKGUpIHx8IFkuaGFzRGF0YShlKX0sDQoJCQlkYXRhOiBmdW5jdGlvbihlLCB0LCBuKSB7cmV0dXJuIFEuYWNjZXNzKGUsIHQsIG4pfSwNCgkJCXJlbW92ZURhdGE6IGZ1bmN0aW9uKGUsIHQpIHtRLnJlbW92ZShlLCB0KX0sDQoJCQlfZGF0YTogZnVuY3Rpb24oZSwgdCwgbikge3JldHVybiBZLmFjY2VzcyhlLCB0LCBuKX0sDQoJCQlfcmVtb3ZlRGF0YTogZnVuY3Rpb24oZSwgdCkge1kucmVtb3ZlKGUsIHQpfQ0KCQl9KSwgRS5mbi5leHRlbmQoew0KCQkJZGF0YTogZnVuY3Rpb24obiwgZSkgew0KCQkJCXZhciB0LCByLCBpLCBvID0gdGhpc1swXSwgYSA9IG8gJiYgby5hdHRyaWJ1dGVzOw0KCQkJCWlmKHZvaWQgMCA9PT0gbikgew0KCQkJCQlpZih0aGlzLmxlbmd0aCAmJiAoaSA9IFEuZ2V0KG8pLCAxID09PSBvLm5vZGVUeXBlICYmICFZLmdldChvLCAiaGFzRGF0YUF0dHJzIikpKSB7DQoJCQkJCQl0ID0gYS5sZW5ndGg7DQoJCQkJCQl3aGlsZSh0LS0pIGFbdF0gJiYgMCA9PT0gKHIgPSBhW3RdLm5hbWUpLmluZGV4T2YoImRhdGEtIikgJiYgKHIgPSBYKHIuc2xpY2UoNSkpLCBaKG8sIHIsIGlbcl0pKTsNCgkJCQkJCVkuc2V0KG8sICJoYXNEYXRhQXR0cnMiLCAhMCkNCgkJCQkJfQ0KCQkJCQlyZXR1cm4gaQ0KCQkJCX0NCgkJCQlyZXR1cm4gIm9iamVjdCIgPT0gdHlwZW9mIG4gPyB0aGlzLmVhY2goZnVuY3Rpb24oKSB7US5zZXQodGhpcywgbil9KSA6IEIodGhpcywgZnVuY3Rpb24oZSkgew0KCQkJCQl2YXIgdDsNCgkJCQkJaWYobyAmJiB2b2lkIDAgPT09IGUpIHJldHVybiB2b2lkIDAgIT09ICh0ID0gUS5nZXQobywgbikpID8gdCA6IHZvaWQgMCAhPT0gKHQgPSBaKG8sIG4pKSA/IHQgOiB2b2lkIDA7DQoJCQkJCXRoaXMuZWFjaChmdW5jdGlvbigpIHtRLnNldCh0aGlzLCBuLCBlKX0pDQoJCQkJfSwgbnVsbCwgZSwgMSA8IGFyZ3VtZW50cy5sZW5ndGgsIG51bGwsICEwKQ0KCQkJfSwgcmVtb3ZlRGF0YTogZnVuY3Rpb24oZSkge3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7US5yZW1vdmUodGhpcywgZSl9KX0NCgkJfSksIEUuZXh0ZW5kKHsNCgkJCXF1ZXVlOiBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJdmFyIHI7DQoJCQkJaWYoZSkgcmV0dXJuIHQgPSAodCB8fCAiZngiKSArICJxdWV1ZSIsIHIgPSBZLmdldChlLCB0KSwgbiAmJiAoIXIgfHwgQXJyYXkuaXNBcnJheShuKSA/IHIgPSBZLmFjY2VzcyhlLCB0LCBFLm1ha2VBcnJheShuKSkgOiByLnB1c2gobikpLCByIHx8IFtdDQoJCQl9LCBkZXF1ZXVlOiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdCA9IHQgfHwgImZ4IjsNCgkJCQl2YXIgbiA9IEUucXVldWUoZSwgdCksIHIgPSBuLmxlbmd0aCwgaSA9IG4uc2hpZnQoKSwgbyA9IEUuX3F1ZXVlSG9va3MoZSwgdCk7DQoJCQkJImlucHJvZ3Jlc3MiID09PSBpICYmIChpID0gbi5zaGlmdCgpLCByLS0pLCBpICYmICgiZngiID09PSB0ICYmIG4udW5zaGlmdCgiaW5wcm9ncmVzcyIpLCBkZWxldGUgby5zdG9wLCBpLmNhbGwoZSwgZnVuY3Rpb24oKSB7RS5kZXF1ZXVlKGUsIHQpfSwgbykpLCAhciAmJiBvICYmIG8uZW1wdHkuZmlyZSgpDQoJCQl9LCBfcXVldWVIb29rczogZnVuY3Rpb24oZSwgdCkgew0KCQkJCXZhciBuID0gdCArICJxdWV1ZUhvb2tzIjsNCgkJCQlyZXR1cm4gWS5nZXQoZSwgbikgfHwgWS5hY2Nlc3MoZSwgbiwge2VtcHR5OiBFLkNhbGxiYWNrcygib25jZSBtZW1vcnkiKS5hZGQoZnVuY3Rpb24oKSB7WS5yZW1vdmUoZSwgW3QgKyAicXVldWUiLCBuXSl9KX0pDQoJCQl9DQoJCX0pLCBFLmZuLmV4dGVuZCh7DQoJCQlxdWV1ZTogZnVuY3Rpb24odCwgbikgew0KCQkJCXZhciBlID0gMjsNCgkJCQlyZXR1cm4gInN0cmluZyIgIT0gdHlwZW9mIHQgJiYgKG4gPSB0LCB0ID0gImZ4IiwgZS0tKSwgYXJndW1lbnRzLmxlbmd0aCA8IGUgPyBFLnF1ZXVlKHRoaXNbMF0sIHQpIDogdm9pZCAwID09PSBuID8gdGhpcyA6IHRoaXMuZWFjaChmdW5jdGlvbigpIHsNCgkJCQkJdmFyIGUgPSBFLnF1ZXVlKHRoaXMsIHQsIG4pOw0KCQkJCQlFLl9xdWV1ZUhvb2tzKHRoaXMsIHQpLCAiZngiID09PSB0ICYmICJpbnByb2dyZXNzIiAhPT0gZVswXSAmJiBFLmRlcXVldWUodGhpcywgdCkNCgkJCQl9KQ0KCQkJfSwgZGVxdWV1ZTogZnVuY3Rpb24oZSkge3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7RS5kZXF1ZXVlKHRoaXMsIGUpfSl9LCBjbGVhclF1ZXVlOiBmdW5jdGlvbihlKSB7cmV0dXJuIHRoaXMucXVldWUoZSB8fCAiZngiLCBbXSl9LCBwcm9taXNlOiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4sIHIgPSAxLCBpID0gRS5EZWZlcnJlZCgpLCBvID0gdGhpcywgYSA9IHRoaXMubGVuZ3RoLCBzID0gZnVuY3Rpb24oKSB7LS1yIHx8IGkucmVzb2x2ZVdpdGgobywgW29dKX07DQoJCQkJInN0cmluZyIgIT0gdHlwZW9mIGUgJiYgKHQgPSBlLCBlID0gdm9pZCAwKSwgZSA9IGUgfHwgImZ4IjsNCgkJCQl3aGlsZShhLS0pIChuID0gWS5nZXQob1thXSwgZSArICJxdWV1ZUhvb2tzIikpICYmIG4uZW1wdHkgJiYgKHIrKywgbi5lbXB0eS5hZGQocykpOw0KCQkJCXJldHVybiBzKCksIGkucHJvbWlzZSh0KQ0KCQkJfQ0KCQl9KTsNCgkJdmFyIGVlID0gL1srLV0/KD86XGQqXC58KVxkKyg/OltlRV1bKy1dP1xkK3wpLy5zb3VyY2UsIHRlID0gbmV3IFJlZ0V4cCgiXig/OihbKy1dKT18KSgiICsgZWUgKyAiKShbYS16JV0qKSQiLCAiaSIpLCBuZSA9IFsiVG9wIiwgIlJpZ2h0IiwgIkJvdHRvbSIsICJMZWZ0Il0sIHJlID0gUy5kb2N1bWVudEVsZW1lbnQsIGllID0gZnVuY3Rpb24oZSkge3JldHVybiBFLmNvbnRhaW5zKGUub3duZXJEb2N1bWVudCwgZSl9LCBvZSA9IHtjb21wb3NlZDogITB9Ow0KCQlyZS5nZXRSb290Tm9kZSAmJiAoaWUgPSBmdW5jdGlvbihlKSB7cmV0dXJuIEUuY29udGFpbnMoZS5vd25lckRvY3VtZW50LCBlKSB8fCBlLmdldFJvb3ROb2RlKG9lKSA9PT0gZS5vd25lckRvY3VtZW50fSk7DQoJCXZhciBhZSA9IGZ1bmN0aW9uKGUsIHQpIHtyZXR1cm4gIm5vbmUiID09PSAoZSA9IHQgfHwgZSkuc3R5bGUuZGlzcGxheSB8fCAiIiA9PT0gZS5zdHlsZS5kaXNwbGF5ICYmIGllKGUpICYmICJub25lIiA9PT0gRS5jc3MoZSwgImRpc3BsYXkiKX07DQoNCgkJZnVuY3Rpb24gc2UoZSwgdCwgbiwgcikgew0KCQkJdmFyIGksIG8sIGEgPSAyMCwgcyA9IHIgPyBmdW5jdGlvbigpIHtyZXR1cm4gci5jdXIoKX0gOiBmdW5jdGlvbigpIHtyZXR1cm4gRS5jc3MoZSwgdCwgIiIpfSwgdSA9IHMoKSwgbCA9IG4gJiYgblszXSB8fCAoRS5jc3NOdW1iZXJbdF0gPyAiIiA6ICJweCIpLCBjID0gZS5ub2RlVHlwZSAmJiAoRS5jc3NOdW1iZXJbdF0gfHwgInB4IiAhPT0gbCAmJiArdSkgJiYgdGUuZXhlYyhFLmNzcyhlLCB0KSk7DQoJCQlpZihjICYmIGNbM10gIT09IGwpIHsNCgkJCQl1IC89IDIsIGwgPSBsIHx8IGNbM10sIGMgPSArdSB8fCAxOw0KCQkJCXdoaWxlKGEtLSkgRS5zdHlsZShlLCB0LCBjICsgbCksICgxIC0gbykgKiAoMSAtIChvID0gcygpIC8gdSB8fCAuNSkpIDw9IDAgJiYgKGEgPSAwKSwgYyAvPSBvOw0KCQkJCWMgKj0gMiwgRS5zdHlsZShlLCB0LCBjICsgbCksIG4gPSBuIHx8IFtdDQoJCQl9DQoJCQlyZXR1cm4gbiAmJiAoYyA9ICtjIHx8ICt1IHx8IDAsIGkgPSBuWzFdID8gYyArIChuWzFdICsgMSkgKiBuWzJdIDogK25bMl0sIHIgJiYgKHIudW5pdCA9IGwsIHIuc3RhcnQgPSBjLCByLmVuZCA9IGkpKSwgaQ0KCQl9DQoNCgkJdmFyIHVlID0ge307DQoNCgkJZnVuY3Rpb24gbGUoZSwgdCkgew0KCQkJZm9yKHZhciBuLCByLCBpLCBvLCBhLCBzLCB1LCBsID0gW10sIGMgPSAwLCBmID0gZS5sZW5ndGg7IGMgPCBmOyBjKyspIChyID0gZVtjXSkuc3R5bGUgJiYgKG4gPSByLnN0eWxlLmRpc3BsYXksIHQgPyAoIm5vbmUiID09PSBuICYmIChsW2NdID0gWS5nZXQociwgImRpc3BsYXkiKSB8fCBudWxsLCBsW2NdIHx8IChyLnN0eWxlLmRpc3BsYXkgPSAiIikpLCAiIiA9PT0gci5zdHlsZS5kaXNwbGF5ICYmIGFlKHIpICYmIChsW2NdID0gKHUgPSBhID0gbyA9IHZvaWQgMCwgYSA9IChpID0gcikub3duZXJEb2N1bWVudCwgcyA9IGkubm9kZU5hbWUsICh1ID0gdWVbc10pIHx8IChvID0gYS5ib2R5LmFwcGVuZENoaWxkKGEuY3JlYXRlRWxlbWVudChzKSksIHUgPSBFLmNzcyhvLCAiZGlzcGxheSIpLCBvLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobyksICJub25lIiA9PT0gdSAmJiAodSA9ICJibG9jayIpLCB1ZVtzXSA9IHUpKSkpIDogIm5vbmUiICE9PSBuICYmIChsW2NdID0gIm5vbmUiLCBZLnNldChyLCAiZGlzcGxheSIsIG4pKSk7DQoJCQlmb3IoYyA9IDA7IGMgPCBmOyBjKyspIG51bGwgIT0gbFtjXSAmJiAoZVtjXS5zdHlsZS5kaXNwbGF5ID0gbFtjXSk7DQoJCQlyZXR1cm4gZQ0KCQl9DQoNCgkJRS5mbi5leHRlbmQoe3Nob3c6IGZ1bmN0aW9uKCkge3JldHVybiBsZSh0aGlzLCAhMCl9LCBoaWRlOiBmdW5jdGlvbigpIHtyZXR1cm4gbGUodGhpcyl9LCB0b2dnbGU6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gImJvb2xlYW4iID09IHR5cGVvZiBlID8gZSA/IHRoaXMuc2hvdygpIDogdGhpcy5oaWRlKCkgOiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7YWUodGhpcykgPyBFKHRoaXMpLnNob3coKSA6IEUodGhpcykuaGlkZSgpfSl9fSk7DQoJCXZhciBjZSwgZmUsIHBlID0gL14oPzpjaGVja2JveHxyYWRpbykkL2ksIGRlID0gLzwoW2Etel1bXlwvXDA+XHgyMFx0XHJcblxmXSopL2ksIGhlID0gL14kfF5tb2R1bGUkfFwvKD86amF2YXxlY21hKXNjcmlwdC9pOw0KCQljZSA9IFMuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLmFwcGVuZENoaWxkKFMuY3JlYXRlRWxlbWVudCgiZGl2IikpLCAoZmUgPSBTLmNyZWF0ZUVsZW1lbnQoImlucHV0IikpLnNldEF0dHJpYnV0ZSgidHlwZSIsICJyYWRpbyIpLCBmZS5zZXRBdHRyaWJ1dGUoImNoZWNrZWQiLCAiY2hlY2tlZCIpLCBmZS5zZXRBdHRyaWJ1dGUoIm5hbWUiLCAidCIpLCBjZS5hcHBlbmRDaGlsZChmZSksIHYuY2hlY2tDbG9uZSA9IGNlLmNsb25lTm9kZSghMCkuY2xvbmVOb2RlKCEwKS5sYXN0Q2hpbGQuY2hlY2tlZCwgY2UuaW5uZXJIVE1MID0gIjx0ZXh0YXJlYT54PC90ZXh0YXJlYT4iLCB2Lm5vQ2xvbmVDaGVja2VkID0gISFjZS5jbG9uZU5vZGUoITApLmxhc3RDaGlsZC5kZWZhdWx0VmFsdWUsIGNlLmlubmVySFRNTCA9ICI8b3B0aW9uPjwvb3B0aW9uPiIsIHYub3B0aW9uID0gISFjZS5sYXN0Q2hpbGQ7DQoJCXZhciBnZSA9IHt0aGVhZDogWzEsICI8dGFibGU+IiwgIjwvdGFibGU+Il0sIGNvbDogWzIsICI8dGFibGU+PGNvbGdyb3VwPiIsICI8L2NvbGdyb3VwPjwvdGFibGU+Il0sIHRyOiBbMiwgIjx0YWJsZT48dGJvZHk+IiwgIjwvdGJvZHk+PC90YWJsZT4iXSwgdGQ6IFszLCAiPHRhYmxlPjx0Ym9keT48dHI+IiwgIjwvdHI+PC90Ym9keT48L3RhYmxlPiJdLCBfZGVmYXVsdDogWzAsICIiLCAiIl19Ow0KDQoJCWZ1bmN0aW9uIHllKGUsIHQpIHsNCgkJCXZhciBuOw0KCQkJcmV0dXJuIG4gPSAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZS5nZXRFbGVtZW50c0J5VGFnTmFtZSA/IGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUodCB8fCAiKiIpIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIGUucXVlcnlTZWxlY3RvckFsbCA/IGUucXVlcnlTZWxlY3RvckFsbCh0IHx8ICIqIikgOiBbXSwgdm9pZCAwID09PSB0IHx8IHQgJiYgQShlLCB0KSA/IEUubWVyZ2UoW2VdLCBuKSA6IG4NCgkJfQ0KDQoJCWZ1bmN0aW9uIHZlKGUsIHQpIHtmb3IodmFyIG4gPSAwLCByID0gZS5sZW5ndGg7IG4gPCByOyBuKyspIFkuc2V0KGVbbl0sICJnbG9iYWxFdmFsIiwgIXQgfHwgWS5nZXQodFtuXSwgImdsb2JhbEV2YWwiKSl9DQoNCgkJZ2UudGJvZHkgPSBnZS50Zm9vdCA9IGdlLmNvbGdyb3VwID0gZ2UuY2FwdGlvbiA9IGdlLnRoZWFkLCBnZS50aCA9IGdlLnRkLCB2Lm9wdGlvbiB8fCAoZ2Uub3B0Z3JvdXAgPSBnZS5vcHRpb24gPSBbMSwgIjxzZWxlY3QgbXVsdGlwbGU9J211bHRpcGxlJz4iLCAiPC9zZWxlY3Q+Il0pOw0KCQl2YXIgbWUgPSAvPHwmIz9cdys7LzsNCg0KCQlmdW5jdGlvbiB4ZShlLCB0LCBuLCByLCBpKSB7DQoJCQlmb3IodmFyIG8sIGEsIHMsIHUsIGwsIGMsIGYgPSB0LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSwgcCA9IFtdLCBkID0gMCwgaCA9IGUubGVuZ3RoOyBkIDwgaDsgZCsrKSBpZigobyA9IGVbZF0pIHx8IDAgPT09IG8pIGlmKCJvYmplY3QiID09PSB3KG8pKSBFLm1lcmdlKHAsIG8ubm9kZVR5cGUgPyBbb10gOiBvKTsgZWxzZSBpZihtZS50ZXN0KG8pKSB7DQoJCQkJYSA9IGEgfHwgZi5hcHBlbmRDaGlsZCh0LmNyZWF0ZUVsZW1lbnQoImRpdiIpKSwgcyA9IChkZS5leGVjKG8pIHx8IFsiIiwgIiJdKVsxXS50b0xvd2VyQ2FzZSgpLCB1ID0gZ2Vbc10gfHwgZ2UuX2RlZmF1bHQsIGEuaW5uZXJIVE1MID0gdVsxXSArIEUuaHRtbFByZWZpbHRlcihvKSArIHVbMl0sIGMgPSB1WzBdOw0KCQkJCXdoaWxlKGMtLSkgYSA9IGEubGFzdENoaWxkOw0KCQkJCUUubWVyZ2UocCwgYS5jaGlsZE5vZGVzKSwgKGEgPSBmLmZpcnN0Q2hpbGQpLnRleHRDb250ZW50ID0gIiINCgkJCX0gZWxzZSBwLnB1c2godC5jcmVhdGVUZXh0Tm9kZShvKSk7DQoJCQlmLnRleHRDb250ZW50ID0gIiIsIGQgPSAwOw0KCQkJd2hpbGUobyA9IHBbZCsrXSkgaWYociAmJiAtMSA8IEUuaW5BcnJheShvLCByKSkgaSAmJiBpLnB1c2gobyk7IGVsc2UgaWYobCA9IGllKG8pLCBhID0geWUoZi5hcHBlbmRDaGlsZChvKSwgInNjcmlwdCIpLCBsICYmIHZlKGEpLCBuKSB7DQoJCQkJYyA9IDA7DQoJCQkJd2hpbGUobyA9IGFbYysrXSkgaGUudGVzdChvLnR5cGUgfHwgIiIpICYmIG4ucHVzaChvKQ0KCQkJfQ0KCQkJcmV0dXJuIGYNCgkJfQ0KDQoJCXZhciBiZSA9IC9eKFteLl0qKSg/OlwuKC4rKXwpLzsNCg0KCQlmdW5jdGlvbiB3ZSgpIHtyZXR1cm4gITB9DQoNCgkJZnVuY3Rpb24gVGUoKSB7cmV0dXJuICExfQ0KDQoJCWZ1bmN0aW9uIENlKGUsIHQpIHtyZXR1cm4gZSA9PT0gZnVuY3Rpb24oKSB7dHJ5IHtyZXR1cm4gUy5hY3RpdmVFbGVtZW50fSBjYXRjaChlKSB7fX0oKSA9PSAoImZvY3VzIiA9PT0gdCl9DQoNCgkJZnVuY3Rpb24gU2UoZSwgdCwgbiwgciwgaSwgbykgew0KCQkJdmFyIGEsIHM7DQoJCQlpZigib2JqZWN0IiA9PSB0eXBlb2YgdCkgew0KCQkJCWZvcihzIGluICJzdHJpbmciICE9IHR5cGVvZiBuICYmIChyID0gciB8fCBuLCBuID0gdm9pZCAwKSwgdCkgU2UoZSwgcywgbiwgciwgdFtzXSwgbyk7DQoJCQkJcmV0dXJuIGUNCgkJCX0NCgkJCWlmKG51bGwgPT0gciAmJiBudWxsID09IGkgPyAoaSA9IG4sIHIgPSBuID0gdm9pZCAwKSA6IG51bGwgPT0gaSAmJiAoInN0cmluZyIgPT0gdHlwZW9mIG4gPyAoaSA9IHIsIHIgPSB2b2lkIDApIDogKGkgPSByLCByID0gbiwgbiA9IHZvaWQgMCkpLCAhMSA9PT0gaSkgaSA9IFRlOyBlbHNlIGlmKCFpKSByZXR1cm4gZTsNCgkJCXJldHVybiAxID09PSBvICYmIChhID0gaSwgKGkgPSBmdW5jdGlvbihlKSB7cmV0dXJuIEUoKS5vZmYoZSksIGEuYXBwbHkodGhpcywgYXJndW1lbnRzKX0pLmd1aWQgPSBhLmd1aWQgfHwgKGEuZ3VpZCA9IEUuZ3VpZCsrKSksIGUuZWFjaChmdW5jdGlvbigpIHtFLmV2ZW50LmFkZCh0aGlzLCB0LCBpLCByLCBuKX0pDQoJCX0NCg0KCQlmdW5jdGlvbiBFZShlLCBpLCBvKSB7DQoJCQlvID8gKFkuc2V0KGUsIGksICExKSwgRS5ldmVudC5hZGQoZSwgaSwgew0KCQkJCW5hbWVzcGFjZTogITEsIGhhbmRsZXI6IGZ1bmN0aW9uKGUpIHsNCgkJCQkJdmFyIHQsIG4sIHIgPSBZLmdldCh0aGlzLCBpKTsNCgkJCQkJaWYoMSAmIGUuaXNUcmlnZ2VyICYmIHRoaXNbaV0pIHtpZihyLmxlbmd0aCkgKEUuZXZlbnQuc3BlY2lhbFtpXSB8fCB7fSkuZGVsZWdhdGVUeXBlICYmIGUuc3RvcFByb3BhZ2F0aW9uKCk7IGVsc2UgaWYociA9IHMuY2FsbChhcmd1bWVudHMpLCBZLnNldCh0aGlzLCBpLCByKSwgdCA9IG8odGhpcywgaSksIHRoaXNbaV0oKSwgciAhPT0gKG4gPSBZLmdldCh0aGlzLCBpKSkgfHwgdCA/IFkuc2V0KHRoaXMsIGksICExKSA6IG4gPSB7fSwgciAhPT0gbikgcmV0dXJuIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksIGUucHJldmVudERlZmF1bHQoKSwgbiAmJiBuLnZhbHVlfSBlbHNlIHIubGVuZ3RoICYmIChZLnNldCh0aGlzLCBpLCB7dmFsdWU6IEUuZXZlbnQudHJpZ2dlcihFLmV4dGVuZChyWzBdLCBFLkV2ZW50LnByb3RvdHlwZSksIHIuc2xpY2UoMSksIHRoaXMpfSksIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCkpDQoJCQkJfQ0KCQkJfSkpIDogdm9pZCAwID09PSBZLmdldChlLCBpKSAmJiBFLmV2ZW50LmFkZChlLCBpLCB3ZSkNCgkJfQ0KDQoJCUUuZXZlbnQgPSB7DQoJCQlnbG9iYWw6IHt9LA0KCQkJYWRkOiBmdW5jdGlvbih0LCBlLCBuLCByLCBpKSB7DQoJCQkJdmFyIG8sIGEsIHMsIHUsIGwsIGMsIGYsIHAsIGQsIGgsIGcsIHkgPSBZLmdldCh0KTsNCgkJCQlpZihWKHQpKSB7DQoJCQkJCW4uaGFuZGxlciAmJiAobiA9IChvID0gbikuaGFuZGxlciwgaSA9IG8uc2VsZWN0b3IpLCBpICYmIEUuZmluZC5tYXRjaGVzU2VsZWN0b3IocmUsIGkpLCBuLmd1aWQgfHwgKG4uZ3VpZCA9IEUuZ3VpZCsrKSwgKHUgPSB5LmV2ZW50cykgfHwgKHUgPSB5LmV2ZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCkpLCAoYSA9IHkuaGFuZGxlKSB8fCAoYSA9IHkuaGFuZGxlID0gZnVuY3Rpb24oZSkge3JldHVybiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgRSAmJiBFLmV2ZW50LnRyaWdnZXJlZCAhPT0gZS50eXBlID8gRS5ldmVudC5kaXNwYXRjaC5hcHBseSh0LCBhcmd1bWVudHMpIDogdm9pZCAwfSksIGwgPSAoZSA9IChlIHx8ICIiKS5tYXRjaChQKSB8fCBbIiJdKS5sZW5ndGg7DQoJCQkJCXdoaWxlKGwtLSkgZCA9IGcgPSAocyA9IGJlLmV4ZWMoZVtsXSkgfHwgW10pWzFdLCBoID0gKHNbMl0gfHwgIiIpLnNwbGl0KCIuIikuc29ydCgpLCBkICYmIChmID0gRS5ldmVudC5zcGVjaWFsW2RdIHx8IHt9LCBkID0gKGkgPyBmLmRlbGVnYXRlVHlwZSA6IGYuYmluZFR5cGUpIHx8IGQsIGYgPSBFLmV2ZW50LnNwZWNpYWxbZF0gfHwge30sIGMgPSBFLmV4dGVuZCh7DQoJCQkJCQl0eXBlOiBkLA0KCQkJCQkJb3JpZ1R5cGU6IGcsDQoJCQkJCQlkYXRhOiByLA0KCQkJCQkJaGFuZGxlcjogbiwNCgkJCQkJCWd1aWQ6IG4uZ3VpZCwNCgkJCQkJCXNlbGVjdG9yOiBpLA0KCQkJCQkJbmVlZHNDb250ZXh0OiBpICYmIEUuZXhwci5tYXRjaC5uZWVkc0NvbnRleHQudGVzdChpKSwNCgkJCQkJCW5hbWVzcGFjZTogaC5qb2luKCIuIikNCgkJCQkJfSwgbyksIChwID0gdVtkXSkgfHwgKChwID0gdVtkXSA9IFtdKS5kZWxlZ2F0ZUNvdW50ID0gMCwgZi5zZXR1cCAmJiAhMSAhPT0gZi5zZXR1cC5jYWxsKHQsIHIsIGgsIGEpIHx8IHQuYWRkRXZlbnRMaXN0ZW5lciAmJiB0LmFkZEV2ZW50TGlzdGVuZXIoZCwgYSkpLCBmLmFkZCAmJiAoZi5hZGQuY2FsbCh0LCBjKSwgYy5oYW5kbGVyLmd1aWQgfHwgKGMuaGFuZGxlci5ndWlkID0gbi5ndWlkKSksIGkgPyBwLnNwbGljZShwLmRlbGVnYXRlQ291bnQrKywgMCwgYykgOiBwLnB1c2goYyksIEUuZXZlbnQuZ2xvYmFsW2RdID0gITApDQoJCQkJfQ0KCQkJfSwNCgkJCXJlbW92ZTogZnVuY3Rpb24oZSwgdCwgbiwgciwgaSkgew0KCQkJCXZhciBvLCBhLCBzLCB1LCBsLCBjLCBmLCBwLCBkLCBoLCBnLCB5ID0gWS5oYXNEYXRhKGUpICYmIFkuZ2V0KGUpOw0KCQkJCWlmKHkgJiYgKHUgPSB5LmV2ZW50cykpIHsNCgkJCQkJbCA9ICh0ID0gKHQgfHwgIiIpLm1hdGNoKFApIHx8IFsiIl0pLmxlbmd0aDsNCgkJCQkJd2hpbGUobC0tKSBpZihkID0gZyA9IChzID0gYmUuZXhlYyh0W2xdKSB8fCBbXSlbMV0sIGggPSAoc1syXSB8fCAiIikuc3BsaXQoIi4iKS5zb3J0KCksIGQpIHsNCgkJCQkJCWYgPSBFLmV2ZW50LnNwZWNpYWxbZF0gfHwge30sIHAgPSB1W2QgPSAociA/IGYuZGVsZWdhdGVUeXBlIDogZi5iaW5kVHlwZSkgfHwgZF0gfHwgW10sIHMgPSBzWzJdICYmIG5ldyBSZWdFeHAoIihefFxcLikiICsgaC5qb2luKCJcXC4oPzouKlxcLnwpIikgKyAiKFxcLnwkKSIpLCBhID0gbyA9IHAubGVuZ3RoOw0KCQkJCQkJd2hpbGUoby0tKSBjID0gcFtvXSwgIWkgJiYgZyAhPT0gYy5vcmlnVHlwZSB8fCBuICYmIG4uZ3VpZCAhPT0gYy5ndWlkIHx8IHMgJiYgIXMudGVzdChjLm5hbWVzcGFjZSkgfHwgciAmJiByICE9PSBjLnNlbGVjdG9yICYmICgiKioiICE9PSByIHx8ICFjLnNlbGVjdG9yKSB8fCAocC5zcGxpY2UobywgMSksIGMuc2VsZWN0b3IgJiYgcC5kZWxlZ2F0ZUNvdW50LS0sIGYucmVtb3ZlICYmIGYucmVtb3ZlLmNhbGwoZSwgYykpOw0KCQkJCQkJYSAmJiAhcC5sZW5ndGggJiYgKGYudGVhcmRvd24gJiYgITEgIT09IGYudGVhcmRvd24uY2FsbChlLCBoLCB5LmhhbmRsZSkgfHwgRS5yZW1vdmVFdmVudChlLCBkLCB5LmhhbmRsZSksIGRlbGV0ZSB1W2RdKQ0KCQkJCQl9IGVsc2UgZm9yKGQgaW4gdSkgRS5ldmVudC5yZW1vdmUoZSwgZCArIHRbbF0sIG4sIHIsICEwKTsNCgkJCQkJRS5pc0VtcHR5T2JqZWN0KHUpICYmIFkucmVtb3ZlKGUsICJoYW5kbGUgZXZlbnRzIikNCgkJCQl9DQoJCQl9LA0KCQkJZGlzcGF0Y2g6IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCwgbiwgciwgaSwgbywgYSwgcyA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoKSwgdSA9IEUuZXZlbnQuZml4KGUpLCBsID0gKFkuZ2V0KHRoaXMsICJldmVudHMiKSB8fCBPYmplY3QuY3JlYXRlKG51bGwpKVt1LnR5cGVdIHx8IFtdLCBjID0gRS5ldmVudC5zcGVjaWFsW3UudHlwZV0gfHwge307DQoJCQkJZm9yKHNbMF0gPSB1LCB0ID0gMTsgdCA8IGFyZ3VtZW50cy5sZW5ndGg7IHQrKykgc1t0XSA9IGFyZ3VtZW50c1t0XTsNCgkJCQlpZih1LmRlbGVnYXRlVGFyZ2V0ID0gdGhpcywgIWMucHJlRGlzcGF0Y2ggfHwgITEgIT09IGMucHJlRGlzcGF0Y2guY2FsbCh0aGlzLCB1KSkgew0KCQkJCQlhID0gRS5ldmVudC5oYW5kbGVycy5jYWxsKHRoaXMsIHUsIGwpLCB0ID0gMDsNCgkJCQkJd2hpbGUoKGkgPSBhW3QrK10pICYmICF1LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkpIHsNCgkJCQkJCXUuY3VycmVudFRhcmdldCA9IGkuZWxlbSwgbiA9IDA7DQoJCQkJCQl3aGlsZSgobyA9IGkuaGFuZGxlcnNbbisrXSkgJiYgIXUuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQoKSkgdS5ybmFtZXNwYWNlICYmICExICE9PSBvLm5hbWVzcGFjZSAmJiAhdS5ybmFtZXNwYWNlLnRlc3Qoby5uYW1lc3BhY2UpIHx8ICh1LmhhbmRsZU9iaiA9IG8sIHUuZGF0YSA9IG8uZGF0YSwgdm9pZCAwICE9PSAociA9ICgoRS5ldmVudC5zcGVjaWFsW28ub3JpZ1R5cGVdIHx8IHt9KS5oYW5kbGUgfHwgby5oYW5kbGVyKS5hcHBseShpLmVsZW0sIHMpKSAmJiAhMSA9PT0gKHUucmVzdWx0ID0gcikgJiYgKHUucHJldmVudERlZmF1bHQoKSwgdS5zdG9wUHJvcGFnYXRpb24oKSkpDQoJCQkJCX0NCgkJCQkJcmV0dXJuIGMucG9zdERpc3BhdGNoICYmIGMucG9zdERpc3BhdGNoLmNhbGwodGhpcywgdSksIHUucmVzdWx0DQoJCQkJfQ0KCQkJfSwNCgkJCWhhbmRsZXJzOiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4sIHIsIGksIG8sIGEsIHMgPSBbXSwgdSA9IHQuZGVsZWdhdGVDb3VudCwgbCA9IGUudGFyZ2V0Ow0KCQkJCWlmKHUgJiYgbC5ub2RlVHlwZSAmJiAhKCJjbGljayIgPT09IGUudHlwZSAmJiAxIDw9IGUuYnV0dG9uKSkgZm9yKDsgbCAhPT0gdGhpczsgbCA9IGwucGFyZW50Tm9kZSB8fCB0aGlzKSBpZigxID09PSBsLm5vZGVUeXBlICYmICgiY2xpY2siICE9PSBlLnR5cGUgfHwgITAgIT09IGwuZGlzYWJsZWQpKSB7DQoJCQkJCWZvcihvID0gW10sIGEgPSB7fSwgbiA9IDA7IG4gPCB1OyBuKyspIHZvaWQgMCA9PT0gYVtpID0gKHIgPSB0W25dKS5zZWxlY3RvciArICIgIl0gJiYgKGFbaV0gPSByLm5lZWRzQ29udGV4dCA/IC0xIDwgRShpLCB0aGlzKS5pbmRleChsKSA6IEUuZmluZChpLCB0aGlzLCBudWxsLCBbbF0pLmxlbmd0aCksIGFbaV0gJiYgby5wdXNoKHIpOw0KCQkJCQlvLmxlbmd0aCAmJiBzLnB1c2goe2VsZW06IGwsIGhhbmRsZXJzOiBvfSkNCgkJCQl9DQoJCQkJcmV0dXJuIGwgPSB0aGlzLCB1IDwgdC5sZW5ndGggJiYgcy5wdXNoKHtlbGVtOiBsLCBoYW5kbGVyczogdC5zbGljZSh1KX0pLCBzDQoJCQl9LA0KCQkJYWRkUHJvcDogZnVuY3Rpb24odCwgZSkgew0KCQkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFLkV2ZW50LnByb3RvdHlwZSwgdCwgew0KCQkJCQllbnVtZXJhYmxlOiAhMCwNCgkJCQkJY29uZmlndXJhYmxlOiAhMCwNCgkJCQkJZ2V0OiBtKGUpID8gZnVuY3Rpb24oKSB7aWYodGhpcy5vcmlnaW5hbEV2ZW50KSByZXR1cm4gZSh0aGlzLm9yaWdpbmFsRXZlbnQpfSA6IGZ1bmN0aW9uKCkge2lmKHRoaXMub3JpZ2luYWxFdmVudCkgcmV0dXJuIHRoaXMub3JpZ2luYWxFdmVudFt0XX0sDQoJCQkJCXNldDogZnVuY3Rpb24oZSkge09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCB0LCB7ZW51bWVyYWJsZTogITAsIGNvbmZpZ3VyYWJsZTogITAsIHdyaXRhYmxlOiAhMCwgdmFsdWU6IGV9KX0NCgkJCQl9KQ0KCQkJfSwNCgkJCWZpeDogZnVuY3Rpb24oZSkge3JldHVybiBlW0UuZXhwYW5kb10gPyBlIDogbmV3IEUuRXZlbnQoZSl9LA0KCQkJc3BlY2lhbDogew0KCQkJCWxvYWQ6IHtub0J1YmJsZTogITB9LCBjbGljazogew0KCQkJCQlzZXR1cDogZnVuY3Rpb24oZSkgew0KCQkJCQkJdmFyIHQgPSB0aGlzIHx8IGU7DQoJCQkJCQlyZXR1cm4gcGUudGVzdCh0LnR5cGUpICYmIHQuY2xpY2sgJiYgQSh0LCAiaW5wdXQiKSAmJiBFZSh0LCAiY2xpY2siLCB3ZSksICExDQoJCQkJCX0sIHRyaWdnZXI6IGZ1bmN0aW9uKGUpIHsNCgkJCQkJCXZhciB0ID0gdGhpcyB8fCBlOw0KCQkJCQkJcmV0dXJuIHBlLnRlc3QodC50eXBlKSAmJiB0LmNsaWNrICYmIEEodCwgImlucHV0IikgJiYgRWUodCwgImNsaWNrIiksICEwDQoJCQkJCX0sIF9kZWZhdWx0OiBmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgdCA9IGUudGFyZ2V0Ow0KCQkJCQkJcmV0dXJuIHBlLnRlc3QodC50eXBlKSAmJiB0LmNsaWNrICYmIEEodCwgImlucHV0IikgJiYgWS5nZXQodCwgImNsaWNrIikgfHwgQSh0LCAiYSIpDQoJCQkJCX0NCgkJCQl9LCBiZWZvcmV1bmxvYWQ6IHtwb3N0RGlzcGF0Y2g6IGZ1bmN0aW9uKGUpIHt2b2lkIDAgIT09IGUucmVzdWx0ICYmIGUub3JpZ2luYWxFdmVudCAmJiAoZS5vcmlnaW5hbEV2ZW50LnJldHVyblZhbHVlID0gZS5yZXN1bHQpfX0NCgkJCX0NCgkJfSwgRS5yZW1vdmVFdmVudCA9IGZ1bmN0aW9uKGUsIHQsIG4pIHtlLnJlbW92ZUV2ZW50TGlzdGVuZXIgJiYgZS5yZW1vdmVFdmVudExpc3RlbmVyKHQsIG4pfSwgRS5FdmVudCA9IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCWlmKCEodGhpcyBpbnN0YW5jZW9mIEUuRXZlbnQpKSByZXR1cm4gbmV3IEUuRXZlbnQoZSwgdCk7DQoJCQllICYmIGUudHlwZSA/ICh0aGlzLm9yaWdpbmFsRXZlbnQgPSBlLCB0aGlzLnR5cGUgPSBlLnR5cGUsIHRoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gZS5kZWZhdWx0UHJldmVudGVkIHx8IHZvaWQgMCA9PT0gZS5kZWZhdWx0UHJldmVudGVkICYmICExID09PSBlLnJldHVyblZhbHVlID8gd2UgOiBUZSwgdGhpcy50YXJnZXQgPSBlLnRhcmdldCAmJiAzID09PSBlLnRhcmdldC5ub2RlVHlwZSA/IGUudGFyZ2V0LnBhcmVudE5vZGUgOiBlLnRhcmdldCwgdGhpcy5jdXJyZW50VGFyZ2V0ID0gZS5jdXJyZW50VGFyZ2V0LCB0aGlzLnJlbGF0ZWRUYXJnZXQgPSBlLnJlbGF0ZWRUYXJnZXQpIDogdGhpcy50eXBlID0gZSwgdCAmJiBFLmV4dGVuZCh0aGlzLCB0KSwgdGhpcy50aW1lU3RhbXAgPSBlICYmIGUudGltZVN0YW1wIHx8IERhdGUubm93KCksIHRoaXNbRS5leHBhbmRvXSA9ICEwDQoJCX0sIEUuRXZlbnQucHJvdG90eXBlID0gew0KCQkJY29uc3RydWN0b3I6IEUuRXZlbnQsIGlzRGVmYXVsdFByZXZlbnRlZDogVGUsIGlzUHJvcGFnYXRpb25TdG9wcGVkOiBUZSwgaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ6IFRlLCBpc1NpbXVsYXRlZDogITEsIHByZXZlbnREZWZhdWx0OiBmdW5jdGlvbigpIHsNCgkJCQl2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsNCgkJCQl0aGlzLmlzRGVmYXVsdFByZXZlbnRlZCA9IHdlLCBlICYmICF0aGlzLmlzU2ltdWxhdGVkICYmIGUucHJldmVudERlZmF1bHQoKQ0KCQkJfSwgc3RvcFByb3BhZ2F0aW9uOiBmdW5jdGlvbigpIHsNCgkJCQl2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsNCgkJCQl0aGlzLmlzUHJvcGFnYXRpb25TdG9wcGVkID0gd2UsIGUgJiYgIXRoaXMuaXNTaW11bGF0ZWQgJiYgZS5zdG9wUHJvcGFnYXRpb24oKQ0KCQkJfSwgc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uOiBmdW5jdGlvbigpIHsNCgkJCQl2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsNCgkJCQl0aGlzLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkID0gd2UsIGUgJiYgIXRoaXMuaXNTaW11bGF0ZWQgJiYgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSwgdGhpcy5zdG9wUHJvcGFnYXRpb24oKQ0KCQkJfQ0KCQl9LCBFLmVhY2goew0KCQkJYWx0S2V5OiAhMCwNCgkJCWJ1YmJsZXM6ICEwLA0KCQkJY2FuY2VsYWJsZTogITAsDQoJCQljaGFuZ2VkVG91Y2hlczogITAsDQoJCQljdHJsS2V5OiAhMCwNCgkJCWRldGFpbDogITAsDQoJCQlldmVudFBoYXNlOiAhMCwNCgkJCW1ldGFLZXk6ICEwLA0KCQkJcGFnZVg6ICEwLA0KCQkJcGFnZVk6ICEwLA0KCQkJc2hpZnRLZXk6ICEwLA0KCQkJdmlldzogITAsDQoJCQkiY2hhciI6ICEwLA0KCQkJY29kZTogITAsDQoJCQljaGFyQ29kZTogITAsDQoJCQlrZXk6ICEwLA0KCQkJa2V5Q29kZTogITAsDQoJCQlidXR0b246ICEwLA0KCQkJYnV0dG9uczogITAsDQoJCQljbGllbnRYOiAhMCwNCgkJCWNsaWVudFk6ICEwLA0KCQkJb2Zmc2V0WDogITAsDQoJCQlvZmZzZXRZOiAhMCwNCgkJCXBvaW50ZXJJZDogITAsDQoJCQlwb2ludGVyVHlwZTogITAsDQoJCQlzY3JlZW5YOiAhMCwNCgkJCXNjcmVlblk6ICEwLA0KCQkJdGFyZ2V0VG91Y2hlczogITAsDQoJCQl0b0VsZW1lbnQ6ICEwLA0KCQkJdG91Y2hlczogITAsDQoJCQl3aGljaDogITANCgkJfSwgRS5ldmVudC5hZGRQcm9wKSwgRS5lYWNoKHtmb2N1czogImZvY3VzaW4iLCBibHVyOiAiZm9jdXNvdXQifSwgZnVuY3Rpb24odCwgZSkgew0KCQkJRS5ldmVudC5zcGVjaWFsW3RdID0gew0KCQkJCXNldHVwOiBmdW5jdGlvbigpIHtyZXR1cm4gRWUodGhpcywgdCwgQ2UpLCAhMX0sDQoJCQkJdHJpZ2dlcjogZnVuY3Rpb24oKSB7cmV0dXJuIEVlKHRoaXMsIHQpLCAhMH0sDQoJCQkJX2RlZmF1bHQ6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gWS5nZXQoZS50YXJnZXQsIHQpfSwNCgkJCQlkZWxlZ2F0ZVR5cGU6IGUNCgkJCX0NCgkJfSksIEUuZWFjaCh7bW91c2VlbnRlcjogIm1vdXNlb3ZlciIsIG1vdXNlbGVhdmU6ICJtb3VzZW91dCIsIHBvaW50ZXJlbnRlcjogInBvaW50ZXJvdmVyIiwgcG9pbnRlcmxlYXZlOiAicG9pbnRlcm91dCJ9LCBmdW5jdGlvbihlLCBpKSB7DQoJCQlFLmV2ZW50LnNwZWNpYWxbZV0gPSB7DQoJCQkJZGVsZWdhdGVUeXBlOiBpLCBiaW5kVHlwZTogaSwgaGFuZGxlOiBmdW5jdGlvbihlKSB7DQoJCQkJCXZhciB0LCBuID0gZS5yZWxhdGVkVGFyZ2V0LCByID0gZS5oYW5kbGVPYmo7DQoJCQkJCXJldHVybiBuICYmIChuID09PSB0aGlzIHx8IEUuY29udGFpbnModGhpcywgbikpIHx8IChlLnR5cGUgPSByLm9yaWdUeXBlLCB0ID0gci5oYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIGUudHlwZSA9IGkpLCB0DQoJCQkJfQ0KCQkJfQ0KCQl9KSwgRS5mbi5leHRlbmQoew0KCQkJb246IGZ1bmN0aW9uKGUsIHQsIG4sIHIpIHtyZXR1cm4gU2UodGhpcywgZSwgdCwgbiwgcil9LCBvbmU6IGZ1bmN0aW9uKGUsIHQsIG4sIHIpIHtyZXR1cm4gU2UodGhpcywgZSwgdCwgbiwgciwgMSl9LCBvZmY6IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQl2YXIgciwgaTsNCgkJCQlpZihlICYmIGUucHJldmVudERlZmF1bHQgJiYgZS5oYW5kbGVPYmopIHJldHVybiByID0gZS5oYW5kbGVPYmosIEUoZS5kZWxlZ2F0ZVRhcmdldCkub2ZmKHIubmFtZXNwYWNlID8gci5vcmlnVHlwZSArICIuIiArIHIubmFtZXNwYWNlIDogci5vcmlnVHlwZSwgci5zZWxlY3Rvciwgci5oYW5kbGVyKSwgdGhpczsNCgkJCQlpZigib2JqZWN0IiA9PSB0eXBlb2YgZSkgew0KCQkJCQlmb3IoaSBpbiBlKSB0aGlzLm9mZihpLCB0LCBlW2ldKTsNCgkJCQkJcmV0dXJuIHRoaXMNCgkJCQl9DQoJCQkJcmV0dXJuICExICE9PSB0ICYmICJmdW5jdGlvbiIgIT0gdHlwZW9mIHQgfHwgKG4gPSB0LCB0ID0gdm9pZCAwKSwgITEgPT09IG4gJiYgKG4gPSBUZSksIHRoaXMuZWFjaChmdW5jdGlvbigpIHtFLmV2ZW50LnJlbW92ZSh0aGlzLCBlLCBuLCB0KX0pDQoJCQl9DQoJCX0pOw0KCQl2YXIga2UgPSAvPHNjcmlwdHw8c3R5bGV8PGxpbmsvaSwgQWUgPSAvY2hlY2tlZFxzKig/OltePV18PVxzKi5jaGVja2VkLikvaSwgTmUgPSAvXlxzKjwhXFtDREFUQVxbfFxdXF0+XHMqJC9nOw0KDQoJCWZ1bmN0aW9uIGplKGUsIHQpIHtyZXR1cm4gQShlLCAidGFibGUiKSAmJiBBKDExICE9PSB0Lm5vZGVUeXBlID8gdCA6IHQuZmlyc3RDaGlsZCwgInRyIikgJiYgRShlKS5jaGlsZHJlbigidGJvZHkiKVswXSB8fCBlfQ0KDQoJCWZ1bmN0aW9uIERlKGUpIHtyZXR1cm4gZS50eXBlID0gKG51bGwgIT09IGUuZ2V0QXR0cmlidXRlKCJ0eXBlIikpICsgIi8iICsgZS50eXBlLCBlfQ0KDQoJCWZ1bmN0aW9uIHFlKGUpIHtyZXR1cm4gInRydWUvIiA9PT0gKGUudHlwZSB8fCAiIikuc2xpY2UoMCwgNSkgPyBlLnR5cGUgPSBlLnR5cGUuc2xpY2UoNSkgOiBlLnJlbW92ZUF0dHJpYnV0ZSgidHlwZSIpLCBlfQ0KDQoJCWZ1bmN0aW9uIExlKGUsIHQpIHsNCgkJCXZhciBuLCByLCBpLCBvLCBhLCBzOw0KCQkJaWYoMSA9PT0gdC5ub2RlVHlwZSkgew0KCQkJCWlmKFkuaGFzRGF0YShlKSAmJiAocyA9IFkuZ2V0KGUpLmV2ZW50cykpIGZvcihpIGluIFkucmVtb3ZlKHQsICJoYW5kbGUgZXZlbnRzIiksIHMpIGZvcihuID0gMCwgciA9IHNbaV0ubGVuZ3RoOyBuIDwgcjsgbisrKSBFLmV2ZW50LmFkZCh0LCBpLCBzW2ldW25dKTsNCgkJCQlRLmhhc0RhdGEoZSkgJiYgKG8gPSBRLmFjY2VzcyhlKSwgYSA9IEUuZXh0ZW5kKHt9LCBvKSwgUS5zZXQodCwgYSkpDQoJCQl9DQoJCX0NCg0KCQlmdW5jdGlvbiBIZShuLCByLCBpLCBvKSB7DQoJCQlyID0gZyhyKTsNCgkJCXZhciBlLCB0LCBhLCBzLCB1LCBsLCBjID0gMCwgZiA9IG4ubGVuZ3RoLCBwID0gZiAtIDEsIGQgPSByWzBdLCBoID0gbShkKTsNCgkJCWlmKGggfHwgMSA8IGYgJiYgInN0cmluZyIgPT0gdHlwZW9mIGQgJiYgIXYuY2hlY2tDbG9uZSAmJiBBZS50ZXN0KGQpKSByZXR1cm4gbi5lYWNoKGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCA9IG4uZXEoZSk7DQoJCQkJaCAmJiAoclswXSA9IGQuY2FsbCh0aGlzLCBlLCB0Lmh0bWwoKSkpLCBIZSh0LCByLCBpLCBvKQ0KCQkJfSk7DQoJCQlpZihmICYmICh0ID0gKGUgPSB4ZShyLCBuWzBdLm93bmVyRG9jdW1lbnQsICExLCBuLCBvKSkuZmlyc3RDaGlsZCwgMSA9PT0gZS5jaGlsZE5vZGVzLmxlbmd0aCAmJiAoZSA9IHQpLCB0IHx8IG8pKSB7DQoJCQkJZm9yKHMgPSAoYSA9IEUubWFwKHllKGUsICJzY3JpcHQiKSwgRGUpKS5sZW5ndGg7IGMgPCBmOyBjKyspIHUgPSBlLCBjICE9PSBwICYmICh1ID0gRS5jbG9uZSh1LCAhMCwgITApLCBzICYmIEUubWVyZ2UoYSwgeWUodSwgInNjcmlwdCIpKSksIGkuY2FsbChuW2NdLCB1LCBjKTsNCgkJCQlpZihzKSBmb3IobCA9IGFbYS5sZW5ndGggLSAxXS5vd25lckRvY3VtZW50LCBFLm1hcChhLCBxZSksIGMgPSAwOyBjIDwgczsgYysrKSB1ID0gYVtjXSwgaGUudGVzdCh1LnR5cGUgfHwgIiIpICYmICFZLmFjY2Vzcyh1LCAiZ2xvYmFsRXZhbCIpICYmIEUuY29udGFpbnMobCwgdSkgJiYgKHUuc3JjICYmICJtb2R1bGUiICE9PSAodS50eXBlIHx8ICIiKS50b0xvd2VyQ2FzZSgpID8gRS5fZXZhbFVybCAmJiAhdS5ub01vZHVsZSAmJiBFLl9ldmFsVXJsKHUuc3JjLCB7bm9uY2U6IHUubm9uY2UgfHwgdS5nZXRBdHRyaWJ1dGUoIm5vbmNlIil9LCBsKSA6IGIodS50ZXh0Q29udGVudC5yZXBsYWNlKE5lLCAiIiksIHUsIGwpKQ0KCQkJfQ0KCQkJcmV0dXJuIG4NCgkJfQ0KDQoJCWZ1bmN0aW9uIE9lKGUsIHQsIG4pIHsNCgkJCWZvcih2YXIgciwgaSA9IHQgPyBFLmZpbHRlcih0LCBlKSA6IGUsIG8gPSAwOyBudWxsICE9IChyID0gaVtvXSk7IG8rKykgbiB8fCAxICE9PSByLm5vZGVUeXBlIHx8IEUuY2xlYW5EYXRhKHllKHIpKSwgci5wYXJlbnROb2RlICYmIChuICYmIGllKHIpICYmIHZlKHllKHIsICJzY3JpcHQiKSksIHIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChyKSk7DQoJCQlyZXR1cm4gZQ0KCQl9DQoNCgkJRS5leHRlbmQoew0KCQkJaHRtbFByZWZpbHRlcjogZnVuY3Rpb24oZSkge3JldHVybiBlfSwgY2xvbmU6IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQl2YXIgciwgaSwgbywgYSwgcywgdSwgbCwgYyA9IGUuY2xvbmVOb2RlKCEwKSwgZiA9IGllKGUpOw0KCQkJCWlmKCEodi5ub0Nsb25lQ2hlY2tlZCB8fCAxICE9PSBlLm5vZGVUeXBlICYmIDExICE9PSBlLm5vZGVUeXBlIHx8IEUuaXNYTUxEb2MoZSkpKSBmb3IoYSA9IHllKGMpLCByID0gMCwgaSA9IChvID0geWUoZSkpLmxlbmd0aDsgciA8IGk7IHIrKykgcyA9IG9bcl0sIHUgPSBhW3JdLCB2b2lkIDAsICJpbnB1dCIgPT09IChsID0gdS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKSAmJiBwZS50ZXN0KHMudHlwZSkgPyB1LmNoZWNrZWQgPSBzLmNoZWNrZWQgOiAiaW5wdXQiICE9PSBsICYmICJ0ZXh0YXJlYSIgIT09IGwgfHwgKHUuZGVmYXVsdFZhbHVlID0gcy5kZWZhdWx0VmFsdWUpOw0KCQkJCWlmKHQpIGlmKG4pIGZvcihvID0gbyB8fCB5ZShlKSwgYSA9IGEgfHwgeWUoYyksIHIgPSAwLCBpID0gby5sZW5ndGg7IHIgPCBpOyByKyspIExlKG9bcl0sIGFbcl0pOyBlbHNlIExlKGUsIGMpOw0KCQkJCXJldHVybiAwIDwgKGEgPSB5ZShjLCAic2NyaXB0IikpLmxlbmd0aCAmJiB2ZShhLCAhZiAmJiB5ZShlLCAic2NyaXB0IikpLCBjDQoJCQl9LCBjbGVhbkRhdGE6IGZ1bmN0aW9uKGUpIHsNCgkJCQlmb3IodmFyIHQsIG4sIHIsIGkgPSBFLmV2ZW50LnNwZWNpYWwsIG8gPSAwOyB2b2lkIDAgIT09IChuID0gZVtvXSk7IG8rKykgaWYoVihuKSkgew0KCQkJCQlpZih0ID0gbltZLmV4cGFuZG9dKSB7DQoJCQkJCQlpZih0LmV2ZW50cykgZm9yKHIgaW4gdC5ldmVudHMpIGlbcl0gPyBFLmV2ZW50LnJlbW92ZShuLCByKSA6IEUucmVtb3ZlRXZlbnQobiwgciwgdC5oYW5kbGUpOw0KCQkJCQkJbltZLmV4cGFuZG9dID0gdm9pZCAwDQoJCQkJCX0NCgkJCQkJbltRLmV4cGFuZG9dICYmIChuW1EuZXhwYW5kb10gPSB2b2lkIDApDQoJCQkJfQ0KCQkJfQ0KCQl9KSwgRS5mbi5leHRlbmQoew0KCQkJZGV0YWNoOiBmdW5jdGlvbihlKSB7cmV0dXJuIE9lKHRoaXMsIGUsICEwKX0sDQoJCQlyZW1vdmU6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gT2UodGhpcywgZSl9LA0KCQkJdGV4dDogZnVuY3Rpb24oZSkge3JldHVybiBCKHRoaXMsIGZ1bmN0aW9uKGUpIHtyZXR1cm4gdm9pZCAwID09PSBlID8gRS50ZXh0KHRoaXMpIDogdGhpcy5lbXB0eSgpLmVhY2goZnVuY3Rpb24oKSB7MSAhPT0gdGhpcy5ub2RlVHlwZSAmJiAxMSAhPT0gdGhpcy5ub2RlVHlwZSAmJiA5ICE9PSB0aGlzLm5vZGVUeXBlIHx8ICh0aGlzLnRleHRDb250ZW50ID0gZSl9KX0sIG51bGwsIGUsIGFyZ3VtZW50cy5sZW5ndGgpfSwNCgkJCWFwcGVuZDogZnVuY3Rpb24oKSB7cmV0dXJuIEhlKHRoaXMsIGFyZ3VtZW50cywgZnVuY3Rpb24oZSkgezEgIT09IHRoaXMubm9kZVR5cGUgJiYgMTEgIT09IHRoaXMubm9kZVR5cGUgJiYgOSAhPT0gdGhpcy5ub2RlVHlwZSB8fCBqZSh0aGlzLCBlKS5hcHBlbmRDaGlsZChlKX0pfSwNCgkJCXByZXBlbmQ6IGZ1bmN0aW9uKCkgew0KCQkJCXJldHVybiBIZSh0aGlzLCBhcmd1bWVudHMsIGZ1bmN0aW9uKGUpIHsNCgkJCQkJaWYoMSA9PT0gdGhpcy5ub2RlVHlwZSB8fCAxMSA9PT0gdGhpcy5ub2RlVHlwZSB8fCA5ID09PSB0aGlzLm5vZGVUeXBlKSB7DQoJCQkJCQl2YXIgdCA9IGplKHRoaXMsIGUpOw0KCQkJCQkJdC5pbnNlcnRCZWZvcmUoZSwgdC5maXJzdENoaWxkKQ0KCQkJCQl9DQoJCQkJfSkNCgkJCX0sDQoJCQliZWZvcmU6IGZ1bmN0aW9uKCkge3JldHVybiBIZSh0aGlzLCBhcmd1bWVudHMsIGZ1bmN0aW9uKGUpIHt0aGlzLnBhcmVudE5vZGUgJiYgdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlLCB0aGlzKX0pfSwNCgkJCWFmdGVyOiBmdW5jdGlvbigpIHtyZXR1cm4gSGUodGhpcywgYXJndW1lbnRzLCBmdW5jdGlvbihlKSB7dGhpcy5wYXJlbnROb2RlICYmIHRoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZSwgdGhpcy5uZXh0U2libGluZyl9KX0sDQoJCQllbXB0eTogZnVuY3Rpb24oKSB7DQoJCQkJZm9yKHZhciBlLCB0ID0gMDsgbnVsbCAhPSAoZSA9IHRoaXNbdF0pOyB0KyspIDEgPT09IGUubm9kZVR5cGUgJiYgKEUuY2xlYW5EYXRhKHllKGUsICExKSksIGUudGV4dENvbnRlbnQgPSAiIik7DQoJCQkJcmV0dXJuIHRoaXMNCgkJCX0sDQoJCQljbG9uZTogZnVuY3Rpb24oZSwgdCkge3JldHVybiBlID0gbnVsbCAhPSBlICYmIGUsIHQgPSBudWxsID09IHQgPyBlIDogdCwgdGhpcy5tYXAoZnVuY3Rpb24oKSB7cmV0dXJuIEUuY2xvbmUodGhpcywgZSwgdCl9KX0sDQoJCQlodG1sOiBmdW5jdGlvbihlKSB7DQoJCQkJcmV0dXJuIEIodGhpcywgZnVuY3Rpb24oZSkgew0KCQkJCQl2YXIgdCA9IHRoaXNbMF0gfHwge30sIG4gPSAwLCByID0gdGhpcy5sZW5ndGg7DQoJCQkJCWlmKHZvaWQgMCA9PT0gZSAmJiAxID09PSB0Lm5vZGVUeXBlKSByZXR1cm4gdC5pbm5lckhUTUw7DQoJCQkJCWlmKCJzdHJpbmciID09IHR5cGVvZiBlICYmICFrZS50ZXN0KGUpICYmICFnZVsoZGUuZXhlYyhlKSB8fCBbIiIsICIiXSlbMV0udG9Mb3dlckNhc2UoKV0pIHsNCgkJCQkJCWUgPSBFLmh0bWxQcmVmaWx0ZXIoZSk7DQoJCQkJCQl0cnkgew0KCQkJCQkJCWZvcig7IG4gPCByOyBuKyspIDEgPT09ICh0ID0gdGhpc1tuXSB8fCB7fSkubm9kZVR5cGUgJiYgKEUuY2xlYW5EYXRhKHllKHQsICExKSksIHQuaW5uZXJIVE1MID0gZSk7DQoJCQkJCQkJdCA9IDANCgkJCQkJCX0gY2F0Y2goZSkge30NCgkJCQkJfQ0KCQkJCQl0ICYmIHRoaXMuZW1wdHkoKS5hcHBlbmQoZSkNCgkJCQl9LCBudWxsLCBlLCBhcmd1bWVudHMubGVuZ3RoKQ0KCQkJfSwNCgkJCXJlcGxhY2VXaXRoOiBmdW5jdGlvbigpIHsNCgkJCQl2YXIgbiA9IFtdOw0KCQkJCXJldHVybiBIZSh0aGlzLCBhcmd1bWVudHMsIGZ1bmN0aW9uKGUpIHsNCgkJCQkJdmFyIHQgPSB0aGlzLnBhcmVudE5vZGU7DQoJCQkJCUUuaW5BcnJheSh0aGlzLCBuKSA8IDAgJiYgKEUuY2xlYW5EYXRhKHllKHRoaXMpKSwgdCAmJiB0LnJlcGxhY2VDaGlsZChlLCB0aGlzKSkNCgkJCQl9LCBuKQ0KCQkJfQ0KCQl9KSwgRS5lYWNoKHsNCgkJCWFwcGVuZFRvOiAiYXBwZW5kIiwNCgkJCXByZXBlbmRUbzogInByZXBlbmQiLA0KCQkJaW5zZXJ0QmVmb3JlOiAiYmVmb3JlIiwNCgkJCWluc2VydEFmdGVyOiAiYWZ0ZXIiLA0KCQkJcmVwbGFjZUFsbDogInJlcGxhY2VXaXRoIg0KCQl9LCBmdW5jdGlvbihlLCBhKSB7DQoJCQlFLmZuW2VdID0gZnVuY3Rpb24oZSkgew0KCQkJCWZvcih2YXIgdCwgbiA9IFtdLCByID0gRShlKSwgaSA9IHIubGVuZ3RoIC0gMSwgbyA9IDA7IG8gPD0gaTsgbysrKSB0ID0gbyA9PT0gaSA/IHRoaXMgOiB0aGlzLmNsb25lKCEwKSwgRShyW29dKVthXSh0KSwgdS5hcHBseShuLCB0LmdldCgpKTsNCgkJCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2sobikNCgkJCX0NCgkJfSk7DQoJCXZhciBQZSA9IG5ldyBSZWdFeHAoIl4oIiArIGVlICsgIikoPyFweClbYS16JV0rJCIsICJpIiksIFJlID0gL14tLS8sIE1lID0gZnVuY3Rpb24oZSkgew0KCQkJdmFyIHQgPSBlLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXc7DQoJCQlyZXR1cm4gdCAmJiB0Lm9wZW5lciB8fCAodCA9IEMpLCB0LmdldENvbXB1dGVkU3R5bGUoZSkNCgkJfSwgSWUgID0gZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJdmFyIHIsIGksIG8gPSB7fTsNCgkJCWZvcihpIGluIHQpIG9baV0gPSBlLnN0eWxlW2ldLCBlLnN0eWxlW2ldID0gdFtpXTsNCgkJCWZvcihpIGluIHIgPSBuLmNhbGwoZSksIHQpIGUuc3R5bGVbaV0gPSBvW2ldOw0KCQkJcmV0dXJuIHINCgkJfSwgV2UgID0gbmV3IFJlZ0V4cChuZS5qb2luKCJ8IiksICJpIiksIEZlID0gIltcXHgyMFxcdFxcclxcblxcZl0iLCAkZSA9IG5ldyBSZWdFeHAoIl4iICsgRmUgKyAiK3woKD86XnxbXlxcXFxdKSg/OlxcXFwuKSopIiArIEZlICsgIiskIiwgImciKTsNCg0KCQlmdW5jdGlvbiBCZShlLCB0LCBuKSB7DQoJCQl2YXIgciwgaSwgbywgYSwgcyA9IFJlLnRlc3QodCksIHUgPSBlLnN0eWxlOw0KCQkJcmV0dXJuIChuID0gbiB8fCBNZShlKSkgJiYgKGEgPSBuLmdldFByb3BlcnR5VmFsdWUodCkgfHwgblt0XSwgcyAmJiBhICYmIChhID0gYS5yZXBsYWNlKCRlLCAiJDEiKSB8fCB2b2lkIDApLCAiIiAhPT0gYSB8fCBpZShlKSB8fCAoYSA9IEUuc3R5bGUoZSwgdCkpLCAhdi5waXhlbEJveFN0eWxlcygpICYmIFBlLnRlc3QoYSkgJiYgV2UudGVzdCh0KSAmJiAociA9IHUud2lkdGgsIGkgPSB1Lm1pbldpZHRoLCBvID0gdS5tYXhXaWR0aCwgdS5taW5XaWR0aCA9IHUubWF4V2lkdGggPSB1LndpZHRoID0gYSwgYSA9IG4ud2lkdGgsIHUud2lkdGggPSByLCB1Lm1pbldpZHRoID0gaSwgdS5tYXhXaWR0aCA9IG8pKSwgdm9pZCAwICE9PSBhID8gYSArICIiIDogYQ0KCQl9DQoNCgkJZnVuY3Rpb24gX2UoZSwgdCkgew0KCQkJcmV0dXJuIHsNCgkJCQlnZXQ6IGZ1bmN0aW9uKCkgew0KCQkJCQlpZighZSgpKSByZXR1cm4gKHRoaXMuZ2V0ID0gdCkuYXBwbHkodGhpcywgYXJndW1lbnRzKTsNCgkJCQkJZGVsZXRlIHRoaXMuZ2V0DQoJCQkJfQ0KCQkJfQ0KCQl9DQoNCgkJIWZ1bmN0aW9uKCkgew0KCQkJZnVuY3Rpb24gZSgpIHsNCgkJCQlpZihsKSB7DQoJCQkJCXUuc3R5bGUuY3NzVGV4dCA9ICJwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0Oi0xMTExMXB4O3dpZHRoOjYwcHg7bWFyZ2luLXRvcDoxcHg7cGFkZGluZzowO2JvcmRlcjowIiwgbC5zdHlsZS5jc3NUZXh0ID0gInBvc2l0aW9uOnJlbGF0aXZlO2Rpc3BsYXk6YmxvY2s7Ym94LXNpemluZzpib3JkZXItYm94O292ZXJmbG93OnNjcm9sbDttYXJnaW46YXV0bztib3JkZXI6MXB4O3BhZGRpbmc6MXB4O3dpZHRoOjYwJTt0b3A6MSUiLCByZS5hcHBlbmRDaGlsZCh1KS5hcHBlbmRDaGlsZChsKTsNCgkJCQkJdmFyIGUgPSBDLmdldENvbXB1dGVkU3R5bGUobCk7DQoJCQkJCW4gPSAiMSUiICE9PSBlLnRvcCwgcyA9IDEyID09PSB0KGUubWFyZ2luTGVmdCksIGwuc3R5bGUucmlnaHQgPSAiNjAlIiwgbyA9IDM2ID09PSB0KGUucmlnaHQpLCByID0gMzYgPT09IHQoZS53aWR0aCksIGwuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiLCBpID0gMTIgPT09IHQobC5vZmZzZXRXaWR0aCAvIDMpLCByZS5yZW1vdmVDaGlsZCh1KSwgbCA9IG51bGwNCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHQoZSkge3JldHVybiBNYXRoLnJvdW5kKHBhcnNlRmxvYXQoZSkpfQ0KDQoJCQl2YXIgbiwgciwgaSwgbywgYSwgcywgdSA9IFMuY3JlYXRlRWxlbWVudCgiZGl2IiksIGwgPSBTLmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KCQkJbC5zdHlsZSAmJiAobC5zdHlsZS5iYWNrZ3JvdW5kQ2xpcCA9ICJjb250ZW50LWJveCIsIGwuY2xvbmVOb2RlKCEwKS5zdHlsZS5iYWNrZ3JvdW5kQ2xpcCA9ICIiLCB2LmNsZWFyQ2xvbmVTdHlsZSA9ICJjb250ZW50LWJveCIgPT09IGwuc3R5bGUuYmFja2dyb3VuZENsaXAsIEUuZXh0ZW5kKHYsIHsNCgkJCQlib3hTaXppbmdSZWxpYWJsZTogZnVuY3Rpb24oKSB7cmV0dXJuIGUoKSwgcn0sDQoJCQkJcGl4ZWxCb3hTdHlsZXM6IGZ1bmN0aW9uKCkge3JldHVybiBlKCksIG99LA0KCQkJCXBpeGVsUG9zaXRpb246IGZ1bmN0aW9uKCkge3JldHVybiBlKCksIG59LA0KCQkJCXJlbGlhYmxlTWFyZ2luTGVmdDogZnVuY3Rpb24oKSB7cmV0dXJuIGUoKSwgc30sDQoJCQkJc2Nyb2xsYm94U2l6ZTogZnVuY3Rpb24oKSB7cmV0dXJuIGUoKSwgaX0sDQoJCQkJcmVsaWFibGVUckRpbWVuc2lvbnM6IGZ1bmN0aW9uKCkgew0KCQkJCQl2YXIgZSwgdCwgbiwgcjsNCgkJCQkJcmV0dXJuIG51bGwgPT0gYSAmJiAoZSA9IFMuY3JlYXRlRWxlbWVudCgidGFibGUiKSwgdCA9IFMuY3JlYXRlRWxlbWVudCgidHIiKSwgbiA9IFMuY3JlYXRlRWxlbWVudCgiZGl2IiksIGUuc3R5bGUuY3NzVGV4dCA9ICJwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0Oi0xMTExMXB4O2JvcmRlci1jb2xsYXBzZTpzZXBhcmF0ZSIsIHQuc3R5bGUuY3NzVGV4dCA9ICJib3JkZXI6MXB4IHNvbGlkIiwgdC5zdHlsZS5oZWlnaHQgPSAiMXB4Iiwgbi5zdHlsZS5oZWlnaHQgPSAiOXB4Iiwgbi5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIiwgcmUuYXBwZW5kQ2hpbGQoZSkuYXBwZW5kQ2hpbGQodCkuYXBwZW5kQ2hpbGQobiksIHIgPSBDLmdldENvbXB1dGVkU3R5bGUodCksIGEgPSBwYXJzZUludChyLmhlaWdodCwgMTApICsgcGFyc2VJbnQoci5ib3JkZXJUb3BXaWR0aCwgMTApICsgcGFyc2VJbnQoci5ib3JkZXJCb3R0b21XaWR0aCwgMTApID09PSB0Lm9mZnNldEhlaWdodCwgcmUucmVtb3ZlQ2hpbGQoZSkpLCBhDQoJCQkJfQ0KCQkJfSkpDQoJCX0oKTsNCgkJdmFyIHplID0gWyJXZWJraXQiLCAiTW96IiwgIm1zIl0sIFVlID0gUy5jcmVhdGVFbGVtZW50KCJkaXYiKS5zdHlsZSwgWGUgPSB7fTsNCg0KCQlmdW5jdGlvbiBWZShlKSB7DQoJCQl2YXIgdCA9IEUuY3NzUHJvcHNbZV0gfHwgWGVbZV07DQoJCQlyZXR1cm4gdCB8fCAoZSBpbiBVZSA/IGUgOiBYZVtlXSA9IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCA9IGVbMF0udG9VcHBlckNhc2UoKSArIGUuc2xpY2UoMSksIG4gPSB6ZS5sZW5ndGg7DQoJCQkJd2hpbGUobi0tKSBpZigoZSA9IHplW25dICsgdCkgaW4gVWUpIHJldHVybiBlDQoJCQl9KGUpIHx8IGUpDQoJCX0NCg0KCQl2YXIgR2UgPSAvXihub25lfHRhYmxlKD8hLWNbZWFdKS4rKS8sIFllID0ge3Bvc2l0aW9uOiAiYWJzb2x1dGUiLCB2aXNpYmlsaXR5OiAiaGlkZGVuIiwgZGlzcGxheTogImJsb2NrIn0sIFFlID0ge2xldHRlclNwYWNpbmc6ICIwIiwgZm9udFdlaWdodDogIjQwMCJ9Ow0KDQoJCWZ1bmN0aW9uIEplKGUsIHQsIG4pIHsNCgkJCXZhciByID0gdGUuZXhlYyh0KTsNCgkJCXJldHVybiByID8gTWF0aC5tYXgoMCwgclsyXSAtIChuIHx8IDApKSArIChyWzNdIHx8ICJweCIpIDogdA0KCQl9DQoNCgkJZnVuY3Rpb24gS2UoZSwgdCwgbiwgciwgaSwgbykgew0KCQkJdmFyIGEgPSAid2lkdGgiID09PSB0ID8gMSA6IDAsIHMgPSAwLCB1ID0gMDsNCgkJCWlmKG4gPT09IChyID8gImJvcmRlciIgOiAiY29udGVudCIpKSByZXR1cm4gMDsNCgkJCWZvcig7IGEgPCA0OyBhICs9IDIpICJtYXJnaW4iID09PSBuICYmICh1ICs9IEUuY3NzKGUsIG4gKyBuZVthXSwgITAsIGkpKSwgciA/ICgiY29udGVudCIgPT09IG4gJiYgKHUgLT0gRS5jc3MoZSwgInBhZGRpbmciICsgbmVbYV0sICEwLCBpKSksICJtYXJnaW4iICE9PSBuICYmICh1IC09IEUuY3NzKGUsICJib3JkZXIiICsgbmVbYV0gKyAiV2lkdGgiLCAhMCwgaSkpKSA6ICh1ICs9IEUuY3NzKGUsICJwYWRkaW5nIiArIG5lW2FdLCAhMCwgaSksICJwYWRkaW5nIiAhPT0gbiA/IHUgKz0gRS5jc3MoZSwgImJvcmRlciIgKyBuZVthXSArICJXaWR0aCIsICEwLCBpKSA6IHMgKz0gRS5jc3MoZSwgImJvcmRlciIgKyBuZVthXSArICJXaWR0aCIsICEwLCBpKSk7DQoJCQlyZXR1cm4gIXIgJiYgMCA8PSBvICYmICh1ICs9IE1hdGgubWF4KDAsIE1hdGguY2VpbChlWyJvZmZzZXQiICsgdFswXS50b1VwcGVyQ2FzZSgpICsgdC5zbGljZSgxKV0gLSBvIC0gdSAtIHMgLSAuNSkpIHx8IDApLCB1DQoJCX0NCg0KCQlmdW5jdGlvbiBaZShlLCB0LCBuKSB7DQoJCQl2YXIgciA9IE1lKGUpLCBpID0gKCF2LmJveFNpemluZ1JlbGlhYmxlKCkgfHwgbikgJiYgImJvcmRlci1ib3giID09PSBFLmNzcyhlLCAiYm94U2l6aW5nIiwgITEsIHIpLCBvID0gaSwgYSA9IEJlKGUsIHQsIHIpLCBzID0gIm9mZnNldCIgKyB0WzBdLnRvVXBwZXJDYXNlKCkgKyB0LnNsaWNlKDEpOw0KCQkJaWYoUGUudGVzdChhKSkgew0KCQkJCWlmKCFuKSByZXR1cm4gYTsNCgkJCQlhID0gImF1dG8iDQoJCQl9DQoJCQlyZXR1cm4gKCF2LmJveFNpemluZ1JlbGlhYmxlKCkgJiYgaSB8fCAhdi5yZWxpYWJsZVRyRGltZW5zaW9ucygpICYmIEEoZSwgInRyIikgfHwgImF1dG8iID09PSBhIHx8ICFwYXJzZUZsb2F0KGEpICYmICJpbmxpbmUiID09PSBFLmNzcyhlLCAiZGlzcGxheSIsICExLCByKSkgJiYgZS5nZXRDbGllbnRSZWN0cygpLmxlbmd0aCAmJiAoaSA9ICJib3JkZXItYm94IiA9PT0gRS5jc3MoZSwgImJveFNpemluZyIsICExLCByKSwgKG8gPSBzIGluIGUpICYmIChhID0gZVtzXSkpLCAoYSA9IHBhcnNlRmxvYXQoYSkgfHwgMCkgKyBLZShlLCB0LCBuIHx8IChpID8gImJvcmRlciIgOiAiY29udGVudCIpLCBvLCByLCBhKSArICJweCINCgkJfQ0KDQoJCWZ1bmN0aW9uIGV0KGUsIHQsIG4sIHIsIGkpIHtyZXR1cm4gbmV3IGV0LnByb3RvdHlwZS5pbml0KGUsIHQsIG4sIHIsIGkpfQ0KDQoJCUUuZXh0ZW5kKHsNCgkJCWNzc0hvb2tzOiB7DQoJCQkJb3BhY2l0eTogew0KCQkJCQlnZXQ6IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJCWlmKHQpIHsNCgkJCQkJCQl2YXIgbiA9IEJlKGUsICJvcGFjaXR5Iik7DQoJCQkJCQkJcmV0dXJuICIiID09PSBuID8gIjEiIDogbg0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfQ0KCQkJfSwNCgkJCWNzc051bWJlcjogew0KCQkJCWFuaW1hdGlvbkl0ZXJhdGlvbkNvdW50OiAhMCwNCgkJCQljb2x1bW5Db3VudDogITAsDQoJCQkJZmlsbE9wYWNpdHk6ICEwLA0KCQkJCWZsZXhHcm93OiAhMCwNCgkJCQlmbGV4U2hyaW5rOiAhMCwNCgkJCQlmb250V2VpZ2h0OiAhMCwNCgkJCQlncmlkQXJlYTogITAsDQoJCQkJZ3JpZENvbHVtbjogITAsDQoJCQkJZ3JpZENvbHVtbkVuZDogITAsDQoJCQkJZ3JpZENvbHVtblN0YXJ0OiAhMCwNCgkJCQlncmlkUm93OiAhMCwNCgkJCQlncmlkUm93RW5kOiAhMCwNCgkJCQlncmlkUm93U3RhcnQ6ICEwLA0KCQkJCWxpbmVIZWlnaHQ6ICEwLA0KCQkJCW9wYWNpdHk6ICEwLA0KCQkJCW9yZGVyOiAhMCwNCgkJCQlvcnBoYW5zOiAhMCwNCgkJCQl3aWRvd3M6ICEwLA0KCQkJCXpJbmRleDogITAsDQoJCQkJem9vbTogITANCgkJCX0sDQoJCQljc3NQcm9wczoge30sDQoJCQlzdHlsZTogZnVuY3Rpb24oZSwgdCwgbiwgcikgew0KCQkJCWlmKGUgJiYgMyAhPT0gZS5ub2RlVHlwZSAmJiA4ICE9PSBlLm5vZGVUeXBlICYmIGUuc3R5bGUpIHsNCgkJCQkJdmFyIGksIG8sIGEsIHMgPSBYKHQpLCB1ID0gUmUudGVzdCh0KSwgbCA9IGUuc3R5bGU7DQoJCQkJCWlmKHUgfHwgKHQgPSBWZShzKSksIGEgPSBFLmNzc0hvb2tzW3RdIHx8IEUuY3NzSG9va3Nbc10sIHZvaWQgMCA9PT0gbikgcmV0dXJuIGEgJiYgImdldCIgaW4gYSAmJiB2b2lkIDAgIT09IChpID0gYS5nZXQoZSwgITEsIHIpKSA/IGkgOiBsW3RdOw0KCQkJCQkic3RyaW5nIiA9PT0gKG8gPSB0eXBlb2YgbikgJiYgKGkgPSB0ZS5leGVjKG4pKSAmJiBpWzFdICYmIChuID0gc2UoZSwgdCwgaSksIG8gPSAibnVtYmVyIiksIG51bGwgIT0gbiAmJiBuID09IG4gJiYgKCJudW1iZXIiICE9PSBvIHx8IHUgfHwgKG4gKz0gaSAmJiBpWzNdIHx8IChFLmNzc051bWJlcltzXSA/ICIiIDogInB4IikpLCB2LmNsZWFyQ2xvbmVTdHlsZSB8fCAiIiAhPT0gbiB8fCAwICE9PSB0LmluZGV4T2YoImJhY2tncm91bmQiKSB8fCAobFt0XSA9ICJpbmhlcml0IiksIGEgJiYgInNldCIgaW4gYSAmJiB2b2lkIDAgPT09IChuID0gYS5zZXQoZSwgbiwgcikpIHx8ICh1ID8gbC5zZXRQcm9wZXJ0eSh0LCBuKSA6IGxbdF0gPSBuKSkNCgkJCQl9DQoJCQl9LA0KCQkJY3NzOiBmdW5jdGlvbihlLCB0LCBuLCByKSB7DQoJCQkJdmFyIGksIG8sIGEsIHMgPSBYKHQpOw0KCQkJCXJldHVybiBSZS50ZXN0KHQpIHx8ICh0ID0gVmUocykpLCAoYSA9IEUuY3NzSG9va3NbdF0gfHwgRS5jc3NIb29rc1tzXSkgJiYgImdldCIgaW4gYSAmJiAoaSA9IGEuZ2V0KGUsICEwLCBuKSksIHZvaWQgMCA9PT0gaSAmJiAoaSA9IEJlKGUsIHQsIHIpKSwgIm5vcm1hbCIgPT09IGkgJiYgdCBpbiBRZSAmJiAoaSA9IFFlW3RdKSwgIiIgPT09IG4gfHwgbiA/IChvID0gcGFyc2VGbG9hdChpKSwgITAgPT09IG4gfHwgaXNGaW5pdGUobykgPyBvIHx8IDAgOiBpKSA6IGkNCgkJCX0NCgkJfSksIEUuZWFjaChbImhlaWdodCIsICJ3aWR0aCJdLCBmdW5jdGlvbihlLCB1KSB7DQoJCQlFLmNzc0hvb2tzW3VdID0gew0KCQkJCWdldDogZnVuY3Rpb24oZSwgdCwgbikge2lmKHQpIHJldHVybiAhR2UudGVzdChFLmNzcyhlLCAiZGlzcGxheSIpKSB8fCBlLmdldENsaWVudFJlY3RzKCkubGVuZ3RoICYmIGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGggPyBaZShlLCB1LCBuKSA6IEllKGUsIFllLCBmdW5jdGlvbigpIHtyZXR1cm4gWmUoZSwgdSwgbil9KX0sDQoJCQkJc2V0OiBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJCXZhciByLCBpID0gTWUoZSksIG8gPSAhdi5zY3JvbGxib3hTaXplKCkgJiYgImFic29sdXRlIiA9PT0gaS5wb3NpdGlvbiwgYSA9IChvIHx8IG4pICYmICJib3JkZXItYm94IiA9PT0gRS5jc3MoZSwgImJveFNpemluZyIsICExLCBpKSwgcyA9IG4gPyBLZShlLCB1LCBuLCBhLCBpKSA6IDA7DQoJCQkJCXJldHVybiBhICYmIG8gJiYgKHMgLT0gTWF0aC5jZWlsKGVbIm9mZnNldCIgKyB1WzBdLnRvVXBwZXJDYXNlKCkgKyB1LnNsaWNlKDEpXSAtIHBhcnNlRmxvYXQoaVt1XSkgLSBLZShlLCB1LCAiYm9yZGVyIiwgITEsIGkpIC0gLjUpKSwgcyAmJiAociA9IHRlLmV4ZWModCkpICYmICJweCIgIT09IChyWzNdIHx8ICJweCIpICYmIChlLnN0eWxlW3VdID0gdCwgdCA9IEUuY3NzKGUsIHUpKSwgSmUoMCwgdCwgcykNCgkJCQl9DQoJCQl9DQoJCX0pLCBFLmNzc0hvb2tzLm1hcmdpbkxlZnQgPSBfZSh2LnJlbGlhYmxlTWFyZ2luTGVmdCwgZnVuY3Rpb24oZSwgdCkge2lmKHQpIHJldHVybiAocGFyc2VGbG9hdChCZShlLCAibWFyZ2luTGVmdCIpKSB8fCBlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQgLSBJZShlLCB7bWFyZ2luTGVmdDogMH0sIGZ1bmN0aW9uKCkge3JldHVybiBlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnR9KSkgKyAicHgifSksIEUuZWFjaCh7DQoJCQltYXJnaW46ICIiLA0KCQkJcGFkZGluZzogIiIsDQoJCQlib3JkZXI6ICJXaWR0aCINCgkJfSwgZnVuY3Rpb24oaSwgbykgew0KCQkJRS5jc3NIb29rc1tpICsgb10gPSB7DQoJCQkJZXhwYW5kOiBmdW5jdGlvbihlKSB7DQoJCQkJCWZvcih2YXIgdCA9IDAsIG4gPSB7fSwgciA9ICJzdHJpbmciID09IHR5cGVvZiBlID8gZS5zcGxpdCgiICIpIDogW2VdOyB0IDwgNDsgdCsrKSBuW2kgKyBuZVt0XSArIG9dID0gclt0XSB8fCByW3QgLSAyXSB8fCByWzBdOw0KCQkJCQlyZXR1cm4gbg0KCQkJCX0NCgkJCX0sICJtYXJnaW4iICE9PSBpICYmIChFLmNzc0hvb2tzW2kgKyBvXS5zZXQgPSBKZSkNCgkJfSksIEUuZm4uZXh0ZW5kKHsNCgkJCWNzczogZnVuY3Rpb24oZSwgdCkgew0KCQkJCXJldHVybiBCKHRoaXMsIGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQkJdmFyIHIsIGksIG8gPSB7fSwgYSA9IDA7DQoJCQkJCWlmKEFycmF5LmlzQXJyYXkodCkpIHsNCgkJCQkJCWZvcihyID0gTWUoZSksIGkgPSB0Lmxlbmd0aDsgYSA8IGk7IGErKykgb1t0W2FdXSA9IEUuY3NzKGUsIHRbYV0sICExLCByKTsNCgkJCQkJCXJldHVybiBvDQoJCQkJCX0NCgkJCQkJcmV0dXJuIHZvaWQgMCAhPT0gbiA/IEUuc3R5bGUoZSwgdCwgbikgOiBFLmNzcyhlLCB0KQ0KCQkJCX0sIGUsIHQsIDEgPCBhcmd1bWVudHMubGVuZ3RoKQ0KCQkJfQ0KCQl9KSwgKChFLlR3ZWVuID0gZXQpLnByb3RvdHlwZSA9IHsNCgkJCWNvbnN0cnVjdG9yOiBldCwNCgkJCWluaXQ6IGZ1bmN0aW9uKGUsIHQsIG4sIHIsIGksIG8pIHt0aGlzLmVsZW0gPSBlLCB0aGlzLnByb3AgPSBuLCB0aGlzLmVhc2luZyA9IGkgfHwgRS5lYXNpbmcuX2RlZmF1bHQsIHRoaXMub3B0aW9ucyA9IHQsIHRoaXMuc3RhcnQgPSB0aGlzLm5vdyA9IHRoaXMuY3VyKCksIHRoaXMuZW5kID0gciwgdGhpcy51bml0ID0gbyB8fCAoRS5jc3NOdW1iZXJbbl0gPyAiIiA6ICJweCIpfSwNCgkJCWN1cjogZnVuY3Rpb24oKSB7DQoJCQkJdmFyIGUgPSBldC5wcm9wSG9va3NbdGhpcy5wcm9wXTsNCgkJCQlyZXR1cm4gZSAmJiBlLmdldCA/IGUuZ2V0KHRoaXMpIDogZXQucHJvcEhvb2tzLl9kZWZhdWx0LmdldCh0aGlzKQ0KCQkJfSwNCgkJCXJ1bjogZnVuY3Rpb24oZSkgew0KCQkJCXZhciB0LCBuID0gZXQucHJvcEhvb2tzW3RoaXMucHJvcF07DQoJCQkJcmV0dXJuIHRoaXMub3B0aW9ucy5kdXJhdGlvbiA/IHRoaXMucG9zID0gdCA9IEUuZWFzaW5nW3RoaXMuZWFzaW5nXShlLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24gKiBlLCAwLCAxLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24pIDogdGhpcy5wb3MgPSB0ID0gZSwgdGhpcy5ub3cgPSAodGhpcy5lbmQgLSB0aGlzLnN0YXJ0KSAqIHQgKyB0aGlzLnN0YXJ0LCB0aGlzLm9wdGlvbnMuc3RlcCAmJiB0aGlzLm9wdGlvbnMuc3RlcC5jYWxsKHRoaXMuZWxlbSwgdGhpcy5ub3csIHRoaXMpLCBuICYmIG4uc2V0ID8gbi5zZXQodGhpcykgOiBldC5wcm9wSG9va3MuX2RlZmF1bHQuc2V0KHRoaXMpLCB0aGlzDQoJCQl9DQoJCX0pLmluaXQucHJvdG90eXBlID0gZXQucHJvdG90eXBlLCAoZXQucHJvcEhvb2tzID0gew0KCQkJX2RlZmF1bHQ6IHsNCgkJCQlnZXQ6IGZ1bmN0aW9uKGUpIHsNCgkJCQkJdmFyIHQ7DQoJCQkJCXJldHVybiAxICE9PSBlLmVsZW0ubm9kZVR5cGUgfHwgbnVsbCAhPSBlLmVsZW1bZS5wcm9wXSAmJiBudWxsID09IGUuZWxlbS5zdHlsZVtlLnByb3BdID8gZS5lbGVtW2UucHJvcF0gOiAodCA9IEUuY3NzKGUuZWxlbSwgZS5wcm9wLCAiIikpICYmICJhdXRvIiAhPT0gdCA/IHQgOiAwDQoJCQkJfSwgc2V0OiBmdW5jdGlvbihlKSB7RS5meC5zdGVwW2UucHJvcF0gPyBFLmZ4LnN0ZXBbZS5wcm9wXShlKSA6IDEgIT09IGUuZWxlbS5ub2RlVHlwZSB8fCAhRS5jc3NIb29rc1tlLnByb3BdICYmIG51bGwgPT0gZS5lbGVtLnN0eWxlW1ZlKGUucHJvcCldID8gZS5lbGVtW2UucHJvcF0gPSBlLm5vdyA6IEUuc3R5bGUoZS5lbGVtLCBlLnByb3AsIGUubm93ICsgZS51bml0KX0NCgkJCX0NCgkJfSkuc2Nyb2xsVG9wID0gZXQucHJvcEhvb2tzLnNjcm9sbExlZnQgPSB7c2V0OiBmdW5jdGlvbihlKSB7ZS5lbGVtLm5vZGVUeXBlICYmIGUuZWxlbS5wYXJlbnROb2RlICYmIChlLmVsZW1bZS5wcm9wXSA9IGUubm93KX19LCBFLmVhc2luZyA9IHsNCgkJCWxpbmVhcjogZnVuY3Rpb24oZSkge3JldHVybiBlfSwNCgkJCXN3aW5nOiBmdW5jdGlvbihlKSB7cmV0dXJuIC41IC0gTWF0aC5jb3MoZSAqIE1hdGguUEkpIC8gMn0sDQoJCQlfZGVmYXVsdDogInN3aW5nIg0KCQl9LCBFLmZ4ID0gZXQucHJvdG90eXBlLmluaXQsIEUuZnguc3RlcCA9IHt9Ow0KCQl2YXIgdHQsIG50LCBydCwgaXQsIG90ID0gL14oPzp0b2dnbGV8c2hvd3xoaWRlKSQvLCBhdCA9IC9xdWV1ZUhvb2tzJC87DQoNCgkJZnVuY3Rpb24gc3QoKSB7bnQgJiYgKCExID09PSBTLmhpZGRlbiAmJiBDLnJlcXVlc3RBbmltYXRpb25GcmFtZSA/IEMucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHN0KSA6IEMuc2V0VGltZW91dChzdCwgRS5meC5pbnRlcnZhbCksIEUuZngudGljaygpKX0NCg0KCQlmdW5jdGlvbiB1dCgpIHtyZXR1cm4gQy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkge3R0ID0gdm9pZCAwfSksIHR0ID0gRGF0ZS5ub3coKX0NCg0KCQlmdW5jdGlvbiBsdChlLCB0KSB7DQoJCQl2YXIgbiwgciA9IDAsIGkgPSB7aGVpZ2h0OiBlfTsNCgkJCWZvcih0ID0gdCA/IDEgOiAwOyByIDwgNDsgciArPSAyIC0gdCkgaVsibWFyZ2luIiArIChuID0gbmVbcl0pXSA9IGlbInBhZGRpbmciICsgbl0gPSBlOw0KCQkJcmV0dXJuIHQgJiYgKGkub3BhY2l0eSA9IGkud2lkdGggPSBlKSwgaQ0KCQl9DQoNCgkJZnVuY3Rpb24gY3QoZSwgdCwgbikge2Zvcih2YXIgciwgaSA9IChmdC50d2VlbmVyc1t0XSB8fCBbXSkuY29uY2F0KGZ0LnR3ZWVuZXJzWyIqIl0pLCBvID0gMCwgYSA9IGkubGVuZ3RoOyBvIDwgYTsgbysrKSBpZihyID0gaVtvXS5jYWxsKG4sIHQsIGUpKSByZXR1cm4gcn0NCg0KCQlmdW5jdGlvbiBmdChvLCBlLCB0KSB7DQoJCQl2YXIgbiwNCgkJCSAgICBhLA0KCQkJICAgIHIgPSAwLA0KCQkJICAgIGkgPSBmdC5wcmVmaWx0ZXJzLmxlbmd0aCwNCgkJCSAgICBzID0gRS5EZWZlcnJlZCgpLmFsd2F5cyhmdW5jdGlvbigpIHtkZWxldGUgdS5lbGVtfSksDQoJCQkgICAgdSA9IGZ1bmN0aW9uKCkgew0KCQkJCSAgICBpZihhKSByZXR1cm4gITE7DQoJCQkJICAgIGZvcih2YXIgZSA9IHR0IHx8IHV0KCksIHQgPSBNYXRoLm1heCgwLCBsLnN0YXJ0VGltZSArIGwuZHVyYXRpb24gLSBlKSwgbiA9IDEgLSAodCAvIGwuZHVyYXRpb24gfHwgMCksIHIgPSAwLCBpID0gbC50d2VlbnMubGVuZ3RoOyByIDwgaTsgcisrKSBsLnR3ZWVuc1tyXS5ydW4obik7DQoJCQkJICAgIHJldHVybiBzLm5vdGlmeVdpdGgobywgW2wsIG4sIHRdKSwgbiA8IDEgJiYgaSA/IHQgOiAoaSB8fCBzLm5vdGlmeVdpdGgobywgW2wsIDEsIDBdKSwgcy5yZXNvbHZlV2l0aChvLCBbbF0pLCAhMSkNCgkJCSAgICB9LA0KCQkJICAgIGwgPSBzLnByb21pc2Uoew0KCQkJCSAgICBlbGVtOiBvLA0KCQkJCSAgICBwcm9wczogRS5leHRlbmQoe30sIGUpLA0KCQkJCSAgICBvcHRzOiBFLmV4dGVuZCghMCwge3NwZWNpYWxFYXNpbmc6IHt9LCBlYXNpbmc6IEUuZWFzaW5nLl9kZWZhdWx0fSwgdCksDQoJCQkJICAgIG9yaWdpbmFsUHJvcGVydGllczogZSwNCgkJCQkgICAgb3JpZ2luYWxPcHRpb25zOiB0LA0KCQkJCSAgICBzdGFydFRpbWU6IHR0IHx8IHV0KCksDQoJCQkJICAgIGR1cmF0aW9uOiB0LmR1cmF0aW9uLA0KCQkJCSAgICB0d2VlbnM6IFtdLA0KCQkJCSAgICBjcmVhdGVUd2VlbjogZnVuY3Rpb24oZSwgdCkgew0KCQkJCQkgICAgdmFyIG4gPSBFLlR3ZWVuKG8sIGwub3B0cywgZSwgdCwgbC5vcHRzLnNwZWNpYWxFYXNpbmdbZV0gfHwgbC5vcHRzLmVhc2luZyk7DQoJCQkJCSAgICByZXR1cm4gbC50d2VlbnMucHVzaChuKSwgbg0KCQkJCSAgICB9LA0KCQkJCSAgICBzdG9wOiBmdW5jdGlvbihlKSB7DQoJCQkJCSAgICB2YXIgdCA9IDAsIG4gPSBlID8gbC50d2VlbnMubGVuZ3RoIDogMDsNCgkJCQkJICAgIGlmKGEpIHJldHVybiB0aGlzOw0KCQkJCQkgICAgZm9yKGEgPSAhMDsgdCA8IG47IHQrKykgbC50d2VlbnNbdF0ucnVuKDEpOw0KCQkJCQkgICAgcmV0dXJuIGUgPyAocy5ub3RpZnlXaXRoKG8sIFtsLCAxLCAwXSksIHMucmVzb2x2ZVdpdGgobywgW2wsIGVdKSkgOiBzLnJlamVjdFdpdGgobywgW2wsIGVdKSwgdGhpcw0KCQkJCSAgICB9DQoJCQkgICAgfSksDQoJCQkgICAgYyA9IGwucHJvcHM7DQoJCQlmb3IoIWZ1bmN0aW9uKGUsIHQpIHsNCgkJCQl2YXIgbiwgciwgaSwgbywgYTsNCgkJCQlmb3IobiBpbiBlKSBpZihpID0gdFtyID0gWChuKV0sIG8gPSBlW25dLCBBcnJheS5pc0FycmF5KG8pICYmIChpID0gb1sxXSwgbyA9IGVbbl0gPSBvWzBdKSwgbiAhPT0gciAmJiAoZVtyXSA9IG8sIGRlbGV0ZSBlW25dKSwgKGEgPSBFLmNzc0hvb2tzW3JdKSAmJiAiZXhwYW5kIiBpbiBhKSBmb3IobiBpbiBvID0gYS5leHBhbmQobyksIGRlbGV0ZSBlW3JdLCBvKSBuIGluIGUgfHwgKGVbbl0gPSBvW25dLCB0W25dID0gaSk7IGVsc2UgdFtyXSA9IGkNCgkJCX0oYywgbC5vcHRzLnNwZWNpYWxFYXNpbmcpOyByIDwgaTsgcisrKSBpZihuID0gZnQucHJlZmlsdGVyc1tyXS5jYWxsKGwsIG8sIGMsIGwub3B0cykpIHJldHVybiBtKG4uc3RvcCkgJiYgKEUuX3F1ZXVlSG9va3MobC5lbGVtLCBsLm9wdHMucXVldWUpLnN0b3AgPSBuLnN0b3AuYmluZChuKSksIG47DQoJCQlyZXR1cm4gRS5tYXAoYywgY3QsIGwpLCBtKGwub3B0cy5zdGFydCkgJiYgbC5vcHRzLnN0YXJ0LmNhbGwobywgbCksIGwucHJvZ3Jlc3MobC5vcHRzLnByb2dyZXNzKS5kb25lKGwub3B0cy5kb25lLCBsLm9wdHMuY29tcGxldGUpLmZhaWwobC5vcHRzLmZhaWwpLmFsd2F5cyhsLm9wdHMuYWx3YXlzKSwgRS5meC50aW1lcihFLmV4dGVuZCh1LCB7ZWxlbTogbywgYW5pbTogbCwgcXVldWU6IGwub3B0cy5xdWV1ZX0pKSwgbA0KCQl9DQoNCgkJRS5BbmltYXRpb24gPSBFLmV4dGVuZChmdCwgew0KCQkJdHdlZW5lcnM6IHsNCgkJCQkiKiI6IFtmdW5jdGlvbihlLCB0KSB7DQoJCQkJCXZhciBuID0gdGhpcy5jcmVhdGVUd2VlbihlLCB0KTsNCgkJCQkJcmV0dXJuIHNlKG4uZWxlbSwgZSwgdGUuZXhlYyh0KSwgbiksIG4NCgkJCQl9XQ0KCQkJfSwgdHdlZW5lcjogZnVuY3Rpb24oZSwgdCkgew0KCQkJCW0oZSkgPyAodCA9IGUsIGUgPSBbIioiXSkgOiBlID0gZS5tYXRjaChQKTsNCgkJCQlmb3IodmFyIG4sIHIgPSAwLCBpID0gZS5sZW5ndGg7IHIgPCBpOyByKyspIG4gPSBlW3JdLCBmdC50d2VlbmVyc1tuXSA9IGZ0LnR3ZWVuZXJzW25dIHx8IFtdLCBmdC50d2VlbmVyc1tuXS51bnNoaWZ0KHQpDQoJCQl9LCBwcmVmaWx0ZXJzOiBbZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCXZhciByLCBpLCBvLCBhLCBzLCB1LCBsLCBjLCBmID0gIndpZHRoIiBpbiB0IHx8ICJoZWlnaHQiIGluIHQsIHAgPSB0aGlzLCBkID0ge30sIGggPSBlLnN0eWxlLCBnID0gZS5ub2RlVHlwZSAmJiBhZShlKSwgeSA9IFkuZ2V0KGUsICJmeHNob3ciKTsNCgkJCQlmb3IociBpbiBuLnF1ZXVlIHx8IChudWxsID09IChhID0gRS5fcXVldWVIb29rcyhlLCAiZngiKSkudW5xdWV1ZWQgJiYgKGEudW5xdWV1ZWQgPSAwLCBzID0gYS5lbXB0eS5maXJlLCBhLmVtcHR5LmZpcmUgPSBmdW5jdGlvbigpIHthLnVucXVldWVkIHx8IHMoKX0pLCBhLnVucXVldWVkKyssIHAuYWx3YXlzKGZ1bmN0aW9uKCkge3AuYWx3YXlzKGZ1bmN0aW9uKCkge2EudW5xdWV1ZWQtLSwgRS5xdWV1ZShlLCAiZngiKS5sZW5ndGggfHwgYS5lbXB0eS5maXJlKCl9KX0pKSwgdCkgaWYoaSA9IHRbcl0sIG90LnRlc3QoaSkpIHsNCgkJCQkJaWYoZGVsZXRlIHRbcl0sIG8gPSBvIHx8ICJ0b2dnbGUiID09PSBpLCBpID09PSAoZyA/ICJoaWRlIiA6ICJzaG93IikpIHsNCgkJCQkJCWlmKCJzaG93IiAhPT0gaSB8fCAheSB8fCB2b2lkIDAgPT09IHlbcl0pIGNvbnRpbnVlOw0KCQkJCQkJZyA9ICEwDQoJCQkJCX0NCgkJCQkJZFtyXSA9IHkgJiYgeVtyXSB8fCBFLnN0eWxlKGUsIHIpDQoJCQkJfQ0KCQkJCWlmKCh1ID0gIUUuaXNFbXB0eU9iamVjdCh0KSkgfHwgIUUuaXNFbXB0eU9iamVjdChkKSkgZm9yKHIgaW4gZiAmJiAxID09PSBlLm5vZGVUeXBlICYmIChuLm92ZXJmbG93ID0gW2gub3ZlcmZsb3csIGgub3ZlcmZsb3dYLCBoLm92ZXJmbG93WV0sIG51bGwgPT0gKGwgPSB5ICYmIHkuZGlzcGxheSkgJiYgKGwgPSBZLmdldChlLCAiZGlzcGxheSIpKSwgIm5vbmUiID09PSAoYyA9IEUuY3NzKGUsICJkaXNwbGF5IikpICYmIChsID8gYyA9IGwgOiAobGUoW2VdLCAhMCksIGwgPSBlLnN0eWxlLmRpc3BsYXkgfHwgbCwgYyA9IEUuY3NzKGUsICJkaXNwbGF5IiksIGxlKFtlXSkpKSwgKCJpbmxpbmUiID09PSBjIHx8ICJpbmxpbmUtYmxvY2siID09PSBjICYmIG51bGwgIT0gbCkgJiYgIm5vbmUiID09PSBFLmNzcyhlLCAiZmxvYXQiKSAmJiAodSB8fCAocC5kb25lKGZ1bmN0aW9uKCkge2guZGlzcGxheSA9IGx9KSwgbnVsbCA9PSBsICYmIChjID0gaC5kaXNwbGF5LCBsID0gIm5vbmUiID09PSBjID8gIiIgOiBjKSksIGguZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siKSksIG4ub3ZlcmZsb3cgJiYgKGgub3ZlcmZsb3cgPSAiaGlkZGVuIiwgcC5hbHdheXMoZnVuY3Rpb24oKSB7aC5vdmVyZmxvdyA9IG4ub3ZlcmZsb3dbMF0sIGgub3ZlcmZsb3dYID0gbi5vdmVyZmxvd1sxXSwgaC5vdmVyZmxvd1kgPSBuLm92ZXJmbG93WzJdfSkpLCB1ID0gITEsIGQpIHUgfHwgKHkgPyAiaGlkZGVuIiBpbiB5ICYmIChnID0geS5oaWRkZW4pIDogeSA9IFkuYWNjZXNzKGUsICJmeHNob3ciLCB7ZGlzcGxheTogbH0pLCBvICYmICh5LmhpZGRlbiA9ICFnKSwgZyAmJiBsZShbZV0sICEwKSwgcC5kb25lKGZ1bmN0aW9uKCkge2ZvcihyIGluIGcgfHwgbGUoW2VdKSwgWS5yZW1vdmUoZSwgImZ4c2hvdyIpLCBkKSBFLnN0eWxlKGUsIHIsIGRbcl0pfSkpLCB1ID0gY3QoZyA/IHlbcl0gOiAwLCByLCBwKSwgciBpbiB5IHx8ICh5W3JdID0gdS5zdGFydCwgZyAmJiAodS5lbmQgPSB1LnN0YXJ0LCB1LnN0YXJ0ID0gMCkpDQoJCQl9XSwgcHJlZmlsdGVyOiBmdW5jdGlvbihlLCB0KSB7dCA/IGZ0LnByZWZpbHRlcnMudW5zaGlmdChlKSA6IGZ0LnByZWZpbHRlcnMucHVzaChlKX0NCgkJfSksIEUuc3BlZWQgPSBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQl2YXIgciA9IGUgJiYgIm9iamVjdCIgPT0gdHlwZW9mIGUgPyBFLmV4dGVuZCh7fSwgZSkgOiB7Y29tcGxldGU6IG4gfHwgIW4gJiYgdCB8fCBtKGUpICYmIGUsIGR1cmF0aW9uOiBlLCBlYXNpbmc6IG4gJiYgdCB8fCB0ICYmICFtKHQpICYmIHR9Ow0KCQkJcmV0dXJuIEUuZngub2ZmID8gci5kdXJhdGlvbiA9IDAgOiAibnVtYmVyIiAhPSB0eXBlb2Ygci5kdXJhdGlvbiAmJiAoci5kdXJhdGlvbiBpbiBFLmZ4LnNwZWVkcyA/IHIuZHVyYXRpb24gPSBFLmZ4LnNwZWVkc1tyLmR1cmF0aW9uXSA6IHIuZHVyYXRpb24gPSBFLmZ4LnNwZWVkcy5fZGVmYXVsdCksIG51bGwgIT0gci5xdWV1ZSAmJiAhMCAhPT0gci5xdWV1ZSB8fCAoci5xdWV1ZSA9ICJmeCIpLCByLm9sZCA9IHIuY29tcGxldGUsIHIuY29tcGxldGUgPSBmdW5jdGlvbigpIHttKHIub2xkKSAmJiByLm9sZC5jYWxsKHRoaXMpLCByLnF1ZXVlICYmIEUuZGVxdWV1ZSh0aGlzLCByLnF1ZXVlKX0sIHINCgkJfSwgRS5mbi5leHRlbmQoew0KCQkJZmFkZVRvOiBmdW5jdGlvbihlLCB0LCBuLCByKSB7cmV0dXJuIHRoaXMuZmlsdGVyKGFlKS5jc3MoIm9wYWNpdHkiLCAwKS5zaG93KCkuZW5kKCkuYW5pbWF0ZSh7b3BhY2l0eTogdH0sIGUsIG4sIHIpfSwgYW5pbWF0ZTogZnVuY3Rpb24odCwgZSwgbiwgcikgew0KCQkJCXZhciBpID0gRS5pc0VtcHR5T2JqZWN0KHQpLCBvID0gRS5zcGVlZChlLCBuLCByKSwgYSA9IGZ1bmN0aW9uKCkgew0KCQkJCQl2YXIgZSA9IGZ0KHRoaXMsIEUuZXh0ZW5kKHt9LCB0KSwgbyk7DQoJCQkJCShpIHx8IFkuZ2V0KHRoaXMsICJmaW5pc2giKSkgJiYgZS5zdG9wKCEwKQ0KCQkJCX07DQoJCQkJcmV0dXJuIGEuZmluaXNoID0gYSwgaSB8fCAhMSA9PT0gby5xdWV1ZSA/IHRoaXMuZWFjaChhKSA6IHRoaXMucXVldWUoby5xdWV1ZSwgYSkNCgkJCX0sIHN0b3A6IGZ1bmN0aW9uKGksIGUsIG8pIHsNCgkJCQl2YXIgYSA9IGZ1bmN0aW9uKGUpIHsNCgkJCQkJdmFyIHQgPSBlLnN0b3A7DQoJCQkJCWRlbGV0ZSBlLnN0b3AsIHQobykNCgkJCQl9Ow0KCQkJCXJldHVybiAic3RyaW5nIiAhPSB0eXBlb2YgaSAmJiAobyA9IGUsIGUgPSBpLCBpID0gdm9pZCAwKSwgZSAmJiB0aGlzLnF1ZXVlKGkgfHwgImZ4IiwgW10pLCB0aGlzLmVhY2goZnVuY3Rpb24oKSB7DQoJCQkJCXZhciBlID0gITAsIHQgPSBudWxsICE9IGkgJiYgaSArICJxdWV1ZUhvb2tzIiwgbiA9IEUudGltZXJzLCByID0gWS5nZXQodGhpcyk7DQoJCQkJCWlmKHQpIHJbdF0gJiYgclt0XS5zdG9wICYmIGEoclt0XSk7IGVsc2UgZm9yKHQgaW4gcikgclt0XSAmJiByW3RdLnN0b3AgJiYgYXQudGVzdCh0KSAmJiBhKHJbdF0pOw0KCQkJCQlmb3IodCA9IG4ubGVuZ3RoOyB0LS07KSBuW3RdLmVsZW0gIT09IHRoaXMgfHwgbnVsbCAhPSBpICYmIG5bdF0ucXVldWUgIT09IGkgfHwgKG5bdF0uYW5pbS5zdG9wKG8pLCBlID0gITEsIG4uc3BsaWNlKHQsIDEpKTsNCgkJCQkJIWUgJiYgbyB8fCBFLmRlcXVldWUodGhpcywgaSkNCgkJCQl9KQ0KCQkJfSwgZmluaXNoOiBmdW5jdGlvbihhKSB7DQoJCQkJcmV0dXJuICExICE9PSBhICYmIChhID0gYSB8fCAiZngiKSwgdGhpcy5lYWNoKGZ1bmN0aW9uKCkgew0KCQkJCQl2YXIgZSwgdCA9IFkuZ2V0KHRoaXMpLCBuID0gdFthICsgInF1ZXVlIl0sIHIgPSB0W2EgKyAicXVldWVIb29rcyJdLCBpID0gRS50aW1lcnMsIG8gPSBuID8gbi5sZW5ndGggOiAwOw0KCQkJCQlmb3IodC5maW5pc2ggPSAhMCwgRS5xdWV1ZSh0aGlzLCBhLCBbXSksIHIgJiYgci5zdG9wICYmIHIuc3RvcC5jYWxsKHRoaXMsICEwKSwgZSA9IGkubGVuZ3RoOyBlLS07KSBpW2VdLmVsZW0gPT09IHRoaXMgJiYgaVtlXS5xdWV1ZSA9PT0gYSAmJiAoaVtlXS5hbmltLnN0b3AoITApLCBpLnNwbGljZShlLCAxKSk7DQoJCQkJCWZvcihlID0gMDsgZSA8IG87IGUrKykgbltlXSAmJiBuW2VdLmZpbmlzaCAmJiBuW2VdLmZpbmlzaC5jYWxsKHRoaXMpOw0KCQkJCQlkZWxldGUgdC5maW5pc2gNCgkJCQl9KQ0KCQkJfQ0KCQl9KSwgRS5lYWNoKFsidG9nZ2xlIiwgInNob3ciLCAiaGlkZSJdLCBmdW5jdGlvbihlLCByKSB7DQoJCQl2YXIgaSA9IEUuZm5bcl07DQoJCQlFLmZuW3JdID0gZnVuY3Rpb24oZSwgdCwgbikge3JldHVybiBudWxsID09IGUgfHwgImJvb2xlYW4iID09IHR5cGVvZiBlID8gaS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIDogdGhpcy5hbmltYXRlKGx0KHIsICEwKSwgZSwgdCwgbil9DQoJCX0pLCBFLmVhY2goew0KCQkJc2xpZGVEb3duOiBsdCgic2hvdyIpLA0KCQkJc2xpZGVVcDogbHQoImhpZGUiKSwNCgkJCXNsaWRlVG9nZ2xlOiBsdCgidG9nZ2xlIiksDQoJCQlmYWRlSW46IHtvcGFjaXR5OiAic2hvdyJ9LA0KCQkJZmFkZU91dDoge29wYWNpdHk6ICJoaWRlIn0sDQoJCQlmYWRlVG9nZ2xlOiB7b3BhY2l0eTogInRvZ2dsZSJ9DQoJCX0sIGZ1bmN0aW9uKGUsIHIpIHtFLmZuW2VdID0gZnVuY3Rpb24oZSwgdCwgbikge3JldHVybiB0aGlzLmFuaW1hdGUociwgZSwgdCwgbil9fSksIEUudGltZXJzID0gW10sIEUuZngudGljayA9IGZ1bmN0aW9uKCkgew0KCQkJdmFyIGUsIHQgPSAwLCBuID0gRS50aW1lcnM7DQoJCQlmb3IodHQgPSBEYXRlLm5vdygpOyB0IDwgbi5sZW5ndGg7IHQrKykgKGUgPSBuW3RdKSgpIHx8IG5bdF0gIT09IGUgfHwgbi5zcGxpY2UodC0tLCAxKTsNCgkJCW4ubGVuZ3RoIHx8IEUuZnguc3RvcCgpLCB0dCA9IHZvaWQgMA0KCQl9LCBFLmZ4LnRpbWVyID0gZnVuY3Rpb24oZSkge0UudGltZXJzLnB1c2goZSksIEUuZnguc3RhcnQoKX0sIEUuZnguaW50ZXJ2YWwgPSAxMywgRS5meC5zdGFydCA9IGZ1bmN0aW9uKCkge250IHx8IChudCA9ICEwLCBzdCgpKX0sIEUuZnguc3RvcCA9IGZ1bmN0aW9uKCkge250ID0gbnVsbH0sIEUuZnguc3BlZWRzID0gew0KCQkJc2xvdzogNjAwLA0KCQkJZmFzdDogMjAwLA0KCQkJX2RlZmF1bHQ6IDQwMA0KCQl9LCBFLmZuLmRlbGF5ID0gZnVuY3Rpb24ociwgZSkgew0KCQkJcmV0dXJuIHIgPSBFLmZ4ICYmIEUuZnguc3BlZWRzW3JdIHx8IHIsIGUgPSBlIHx8ICJmeCIsIHRoaXMucXVldWUoZSwgZnVuY3Rpb24oZSwgdCkgew0KCQkJCXZhciBuID0gQy5zZXRUaW1lb3V0KGUsIHIpOw0KCQkJCXQuc3RvcCA9IGZ1bmN0aW9uKCkge0MuY2xlYXJUaW1lb3V0KG4pfQ0KCQkJfSkNCgkJfSwgcnQgPSBTLmNyZWF0ZUVsZW1lbnQoImlucHV0IiksIGl0ID0gUy5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKS5hcHBlbmRDaGlsZChTLmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpKSwgcnQudHlwZSA9ICJjaGVja2JveCIsIHYuY2hlY2tPbiA9ICIiICE9PSBydC52YWx1ZSwgdi5vcHRTZWxlY3RlZCA9IGl0LnNlbGVjdGVkLCAocnQgPSBTLmNyZWF0ZUVsZW1lbnQoImlucHV0IikpLnZhbHVlID0gInQiLCBydC50eXBlID0gInJhZGlvIiwgdi5yYWRpb1ZhbHVlID0gInQiID09PSBydC52YWx1ZTsNCgkJdmFyIHB0LCBkdCA9IEUuZXhwci5hdHRySGFuZGxlOw0KCQlFLmZuLmV4dGVuZCh7YXR0cjogZnVuY3Rpb24oZSwgdCkge3JldHVybiBCKHRoaXMsIEUuYXR0ciwgZSwgdCwgMSA8IGFyZ3VtZW50cy5sZW5ndGgpfSwgcmVtb3ZlQXR0cjogZnVuY3Rpb24oZSkge3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7RS5yZW1vdmVBdHRyKHRoaXMsIGUpfSl9fSksIEUuZXh0ZW5kKHsNCgkJCWF0dHI6IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQl2YXIgciwgaSwgbyA9IGUubm9kZVR5cGU7DQoJCQkJaWYoMyAhPT0gbyAmJiA4ICE9PSBvICYmIDIgIT09IG8pIHJldHVybiAidW5kZWZpbmVkIiA9PSB0eXBlb2YgZS5nZXRBdHRyaWJ1dGUgPyBFLnByb3AoZSwgdCwgbikgOiAoMSA9PT0gbyAmJiBFLmlzWE1MRG9jKGUpIHx8IChpID0gRS5hdHRySG9va3NbdC50b0xvd2VyQ2FzZSgpXSB8fCAoRS5leHByLm1hdGNoLmJvb2wudGVzdCh0KSA/IHB0IDogdm9pZCAwKSksIHZvaWQgMCAhPT0gbiA/IG51bGwgPT09IG4gPyB2b2lkIEUucmVtb3ZlQXR0cihlLCB0KSA6IGkgJiYgInNldCIgaW4gaSAmJiB2b2lkIDAgIT09IChyID0gaS5zZXQoZSwgbiwgdCkpID8gciA6IChlLnNldEF0dHJpYnV0ZSh0LCBuICsgIiIpLCBuKSA6IGkgJiYgImdldCIgaW4gaSAmJiBudWxsICE9PSAociA9IGkuZ2V0KGUsIHQpKSA/IHIgOiBudWxsID09IChyID0gRS5maW5kLmF0dHIoZSwgdCkpID8gdm9pZCAwIDogcikNCgkJCX0sIGF0dHJIb29rczogew0KCQkJCXR5cGU6IHsNCgkJCQkJc2V0OiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJCQlpZighdi5yYWRpb1ZhbHVlICYmICJyYWRpbyIgPT09IHQgJiYgQShlLCAiaW5wdXQiKSkgew0KCQkJCQkJCXZhciBuID0gZS52YWx1ZTsNCgkJCQkJCQlyZXR1cm4gZS5zZXRBdHRyaWJ1dGUoInR5cGUiLCB0KSwgbiAmJiAoZS52YWx1ZSA9IG4pLCB0DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9DQoJCQl9LCByZW1vdmVBdHRyOiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4sIHIgPSAwLCBpID0gdCAmJiB0Lm1hdGNoKFApOw0KCQkJCWlmKGkgJiYgMSA9PT0gZS5ub2RlVHlwZSkgd2hpbGUobiA9IGlbcisrXSkgZS5yZW1vdmVBdHRyaWJ1dGUobikNCgkJCX0NCgkJfSksIHB0ID0ge3NldDogZnVuY3Rpb24oZSwgdCwgbikge3JldHVybiAhMSA9PT0gdCA/IEUucmVtb3ZlQXR0cihlLCBuKSA6IGUuc2V0QXR0cmlidXRlKG4sIG4pLCBufX0sIEUuZWFjaChFLmV4cHIubWF0Y2guYm9vbC5zb3VyY2UubWF0Y2goL1x3Ky9nKSwgZnVuY3Rpb24oZSwgdCkgew0KCQkJdmFyIGEgPSBkdFt0XSB8fCBFLmZpbmQuYXR0cjsNCgkJCWR0W3RdID0gZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCXZhciByLCBpLCBvID0gdC50b0xvd2VyQ2FzZSgpOw0KCQkJCXJldHVybiBuIHx8IChpID0gZHRbb10sIGR0W29dID0gciwgciA9IG51bGwgIT0gYShlLCB0LCBuKSA/IG8gOiBudWxsLCBkdFtvXSA9IGkpLCByDQoJCQl9DQoJCX0pOw0KCQl2YXIgaHQgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b24pJC9pLCBndCA9IC9eKD86YXxhcmVhKSQvaTsNCg0KCQlmdW5jdGlvbiB5dChlKSB7cmV0dXJuIChlLm1hdGNoKFApIHx8IFtdKS5qb2luKCIgIil9DQoNCgkJZnVuY3Rpb24gdnQoZSkge3JldHVybiBlLmdldEF0dHJpYnV0ZSAmJiBlLmdldEF0dHJpYnV0ZSgiY2xhc3MiKSB8fCAiIn0NCg0KCQlmdW5jdGlvbiBtdChlKSB7cmV0dXJuIEFycmF5LmlzQXJyYXkoZSkgPyBlIDogInN0cmluZyIgPT0gdHlwZW9mIGUgJiYgZS5tYXRjaChQKSB8fCBbXX0NCg0KCQlFLmZuLmV4dGVuZCh7cHJvcDogZnVuY3Rpb24oZSwgdCkge3JldHVybiBCKHRoaXMsIEUucHJvcCwgZSwgdCwgMSA8IGFyZ3VtZW50cy5sZW5ndGgpfSwgcmVtb3ZlUHJvcDogZnVuY3Rpb24oZSkge3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7ZGVsZXRlIHRoaXNbRS5wcm9wRml4W2VdIHx8IGVdfSl9fSksIEUuZXh0ZW5kKHsNCgkJCXByb3A6IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQl2YXIgciwgaSwgbyA9IGUubm9kZVR5cGU7DQoJCQkJaWYoMyAhPT0gbyAmJiA4ICE9PSBvICYmIDIgIT09IG8pIHJldHVybiAxID09PSBvICYmIEUuaXNYTUxEb2MoZSkgfHwgKHQgPSBFLnByb3BGaXhbdF0gfHwgdCwgaSA9IEUucHJvcEhvb2tzW3RdKSwgdm9pZCAwICE9PSBuID8gaSAmJiAic2V0IiBpbiBpICYmIHZvaWQgMCAhPT0gKHIgPSBpLnNldChlLCBuLCB0KSkgPyByIDogZVt0XSA9IG4gOiBpICYmICJnZXQiIGluIGkgJiYgbnVsbCAhPT0gKHIgPSBpLmdldChlLCB0KSkgPyByIDogZVt0XQ0KCQkJfSwgcHJvcEhvb2tzOiB7DQoJCQkJdGFiSW5kZXg6IHsNCgkJCQkJZ2V0OiBmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgdCA9IEUuZmluZC5hdHRyKGUsICJ0YWJpbmRleCIpOw0KCQkJCQkJcmV0dXJuIHQgPyBwYXJzZUludCh0LCAxMCkgOiBodC50ZXN0KGUubm9kZU5hbWUpIHx8IGd0LnRlc3QoZS5ub2RlTmFtZSkgJiYgZS5ocmVmID8gMCA6IC0xDQoJCQkJCX0NCgkJCQl9DQoJCQl9LCBwcm9wRml4OiB7ImZvciI6ICJodG1sRm9yIiwgImNsYXNzIjogImNsYXNzTmFtZSJ9DQoJCX0pLCB2Lm9wdFNlbGVjdGVkIHx8IChFLnByb3BIb29rcy5zZWxlY3RlZCA9IHsNCgkJCWdldDogZnVuY3Rpb24oZSkgew0KCQkJCXZhciB0ID0gZS5wYXJlbnROb2RlOw0KCQkJCXJldHVybiB0ICYmIHQucGFyZW50Tm9kZSAmJiB0LnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleCwgbnVsbA0KCQkJfSwgc2V0OiBmdW5jdGlvbihlKSB7DQoJCQkJdmFyIHQgPSBlLnBhcmVudE5vZGU7DQoJCQkJdCAmJiAodC5zZWxlY3RlZEluZGV4LCB0LnBhcmVudE5vZGUgJiYgdC5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXgpDQoJCQl9DQoJCX0pLCBFLmVhY2goWyJ0YWJJbmRleCIsICJyZWFkT25seSIsICJtYXhMZW5ndGgiLCAiY2VsbFNwYWNpbmciLCAiY2VsbFBhZGRpbmciLCAicm93U3BhbiIsICJjb2xTcGFuIiwgInVzZU1hcCIsICJmcmFtZUJvcmRlciIsICJjb250ZW50RWRpdGFibGUiXSwgZnVuY3Rpb24oKSB7RS5wcm9wRml4W3RoaXMudG9Mb3dlckNhc2UoKV0gPSB0aGlzfSksIEUuZm4uZXh0ZW5kKHsNCgkJCWFkZENsYXNzOiBmdW5jdGlvbih0KSB7DQoJCQkJdmFyIGUsIG4sIHIsIGksIG8sIGE7DQoJCQkJcmV0dXJuIG0odCkgPyB0aGlzLmVhY2goZnVuY3Rpb24oZSkge0UodGhpcykuYWRkQ2xhc3ModC5jYWxsKHRoaXMsIGUsIHZ0KHRoaXMpKSl9KSA6IChlID0gbXQodCkpLmxlbmd0aCA/IHRoaXMuZWFjaChmdW5jdGlvbigpIHsNCgkJCQkJaWYociA9IHZ0KHRoaXMpLCBuID0gMSA9PT0gdGhpcy5ub2RlVHlwZSAmJiAiICIgKyB5dChyKSArICIgIikgew0KCQkJCQkJZm9yKG8gPSAwOyBvIDwgZS5sZW5ndGg7IG8rKykgaSA9IGVbb10sIG4uaW5kZXhPZigiICIgKyBpICsgIiAiKSA8IDAgJiYgKG4gKz0gaSArICIgIik7DQoJCQkJCQlhID0geXQobiksIHIgIT09IGEgJiYgdGhpcy5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgYSkNCgkJCQkJfQ0KCQkJCX0pIDogdGhpcw0KCQkJfSwgcmVtb3ZlQ2xhc3M6IGZ1bmN0aW9uKHQpIHsNCgkJCQl2YXIgZSwgbiwgciwgaSwgbywgYTsNCgkJCQlyZXR1cm4gbSh0KSA/IHRoaXMuZWFjaChmdW5jdGlvbihlKSB7RSh0aGlzKS5yZW1vdmVDbGFzcyh0LmNhbGwodGhpcywgZSwgdnQodGhpcykpKX0pIDogYXJndW1lbnRzLmxlbmd0aCA/IChlID0gbXQodCkpLmxlbmd0aCA/IHRoaXMuZWFjaChmdW5jdGlvbigpIHsNCgkJCQkJaWYociA9IHZ0KHRoaXMpLCBuID0gMSA9PT0gdGhpcy5ub2RlVHlwZSAmJiAiICIgKyB5dChyKSArICIgIikgew0KCQkJCQkJZm9yKG8gPSAwOyBvIDwgZS5sZW5ndGg7IG8rKykgew0KCQkJCQkJCWkgPSBlW29dOw0KCQkJCQkJCXdoaWxlKC0xIDwgbi5pbmRleE9mKCIgIiArIGkgKyAiICIpKSBuID0gbi5yZXBsYWNlKCIgIiArIGkgKyAiICIsICIgIikNCgkJCQkJCX0NCgkJCQkJCWEgPSB5dChuKSwgciAhPT0gYSAmJiB0aGlzLnNldEF0dHJpYnV0ZSgiY2xhc3MiLCBhKQ0KCQkJCQl9DQoJCQkJfSkgOiB0aGlzIDogdGhpcy5hdHRyKCJjbGFzcyIsICIiKQ0KCQkJfSwgdG9nZ2xlQ2xhc3M6IGZ1bmN0aW9uKHQsIG4pIHsNCgkJCQl2YXIgZSwgciwgaSwgbywgYSA9IHR5cGVvZiB0LCBzID0gInN0cmluZyIgPT09IGEgfHwgQXJyYXkuaXNBcnJheSh0KTsNCgkJCQlyZXR1cm4gbSh0KSA/IHRoaXMuZWFjaChmdW5jdGlvbihlKSB7RSh0aGlzKS50b2dnbGVDbGFzcyh0LmNhbGwodGhpcywgZSwgdnQodGhpcyksIG4pLCBuKX0pIDogImJvb2xlYW4iID09IHR5cGVvZiBuICYmIHMgPyBuID8gdGhpcy5hZGRDbGFzcyh0KSA6IHRoaXMucmVtb3ZlQ2xhc3ModCkgOiAoZSA9IG10KHQpLCB0aGlzLmVhY2goZnVuY3Rpb24oKSB7aWYocykgZm9yKG8gPSBFKHRoaXMpLCBpID0gMDsgaSA8IGUubGVuZ3RoOyBpKyspIHIgPSBlW2ldLCBvLmhhc0NsYXNzKHIpID8gby5yZW1vdmVDbGFzcyhyKSA6IG8uYWRkQ2xhc3Mocik7IGVsc2Ugdm9pZCAwICE9PSB0ICYmICJib29sZWFuIiAhPT0gYSB8fCAoKHIgPSB2dCh0aGlzKSkgJiYgWS5zZXQodGhpcywgIl9fY2xhc3NOYW1lX18iLCByKSwgdGhpcy5zZXRBdHRyaWJ1dGUgJiYgdGhpcy5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgciB8fCAhMSA9PT0gdCA/ICIiIDogWS5nZXQodGhpcywgIl9fY2xhc3NOYW1lX18iKSB8fCAiIikpfSkpDQoJCQl9LCBoYXNDbGFzczogZnVuY3Rpb24oZSkgew0KCQkJCXZhciB0LCBuLCByID0gMDsNCgkJCQl0ID0gIiAiICsgZSArICIgIjsNCgkJCQl3aGlsZShuID0gdGhpc1tyKytdKSBpZigxID09PSBuLm5vZGVUeXBlICYmIC0xIDwgKCIgIiArIHl0KHZ0KG4pKSArICIgIikuaW5kZXhPZih0KSkgcmV0dXJuICEwOw0KCQkJCXJldHVybiAhMQ0KCQkJfQ0KCQl9KTsNCgkJdmFyIHh0ID0gL1xyL2c7DQoJCUUuZm4uZXh0ZW5kKHsNCgkJCXZhbDogZnVuY3Rpb24obikgew0KCQkJCXZhciByLCBlLCBpLCB0ID0gdGhpc1swXTsNCgkJCQlyZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChpID0gbShuKSwgdGhpcy5lYWNoKGZ1bmN0aW9uKGUpIHsNCgkJCQkJdmFyIHQ7DQoJCQkJCTEgPT09IHRoaXMubm9kZVR5cGUgJiYgKG51bGwgPT0gKHQgPSBpID8gbi5jYWxsKHRoaXMsIGUsIEUodGhpcykudmFsKCkpIDogbikgPyB0ID0gIiIgOiAibnVtYmVyIiA9PSB0eXBlb2YgdCA/IHQgKz0gIiIgOiBBcnJheS5pc0FycmF5KHQpICYmICh0ID0gRS5tYXAodCwgZnVuY3Rpb24oZSkge3JldHVybiBudWxsID09IGUgPyAiIiA6IGUgKyAiIn0pKSwgKHIgPSBFLnZhbEhvb2tzW3RoaXMudHlwZV0gfHwgRS52YWxIb29rc1t0aGlzLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKSAmJiAic2V0IiBpbiByICYmIHZvaWQgMCAhPT0gci5zZXQodGhpcywgdCwgInZhbHVlIikgfHwgKHRoaXMudmFsdWUgPSB0KSkNCgkJCQl9KSkgOiB0ID8gKHIgPSBFLnZhbEhvb2tzW3QudHlwZV0gfHwgRS52YWxIb29rc1t0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKSAmJiAiZ2V0IiBpbiByICYmIHZvaWQgMCAhPT0gKGUgPSByLmdldCh0LCAidmFsdWUiKSkgPyBlIDogInN0cmluZyIgPT0gdHlwZW9mIChlID0gdC52YWx1ZSkgPyBlLnJlcGxhY2UoeHQsICIiKSA6IG51bGwgPT0gZSA/ICIiIDogZSA6IHZvaWQgMA0KCQkJfQ0KCQl9KSwgRS5leHRlbmQoew0KCQkJdmFsSG9va3M6IHsNCgkJCQlvcHRpb246IHsNCgkJCQkJZ2V0OiBmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgdCA9IEUuZmluZC5hdHRyKGUsICJ2YWx1ZSIpOw0KCQkJCQkJcmV0dXJuIG51bGwgIT0gdCA/IHQgOiB5dChFLnRleHQoZSkpDQoJCQkJCX0NCgkJCQl9LCBzZWxlY3Q6IHsNCgkJCQkJZ2V0OiBmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgdCwgbiwgciwgaSA9IGUub3B0aW9ucywgbyA9IGUuc2VsZWN0ZWRJbmRleCwgYSA9ICJzZWxlY3Qtb25lIiA9PT0gZS50eXBlLCBzID0gYSA/IG51bGwgOiBbXSwgdSA9IGEgPyBvICsgMSA6IGkubGVuZ3RoOw0KCQkJCQkJZm9yKHIgPSBvIDwgMCA/IHUgOiBhID8gbyA6IDA7IHIgPCB1OyByKyspIGlmKCgobiA9IGlbcl0pLnNlbGVjdGVkIHx8IHIgPT09IG8pICYmICFuLmRpc2FibGVkICYmICghbi5wYXJlbnROb2RlLmRpc2FibGVkIHx8ICFBKG4ucGFyZW50Tm9kZSwgIm9wdGdyb3VwIikpKSB7DQoJCQkJCQkJaWYodCA9IEUobikudmFsKCksIGEpIHJldHVybiB0Ow0KCQkJCQkJCXMucHVzaCh0KQ0KCQkJCQkJfQ0KCQkJCQkJcmV0dXJuIHMNCgkJCQkJfSwgc2V0OiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJCQl2YXIgbiwgciwgaSA9IGUub3B0aW9ucywgbyA9IEUubWFrZUFycmF5KHQpLCBhID0gaS5sZW5ndGg7DQoJCQkJCQl3aGlsZShhLS0pICgociA9IGlbYV0pLnNlbGVjdGVkID0gLTEgPCBFLmluQXJyYXkoRS52YWxIb29rcy5vcHRpb24uZ2V0KHIpLCBvKSkgJiYgKG4gPSAhMCk7DQoJCQkJCQlyZXR1cm4gbiB8fCAoZS5zZWxlY3RlZEluZGV4ID0gLTEpLCBvDQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCX0pLCBFLmVhY2goWyJyYWRpbyIsICJjaGVja2JveCJdLCBmdW5jdGlvbigpIHtFLnZhbEhvb2tzW3RoaXNdID0ge3NldDogZnVuY3Rpb24oZSwgdCkge2lmKEFycmF5LmlzQXJyYXkodCkpIHJldHVybiBlLmNoZWNrZWQgPSAtMSA8IEUuaW5BcnJheShFKGUpLnZhbCgpLCB0KX19LCB2LmNoZWNrT24gfHwgKEUudmFsSG9va3NbdGhpc10uZ2V0ID0gZnVuY3Rpb24oZSkge3JldHVybiBudWxsID09PSBlLmdldEF0dHJpYnV0ZSgidmFsdWUiKSA/ICJvbiIgOiBlLnZhbHVlfSl9KSwgdi5mb2N1c2luID0gIm9uZm9jdXNpbiIgaW4gQzsNCgkJdmFyIGJ0ID0gL14oPzpmb2N1c2luZm9jdXN8Zm9jdXNvdXRibHVyKSQvLCB3dCA9IGZ1bmN0aW9uKGUpIHtlLnN0b3BQcm9wYWdhdGlvbigpfTsNCgkJRS5leHRlbmQoRS5ldmVudCwgew0KCQkJdHJpZ2dlcjogZnVuY3Rpb24oZSwgdCwgbiwgcikgew0KCQkJCXZhciBpLCBvLCBhLCBzLCB1LCBsLCBjLCBmLCBwID0gW24gfHwgU10sIGQgPSB5LmNhbGwoZSwgInR5cGUiKSA/IGUudHlwZSA6IGUsIGggPSB5LmNhbGwoZSwgIm5hbWVzcGFjZSIpID8gZS5uYW1lc3BhY2Uuc3BsaXQoIi4iKSA6IFtdOw0KCQkJCWlmKG8gPSBmID0gYSA9IG4gPSBuIHx8IFMsIDMgIT09IG4ubm9kZVR5cGUgJiYgOCAhPT0gbi5ub2RlVHlwZSAmJiAhYnQudGVzdChkICsgRS5ldmVudC50cmlnZ2VyZWQpICYmICgtMSA8IGQuaW5kZXhPZigiLiIpICYmIChkID0gKGggPSBkLnNwbGl0KCIuIikpLnNoaWZ0KCksIGguc29ydCgpKSwgdSA9IGQuaW5kZXhPZigiOiIpIDwgMCAmJiAib24iICsgZCwgKGUgPSBlW0UuZXhwYW5kb10gPyBlIDogbmV3IEUuRXZlbnQoZCwgIm9iamVjdCIgPT0gdHlwZW9mIGUgJiYgZSkpLmlzVHJpZ2dlciA9IHIgPyAyIDogMywgZS5uYW1lc3BhY2UgPSBoLmpvaW4oIi4iKSwgZS5ybmFtZXNwYWNlID0gZS5uYW1lc3BhY2UgPyBuZXcgUmVnRXhwKCIoXnxcXC4pIiArIGguam9pbigiXFwuKD86LipcXC58KSIpICsgIihcXC58JCkiKSA6IG51bGwsIGUucmVzdWx0ID0gdm9pZCAwLCBlLnRhcmdldCB8fCAoZS50YXJnZXQgPSBuKSwgdCA9IG51bGwgPT0gdCA/IFtlXSA6IEUubWFrZUFycmF5KHQsIFtlXSksIGMgPSBFLmV2ZW50LnNwZWNpYWxbZF0gfHwge30sIHIgfHwgIWMudHJpZ2dlciB8fCAhMSAhPT0gYy50cmlnZ2VyLmFwcGx5KG4sIHQpKSkgew0KCQkJCQlpZighciAmJiAhYy5ub0J1YmJsZSAmJiAheChuKSkgew0KCQkJCQkJZm9yKHMgPSBjLmRlbGVnYXRlVHlwZSB8fCBkLCBidC50ZXN0KHMgKyBkKSB8fCAobyA9IG8ucGFyZW50Tm9kZSk7IG87IG8gPSBvLnBhcmVudE5vZGUpIHAucHVzaChvKSwgYSA9IG87DQoJCQkJCQlhID09PSAobi5vd25lckRvY3VtZW50IHx8IFMpICYmIHAucHVzaChhLmRlZmF1bHRWaWV3IHx8IGEucGFyZW50V2luZG93IHx8IEMpDQoJCQkJCX0NCgkJCQkJaSA9IDA7DQoJCQkJCXdoaWxlKChvID0gcFtpKytdKSAmJiAhZS5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKSBmID0gbywgZS50eXBlID0gMSA8IGkgPyBzIDogYy5iaW5kVHlwZSB8fCBkLCAobCA9IChZLmdldChvLCAiZXZlbnRzIikgfHwgT2JqZWN0LmNyZWF0ZShudWxsKSlbZS50eXBlXSAmJiBZLmdldChvLCAiaGFuZGxlIikpICYmIGwuYXBwbHkobywgdCksIChsID0gdSAmJiBvW3VdKSAmJiBsLmFwcGx5ICYmIFYobykgJiYgKGUucmVzdWx0ID0gbC5hcHBseShvLCB0KSwgITEgPT09IGUucmVzdWx0ICYmIGUucHJldmVudERlZmF1bHQoKSk7DQoJCQkJCXJldHVybiBlLnR5cGUgPSBkLCByIHx8IGUuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgYy5fZGVmYXVsdCAmJiAhMSAhPT0gYy5fZGVmYXVsdC5hcHBseShwLnBvcCgpLCB0KSB8fCAhVihuKSB8fCB1ICYmIG0obltkXSkgJiYgIXgobikgJiYgKChhID0gblt1XSkgJiYgKG5bdV0gPSBudWxsKSwgRS5ldmVudC50cmlnZ2VyZWQgPSBkLCBlLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgJiYgZi5hZGRFdmVudExpc3RlbmVyKGQsIHd0KSwgbltkXSgpLCBlLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgJiYgZi5yZW1vdmVFdmVudExpc3RlbmVyKGQsIHd0KSwgRS5ldmVudC50cmlnZ2VyZWQgPSB2b2lkIDAsIGEgJiYgKG5bdV0gPSBhKSksIGUucmVzdWx0DQoJCQkJfQ0KCQkJfSwgc2ltdWxhdGU6IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQl2YXIgciA9IEUuZXh0ZW5kKG5ldyBFLkV2ZW50LCBuLCB7dHlwZTogZSwgaXNTaW11bGF0ZWQ6ICEwfSk7DQoJCQkJRS5ldmVudC50cmlnZ2VyKHIsIG51bGwsIHQpDQoJCQl9DQoJCX0pLCBFLmZuLmV4dGVuZCh7DQoJCQl0cmlnZ2VyOiBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtFLmV2ZW50LnRyaWdnZXIoZSwgdCwgdGhpcyl9KX0sIHRyaWdnZXJIYW5kbGVyOiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4gPSB0aGlzWzBdOw0KCQkJCWlmKG4pIHJldHVybiBFLmV2ZW50LnRyaWdnZXIoZSwgdCwgbiwgITApDQoJCQl9DQoJCX0pLCB2LmZvY3VzaW4gfHwgRS5lYWNoKHtmb2N1czogImZvY3VzaW4iLCBibHVyOiAiZm9jdXNvdXQifSwgZnVuY3Rpb24obiwgcikgew0KCQkJdmFyIGkgPSBmdW5jdGlvbihlKSB7RS5ldmVudC5zaW11bGF0ZShyLCBlLnRhcmdldCwgRS5ldmVudC5maXgoZSkpfTsNCgkJCUUuZXZlbnQuc3BlY2lhbFtyXSA9IHsNCgkJCQlzZXR1cDogZnVuY3Rpb24oKSB7DQoJCQkJCXZhciBlID0gdGhpcy5vd25lckRvY3VtZW50IHx8IHRoaXMuZG9jdW1lbnQgfHwgdGhpcywgdCA9IFkuYWNjZXNzKGUsIHIpOw0KCQkJCQl0IHx8IGUuYWRkRXZlbnRMaXN0ZW5lcihuLCBpLCAhMCksIFkuYWNjZXNzKGUsIHIsICh0IHx8IDApICsgMSkNCgkJCQl9LCB0ZWFyZG93bjogZnVuY3Rpb24oKSB7DQoJCQkJCXZhciBlID0gdGhpcy5vd25lckRvY3VtZW50IHx8IHRoaXMuZG9jdW1lbnQgfHwgdGhpcywgdCA9IFkuYWNjZXNzKGUsIHIpIC0gMTsNCgkJCQkJdCA/IFkuYWNjZXNzKGUsIHIsIHQpIDogKGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihuLCBpLCAhMCksIFkucmVtb3ZlKGUsIHIpKQ0KCQkJCX0NCgkJCX0NCgkJfSk7DQoJCXZhciBUdCA9IEMubG9jYXRpb24sIEN0ID0ge2d1aWQ6IERhdGUubm93KCl9LCBTdCA9IC9cPy87DQoJCUUucGFyc2VYTUwgPSBmdW5jdGlvbihlKSB7DQoJCQl2YXIgdCwgbjsNCgkJCWlmKCFlIHx8ICJzdHJpbmciICE9IHR5cGVvZiBlKSByZXR1cm4gbnVsbDsNCgkJCXRyeSB7dCA9IChuZXcgQy5ET01QYXJzZXIpLnBhcnNlRnJvbVN0cmluZyhlLCAidGV4dC94bWwiKX0gY2F0Y2goZSkge30NCgkJCXJldHVybiBuID0gdCAmJiB0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJwYXJzZXJlcnJvciIpWzBdLCB0ICYmICFuIHx8IEUuZXJyb3IoIkludmFsaWQgWE1MOiAiICsgKG4gPyBFLm1hcChuLmNoaWxkTm9kZXMsIGZ1bmN0aW9uKGUpIHtyZXR1cm4gZS50ZXh0Q29udGVudH0pLmpvaW4oIlxuIikgOiBlKSksIHQNCgkJfTsNCgkJdmFyIEV0ID0gL1xbXF0kLywga3QgPSAvXHI/XG4vZywgQXQgPSAvXig/OnN1Ym1pdHxidXR0b258aW1hZ2V8cmVzZXR8ZmlsZSkkL2ksIE50ID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8a2V5Z2VuKS9pOw0KDQoJCWZ1bmN0aW9uIGp0KG4sIGUsIHIsIGkpIHsNCgkJCXZhciB0Ow0KCQkJaWYoQXJyYXkuaXNBcnJheShlKSkgRS5lYWNoKGUsIGZ1bmN0aW9uKGUsIHQpIHtyIHx8IEV0LnRlc3QobikgPyBpKG4sIHQpIDoganQobiArICJbIiArICgib2JqZWN0IiA9PSB0eXBlb2YgdCAmJiBudWxsICE9IHQgPyBlIDogIiIpICsgIl0iLCB0LCByLCBpKX0pOyBlbHNlIGlmKHIgfHwgIm9iamVjdCIgIT09IHcoZSkpIGkobiwgZSk7IGVsc2UgZm9yKHQgaW4gZSkganQobiArICJbIiArIHQgKyAiXSIsIGVbdF0sIHIsIGkpDQoJCX0NCg0KCQlFLnBhcmFtID0gZnVuY3Rpb24oZSwgdCkgew0KCQkJdmFyIG4sIHIgPSBbXSwgaSA9IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQl2YXIgbiA9IG0odCkgPyB0KCkgOiB0Ow0KCQkJCXJbci5sZW5ndGhdID0gZW5jb2RlVVJJQ29tcG9uZW50KGUpICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KG51bGwgPT0gbiA/ICIiIDogbikNCgkJCX07DQoJCQlpZihudWxsID09IGUpIHJldHVybiAiIjsNCgkJCWlmKEFycmF5LmlzQXJyYXkoZSkgfHwgZS5qcXVlcnkgJiYgIUUuaXNQbGFpbk9iamVjdChlKSkgRS5lYWNoKGUsIGZ1bmN0aW9uKCkge2kodGhpcy5uYW1lLCB0aGlzLnZhbHVlKX0pOyBlbHNlIGZvcihuIGluIGUpIGp0KG4sIGVbbl0sIHQsIGkpOw0KCQkJcmV0dXJuIHIuam9pbigiJiIpDQoJCX0sIEUuZm4uZXh0ZW5kKHsNCgkJCXNlcmlhbGl6ZTogZnVuY3Rpb24oKSB7cmV0dXJuIEUucGFyYW0odGhpcy5zZXJpYWxpemVBcnJheSgpKX0sIHNlcmlhbGl6ZUFycmF5OiBmdW5jdGlvbigpIHsNCgkJCQlyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKSB7DQoJCQkJCXZhciBlID0gRS5wcm9wKHRoaXMsICJlbGVtZW50cyIpOw0KCQkJCQlyZXR1cm4gZSA/IEUubWFrZUFycmF5KGUpIDogdGhpcw0KCQkJCX0pLmZpbHRlcihmdW5jdGlvbigpIHsNCgkJCQkJdmFyIGUgPSB0aGlzLnR5cGU7DQoJCQkJCXJldHVybiB0aGlzLm5hbWUgJiYgIUUodGhpcykuaXMoIjpkaXNhYmxlZCIpICYmIE50LnRlc3QodGhpcy5ub2RlTmFtZSkgJiYgIUF0LnRlc3QoZSkgJiYgKHRoaXMuY2hlY2tlZCB8fCAhcGUudGVzdChlKSkNCgkJCQl9KS5tYXAoZnVuY3Rpb24oZSwgdCkgew0KCQkJCQl2YXIgbiA9IEUodGhpcykudmFsKCk7DQoJCQkJCXJldHVybiBudWxsID09IG4gPyBudWxsIDogQXJyYXkuaXNBcnJheShuKSA/IEUubWFwKG4sIGZ1bmN0aW9uKGUpIHtyZXR1cm4ge25hbWU6IHQubmFtZSwgdmFsdWU6IGUucmVwbGFjZShrdCwgIlxyXG4iKX19KSA6IHtuYW1lOiB0Lm5hbWUsIHZhbHVlOiBuLnJlcGxhY2Uoa3QsICJcclxuIil9DQoJCQkJfSkuZ2V0KCkNCgkJCX0NCgkJfSk7DQoJCXZhciBEdCA9IC8lMjAvZywgcXQgPSAvIy4qJC8sIEx0ID0gLyhbPyZdKV89W14mXSovLCBIdCA9IC9eKC4qPyk6WyBcdF0qKFteXHJcbl0qKSQvZ20sIE90ID0gL14oPzpHRVR8SEVBRCkkLywgUHQgPSAvXlwvXC8vLCBSdCA9IHt9LCBNdCA9IHt9LCBJdCA9ICIqLyIuY29uY2F0KCIqIiksIFd0ID0gUy5jcmVhdGVFbGVtZW50KCJhIik7DQoNCgkJZnVuY3Rpb24gRnQobykgew0KCQkJcmV0dXJuIGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkic3RyaW5nIiAhPSB0eXBlb2YgZSAmJiAodCA9IGUsIGUgPSAiKiIpOw0KCQkJCXZhciBuLCByID0gMCwgaSA9IGUudG9Mb3dlckNhc2UoKS5tYXRjaChQKSB8fCBbXTsNCgkJCQlpZihtKHQpKSB3aGlsZShuID0gaVtyKytdKSAiKyIgPT09IG5bMF0gPyAobiA9IG4uc2xpY2UoMSkgfHwgIioiLCAob1tuXSA9IG9bbl0gfHwgW10pLnVuc2hpZnQodCkpIDogKG9bbl0gPSBvW25dIHx8IFtdKS5wdXNoKHQpDQoJCQl9DQoJCX0NCg0KCQlmdW5jdGlvbiAkdCh0LCBpLCBvLCBhKSB7DQoJCQl2YXIgcyA9IHt9LCB1ID0gdCA9PT0gTXQ7DQoNCgkJCWZ1bmN0aW9uIGwoZSkgew0KCQkJCXZhciByOw0KCQkJCXJldHVybiBzW2VdID0gITAsIEUuZWFjaCh0W2VdIHx8IFtdLCBmdW5jdGlvbihlLCB0KSB7DQoJCQkJCXZhciBuID0gdChpLCBvLCBhKTsNCgkJCQkJcmV0dXJuICJzdHJpbmciICE9IHR5cGVvZiBuIHx8IHUgfHwgc1tuXSA/IHUgPyAhKHIgPSBuKSA6IHZvaWQgMCA6IChpLmRhdGFUeXBlcy51bnNoaWZ0KG4pLCBsKG4pLCAhMSkNCgkJCQl9KSwgcg0KCQkJfQ0KDQoJCQlyZXR1cm4gbChpLmRhdGFUeXBlc1swXSkgfHwgIXNbIioiXSAmJiBsKCIqIikNCgkJfQ0KDQoJCWZ1bmN0aW9uIEJ0KGUsIHQpIHsNCgkJCXZhciBuLCByLCBpID0gRS5hamF4U2V0dGluZ3MuZmxhdE9wdGlvbnMgfHwge307DQoJCQlmb3IobiBpbiB0KSB2b2lkIDAgIT09IHRbbl0gJiYgKChpW25dID8gZSA6IHIgfHwgKHIgPSB7fSkpW25dID0gdFtuXSk7DQoJCQlyZXR1cm4gciAmJiBFLmV4dGVuZCghMCwgZSwgciksIGUNCgkJfQ0KDQoJCVd0LmhyZWYgPSBUdC5ocmVmLCBFLmV4dGVuZCh7DQoJCQlhY3RpdmU6IDAsDQoJCQlsYXN0TW9kaWZpZWQ6IHt9LA0KCQkJZXRhZzoge30sDQoJCQlhamF4U2V0dGluZ3M6IHsNCgkJCQl1cmw6IFR0LmhyZWYsDQoJCQkJdHlwZTogIkdFVCIsDQoJCQkJaXNMb2NhbDogL14oPzphYm91dHxhcHB8YXBwLXN0b3JhZ2V8ListZXh0ZW5zaW9ufGZpbGV8cmVzfHdpZGdldCk6JC8udGVzdChUdC5wcm90b2NvbCksDQoJCQkJZ2xvYmFsOiAhMCwNCgkJCQlwcm9jZXNzRGF0YTogITAsDQoJCQkJYXN5bmM6ICEwLA0KCQkJCWNvbnRlbnRUeXBlOiAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04IiwNCgkJCQlhY2NlcHRzOiB7IioiOiBJdCwgdGV4dDogInRleHQvcGxhaW4iLCBodG1sOiAidGV4dC9odG1sIiwgeG1sOiAiYXBwbGljYXRpb24veG1sLCB0ZXh0L3htbCIsIGpzb246ICJhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L2phdmFzY3JpcHQifSwNCgkJCQljb250ZW50czoge3htbDogL1xieG1sXGIvLCBodG1sOiAvXGJodG1sLywganNvbjogL1xianNvblxiL30sDQoJCQkJcmVzcG9uc2VGaWVsZHM6IHt4bWw6ICJyZXNwb25zZVhNTCIsIHRleHQ6ICJyZXNwb25zZVRleHQiLCBqc29uOiAicmVzcG9uc2VKU09OIn0sDQoJCQkJY29udmVydGVyczogeyIqIHRleHQiOiBTdHJpbmcsICJ0ZXh0IGh0bWwiOiAhMCwgInRleHQganNvbiI6IEpTT04ucGFyc2UsICJ0ZXh0IHhtbCI6IEUucGFyc2VYTUx9LA0KCQkJCWZsYXRPcHRpb25zOiB7dXJsOiAhMCwgY29udGV4dDogITB9DQoJCQl9LA0KCQkJYWpheFNldHVwOiBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIHQgPyBCdChCdChlLCBFLmFqYXhTZXR0aW5ncyksIHQpIDogQnQoRS5hamF4U2V0dGluZ3MsIGUpfSwNCgkJCWFqYXhQcmVmaWx0ZXI6IEZ0KFJ0KSwNCgkJCWFqYXhUcmFuc3BvcnQ6IEZ0KE10KSwNCgkJCWFqYXg6IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkib2JqZWN0IiA9PSB0eXBlb2YgZSAmJiAodCA9IGUsIGUgPSB2b2lkIDApLCB0ID0gdCB8fCB7fTsNCgkJCQl2YXIgYywNCgkJCQkgICAgZiwNCgkJCQkgICAgcCwNCgkJCQkgICAgbiwNCgkJCQkgICAgZCwNCgkJCQkgICAgciwNCgkJCQkgICAgaCwNCgkJCQkgICAgZywNCgkJCQkgICAgaSwNCgkJCQkgICAgbywNCgkJCQkgICAgeSA9IEUuYWpheFNldHVwKHt9LCB0KSwNCgkJCQkgICAgdiA9IHkuY29udGV4dCB8fCB5LA0KCQkJCSAgICBtID0geS5jb250ZXh0ICYmICh2Lm5vZGVUeXBlIHx8IHYuanF1ZXJ5KSA/IEUodikgOiBFLmV2ZW50LA0KCQkJCSAgICB4ID0gRS5EZWZlcnJlZCgpLA0KCQkJCSAgICBiID0gRS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksDQoJCQkJICAgIHcgPSB5LnN0YXR1c0NvZGUgfHwge30sDQoJCQkJICAgIGEgPSB7fSwNCgkJCQkgICAgcyA9IHt9LA0KCQkJCSAgICB1ID0gImNhbmNlbGVkIiwNCgkJCQkgICAgVCA9IHsNCgkJCQkJICAgIHJlYWR5U3RhdGU6IDAsDQoJCQkJCSAgICBnZXRSZXNwb25zZUhlYWRlcjogZnVuY3Rpb24oZSkgew0KCQkJCQkJICAgIHZhciB0Ow0KCQkJCQkJICAgIGlmKGgpIHsNCgkJCQkJCQkgICAgaWYoIW4pIHsNCgkJCQkJCQkJICAgIG4gPSB7fTsNCgkJCQkJCQkJICAgIHdoaWxlKHQgPSBIdC5leGVjKHApKSBuW3RbMV0udG9Mb3dlckNhc2UoKSArICIgIl0gPSAoblt0WzFdLnRvTG93ZXJDYXNlKCkgKyAiICJdIHx8IFtdKS5jb25jYXQodFsyXSkNCgkJCQkJCQkgICAgfQ0KCQkJCQkJCSAgICB0ID0gbltlLnRvTG93ZXJDYXNlKCkgKyAiICJdDQoJCQkJCQkgICAgfQ0KCQkJCQkJICAgIHJldHVybiBudWxsID09IHQgPyBudWxsIDogdC5qb2luKCIsICIpDQoJCQkJCSAgICB9LA0KCQkJCQkgICAgZ2V0QWxsUmVzcG9uc2VIZWFkZXJzOiBmdW5jdGlvbigpIHtyZXR1cm4gaCA/IHAgOiBudWxsfSwNCgkJCQkJICAgIHNldFJlcXVlc3RIZWFkZXI6IGZ1bmN0aW9uKGUsIHQpIHtyZXR1cm4gbnVsbCA9PSBoICYmIChlID0gc1tlLnRvTG93ZXJDYXNlKCldID0gc1tlLnRvTG93ZXJDYXNlKCldIHx8IGUsIGFbZV0gPSB0KSwgdGhpc30sDQoJCQkJCSAgICBvdmVycmlkZU1pbWVUeXBlOiBmdW5jdGlvbihlKSB7cmV0dXJuIG51bGwgPT0gaCAmJiAoeS5taW1lVHlwZSA9IGUpLCB0aGlzfSwNCgkJCQkJICAgIHN0YXR1c0NvZGU6IGZ1bmN0aW9uKGUpIHsNCgkJCQkJCSAgICB2YXIgdDsNCgkJCQkJCSAgICBpZihlKSBpZihoKSBULmFsd2F5cyhlW1Quc3RhdHVzXSk7IGVsc2UgZm9yKHQgaW4gZSkgd1t0XSA9IFt3W3RdLCBlW3RdXTsNCgkJCQkJCSAgICByZXR1cm4gdGhpcw0KCQkJCQkgICAgfSwNCgkJCQkJICAgIGFib3J0OiBmdW5jdGlvbihlKSB7DQoJCQkJCQkgICAgdmFyIHQgPSBlIHx8IHU7DQoJCQkJCQkgICAgcmV0dXJuIGMgJiYgYy5hYm9ydCh0KSwgbCgwLCB0KSwgdGhpcw0KCQkJCQkgICAgfQ0KCQkJCSAgICB9Ow0KCQkJCWlmKHgucHJvbWlzZShUKSwgeS51cmwgPSAoKGUgfHwgeS51cmwgfHwgVHQuaHJlZikgKyAiIikucmVwbGFjZShQdCwgVHQucHJvdG9jb2wgKyAiLy8iKSwgeS50eXBlID0gdC5tZXRob2QgfHwgdC50eXBlIHx8IHkubWV0aG9kIHx8IHkudHlwZSwgeS5kYXRhVHlwZXMgPSAoeS5kYXRhVHlwZSB8fCAiKiIpLnRvTG93ZXJDYXNlKCkubWF0Y2goUCkgfHwgWyIiXSwgbnVsbCA9PSB5LmNyb3NzRG9tYWluKSB7DQoJCQkJCXIgPSBTLmNyZWF0ZUVsZW1lbnQoImEiKTsNCgkJCQkJdHJ5IHtyLmhyZWYgPSB5LnVybCwgci5ocmVmID0gci5ocmVmLCB5LmNyb3NzRG9tYWluID0gV3QucHJvdG9jb2wgKyAiLy8iICsgV3QuaG9zdCAhPSByLnByb3RvY29sICsgIi8vIiArIHIuaG9zdH0gY2F0Y2goZSkge3kuY3Jvc3NEb21haW4gPSAhMH0NCgkJCQl9DQoJCQkJaWYoeS5kYXRhICYmIHkucHJvY2Vzc0RhdGEgJiYgInN0cmluZyIgIT0gdHlwZW9mIHkuZGF0YSAmJiAoeS5kYXRhID0gRS5wYXJhbSh5LmRhdGEsIHkudHJhZGl0aW9uYWwpKSwgJHQoUnQsIHksIHQsIFQpLCBoKSByZXR1cm4gVDsNCgkJCQlmb3IoaSBpbiAoZyA9IEUuZXZlbnQgJiYgeS5nbG9iYWwpICYmIDAgPT0gRS5hY3RpdmUrKyAmJiBFLmV2ZW50LnRyaWdnZXIoImFqYXhTdGFydCIpLCB5LnR5cGUgPSB5LnR5cGUudG9VcHBlckNhc2UoKSwgeS5oYXNDb250ZW50ID0gIU90LnRlc3QoeS50eXBlKSwgZiA9IHkudXJsLnJlcGxhY2UocXQsICIiKSwgeS5oYXNDb250ZW50ID8geS5kYXRhICYmIHkucHJvY2Vzc0RhdGEgJiYgMCA9PT0gKHkuY29udGVudFR5cGUgfHwgIiIpLmluZGV4T2YoImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIpICYmICh5LmRhdGEgPSB5LmRhdGEucmVwbGFjZShEdCwgIisiKSkgOiAobyA9IHkudXJsLnNsaWNlKGYubGVuZ3RoKSwgeS5kYXRhICYmICh5LnByb2Nlc3NEYXRhIHx8ICJzdHJpbmciID09IHR5cGVvZiB5LmRhdGEpICYmIChmICs9IChTdC50ZXN0KGYpID8gIiYiIDogIj8iKSArIHkuZGF0YSwgZGVsZXRlIHkuZGF0YSksICExID09PSB5LmNhY2hlICYmIChmID0gZi5yZXBsYWNlKEx0LCAiJDEiKSwgbyA9IChTdC50ZXN0KGYpID8gIiYiIDogIj8iKSArICJfPSIgKyBDdC5ndWlkKysgKyBvKSwgeS51cmwgPSBmICsgbyksIHkuaWZNb2RpZmllZCAmJiAoRS5sYXN0TW9kaWZpZWRbZl0gJiYgVC5zZXRSZXF1ZXN0SGVhZGVyKCJJZi1Nb2RpZmllZC1TaW5jZSIsIEUubGFzdE1vZGlmaWVkW2ZdKSwgRS5ldGFnW2ZdICYmIFQuc2V0UmVxdWVzdEhlYWRlcigiSWYtTm9uZS1NYXRjaCIsIEUuZXRhZ1tmXSkpLCAoeS5kYXRhICYmIHkuaGFzQ29udGVudCAmJiAhMSAhPT0geS5jb250ZW50VHlwZSB8fCB0LmNvbnRlbnRUeXBlKSAmJiBULnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtVHlwZSIsIHkuY29udGVudFR5cGUpLCBULnNldFJlcXVlc3RIZWFkZXIoIkFjY2VwdCIsIHkuZGF0YVR5cGVzWzBdICYmIHkuYWNjZXB0c1t5LmRhdGFUeXBlc1swXV0gPyB5LmFjY2VwdHNbeS5kYXRhVHlwZXNbMF1dICsgKCIqIiAhPT0geS5kYXRhVHlwZXNbMF0gPyAiLCAiICsgSXQgKyAiOyBxPTAuMDEiIDogIiIpIDogeS5hY2NlcHRzWyIqIl0pLCB5LmhlYWRlcnMpIFQuc2V0UmVxdWVzdEhlYWRlcihpLCB5LmhlYWRlcnNbaV0pOw0KCQkJCWlmKHkuYmVmb3JlU2VuZCAmJiAoITEgPT09IHkuYmVmb3JlU2VuZC5jYWxsKHYsIFQsIHkpIHx8IGgpKSByZXR1cm4gVC5hYm9ydCgpOw0KCQkJCWlmKHUgPSAiYWJvcnQiLCBiLmFkZCh5LmNvbXBsZXRlKSwgVC5kb25lKHkuc3VjY2VzcyksIFQuZmFpbCh5LmVycm9yKSwgYyA9ICR0KE10LCB5LCB0LCBUKSkgew0KCQkJCQlpZihULnJlYWR5U3RhdGUgPSAxLCBnICYmIG0udHJpZ2dlcigiYWpheFNlbmQiLCBbVCwgeV0pLCBoKSByZXR1cm4gVDsNCgkJCQkJeS5hc3luYyAmJiAwIDwgeS50aW1lb3V0ICYmIChkID0gQy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1QuYWJvcnQoInRpbWVvdXQiKX0sIHkudGltZW91dCkpOw0KCQkJCQl0cnkge2ggPSAhMSwgYy5zZW5kKGEsIGwpfSBjYXRjaChlKSB7DQoJCQkJCQlpZihoKSB0aHJvdyBlOw0KCQkJCQkJbCgtMSwgZSkNCgkJCQkJfQ0KCQkJCX0gZWxzZSBsKC0xLCAiTm8gVHJhbnNwb3J0Iik7DQoNCgkJCQlmdW5jdGlvbiBsKGUsIHQsIG4sIHIpIHsNCgkJCQkJdmFyIGksIG8sIGEsIHMsIHUsIGwgPSB0Ow0KCQkJCQloIHx8IChoID0gITAsIGQgJiYgQy5jbGVhclRpbWVvdXQoZCksIGMgPSB2b2lkIDAsIHAgPSByIHx8ICIiLCBULnJlYWR5U3RhdGUgPSAwIDwgZSA/IDQgOiAwLCBpID0gMjAwIDw9IGUgJiYgZSA8IDMwMCB8fCAzMDQgPT09IGUsIG4gJiYgKHMgPSBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJCQl2YXIgciwgaSwgbywgYSwgcyA9IGUuY29udGVudHMsIHUgPSBlLmRhdGFUeXBlczsNCgkJCQkJCXdoaWxlKCIqIiA9PT0gdVswXSkgdS5zaGlmdCgpLCB2b2lkIDAgPT09IHIgJiYgKHIgPSBlLm1pbWVUeXBlIHx8IHQuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtVHlwZSIpKTsNCgkJCQkJCWlmKHIpIGZvcihpIGluIHMpIGlmKHNbaV0gJiYgc1tpXS50ZXN0KHIpKSB7DQoJCQkJCQkJdS51bnNoaWZ0KGkpOw0KCQkJCQkJCWJyZWFrDQoJCQkJCQl9DQoJCQkJCQlpZih1WzBdIGluIG4pIG8gPSB1WzBdOyBlbHNlIHsNCgkJCQkJCQlmb3IoaSBpbiBuKSB7DQoJCQkJCQkJCWlmKCF1WzBdIHx8IGUuY29udmVydGVyc1tpICsgIiAiICsgdVswXV0pIHsNCgkJCQkJCQkJCW8gPSBpOw0KCQkJCQkJCQkJYnJlYWsNCgkJCQkJCQkJfQ0KCQkJCQkJCQlhIHx8IChhID0gaSkNCgkJCQkJCQl9DQoJCQkJCQkJbyA9IG8gfHwgYQ0KCQkJCQkJfQ0KCQkJCQkJaWYobykgcmV0dXJuIG8gIT09IHVbMF0gJiYgdS51bnNoaWZ0KG8pLCBuW29dDQoJCQkJCX0oeSwgVCwgbikpLCAhaSAmJiAtMSA8IEUuaW5BcnJheSgic2NyaXB0IiwgeS5kYXRhVHlwZXMpICYmIEUuaW5BcnJheSgianNvbiIsIHkuZGF0YVR5cGVzKSA8IDAgJiYgKHkuY29udmVydGVyc1sidGV4dCBzY3JpcHQiXSA9IGZ1bmN0aW9uKCkge30pLCBzID0gZnVuY3Rpb24oZSwgdCwgbiwgcikgew0KCQkJCQkJdmFyIGksIG8sIGEsIHMsIHUsIGwgPSB7fSwgYyA9IGUuZGF0YVR5cGVzLnNsaWNlKCk7DQoJCQkJCQlpZihjWzFdKSBmb3IoYSBpbiBlLmNvbnZlcnRlcnMpIGxbYS50b0xvd2VyQ2FzZSgpXSA9IGUuY29udmVydGVyc1thXTsNCgkJCQkJCW8gPSBjLnNoaWZ0KCk7DQoJCQkJCQl3aGlsZShvKSBpZihlLnJlc3BvbnNlRmllbGRzW29dICYmIChuW2UucmVzcG9uc2VGaWVsZHNbb11dID0gdCksICF1ICYmIHIgJiYgZS5kYXRhRmlsdGVyICYmICh0ID0gZS5kYXRhRmlsdGVyKHQsIGUuZGF0YVR5cGUpKSwgdSA9IG8sIG8gPSBjLnNoaWZ0KCkpIGlmKCIqIiA9PT0gbykgbyA9IHU7IGVsc2UgaWYoIioiICE9PSB1ICYmIHUgIT09IG8pIHsNCgkJCQkJCQlpZighKGEgPSBsW3UgKyAiICIgKyBvXSB8fCBsWyIqICIgKyBvXSkpIGZvcihpIGluIGwpIGlmKChzID0gaS5zcGxpdCgiICIpKVsxXSA9PT0gbyAmJiAoYSA9IGxbdSArICIgIiArIHNbMF1dIHx8IGxbIiogIiArIHNbMF1dKSkgew0KCQkJCQkJCQkhMCA9PT0gYSA/IGEgPSBsW2ldIDogITAgIT09IGxbaV0gJiYgKG8gPSBzWzBdLCBjLnVuc2hpZnQoc1sxXSkpOw0KCQkJCQkJCQlicmVhaw0KCQkJCQkJCX0NCgkJCQkJCQlpZighMCAhPT0gYSkgaWYoYSAmJiBlWyJ0aHJvd3MiXSkgdCA9IGEodCk7IGVsc2UgdHJ5IHt0ID0gYSh0KX0gY2F0Y2goZSkge3JldHVybiB7c3RhdGU6ICJwYXJzZXJlcnJvciIsIGVycm9yOiBhID8gZSA6ICJObyBjb252ZXJzaW9uIGZyb20gIiArIHUgKyAiIHRvICIgKyBvfX0NCgkJCQkJCX0NCgkJCQkJCXJldHVybiB7c3RhdGU6ICJzdWNjZXNzIiwgZGF0YTogdH0NCgkJCQkJfSh5LCBzLCBULCBpKSwgaSA/ICh5LmlmTW9kaWZpZWQgJiYgKCh1ID0gVC5nZXRSZXNwb25zZUhlYWRlcigiTGFzdC1Nb2RpZmllZCIpKSAmJiAoRS5sYXN0TW9kaWZpZWRbZl0gPSB1KSwgKHUgPSBULmdldFJlc3BvbnNlSGVhZGVyKCJldGFnIikpICYmIChFLmV0YWdbZl0gPSB1KSksIDIwNCA9PT0gZSB8fCAiSEVBRCIgPT09IHkudHlwZSA/IGwgPSAibm9jb250ZW50IiA6IDMwNCA9PT0gZSA/IGwgPSAibm90bW9kaWZpZWQiIDogKGwgPSBzLnN0YXRlLCBvID0gcy5kYXRhLCBpID0gIShhID0gcy5lcnJvcikpKSA6IChhID0gbCwgIWUgJiYgbCB8fCAobCA9ICJlcnJvciIsIGUgPCAwICYmIChlID0gMCkpKSwgVC5zdGF0dXMgPSBlLCBULnN0YXR1c1RleHQgPSAodCB8fCBsKSArICIiLCBpID8geC5yZXNvbHZlV2l0aCh2LCBbbywgbCwgVF0pIDogeC5yZWplY3RXaXRoKHYsIFtULCBsLCBhXSksIFQuc3RhdHVzQ29kZSh3KSwgdyA9IHZvaWQgMCwgZyAmJiBtLnRyaWdnZXIoaSA/ICJhamF4U3VjY2VzcyIgOiAiYWpheEVycm9yIiwgW1QsIHksIGkgPyBvIDogYV0pLCBiLmZpcmVXaXRoKHYsIFtULCBsXSksIGcgJiYgKG0udHJpZ2dlcigiYWpheENvbXBsZXRlIiwgW1QsIHldKSwgLS1FLmFjdGl2ZSB8fCBFLmV2ZW50LnRyaWdnZXIoImFqYXhTdG9wIikpKQ0KCQkJCX0NCg0KCQkJCXJldHVybiBUDQoJCQl9LA0KCQkJZ2V0SlNPTjogZnVuY3Rpb24oZSwgdCwgbikge3JldHVybiBFLmdldChlLCB0LCBuLCAianNvbiIpfSwNCgkJCWdldFNjcmlwdDogZnVuY3Rpb24oZSwgdCkge3JldHVybiBFLmdldChlLCB2b2lkIDAsIHQsICJzY3JpcHQiKX0NCgkJfSksIEUuZWFjaChbImdldCIsICJwb3N0Il0sIGZ1bmN0aW9uKGUsIGkpIHtFW2ldID0gZnVuY3Rpb24oZSwgdCwgbiwgcikge3JldHVybiBtKHQpICYmIChyID0gciB8fCBuLCBuID0gdCwgdCA9IHZvaWQgMCksIEUuYWpheChFLmV4dGVuZCh7dXJsOiBlLCB0eXBlOiBpLCBkYXRhVHlwZTogciwgZGF0YTogdCwgc3VjY2Vzczogbn0sIEUuaXNQbGFpbk9iamVjdChlKSAmJiBlKSl9fSksIEUuYWpheFByZWZpbHRlcihmdW5jdGlvbihlKSB7DQoJCQl2YXIgdDsNCgkJCWZvcih0IGluIGUuaGVhZGVycykgImNvbnRlbnQtdHlwZSIgPT09IHQudG9Mb3dlckNhc2UoKSAmJiAoZS5jb250ZW50VHlwZSA9IGUuaGVhZGVyc1t0XSB8fCAiIikNCgkJfSksIEUuX2V2YWxVcmwgPSBmdW5jdGlvbihlLCB0LCBuKSB7cmV0dXJuIEUuYWpheCh7dXJsOiBlLCB0eXBlOiAiR0VUIiwgZGF0YVR5cGU6ICJzY3JpcHQiLCBjYWNoZTogITAsIGFzeW5jOiAhMSwgZ2xvYmFsOiAhMSwgY29udmVydGVyczogeyJ0ZXh0IHNjcmlwdCI6IGZ1bmN0aW9uKCkge319LCBkYXRhRmlsdGVyOiBmdW5jdGlvbihlKSB7RS5nbG9iYWxFdmFsKGUsIHQsIG4pfX0pfSwgRS5mbi5leHRlbmQoew0KCQkJd3JhcEFsbDogZnVuY3Rpb24oZSkgew0KCQkJCXZhciB0Ow0KCQkJCXJldHVybiB0aGlzWzBdICYmIChtKGUpICYmIChlID0gZS5jYWxsKHRoaXNbMF0pKSwgdCA9IEUoZSwgdGhpc1swXS5vd25lckRvY3VtZW50KS5lcSgwKS5jbG9uZSghMCksIHRoaXNbMF0ucGFyZW50Tm9kZSAmJiB0Lmluc2VydEJlZm9yZSh0aGlzWzBdKSwgdC5tYXAoZnVuY3Rpb24oKSB7DQoJCQkJCXZhciBlID0gdGhpczsNCgkJCQkJd2hpbGUoZS5maXJzdEVsZW1lbnRDaGlsZCkgZSA9IGUuZmlyc3RFbGVtZW50Q2hpbGQ7DQoJCQkJCXJldHVybiBlDQoJCQkJfSkuYXBwZW5kKHRoaXMpKSwgdGhpcw0KCQkJfSwgd3JhcElubmVyOiBmdW5jdGlvbihuKSB7DQoJCQkJcmV0dXJuIG0obikgPyB0aGlzLmVhY2goZnVuY3Rpb24oZSkge0UodGhpcykud3JhcElubmVyKG4uY2FsbCh0aGlzLCBlKSl9KSA6IHRoaXMuZWFjaChmdW5jdGlvbigpIHsNCgkJCQkJdmFyIGUgPSBFKHRoaXMpLCB0ID0gZS5jb250ZW50cygpOw0KCQkJCQl0Lmxlbmd0aCA/IHQud3JhcEFsbChuKSA6IGUuYXBwZW5kKG4pDQoJCQkJfSkNCgkJCX0sIHdyYXA6IGZ1bmN0aW9uKHQpIHsNCgkJCQl2YXIgbiA9IG0odCk7DQoJCQkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihlKSB7RSh0aGlzKS53cmFwQWxsKG4gPyB0LmNhbGwodGhpcywgZSkgOiB0KX0pDQoJCQl9LCB1bndyYXA6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gdGhpcy5wYXJlbnQoZSkubm90KCJib2R5IikuZWFjaChmdW5jdGlvbigpIHtFKHRoaXMpLnJlcGxhY2VXaXRoKHRoaXMuY2hpbGROb2Rlcyl9KSwgdGhpc30NCgkJfSksIEUuZXhwci5wc2V1ZG9zLmhpZGRlbiA9IGZ1bmN0aW9uKGUpIHtyZXR1cm4gIUUuZXhwci5wc2V1ZG9zLnZpc2libGUoZSl9LCBFLmV4cHIucHNldWRvcy52aXNpYmxlID0gZnVuY3Rpb24oZSkge3JldHVybiAhIShlLm9mZnNldFdpZHRoIHx8IGUub2Zmc2V0SGVpZ2h0IHx8IGUuZ2V0Q2xpZW50UmVjdHMoKS5sZW5ndGgpfSwgRS5hamF4U2V0dGluZ3MueGhyID0gZnVuY3Rpb24oKSB7dHJ5IHtyZXR1cm4gbmV3IEMuWE1MSHR0cFJlcXVlc3R9IGNhdGNoKGUpIHt9fTsNCgkJdmFyIF90ID0gezA6IDIwMCwgMTIyMzogMjA0fSwgenQgPSBFLmFqYXhTZXR0aW5ncy54aHIoKTsNCgkJdi5jb3JzID0gISF6dCAmJiAid2l0aENyZWRlbnRpYWxzIiBpbiB6dCwgdi5hamF4ID0genQgPSAhIXp0LCBFLmFqYXhUcmFuc3BvcnQoZnVuY3Rpb24oaSkgew0KCQkJdmFyIG8sIGE7DQoJCQlpZih2LmNvcnMgfHwgenQgJiYgIWkuY3Jvc3NEb21haW4pIHJldHVybiB7DQoJCQkJc2VuZDogZnVuY3Rpb24oZSwgdCkgew0KCQkJCQl2YXIgbiwgciA9IGkueGhyKCk7DQoJCQkJCWlmKHIub3BlbihpLnR5cGUsIGkudXJsLCBpLmFzeW5jLCBpLnVzZXJuYW1lLCBpLnBhc3N3b3JkKSwgaS54aHJGaWVsZHMpIGZvcihuIGluIGkueGhyRmllbGRzKSByW25dID0gaS54aHJGaWVsZHNbbl07DQoJCQkJCWZvcihuIGluIGkubWltZVR5cGUgJiYgci5vdmVycmlkZU1pbWVUeXBlICYmIHIub3ZlcnJpZGVNaW1lVHlwZShpLm1pbWVUeXBlKSwgaS5jcm9zc0RvbWFpbiB8fCBlWyJYLVJlcXVlc3RlZC1XaXRoIl0gfHwgKGVbIlgtUmVxdWVzdGVkLVdpdGgiXSA9ICJYTUxIdHRwUmVxdWVzdCIpLCBlKSByLnNldFJlcXVlc3RIZWFkZXIobiwgZVtuXSk7DQoJCQkJCW8gPSBmdW5jdGlvbihlKSB7cmV0dXJuIGZ1bmN0aW9uKCkge28gJiYgKG8gPSBhID0gci5vbmxvYWQgPSByLm9uZXJyb3IgPSByLm9uYWJvcnQgPSByLm9udGltZW91dCA9IHIub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbCwgImFib3J0IiA9PT0gZSA/IHIuYWJvcnQoKSA6ICJlcnJvciIgPT09IGUgPyAibnVtYmVyIiAhPSB0eXBlb2Ygci5zdGF0dXMgPyB0KDAsICJlcnJvciIpIDogdChyLnN0YXR1cywgci5zdGF0dXNUZXh0KSA6IHQoX3Rbci5zdGF0dXNdIHx8IHIuc3RhdHVzLCByLnN0YXR1c1RleHQsICJ0ZXh0IiAhPT0gKHIucmVzcG9uc2VUeXBlIHx8ICJ0ZXh0IikgfHwgInN0cmluZyIgIT0gdHlwZW9mIHIucmVzcG9uc2VUZXh0ID8ge2JpbmFyeTogci5yZXNwb25zZX0gOiB7dGV4dDogci5yZXNwb25zZVRleHR9LCByLmdldEFsbFJlc3BvbnNlSGVhZGVycygpKSl9fSwgci5vbmxvYWQgPSBvKCksIGEgPSByLm9uZXJyb3IgPSByLm9udGltZW91dCA9IG8oImVycm9yIiksIHZvaWQgMCAhPT0gci5vbmFib3J0ID8gci5vbmFib3J0ID0gYSA6IHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7NCA9PT0gci5yZWFkeVN0YXRlICYmIEMuc2V0VGltZW91dChmdW5jdGlvbigpIHtvICYmIGEoKX0pfSwgbyA9IG8oImFib3J0Iik7DQoJCQkJCXRyeSB7ci5zZW5kKGkuaGFzQ29udGVudCAmJiBpLmRhdGEgfHwgbnVsbCl9IGNhdGNoKGUpIHtpZihvKSB0aHJvdyBlfQ0KCQkJCX0sIGFib3J0OiBmdW5jdGlvbigpIHtvICYmIG8oKX0NCgkJCX0NCgkJfSksIEUuYWpheFByZWZpbHRlcihmdW5jdGlvbihlKSB7ZS5jcm9zc0RvbWFpbiAmJiAoZS5jb250ZW50cy5zY3JpcHQgPSAhMSl9KSwgRS5hamF4U2V0dXAoew0KCQkJYWNjZXB0czoge3NjcmlwdDogInRleHQvamF2YXNjcmlwdCwgYXBwbGljYXRpb24vamF2YXNjcmlwdCwgYXBwbGljYXRpb24vZWNtYXNjcmlwdCwgYXBwbGljYXRpb24veC1lY21hc2NyaXB0In0sDQoJCQljb250ZW50czoge3NjcmlwdDogL1xiKD86amF2YXxlY21hKXNjcmlwdFxiL30sDQoJCQljb252ZXJ0ZXJzOiB7InRleHQgc2NyaXB0IjogZnVuY3Rpb24oZSkge3JldHVybiBFLmdsb2JhbEV2YWwoZSksIGV9fQ0KCQl9KSwgRS5hamF4UHJlZmlsdGVyKCJzY3JpcHQiLCBmdW5jdGlvbihlKSB7dm9pZCAwID09PSBlLmNhY2hlICYmIChlLmNhY2hlID0gITEpLCBlLmNyb3NzRG9tYWluICYmIChlLnR5cGUgPSAiR0VUIil9KSwgRS5hamF4VHJhbnNwb3J0KCJzY3JpcHQiLCBmdW5jdGlvbihuKSB7DQoJCQl2YXIgciwgaTsNCgkJCWlmKG4uY3Jvc3NEb21haW4gfHwgbi5zY3JpcHRBdHRycykgcmV0dXJuIHsNCgkJCQlzZW5kOiBmdW5jdGlvbihlLCB0KSB7ciA9IEUoIjxzY3JpcHQ+IikuYXR0cihuLnNjcmlwdEF0dHJzIHx8IHt9KS5wcm9wKHtjaGFyc2V0OiBuLnNjcmlwdENoYXJzZXQsIHNyYzogbi51cmx9KS5vbigibG9hZCBlcnJvciIsIGkgPSBmdW5jdGlvbihlKSB7ci5yZW1vdmUoKSwgaSA9IG51bGwsIGUgJiYgdCgiZXJyb3IiID09PSBlLnR5cGUgPyA0MDQgOiAyMDAsIGUudHlwZSl9KSwgUy5oZWFkLmFwcGVuZENoaWxkKHJbMF0pfSwNCgkJCQlhYm9ydDogZnVuY3Rpb24oKSB7aSAmJiBpKCl9DQoJCQl9DQoJCX0pOw0KCQl2YXIgVXQsIFh0ID0gW10sIFZ0ID0gLyg9KVw/KD89JnwkKXxcP1w/LzsNCgkJRS5hamF4U2V0dXAoew0KCQkJanNvbnA6ICJjYWxsYmFjayIsIGpzb25wQ2FsbGJhY2s6IGZ1bmN0aW9uKCkgew0KCQkJCXZhciBlID0gWHQucG9wKCkgfHwgRS5leHBhbmRvICsgIl8iICsgQ3QuZ3VpZCsrOw0KCQkJCXJldHVybiB0aGlzW2VdID0gITAsIGUNCgkJCX0NCgkJfSksIEUuYWpheFByZWZpbHRlcigianNvbiBqc29ucCIsIGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCXZhciByLCBpLCBvLCBhID0gITEgIT09IGUuanNvbnAgJiYgKFZ0LnRlc3QoZS51cmwpID8gInVybCIgOiAic3RyaW5nIiA9PSB0eXBlb2YgZS5kYXRhICYmIDAgPT09IChlLmNvbnRlbnRUeXBlIHx8ICIiKS5pbmRleE9mKCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKSAmJiBWdC50ZXN0KGUuZGF0YSkgJiYgImRhdGEiKTsNCgkJCWlmKGEgfHwgImpzb25wIiA9PT0gZS5kYXRhVHlwZXNbMF0pIHJldHVybiByID0gZS5qc29ucENhbGxiYWNrID0gbShlLmpzb25wQ2FsbGJhY2spID8gZS5qc29ucENhbGxiYWNrKCkgOiBlLmpzb25wQ2FsbGJhY2ssIGEgPyBlW2FdID0gZVthXS5yZXBsYWNlKFZ0LCAiJDEiICsgcikgOiAhMSAhPT0gZS5qc29ucCAmJiAoZS51cmwgKz0gKFN0LnRlc3QoZS51cmwpID8gIiYiIDogIj8iKSArIGUuanNvbnAgKyAiPSIgKyByKSwgZS5jb252ZXJ0ZXJzWyJzY3JpcHQganNvbiJdID0gZnVuY3Rpb24oKSB7cmV0dXJuIG8gfHwgRS5lcnJvcihyICsgIiB3YXMgbm90IGNhbGxlZCIpLCBvWzBdfSwgZS5kYXRhVHlwZXNbMF0gPSAianNvbiIsIGkgPSBDW3JdLCBDW3JdID0gZnVuY3Rpb24oKSB7byA9IGFyZ3VtZW50c30sIG4uYWx3YXlzKGZ1bmN0aW9uKCkge3ZvaWQgMCA9PT0gaSA/IEUoQykucmVtb3ZlUHJvcChyKSA6IENbcl0gPSBpLCBlW3JdICYmIChlLmpzb25wQ2FsbGJhY2sgPSB0Lmpzb25wQ2FsbGJhY2ssIFh0LnB1c2gocikpLCBvICYmIG0oaSkgJiYgaShvWzBdKSwgbyA9IGkgPSB2b2lkIDB9KSwgInNjcmlwdCINCgkJfSksIHYuY3JlYXRlSFRNTERvY3VtZW50ID0gKChVdCA9IFMuaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50KCIiKS5ib2R5KS5pbm5lckhUTUwgPSAiPGZvcm0+PC9mb3JtPjxmb3JtPjwvZm9ybT4iLCAyID09PSBVdC5jaGlsZE5vZGVzLmxlbmd0aCksIEUucGFyc2VIVE1MID0gZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJcmV0dXJuICJzdHJpbmciICE9IHR5cGVvZiBlID8gW10gOiAoImJvb2xlYW4iID09IHR5cGVvZiB0ICYmIChuID0gdCwgdCA9ICExKSwgdCB8fCAodi5jcmVhdGVIVE1MRG9jdW1lbnQgPyAoKHIgPSAodCA9IFMuaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50KCIiKSkuY3JlYXRlRWxlbWVudCgiYmFzZSIpKS5ocmVmID0gUy5sb2NhdGlvbi5ocmVmLCB0LmhlYWQuYXBwZW5kQ2hpbGQocikpIDogdCA9IFMpLCBvID0gIW4gJiYgW10sIChpID0gTi5leGVjKGUpKSA/IFt0LmNyZWF0ZUVsZW1lbnQoaVsxXSldIDogKGkgPSB4ZShbZV0sIHQsIG8pLCBvICYmIG8ubGVuZ3RoICYmIEUobykucmVtb3ZlKCksIEUubWVyZ2UoW10sIGkuY2hpbGROb2RlcykpKTsNCgkJCXZhciByLCBpLCBvDQoJCX0sIEUuZm4ubG9hZCA9IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCXZhciByLCBpLCBvLCBhID0gdGhpcywgcyA9IGUuaW5kZXhPZigiICIpOw0KCQkJcmV0dXJuIC0xIDwgcyAmJiAociA9IHl0KGUuc2xpY2UocykpLCBlID0gZS5zbGljZSgwLCBzKSksIG0odCkgPyAobiA9IHQsIHQgPSB2b2lkIDApIDogdCAmJiAib2JqZWN0IiA9PSB0eXBlb2YgdCAmJiAoaSA9ICJQT1NUIiksIDAgPCBhLmxlbmd0aCAmJiBFLmFqYXgoew0KCQkJCXVybDogZSwNCgkJCQl0eXBlOiBpIHx8ICJHRVQiLA0KCQkJCWRhdGFUeXBlOiAiaHRtbCIsDQoJCQkJZGF0YTogdA0KCQkJfSkuZG9uZShmdW5jdGlvbihlKSB7byA9IGFyZ3VtZW50cywgYS5odG1sKHIgPyBFKCI8ZGl2PiIpLmFwcGVuZChFLnBhcnNlSFRNTChlKSkuZmluZChyKSA6IGUpfSkuYWx3YXlzKG4gJiYgZnVuY3Rpb24oZSwgdCkge2EuZWFjaChmdW5jdGlvbigpIHtuLmFwcGx5KHRoaXMsIG8gfHwgW2UucmVzcG9uc2VUZXh0LCB0LCBlXSl9KX0pLCB0aGlzDQoJCX0sIEUuZXhwci5wc2V1ZG9zLmFuaW1hdGVkID0gZnVuY3Rpb24odCkge3JldHVybiBFLmdyZXAoRS50aW1lcnMsIGZ1bmN0aW9uKGUpIHtyZXR1cm4gdCA9PT0gZS5lbGVtfSkubGVuZ3RofSwgRS5vZmZzZXQgPSB7DQoJCQlzZXRPZmZzZXQ6IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQl2YXIgciwgaSwgbywgYSwgcywgdSwgbCA9IEUuY3NzKGUsICJwb3NpdGlvbiIpLCBjID0gRShlKSwgZiA9IHt9Ow0KCQkJCSJzdGF0aWMiID09PSBsICYmIChlLnN0eWxlLnBvc2l0aW9uID0gInJlbGF0aXZlIiksIHMgPSBjLm9mZnNldCgpLCBvID0gRS5jc3MoZSwgInRvcCIpLCB1ID0gRS5jc3MoZSwgImxlZnQiKSwgKCJhYnNvbHV0ZSIgPT09IGwgfHwgImZpeGVkIiA9PT0gbCkgJiYgLTEgPCAobyArIHUpLmluZGV4T2YoImF1dG8iKSA/IChhID0gKHIgPSBjLnBvc2l0aW9uKCkpLnRvcCwgaSA9IHIubGVmdCkgOiAoYSA9IHBhcnNlRmxvYXQobykgfHwgMCwgaSA9IHBhcnNlRmxvYXQodSkgfHwgMCksIG0odCkgJiYgKHQgPSB0LmNhbGwoZSwgbiwgRS5leHRlbmQoe30sIHMpKSksIG51bGwgIT0gdC50b3AgJiYgKGYudG9wID0gdC50b3AgLSBzLnRvcCArIGEpLCBudWxsICE9IHQubGVmdCAmJiAoZi5sZWZ0ID0gdC5sZWZ0IC0gcy5sZWZ0ICsgaSksICJ1c2luZyIgaW4gdCA/IHQudXNpbmcuY2FsbChlLCBmKSA6IGMuY3NzKGYpDQoJCQl9DQoJCX0sIEUuZm4uZXh0ZW5kKHsNCgkJCW9mZnNldDogZnVuY3Rpb24odCkgew0KCQkJCWlmKGFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB2b2lkIDAgPT09IHQgPyB0aGlzIDogdGhpcy5lYWNoKGZ1bmN0aW9uKGUpIHtFLm9mZnNldC5zZXRPZmZzZXQodGhpcywgdCwgZSl9KTsNCgkJCQl2YXIgZSwgbiwgciA9IHRoaXNbMF07DQoJCQkJcmV0dXJuIHIgPyByLmdldENsaWVudFJlY3RzKCkubGVuZ3RoID8gKGUgPSByLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLCBuID0gci5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3LCB7dG9wOiBlLnRvcCArIG4ucGFnZVlPZmZzZXQsIGxlZnQ6IGUubGVmdCArIG4ucGFnZVhPZmZzZXR9KSA6IHt0b3A6IDAsIGxlZnQ6IDB9IDogdm9pZCAwDQoJCQl9LCBwb3NpdGlvbjogZnVuY3Rpb24oKSB7DQoJCQkJaWYodGhpc1swXSkgew0KCQkJCQl2YXIgZSwgdCwgbiwgciA9IHRoaXNbMF0sIGkgPSB7dG9wOiAwLCBsZWZ0OiAwfTsNCgkJCQkJaWYoImZpeGVkIiA9PT0gRS5jc3MociwgInBvc2l0aW9uIikpIHQgPSByLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOyBlbHNlIHsNCgkJCQkJCXQgPSB0aGlzLm9mZnNldCgpLCBuID0gci5vd25lckRvY3VtZW50LCBlID0gci5vZmZzZXRQYXJlbnQgfHwgbi5kb2N1bWVudEVsZW1lbnQ7DQoJCQkJCQl3aGlsZShlICYmIChlID09PSBuLmJvZHkgfHwgZSA9PT0gbi5kb2N1bWVudEVsZW1lbnQpICYmICJzdGF0aWMiID09PSBFLmNzcyhlLCAicG9zaXRpb24iKSkgZSA9IGUucGFyZW50Tm9kZTsNCgkJCQkJCWUgJiYgZSAhPT0gciAmJiAxID09PSBlLm5vZGVUeXBlICYmICgoaSA9IEUoZSkub2Zmc2V0KCkpLnRvcCArPSBFLmNzcyhlLCAiYm9yZGVyVG9wV2lkdGgiLCAhMCksIGkubGVmdCArPSBFLmNzcyhlLCAiYm9yZGVyTGVmdFdpZHRoIiwgITApKQ0KCQkJCQl9DQoJCQkJCXJldHVybiB7dG9wOiB0LnRvcCAtIGkudG9wIC0gRS5jc3MociwgIm1hcmdpblRvcCIsICEwKSwgbGVmdDogdC5sZWZ0IC0gaS5sZWZ0IC0gRS5jc3MociwgIm1hcmdpbkxlZnQiLCAhMCl9DQoJCQkJfQ0KCQkJfSwgb2Zmc2V0UGFyZW50OiBmdW5jdGlvbigpIHsNCgkJCQlyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKSB7DQoJCQkJCXZhciBlID0gdGhpcy5vZmZzZXRQYXJlbnQ7DQoJCQkJCXdoaWxlKGUgJiYgInN0YXRpYyIgPT09IEUuY3NzKGUsICJwb3NpdGlvbiIpKSBlID0gZS5vZmZzZXRQYXJlbnQ7DQoJCQkJCXJldHVybiBlIHx8IHJlDQoJCQkJfSkNCgkJCX0NCgkJfSksIEUuZWFjaCh7c2Nyb2xsTGVmdDogInBhZ2VYT2Zmc2V0Iiwgc2Nyb2xsVG9wOiAicGFnZVlPZmZzZXQifSwgZnVuY3Rpb24odCwgaSkgew0KCQkJdmFyIG8gPSAicGFnZVlPZmZzZXQiID09PSBpOw0KCQkJRS5mblt0XSA9IGZ1bmN0aW9uKGUpIHsNCgkJCQlyZXR1cm4gQih0aGlzLCBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJCXZhciByOw0KCQkJCQlpZih4KGUpID8gciA9IGUgOiA5ID09PSBlLm5vZGVUeXBlICYmIChyID0gZS5kZWZhdWx0VmlldyksIHZvaWQgMCA9PT0gbikgcmV0dXJuIHIgPyByW2ldIDogZVt0XTsNCgkJCQkJciA/IHIuc2Nyb2xsVG8obyA/IHIucGFnZVhPZmZzZXQgOiBuLCBvID8gbiA6IHIucGFnZVlPZmZzZXQpIDogZVt0XSA9IG4NCgkJCQl9LCB0LCBlLCBhcmd1bWVudHMubGVuZ3RoKQ0KCQkJfQ0KCQl9KSwgRS5lYWNoKFsidG9wIiwgImxlZnQiXSwgZnVuY3Rpb24oZSwgbikge0UuY3NzSG9va3Nbbl0gPSBfZSh2LnBpeGVsUG9zaXRpb24sIGZ1bmN0aW9uKGUsIHQpIHtpZih0KSByZXR1cm4gdCA9IEJlKGUsIG4pLCBQZS50ZXN0KHQpID8gRShlKS5wb3NpdGlvbigpW25dICsgInB4IiA6IHR9KX0pLCBFLmVhY2goe0hlaWdodDogImhlaWdodCIsIFdpZHRoOiAid2lkdGgifSwgZnVuY3Rpb24oYSwgcykgew0KCQkJRS5lYWNoKHsNCgkJCQlwYWRkaW5nOiAiaW5uZXIiICsgYSwNCgkJCQljb250ZW50OiBzLA0KCQkJCSIiOiAib3V0ZXIiICsgYQ0KCQkJfSwgZnVuY3Rpb24ociwgbykgew0KCQkJCUUuZm5bb10gPSBmdW5jdGlvbihlLCB0KSB7DQoJCQkJCXZhciBuID0gYXJndW1lbnRzLmxlbmd0aCAmJiAociB8fCAiYm9vbGVhbiIgIT0gdHlwZW9mIGUpLCBpID0gciB8fCAoITAgPT09IGUgfHwgITAgPT09IHQgPyAibWFyZ2luIiA6ICJib3JkZXIiKTsNCgkJCQkJcmV0dXJuIEIodGhpcywgZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCQkJdmFyIHI7DQoJCQkJCQlyZXR1cm4geChlKSA/IDAgPT09IG8uaW5kZXhPZigib3V0ZXIiKSA/IGVbImlubmVyIiArIGFdIDogZS5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbImNsaWVudCIgKyBhXSA6IDkgPT09IGUubm9kZVR5cGUgPyAociA9IGUuZG9jdW1lbnRFbGVtZW50LCBNYXRoLm1heChlLmJvZHlbInNjcm9sbCIgKyBhXSwgclsic2Nyb2xsIiArIGFdLCBlLmJvZHlbIm9mZnNldCIgKyBhXSwgclsib2Zmc2V0IiArIGFdLCByWyJjbGllbnQiICsgYV0pKSA6IHZvaWQgMCA9PT0gbiA/IEUuY3NzKGUsIHQsIGkpIDogRS5zdHlsZShlLCB0LCBuLCBpKQ0KCQkJCQl9LCBzLCBuID8gZSA6IHZvaWQgMCwgbikNCgkJCQl9DQoJCQl9KQ0KCQl9KSwgRS5lYWNoKFsiYWpheFN0YXJ0IiwgImFqYXhTdG9wIiwgImFqYXhDb21wbGV0ZSIsICJhamF4RXJyb3IiLCAiYWpheFN1Y2Nlc3MiLCAiYWpheFNlbmQiXSwgZnVuY3Rpb24oZSwgdCkge0UuZm5bdF0gPSBmdW5jdGlvbihlKSB7cmV0dXJuIHRoaXMub24odCwgZSl9fSksIEUuZm4uZXh0ZW5kKHsNCgkJCWJpbmQ6IGZ1bmN0aW9uKGUsIHQsIG4pIHtyZXR1cm4gdGhpcy5vbihlLCBudWxsLCB0LCBuKX0sDQoJCQl1bmJpbmQ6IGZ1bmN0aW9uKGUsIHQpIHtyZXR1cm4gdGhpcy5vZmYoZSwgbnVsbCwgdCl9LA0KCQkJZGVsZWdhdGU6IGZ1bmN0aW9uKGUsIHQsIG4sIHIpIHtyZXR1cm4gdGhpcy5vbih0LCBlLCBuLCByKX0sDQoJCQl1bmRlbGVnYXRlOiBmdW5jdGlvbihlLCB0LCBuKSB7cmV0dXJuIDEgPT09IGFyZ3VtZW50cy5sZW5ndGggPyB0aGlzLm9mZihlLCAiKioiKSA6IHRoaXMub2ZmKHQsIGUgfHwgIioqIiwgbil9LA0KCQkJaG92ZXI6IGZ1bmN0aW9uKGUsIHQpIHtyZXR1cm4gdGhpcy5tb3VzZWVudGVyKGUpLm1vdXNlbGVhdmUodCB8fCBlKX0NCgkJfSksIEUuZWFjaCgiYmx1ciBmb2N1cyBmb2N1c2luIGZvY3Vzb3V0IHJlc2l6ZSBzY3JvbGwgY2xpY2sgZGJsY2xpY2sgbW91c2Vkb3duIG1vdXNldXAgbW91c2Vtb3ZlIG1vdXNlb3ZlciBtb3VzZW91dCBtb3VzZWVudGVyIG1vdXNlbGVhdmUgY2hhbmdlIHNlbGVjdCBzdWJtaXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBjb250ZXh0bWVudSIuc3BsaXQoIiAiKSwgZnVuY3Rpb24oZSwgbikge0UuZm5bbl0gPSBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIDAgPCBhcmd1bWVudHMubGVuZ3RoID8gdGhpcy5vbihuLCBudWxsLCBlLCB0KSA6IHRoaXMudHJpZ2dlcihuKX19KTsNCgkJdmFyIEd0ID0gL15bXHNcdUZFRkZceEEwXSt8KFteXHNcdUZFRkZceEEwXSlbXHNcdUZFRkZceEEwXSskL2c7DQoJCUUucHJveHkgPSBmdW5jdGlvbihlLCB0KSB7DQoJCQl2YXIgbiwgciwgaTsNCgkJCWlmKCJzdHJpbmciID09IHR5cGVvZiB0ICYmIChuID0gZVt0XSwgdCA9IGUsIGUgPSBuKSwgbShlKSkgcmV0dXJuIHIgPSBzLmNhbGwoYXJndW1lbnRzLCAyKSwgKGkgPSBmdW5jdGlvbigpIHtyZXR1cm4gZS5hcHBseSh0IHx8IHRoaXMsIHIuY29uY2F0KHMuY2FsbChhcmd1bWVudHMpKSl9KS5ndWlkID0gZS5ndWlkID0gZS5ndWlkIHx8IEUuZ3VpZCsrLCBpDQoJCX0sIEUuaG9sZFJlYWR5ID0gZnVuY3Rpb24oZSkge2UgPyBFLnJlYWR5V2FpdCsrIDogRS5yZWFkeSghMCl9LCBFLmlzQXJyYXkgPSBBcnJheS5pc0FycmF5LCBFLnBhcnNlSlNPTiA9IEpTT04ucGFyc2UsIEUubm9kZU5hbWUgPSBBLCBFLmlzRnVuY3Rpb24gPSBtLCBFLmlzV2luZG93ID0geCwgRS5jYW1lbENhc2UgPSBYLCBFLnR5cGUgPSB3LCBFLm5vdyA9IERhdGUubm93LCBFLmlzTnVtZXJpYyA9IGZ1bmN0aW9uKGUpIHsNCgkJCXZhciB0ID0gRS50eXBlKGUpOw0KCQkJcmV0dXJuICgibnVtYmVyIiA9PT0gdCB8fCAic3RyaW5nIiA9PT0gdCkgJiYgIWlzTmFOKGUgLSBwYXJzZUZsb2F0KGUpKQ0KCQl9LCBFLnRyaW0gPSBmdW5jdGlvbihlKSB7cmV0dXJuIG51bGwgPT0gZSA/ICIiIDogKGUgKyAiIikucmVwbGFjZShHdCwgIiQxIil9LCAiZnVuY3Rpb24iID09IHR5cGVvZiBkZWZpbmUgJiYgZGVmaW5lLmFtZCAmJiBkZWZpbmUoImpxdWVyeSIsIFtdLCBmdW5jdGlvbigpIHtyZXR1cm4gRX0pOw0KCQl2YXIgWXQgPSBDLmpRdWVyeSwgUXQgPSBDLiQ7DQoJCXJldHVybiBFLm5vQ29uZmxpY3QgPSBmdW5jdGlvbihlKSB7cmV0dXJuIEMuJCA9PT0gRSAmJiAoQy4kID0gUXQpLCBlICYmIEMualF1ZXJ5ID09PSBFICYmIChDLmpRdWVyeSA9IFl0KSwgRX0sICJ1bmRlZmluZWQiID09IHR5cGVvZiBlICYmIChDLmpRdWVyeSA9IEMuJCA9IEUpLCBFDQoJfSk7DQp9DQoNCmNvbnN0IHVudGlsID0gKHByZWRpY2F0ZUZuKSA9PiB7DQoJY29uc3QgcG9sbCA9IChkb25lKSA9PiAocHJlZGljYXRlRm4oKSA/IGRvbmUoKSA6IHNldFRpbWVvdXQoKCkgPT4gcG9sbChkb25lKSwgNTAwKSk7DQoJcmV0dXJuIG5ldyBQcm9taXNlKHBvbGwpOw0KfTsNCg0KYXN5bmMgZnVuY3Rpb24gcGF1c2Uodikgew0KCXdoaWxlKHYgPCAxMDApDQoJCWF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDAwKSk7DQp9DQoNCmZ1bmN0aW9uIGxvb3AobGlnaHRib3hJbWFnZXMsIGluZGV4KSB7DQoJaWYoaW5kZXggPT09IGxpZ2h0Ym94SW1hZ2VzLmxlbmd0aCkgcmV0dXJuOw0KDQoJbGlnaHRib3hJbWFnZXNbaW5kZXhdLm9ubG9hZCA9IGZ1bmN0aW9uKCkgew0KCQljb25zb2xlLmxvZygiaW1hZ2UgIiArIGluZGV4ICsgIiBsb2FkZWQuIik7DQoJCWxvb3AobGlnaHRib3hJbWFnZXMsICsraW5kZXgpOw0KCX07DQp9DQoNCjsoZnVuY3Rpb24oZmFjdG9yeSkgew0KCWZhY3RvcnkoJCk7DQp9KShmdW5jdGlvbihqUXVlcnkpIHsNCgkoYXN5bmMgZnVuY3Rpb24ocHJlY2FsbGJhY2spIHsNCgkJY29uc3QgdGl0bGUgPSBkb2N1bWVudC50aXRsZTsNCgkJaWYodGl0bGUgIT09IHVuZGVmaW5lZCkNCgkJCWRvY3VtZW50LnRpdGxlID0gIkxvYWRpbmcuLi4iOw0KDQoJCWlmKHdpbmRvdy5qUXVlcnkpDQoJCQkkLmhvbGRSZWFkeSh0cnVlKTsNCg0KCQkoKCkgPT4gew0KCQkJY29uc3QgY3NzID0gYC8qDQogKiBDb3B5cmlnaHQgKGMpIDIwMjIgU0dOZXR3b3Jrcy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4NCiAqDQogKiBUaGUgc29mdHdhcmUgaXMgYW4gZXhjbHVzaXZlIGNvcHlyaWdodCBvZiAiU0dOZXR3b3JrcyIgYW5kIGlzIHByb3ZpZGVkIGFzIGlzIGV4Y2x1c2l2ZWx5IHdpdGggb25seSAiVVNBR0UiIGFjY2Vzcy4gIk1vZGlmaWNhdGlvbiIsICAiQWx0ZXJhdGlvbiIsICJSZS1kaXN0cmlidXRpb24iIGlzIGNvbXBsZXRlbHkgcHJvaGliaXRlZC4NCiAqIFZJT0xBVElORyBUSEUgQUJPVkUgVEVSTVMgSVMgQSBQVU5JU0hBQkxFIE9GRkVOU0UgV0hJQ0ggTUFZIExFQUQgVE8gTEVHQUwgQ09OU0VRVUVOQ0VTLg0KICovDQoNCi5oYXMtcHJlbG9hZGVyLA0KLmhhcy1wcmVsb2FkZXIgKiB7DQpcdC0tc2duLWJhY2tncm91bmQ6ICNmZmY7DQpcdC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoOiA2cHg7DQpcdC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoOiA0NHB4Ow0KXHQtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1oZWlnaHQ6IDIycHg7DQpcdC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbjogMXB4Ow0KXHQtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1yYWRpdXM6IDZweDsNCn0NCg0KQG1lZGlhIGFsbCBhbmQgKHByZWZlcnMtY29sb3Itc2NoZW1lOiBkYXJrKSB7DQpcdC5oYXMtcHJlbG9hZGVyLA0KXHQuaGFzLXByZWxvYWRlciAqIHsNClx0LS1zZ24tYmFja2dyb3VuZDogIzAwMDsNClx0fQ0KfQ0KDQpib2R5IHsNClx0bWFyZ2luOiAwOw0KfQ0KDQouc2duLXByZWxvYWRlciB7DQpcdHBhZGRpbmc6IDA7DQpcdHdpZHRoOiAxMDAlOw0KXHRoZWlnaHQ6IDEwMCU7DQpcdGJhY2tncm91bmQtY29sb3I6IHZhcigtLXNnbi1iYWNrZ3JvdW5kKTsNClx0ZGlzcGxheTogZmxleDsNClx0anVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQpcdGFsaWduLWl0ZW1zOiBjZW50ZXI7DQpcdHBvc2l0aW9uOiBhYnNvbHV0ZTsNClx0ei1pbmRleDogOTk5OTk5Ow0KfQ0KDQoNCi5zZ24tcHJlbG9hZGVyID4gLnByZWxvYWRlciB7DQpcdHBvc2l0aW9uOiByZWxhdGl2ZTsNClx0ZGlzcGxheTogaW5saW5lLWZsZXg7DQpcdGp1c3RpZnktY29udGVudDogY2VudGVyOw0KXHRhbGlnbi1pdGVtczogY2VudGVyOw0KfQ0KDQouc2duLXByZWxvYWRlciA+IC5wcmVsb2FkZXIgPiAuc3Bpbm5lciB7DQpcdGFuaW1hdGlvbjogcm90YXRlIDEwcyBpbmZpbml0ZSBsaW5lYXI7DQpcdHBvc2l0aW9uOiByZWxhdGl2ZTsNClx0ZGlzcGxheTogaW5saW5lLWZsZXg7DQpcdGp1c3RpZnktY29udGVudDogY2VudGVyOw0KXHRhbGlnbi1pdGVtczogY2VudGVyOw0KXHR3aWR0aDogMTAwJTsNClx0aGVpZ2h0OiAxMDAlOw0KfQ0KDQoNCi5zZ24tcHJlbG9hZGVyID4gLnByZWxvYWRlciA+IGltZyB7DQpcdHdpZHRoOiAxMDAlOw0KXHRoZWlnaHQ6IDEwMCU7DQpcdG1hcmdpbjogdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbik7DQpcdGRpc3BsYXk6IGZsZXg7DQpcdGp1c3RpZnktY29udGVudDogY2VudGVyOw0KXHRhbGlnbi1pdGVtczogY2VudGVyOw0KXHRwb3NpdGlvbjogcmVsYXRpdmU7DQpcdHRvcDogNTAlOw0KXHRsZWZ0OiA1MCU7DQp9DQouc2duLXByZWxvYWRlciA+IC5wcmVsb2FkZXIgPiAuc3Bpbm5lciA+IGltZyB7DQpcdHdpZHRoOiBjYWxjKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkpOw0KXHRoZWlnaHQ6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSk7DQpcdG1hcmdpbjogdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbik7DQp9DQouc2duLXByZWxvYWRlciA+IC5wcmVsb2FkZXIgPiAuc3Bpbm5lciA+IGkgew0KXHRhbmltYXRpb246IHJvdGF0ZSAzcyBpbmZpbml0ZSBjdWJpYy1iZXppZXIoMC4wOSwgMC42LCAwLjgsIDAuMDMpOw0KXHR0cmFuc2Zvcm0tb3JpZ2luOiA1MCUgMTAwJSAwOw0KXHRwb3NpdGlvbjogYWJzb2x1dGU7DQpcdGRpc3BsYXk6IGlubGluZS1mbGV4Ow0KXHRqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNClx0YWxpZ24taXRlbXM6IGNlbnRlcjsNClx0dG9wOiA1MCU7DQpcdGxlZnQ6IDUwJTsNClx0Ym9yZGVyOiBzb2xpZCB2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpIHRyYW5zcGFyZW50Ow0KXHRib3JkZXItYm90dG9tOiBub25lOw0KfQ0KLnNnbi1wcmVsb2FkZXIgPiAucHJlbG9hZGVyID4gLnNwaW5uZXIgPiBpOm50aC1jaGlsZCgxKSB7DQpcdC1tb3otYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMDksIDAuMywgMC4xMiwgMC4wMyk7DQpcdC13ZWJraXQtYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMDksIDAuMywgMC4xMiwgMC4wMyk7DQpcdGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAwLjMsIDAuMTIsIDAuMDMpOw0KXHR3aWR0aDogdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKTsNClx0aGVpZ2h0OiB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KTsNClx0bWFyZ2luLXRvcDogY2FsYygwcHggLSB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSk7DQpcdG1hcmdpbi1sZWZ0OiBjYWxjKDBweCAtIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1oZWlnaHQpKTsNClx0Ym9yZGVyLWNvbG9yOiAjMjE3MmI4Ow0KXHRib3JkZXItdG9wLWxlZnQtcmFkaXVzOiBjYWxjKCh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikgKiAxKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1yYWRpdXMpKTsNClx0Ym9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IGNhbGMoKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDEpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXJhZGl1cykpOw0KfQ0KLnNnbi1wcmVsb2FkZXIgPiAucHJlbG9hZGVyID4gLnNwaW5uZXIgPiBpOm50aC1jaGlsZCgyKSB7DQpcdC1tb3otYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMDksIDAuNiwgMC4yNCwgMC4wMyk7DQpcdC13ZWJraXQtYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMDksIDAuNiwgMC4yNCwgMC4wMyk7DQpcdGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAwLjYsIDAuMjQsIDAuMDMpOw0KXHR3aWR0aDogY2FsYyh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikpOw0KXHRoZWlnaHQ6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSk7DQpcdG1hcmdpbi10b3A6IGNhbGMoMHB4IC0gKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1oZWlnaHQpICsgKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkpKTsNClx0bWFyZ2luLWxlZnQ6IGNhbGMoMHB4IC0gKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1oZWlnaHQpICsgKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkpKTsNClx0Ym9yZGVyLWNvbG9yOiAjMThhMzliOw0KXHRib3JkZXItdG9wLWxlZnQtcmFkaXVzOiBjYWxjKCh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikgKiAyKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1yYWRpdXMpKTsNClx0Ym9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IGNhbGMoKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDIpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXJhZGl1cykpOw0KfQ0KLnNnbi1wcmVsb2FkZXIgPiAucHJlbG9hZGVyID4gLnNwaW5uZXIgPiBpOm50aC1jaGlsZCgzKSB7DQpcdC1tb3otYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMDksIDAuOSwgMC4zNiwgMC4wMyk7DQpcdC13ZWJraXQtYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMDksIDAuOSwgMC4zNiwgMC4wMyk7DQpcdGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAwLjksIDAuMzYsIDAuMDMpOw0KXHR3aWR0aDogY2FsYyh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikgKiAyKTsNClx0aGVpZ2h0OiBjYWxjKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1oZWlnaHQpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikpOw0KXHRtYXJnaW4tdG9wOiBjYWxjKDBweCAtICh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpKSk7DQpcdG1hcmdpbi1sZWZ0OiBjYWxjKDBweCAtICh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpKSk7DQpcdGJvcmRlci1jb2xvcjogIzgyYzU0NTsNClx0Ym9yZGVyLXRvcC1sZWZ0LXJhZGl1czogY2FsYygodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogMikgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtcmFkaXVzKSk7DQpcdGJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiBjYWxjKCh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikgKiAyKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1yYWRpdXMpKTsNCn0NCi5zZ24tcHJlbG9hZGVyID4gLnByZWxvYWRlciA+IC5zcGlubmVyID4gaTpudGgtY2hpbGQoNCkgew0KXHQtbW96LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAxLjIsIDAuNDgsIDAuMDMpOw0KXHQtd2Via2l0LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAxLjIsIDAuNDgsIDAuMDMpOw0KXHRhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4wOSwgMS4yLCAwLjQ4LCAwLjAzKTsNClx0d2lkdGg6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogMyk7DQpcdGhlaWdodDogY2FsYyh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogMS41KTsNClx0bWFyZ2luLXRvcDogY2FsYygwcHggLSAodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAzKSkpOw0KXHRtYXJnaW4tbGVmdDogY2FsYygwcHggLSAodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAzKSkpOw0KXHRib3JkZXItY29sb3I6ICNmOGI3Mzk7DQpcdGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IGNhbGMoKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDMpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXJhZGl1cykpOw0KXHRib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogY2FsYygodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogMykgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtcmFkaXVzKSk7DQp9DQouc2duLXByZWxvYWRlciA+IC5wcmVsb2FkZXIgPiAuc3Bpbm5lciA+IGk6bnRoLWNoaWxkKDUpIHsNClx0LW1vei1hbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4wOSwgMS41LCAwLjYsIDAuMDMpOw0KXHQtd2Via2l0LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAxLjUsIDAuNiwgMC4wMyk7DQpcdGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAxLjUsIDAuNiwgMC4wMyk7DQpcdHdpZHRoOiBjYWxjKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDQpOw0KXHRoZWlnaHQ6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDIpOw0KXHRtYXJnaW4tdG9wOiBjYWxjKDBweCAtICh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDQpKSk7DQpcdG1hcmdpbi1sZWZ0OiBjYWxjKDBweCAtICh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDQpKSk7DQpcdGJvcmRlci1jb2xvcjogI2YwNjA0NTsNClx0Ym9yZGVyLXRvcC1sZWZ0LXJhZGl1czogY2FsYygodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogNCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtcmFkaXVzKSk7DQpcdGJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiBjYWxjKCh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikgKiA0KSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1yYWRpdXMpKTsNCn0NCi5zZ24tcHJlbG9hZGVyID4gLnByZWxvYWRlciA+IC5zcGlubmVyID4gaTpudGgtY2hpbGQoNikgew0KXHQtbW96LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAxLjgsIDAuNzIsIDAuMDMpOw0KXHQtd2Via2l0LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAxLjgsIDAuNzIsIDAuMDMpOw0KXHRhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4wOSwgMS44LCAwLjcyLCAwLjAzKTsNClx0d2lkdGg6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogNSk7DQpcdGhlaWdodDogY2FsYyh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogMi41KTsNClx0bWFyZ2luLXRvcDogY2FsYygwcHggLSAodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiA1KSkpOw0KXHRtYXJnaW4tbGVmdDogY2FsYygwcHggLSAodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiA1KSkpOw0KXHRib3JkZXItY29sb3I6ICNlZDI4NjE7DQpcdGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IGNhbGMoKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDUpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXJhZGl1cykpOw0KXHRib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogY2FsYygodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogNSkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtcmFkaXVzKSk7DQp9DQouc2duLXByZWxvYWRlciA+IC5wcmVsb2FkZXIgPiAuc3Bpbm5lciA+IGk6bnRoLWNoaWxkKDcpIHsNClx0LW1vei1hbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4wOSwgMi4xLCAwLjg0LCAwLjAzKTsNClx0LXdlYmtpdC1hbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4wOSwgMi4xLCAwLjg0LCAwLjAzKTsNClx0YW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMDksIDIuMSwgMC44NCwgMC4wMyk7DQpcdHdpZHRoOiBjYWxjKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDYpOw0KXHRoZWlnaHQ6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDMpOw0KXHRtYXJnaW4tdG9wOiBjYWxjKDBweCAtICh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDYpKSk7DQpcdG1hcmdpbi1sZWZ0OiBjYWxjKDBweCAtICh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDYpKSk7DQpcdGJvcmRlci1jb2xvcjogI2MxMjY4MDsNClx0Ym9yZGVyLXRvcC1sZWZ0LXJhZGl1czogY2FsYygodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogNikgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtcmFkaXVzKSk7DQpcdGJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiBjYWxjKCh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikgKiA2KSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1yYWRpdXMpKTsNCn0NCi5zZ24tcHJlbG9hZGVyID4gLnByZWxvYWRlciA+IC5zcGlubmVyID4gaTpudGgtY2hpbGQoOCkgew0KXHQtbW96LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAyLjQsIDAuOTYsIDAuMDMpOw0KXHQtd2Via2l0LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAyLjQsIDAuOTYsIDAuMDMpOw0KXHRhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4wOSwgMi40LCAwLjk2LCAwLjAzKTsNClx0d2lkdGg6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogNyk7DQpcdGhlaWdodDogY2FsYyh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogMy41KTsNClx0bWFyZ2luLXRvcDogY2FsYygwcHggLSAodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiA3KSkpOw0KXHRtYXJnaW4tbGVmdDogY2FsYygwcHggLSAodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiA3KSkpOw0KXHRib3JkZXItY29sb3I6ICM1ZDMxOTE7DQpcdGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IGNhbGMoKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDcpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXJhZGl1cykpOw0KXHRib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogY2FsYygodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogNykgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtcmFkaXVzKSk7DQp9DQoNCkAtbW96LWtleWZyYW1lcyByb3RhdGUgew0KXHR0byB7DQpcdFx0dHJhbnNmb3JtOiByb3RhdGUoMzYwZGVnKTsNClx0fQ0KfQ0KQC13ZWJraXQta2V5ZnJhbWVzIHJvdGF0ZSB7DQpcdHRvIHsNClx0XHR0cmFuc2Zvcm06IHJvdGF0ZSgzNjBkZWcpOw0KXHR9DQp9DQpAa2V5ZnJhbWVzIHJvdGF0ZSB7DQpcdHRvIHsNClx0XHR0cmFuc2Zvcm06IHJvdGF0ZSgzNjBkZWcpOw0KXHR9DQp9DQoNCg0KYDsNCgkJCWNvbnN0IGhlYWQgID0gZG9jdW1lbnQuaGVhZCB8fCBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdLA0KCQkJICAgICAgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdHlsZSIpOw0KDQoJCQloZWFkLmFwcGVuZENoaWxkKHN0eWxlKTsNCgkJCXN0eWxlLnR5cGUgPSAidGV4dC9jc3MiOw0KCQkJc3R5bGUuaWQgPSAic2duLXVpa2l0LXN0eWxlcyI7DQoJCQlpZihzdHlsZS5zdHlsZVNoZWV0KSB7DQoJCQkJLy8gVGhpcyBpcyByZXF1aXJlZCBmb3IgSUU4IGFuZCBiZWxvdy4NCgkJCQlzdHlsZS5zdHlsZVNoZWV0LmNzc1RleHQgPSBjc3M7DQoJCQl9IGVsc2Ugew0KCQkJCXN0eWxlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNzcykpOw0KCQkJfQ0KCQl9KSgpOw0KCQkoZnVuY3Rpb24oKSB7DQoJCQlsZXQgcHJlbG9hZGVyRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KCQkJcHJlbG9hZGVyRWxlbS5jbGFzc05hbWUgPSAic2duLXByZWxvYWRlciI7DQoJCQlsZXQgcHJlbG9hZGVyID0gYFx0XHRcdDxkaXYgY2xhc3M9InByZWxvYWRlciI+XG5gOw0KCQkJLy9wcmVsb2FkZXIgKz0gYFx0XHRcdFx0PGltZyBzcmM9Ijw/PSRwdWJsaWNfaW1nQXNzZXRzOz8+aWNvbnMveHNtYWxsLnBuZyI+XG5gOw0KCQkJcHJlbG9hZGVyICs9IGBcdFx0XHRcdDxkaXYgY2xhc3M9InNwaW5uZXIiPlxuYDsNCgkJCXByZWxvYWRlciArPSBgXHRcdFx0XHRcdDxpPjwvaT5cbmA7DQoJCQlwcmVsb2FkZXIgKz0gYFx0XHRcdFx0XHQ8aT48L2k+XG5gOw0KCQkJcHJlbG9hZGVyICs9IGBcdFx0XHRcdFx0PGk+PC9pPlxuYDsNCgkJCXByZWxvYWRlciArPSBgXHRcdFx0XHRcdDxpPjwvaT5cbmA7DQoJCQlwcmVsb2FkZXIgKz0gYFx0XHRcdFx0XHQ8aT48L2k+XG5gOw0KCQkJcHJlbG9hZGVyICs9IGBcdFx0XHRcdFx0PGk+PC9pPlxuYDsNCgkJCXByZWxvYWRlciArPSBgXHRcdFx0XHRcdDxpPjwvaT5cbmA7DQoJCQlwcmVsb2FkZXIgKz0gYFx0XHRcdFx0XHQ8aT48L2k+XG5gOw0KCQkJcHJlbG9hZGVyICs9IGBcdFx0XHRcdDwvZGl2PlxuYDsNCgkJCXByZWxvYWRlciArPSBgXHRcdFx0PC9kaXY+XG5gOw0KCQkJcHJlbG9hZGVyICs9IGBcdFx0PC9kaXY+XG5gOw0KDQoJCQlwcmVsb2FkZXJFbGVtLmlubmVySFRNTCA9IHByZWxvYWRlcjsNCg0KCQkJd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkgew0KCQkJCWRvY3VtZW50LmJvZHkuY2xhc3NOYW1lICs9ICIgaGFzLXByZWxvYWRlciI7DQoJCQkJZG9jdW1lbnQuYm9keS5pbnNlcnRCZWZvcmUocHJlbG9hZGVyRWxlbSwgZG9jdW1lbnQuYm9keS5maXJzdENoaWxkKTsNCgkJCX07DQoJCX0pKCk7DQoNCgkJY29uc3QgY3VycmVudFNjcmlwdCA9IGRvY3VtZW50LmN1cnJlbnRTY3JpcHQgfHwgZG9jdW1lbnQucXVlcnlTZWxlY3Rvcigic2NyaXB0W3NyYyo9XCJTR05VSUtpdC5sb2FkZXIuanNcIl0iKTsNCgkJY29uc3QgdXJsID0gY3VycmVudFNjcmlwdC5zcmMuc3BsaXQoIi8iKS5zbGljZSgwLCAtMikuam9pbigiLyIpICsgIi8iOw0KCQljb25zdCBwcmVsb2FkID0gWw0KCQkJLy8nanMvaTE4bi9TR05pMThuLmpzJw0KCQldOw0KDQoJCWxldCBmaWxlc2xvYWRlZCA9IDA7DQoJCWNvbnN0IGZpbGVzdG9sb2FkID0gcHJlbG9hZC5sZW5ndGg7DQoNCgkJaWYoZmlsZXN0b2xvYWQgPiAwKSB7DQoJCQlmb3IobGV0IGkgPSAwOyBpIDwgZmlsZXN0b2xvYWQ7IGkrKykgew0KCQkJCWNvbnN0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOw0KCQkJCXNjcmlwdC5zcmMgPSB1cmwgKyBwcmVsb2FkW2ldOw0KCQkJCXNjcmlwdC5hc3luYyA9IGZhbHNlOw0KCQkJCXNjcmlwdC5kZWZlciA9IGZhbHNlOw0KCQkJCWN1cnJlbnRTY3JpcHQuYWZ0ZXIoc2NyaXB0KTsNCgkJCQlpZihpID09PSAwKQ0KCQkJCQlzY3JpcHQuaWQgPSAic2duLXByZWxvYWQtZW5kIjsNCgkJCQlzY3JpcHQub25sb2FkID0gZnVuY3Rpb24oKSB7DQoJCQkJCWZpbGVzbG9hZGVkKys7DQoJCQkJCXNjcmlwdC5vbmxvYWQgPSBudWxsOw0KCQkJCQlmaW5pc2hMb2FkKCk7DQoJCQkJfTsNCgkJCX0NCgkJfSBlbHNlDQoJCQlmaW5pc2hMb2FkKCk7DQoNCgkJYXN5bmMgZnVuY3Rpb24gZmluaXNoTG9hZCgpIHsNCgkJCWxldCBwcm9ncmVzcyA9IE1hdGgucm91bmQoKGZpbGVzbG9hZGVkICogMTAwKSAvIGZpbGVzdG9sb2FkKSB8fCAxMDA7DQoNCgkJCWF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gew0KCQkJCWlmKGZpbGVzbG9hZGVkID49IGZpbGVzdG9sb2FkKSB7DQoJCQkJCXJlc29sdmUoKTsNCgkJCQl9DQoJCQl9KS50aGVuKGZ1bmN0aW9uKCkgew0KCQkJCS8vaW1wb3J0KCcuL2hlbHBlcnMvaGVscGVycy5qcycpOw0KCQkJCSQoImhlYWQgPiB0aXRsZSIpLnRleHQodGl0bGUpOw0KCQkJCWlmKHR5cGVvZiBwcmVjYWxsYmFjayA9PT0gImZ1bmN0aW9uIiAmJiBwcm9ncmVzcyA9PT0gMTAwKQ0KCQkJCQlwcmVjYWxsYmFjaygpOw0KCQkJfSk7DQoJCX0NCgl9KShmdW5jdGlvbigpIHsNCgkJKGFzeW5jIGZ1bmN0aW9uKGNhbGxiYWNrKSB7DQoJCQljb25zdCBzZ251aWtpdFNjcmlwdCA9IGRvY3VtZW50LmN1cnJlbnRTY3JpcHQgfHwgZG9jdW1lbnQucXVlcnlTZWxlY3Rvcigic2NyaXB0W3NyYyo9XCJTR05VSUtpdC5sb2FkZXIuanNcIl0iKTsNCgkJCWNvbnN0IGN1cnJlbnRTY3JpcHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2duLXByZWxvYWQtZW5kIikgfHwgc2dudWlraXRTY3JpcHQ7DQoNCgkJCWZ1bmN0aW9uIGdldFNjcmlwdFVSTCgpIHsNCgkJCQlyZXR1cm4gc2dudWlraXRTY3JpcHQuc3JjOw0KCQkJfQ0KDQoJCQljb25zdCB1cmwgPSBnZXRTY3JpcHRVUkwoKS5zcGxpdCgiLyIpLnNsaWNlKDAsIC0yKS5qb2luKCIvIikgKyAiLyI7DQoNCgkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQoJCQkJc3RhcnRMb2FkKCk7DQoJCQl9LCA1MDAwKTsNCg0KCQkJZnVuY3Rpb24gc3RhcnRMb2FkKCkgew0KCQkJCWNvbnN0IHNjcmlwdHMgPSBbDQoJCQkJCSJqcy9TR05VSUtpdC5idW5kbGUuanMiLA0KCQkJCV07DQoJCQkJY29uc3Qgc3R5bGVzID0gWw0KCQkJCQkiY3NzL1NHTlVJS2l0LmJ1bmRsZS5jc3MiLA0KCQkJCV07DQoJCQkJbGV0IGZpbGVzbG9hZGVkID0gMCwNCgkJCQkgICAgbGFzdFNjcmlwdCAgPSBjdXJyZW50U2NyaXB0Ow0KCQkJCWNvbnN0IGZpbGVzdG9sb2FkID0gc2NyaXB0cy5sZW5ndGggKyBzdHlsZXMubGVuZ3RoOw0KDQoJCQkJZnVuY3Rpb24gbG9hZFNjcmlwdChpKSB7DQoJCQkJCWlmKGkgPT09IHNjcmlwdHMubGVuZ3RoKSByZXR1cm47DQoNCgkJCQkJY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7DQoJCQkJCXNjcmlwdC5zcmMgPSB1cmwgKyBzY3JpcHRzW2ldOw0KCQkJCQlzY3JpcHQub25sb2FkID0gZnVuY3Rpb24oKSB7DQoJCQkJCQlmaWxlc2xvYWRlZCsrOw0KCQkJCQkJU0dOVUlLaXQuY29tcG9uZW50ID0gew0KCQkJCQkJCWk6IHNjcmlwdHNbaV0sDQoJCQkJCQl9Ow0KCQkJCQkJc2NyaXB0Lm9ubG9hZCA9IG51bGw7DQoJCQkJCQkvL2NvbnNvbGUubG9nKGBMT0FERUQgU0NSSVBUOiAke3NjcmlwdC5zcmN9YCwgYCR7aX0vJHtmaWxlc3RvbG9hZH1gKTsNCgkJCQkJCWZpbmlzaExvYWQoKTsNCgkJCQkJCWxvYWRTY3JpcHQoKytpKTsNCgkJCQkJfTsNCgkJCQkJbGFzdFNjcmlwdC5hZnRlcihzY3JpcHQpOw0KCQkJCQlsYXN0U2NyaXB0ID0gbGFzdFNjcmlwdC5uZXh0RWxlbWVudFNpYmxpbmcgfHwgY3VycmVudFNjcmlwdDsNCgkJCQl9DQoNCgkJCQlmdW5jdGlvbiBsb2FkU3R5bGUoaSkgew0KCQkJCQlpZihpID09PSBzY3JpcHRzLmxlbmd0aCkgcmV0dXJuOw0KDQoJCQkJCWNvbnN0IHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGluayIpOw0KCQkJCQlzdHlsZS5yZWwgPSAic3R5bGVzaGVldCI7DQoJCQkJCXN0eWxlLmhyZWYgPSB1cmwgKyBzdHlsZXNbaV07DQoJCQkJCXN0eWxlLm9ubG9hZCA9IGZ1bmN0aW9uKCkgew0KCQkJCQkJZmlsZXNsb2FkZWQrKzsNCgkJCQkJCXN0eWxlLm9ubG9hZCA9IG51bGw7DQoJCQkJCQlmaW5pc2hMb2FkKCk7DQoJCQkJCQlsb29wKCsraSk7DQoJCQkJCX07DQoJCQkJCWN1cnJlbnRTY3JpcHQuYWZ0ZXIoc3R5bGUpOw0KCQkJCX0NCg0KCQkJCWxvYWRTY3JpcHQoMCk7DQoJCQkJbG9hZFN0eWxlKDApOw0KDQoJCQkJYXN5bmMgZnVuY3Rpb24gZmluaXNoTG9hZCgpIHsNCgkJCQkJY29uc3QgcHJvZ3Jlc3MgPSBNYXRoLnJvdW5kKChmaWxlc2xvYWRlZCAqIDEwMCkgLyBmaWxlc3RvbG9hZCk7DQoNCgkJCQkJaWYodHlwZW9mIGNhbGxiYWNrID09PSAiZnVuY3Rpb24iKSB7DQoJCQkJCQljYWxsYmFjayhmaWxlc2xvYWRlZCwgZmlsZXN0b2xvYWQsIHByb2dyZXNzKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCgkJfSkoYXN5bmMgZnVuY3Rpb24obG9hZGVkLCB0b3RhbCwgcHJvZ3Jlc3MpIHsNCgkJCWlmKHByb2dyZXNzID09PSAxMDApIHsNCgkJCQkvL2ltcG9ydCgnLi9pMThuL1NHTmkxOG4uanMnKTsNCgkJCQkvL2ltcG9ydCgnLi9jb21wb25lbnRzL2NvbXBvbmVudHMuanMnKTsNCgkJCQlTR05VSUtpdC5yZWFkeSA9IHRydWU7DQoJCQkJd2luZG93LlNHTlVJS2l0UmVhZHkgPSB0cnVlOw0KDQoJCQkJY29uc3QgbGVmdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInN0eWxlW2RhdGEtY2tlPVwidHJ1ZVwiXSIpOw0KCQkJCWlmKGxlZnQgIT09IG51bGwpDQoJCQkJCWxlZnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChsZWZ0KTsNCg0KCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQoJCQkJCSQuaG9sZFJlYWR5KGZhbHNlKTsNCgkJCQkJalF1ZXJ5LnJlYWR5KCk7DQoNCgkJCQkJU0dOVUlLaXQuc2V0T25DaGFuZ2VMaXN0ZW5lcigocHJvcCwgdmFsdWUpID0+IHsNCgkJCQkJCWlmKHByb3AgPT09ICdob2xkUHJlbG9hZGVyJyAmJiAhdmFsdWUpIHsNCgkJCQkJCQljb25zdCAkYm9keSA9ICQoImJvZHkiKTsNCg0KCQkJCQkJCSRib2R5LmNoaWxkcmVuKCIuc2duLXByZWxvYWRlciIpLmZhZGVPdXQoMjAwMCwgZnVuY3Rpb24oKSB7DQoJCQkJCQkJCSRib2R5LmNoaWxkcmVuKCIuc2duLXByZWxvYWRlciIpLnJlbW92ZSgpOw0KCQkJCQkJCQkkYm9keS5yZW1vdmVDbGFzcygiaGFzLXByZWxvYWRlciIpOw0KCQkJCQkJCX0pOw0KCQkJCQkJfQ0KCQkJCQl9KTsNCgkJCQl9LCA1MDAwKTsNCg0KCQkJfQ0KCQl9KTsNCgl9KTsNCn0pOw0KDQoNCmFzeW5jIGZ1bmN0aW9uIGdldFNHTkkxOG5JbnN0YW5jZShjYWxsYmFjaykgew0KCXJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQoJCWNvbnN0IHRpbWVvdXRIYW5kbGVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsNCgkJCWlmKGNoZWNrSW50ZXJ2YWxIYW5kbGVyKQ0KCQkJCWNsZWFySW50ZXJ2YWwoY2hlY2tJbnRlcnZhbEhhbmRsZXIpOw0KCQl9LCAxMDAwMCk7DQoNCgkJY29uc3QgY2hlY2tJbnRlcnZhbEhhbmRsZXIgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHsNCgkJCWlmKHdpbmRvdy5TR05VSUtpdFJlYWR5KSB7DQoJCQkJaWYodGltZW91dEhhbmRsZXIpDQoJCQkJCWNsZWFyVGltZW91dCh0aW1lb3V0SGFuZGxlcik7DQoJCQkJY2xlYXJJbnRlcnZhbChjaGVja0ludGVydmFsSGFuZGxlcik7DQoJCQkJY29uc3QgYyA9IG5ldyBTR05pMThuKCk7DQoNCgkJCQlyZXNvbHZlKGMpOw0KCQkJfQ0KCQl9LCAxMDApOw0KCX0pOw0KfQ0KDQo=";

module.exports = {
	args, SGNUIKitLoader, version, cdn_dir,
};
