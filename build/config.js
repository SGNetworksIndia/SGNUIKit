/*
 * Copyright (c) 2022-2023 SGNetworks. All rights reserved.
 *
 * The software is an exclusive copyright of "SGNetworks" and is provided as is exclusively with only "USAGE" access. "Modification",  "Alteration", "Re-distribution" is completely prohibited.
 * VIOLATING THE ABOVE TERMS IS A PUNISHABLE OFFENSE WHICH MAY LEAD TO LEGAL CONSEQUENCES.
 */

Date.prototype.toUnixTime = function() { return this.getTime() / 1000 | 0; };
Date.time = function() { return new Date().toUnixTime(); };

const argv = process.argv,
      info = require("../package.json");
const args    = {},
      cdn_dir = "E:\\home\\sgn\\public_html\\cdn\\jquery\\plugins\\SGNetworks\\SGNUIKit\\";

for(let i = 2; i < argv.length; i++) {
	const v = argv[i].replace("--", "");
	i++;
	args[v] = argv[i];
}

const v = info.version.split(".");
const version = {
	"major": v[0] | 0,
	"minor": v[1] | 0,
	"patch": v[2] | 0,
};


const SGNUIKitLoader = "LyoNCiAqIENvcHlyaWdodCAoYykgMjAyMi0yMDIzIFNHTmV0d29ya3MuIEFsbCByaWdodHMgcmVzZXJ2ZWQuDQogKg0KICogVGhlIHNvZnR3YXJlIGlzIGFuIGV4Y2x1c2l2ZSBjb3B5cmlnaHQgb2YgIlNHTmV0d29ya3MiIGFuZCBpcyBwcm92aWRlZCBhcyBpcyBleGNsdXNpdmVseSB3aXRoIG9ubHkgIlVTQUdFIiBhY2Nlc3MuICJNb2RpZmljYXRpb24iLCAgIkFsdGVyYXRpb24iLCAiUmUtZGlzdHJpYnV0aW9uIiBpcyBjb21wbGV0ZWx5IHByb2hpYml0ZWQuDQogKiBWSU9MQVRJTkcgVEhFIEFCT1ZFIFRFUk1TIElTIEEgUFVOSVNIQUJMRSBPRkZFTlNFIFdISUNIIE1BWSBMRUFEIFRPIExFR0FMIENPTlNFUVVFTkNFUy4NCiAqLw0KDQovKioNCiAqIFBlcmZvcm1zIHRoZSBzcGVjaWZpZWQgYWN0aW9uIGZvciBlYWNoIGVsZW1lbnQgaW4gYW4gb2JqZWN0Lg0KICoNCiAqIEBwYXJhbSB7T2JqZWN0fSBvYmoNCiAqIEBwYXJhbSB7KHZhbHVlOmFueSwga2V5OnN0cmluZyk9PnZvaWR9IGNhbGxiYWNrIEEgZnVuY3Rpb24gdGhhdCBhY2NlcHRzIHVwIHRvIHRocmVlIGFyZ3VtZW50cy4gZm9yRWFjaCBjYWxscyB0aGUgPGI+PGk+Y2FsbGJhY2s8L2k+PC9iPiBmdW5jdGlvbiBvbmUgdGltZSBmb3IgZWFjaCBlbGVtZW50IGluIHRoZSBvYmplY3QuDQogKi8NCmNvbnN0IGZvckVhY2ggPSAob2JqLCBjYWxsYmFjaykgPT4gew0KCWxldCB2YWx1ZTsNCgkvL2NvbnRleHQgPSBjb250ZXh0IHx8IHRoaXM7ICAvL2FwcGx5IHRoZSBmdW5jdGlvbiB0byAndGhpcycgYnkgZGVmYXVsdA0KDQoJZm9yKGNvbnN0IGtleSBpbiBvYmopIHsNCgkJaWYoa2V5ICE9PSAnbGVuZ3RoJyAmJiBvYmouaGFzT3duUHJvcGVydHkoa2V5KSkgeyAgLy90byBydWxlIG91dCBpbmhlcml0ZWQgcHJvcGVydGllcw0KCQkJdmFsdWUgPSBvYmpba2V5XTsNCgkJCWlmKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykNCgkJCQljYWxsYmFjayh2YWx1ZSwga2V5KTsNCgkJfQ0KCX0NCn0NCg0KLyoqDQogKiBBcHBlbmRzIG5ldyBlbGVtZW50cyB0byB0aGUgZW5kIG9mIGFuIG9iamVjdCwgYW5kIHJldHVybnMgdGhlIG5ldyBsZW5ndGggb2YgdGhlIG9iamVjdC4NCiAqIEBwYXJhbSB7T2JqZWN0fSBvYmoNCiAqIEBwYXJhbSB7Li4uYW55fSBpdGVtcyBOZXcgZWxlbWVudHMgdG8gYWRkIHRvIHRoZSBvYmplY3QuDQogKi8NCmNvbnN0IHB1c2ggPSAob2JqLCAuLi5pdGVtcykgPT4gew0KCWxldCBrID0gb2JqLmxlbmd0aCB8fCAwOw0KDQoJaXRlbXMuZm9yRWFjaCgodmFsdWUpID0+IHsNCgkJb2JqW2tdID0gdmFsdWU7DQoJCWsrKzsNCgkJb2JqLmxlbmd0aCA9IGs7DQoJfSk7DQp9DQoNCmNvbnN0IFNHTlVJS2l0ID0gew0KCWlzUmVhZHk6IGZhbHNlLA0KCWlzSW5pdDogZmFsc2UsDQoJaXNQcmVsb2FkZXJIZWxkOiBmYWxzZSwNCgljb25maWdzOiB7DQoJCSd1cmxzJzogew0KCQkJJ2FwaSc6IHsNCgkJCQknZ2VvbmFtZXMnOiAnaHR0cHM6Ly9zZWN1cmUuZ2VvbmFtZXMub3JnLycsDQoJCQkJJ29zbSc6ICdodHRwczovL25vbWluYXRpbS5vcGVuc3RyZWV0bWFwLm9yZy8nDQoJCQl9LA0KCQl9LA0KCQknYXBpJzogew0KCQkJJ2dlb25hbWVzJzogJycgLy91c2VybmFtZQ0KCQl9LA0KCQknZ2VvY29kaW5nJzogew0KCQkJJ2RlZmF1bHRBUEknOiAnb3NtJw0KCQl9DQoJfSwNCgljb21wb25lbnRzOiB7fSwNCglvbkNoYW5nZUxpc3RlbmVyOiB7fSwNCglvbkluaXRMaXN0ZW5lcjoge30sDQoJb25SZWFkeUxpc3RlbmVyOiB7fSwNCgljYWxsQ291bnRzOiB7DQoJCSdpbml0JzogMCwNCgkJJ3JlYWR5JzogMCwNCgkJJ2NvbmZpZyc6IDAsDQoJCSdjb21wb25lbnQnOiAwLA0KCQknaG9sZFByZWxvYWRlcic6IDAsDQoJfSwNCg0KCS8qKg0KCSAqIFRoaXMgY2FsbGJhY2sgaXMgY2FsbGVkIHdoZW4gYSBjb21wb25lbnQgaXMgbG9hZGVkL3JlbW92ZWQgb3IgdGhlIHN0YXR1cyBvZiByZWFkaW5lc3MgaXMgY2hhbmdlZC4NCgkgKg0KCSAqIEBjYWxsYmFjayBTR05VSUtpdENoYW5nZUNhbGxiYWNrDQoJICogQHBhcmFtIHtzdHJpbmd9IHN0YXRlIFRoZSBuYW1lIG9mIHRoZSBzdGF0ZSB3aGljaCBpcyBjaGFuZ2VkLg0KCSAqIEBwYXJhbSB7Ym9vbGVhbnxKU09OfSB2YWx1ZSBUaGUgdmFsdWUgb2YgdGhlIHN0YXRlIHdoaWNoIGlzIGNoYW5nZWQuDQoJICogQHBhcmFtIHtKU09OfSBjb21wb25lbnRzIFRoZSA8Yj48aT5KU09OPC9pPjwvYj4gb2JqZWN0IG9mIGxvYWRlZCA8Yj5TR05VSUtpdDwvYj4gY29tcG9uZW50cywgb3IgYW4gZW1wdHkgPGI+PGk+SlNPTjwvaT48L2I+IG9iamVjdCBpZiBubyBjb21wb25lbnRzIGxvYWRlZC4NCgkgKi8NCgkvKioNCgkgKiBUaGlzIGNhbGxiYWNrIGlzIGNhbGxlZCB3aGVuIDxiPlNHTlVJS2l0PC9iPiBpcyByZWFkeS4NCgkgKg0KCSAqIEBjYWxsYmFjayBTR05VSUtpdFJlYWR5Q2FsbGJhY2sNCgkgKiBAcGFyYW0ge2Jvb2xlYW59IGlzUmVhZHkgdGhlIHN0YXR1cyBvZiByZWFkaW5lc3Mgb2YgPGI+U0dOVUlLaXQ8L2I+Lg0KCSAqLw0KDQoJLyoqDQoJICogQWRkIGEgbG9hZGVkIDxiPlNHTlVJS2l0PC9iPiBjb21wb25lbnQuDQoJICoNCgkgKiBAcGFyYW0ge3t9fSBjb25maWcgVGhlIDxiPjxpPkpTT048L2k+PC9iPiBvYmplY3Qgb2YgdGhlIDxiPlNHTlVJS2l0PC9iPiBjb25maWd1cmF0aW9uIG9wdGlvbnMuDQoJICovDQoJc2V0IGNvbmZpZyhjb25maWcpIHsNCgkJaWYoY29uZmlnICE9PSB1bmRlZmluZWQgJiYgY29uZmlnICE9PSBudWxsICYmIGNvbmZpZyAhPT0gIiIpIHsNCgkJCXRoaXMuY29uZmlncyA9IG5ldyBTR05VS0NvbmZpZyhjb25maWcpOw0KCQkJdGhpcy5jYWxsQ291bnRzLmNvbmZpZysrOw0KDQoJCQlmb3JFYWNoKHRoaXMub25DaGFuZ2VMaXN0ZW5lciwgKGxpc3RlbmVyKSA9PiBsaXN0ZW5lcigiY29uZmlnIiwgY29uZmlnLCB0aGlzLmNvbmZpZ3MpKTsNCgkJfQ0KCX0sDQoNCgkvKioNCgkgKiBHZXQgdGhlIGxpc3Qgb2YgbG9hZGVkIDxiPlNHTlVJS2l0PC9iPiBjb21wb25lbnRzLg0KCSAqDQoJICogQHJldHVybiB7T2JqZWN0fSBUaGUgPGI+PGk+SlNPTjwvaT48L2I+IG9iamVjdCBvZiBsb2FkZWQgPGI+U0dOVUlLaXQ8L2I+IGNvbXBvbmVudHMsIG9yIGFuIGVtcHR5IDxiPjxpPkpTT048L2k+PC9iPiBvYmplY3QgaWYgbm8gY29tcG9uZW50cyBsb2FkZWQuDQoJICovDQoJZ2V0IGNvbmZpZygpIHsNCgkJcmV0dXJuIHRoaXMuY29uZmlnczsNCgl9LA0KDQoJLyoqDQoJICogQWRkIGEgbG9hZGVkIDxiPlNHTlVJS2l0PC9iPiBjb21wb25lbnQuDQoJICoNCgkgKiBAcGFyYW0ge3t9fSB2YWx1ZSBUaGUgPGI+PGk+SlNPTjwvaT48L2I+IG9iamVjdCBvZiB0aGUgbG9hZGVkIDxiPlNHTlVJS2l0PC9iPiBjb21wb25lbnQuDQoJICovDQoJc2V0IGNvbXBvbmVudCh2YWx1ZSkgew0KCQlpZih2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSAiIikgew0KCQkJT2JqZWN0LmFzc2lnbih0aGlzLmNvbXBvbmVudHMsIHZhbHVlKTsNCgkJCXRoaXMuY2FsbENvdW50cy5jb21wb25lbnQrKzsNCg0KCQkJZm9yRWFjaCh0aGlzLm9uQ2hhbmdlTGlzdGVuZXIsIChsaXN0ZW5lcikgPT4gbGlzdGVuZXIoImNvbXBvbmVudHMiLCB2YWx1ZSwgdGhpcy5jb21wb25lbnRzKSk7DQoJCQkvL3RoaXMub25DaGFuZ2VMaXN0ZW5lci5mb3JFYWNoKChsaXN0ZW5lcikgPT4gbGlzdGVuZXIoImNvbXBvbmVudHMiLCB2YWx1ZSwgdGhpcy5jb21wb25lbnRzKSk7DQoJCX0NCgl9LA0KDQoJLyoqDQoJICogR2V0IHRoZSBsaXN0IG9mIGxvYWRlZCA8Yj5TR05VSUtpdDwvYj4gY29tcG9uZW50cy4NCgkgKg0KCSAqIEByZXR1cm4ge29iamVjdH0gVGhlIDxiPjxpPkpTT048L2k+PC9iPiBvYmplY3Qgb2YgbG9hZGVkIDxiPlNHTlVJS2l0PC9iPiBjb21wb25lbnRzLCBvciBhbiBlbXB0eSA8Yj48aT5KU09OPC9pPjwvYj4gb2JqZWN0IGlmIG5vIGNvbXBvbmVudHMgbG9hZGVkLg0KCSAqLw0KCWdldCBjb21wb25lbnQoKSB7DQoJCXJldHVybiB0aGlzLmNvbXBvbmVudHM7DQoJfSwNCg0KCS8qKg0KCSAqIENoZWNrIGlmIGEgPGI+U0dOVUlLaXQ8L2I+IGNvbXBvbmVudCBpcyBsb2FkZWQuDQoJICoNCgkgKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ9IGlkIFRoZSA8aT5JRDwvaT4gb2YgdGhlIDxiPlNHTlVJS2l0PC9iPiBjb21wb25lbnQgdG8gY2hlY2suDQoJICovDQoJaXNDb21wb25lbnRMb2FkZWQ6IGZ1bmN0aW9uKGlkKSB7DQoJCXJldHVybiB0aGlzLmNvbXBvbmVudHMuaGFzT3duUHJvcGVydHkoaWQpOw0KCX0sDQoNCgkvKioNCgkgKiBTZXQgdGhlIHN0YXR1cyBvZiByZWFkaW5lc3Mgb2YgPGI+U0dOVUlLaXQ8L2I+Lg0KCSAqDQoJICogQHBhcmFtIHtib29sZWFufSBpc0luaXQgVGhlIHRoZSBzdGF0dXMgb2YgcmVhZGluZXNzIG9mIDxiPlNHTlVJS2l0PC9iPi4NCgkgKi8NCglzZXQgaW5pdChpc0luaXQpIHsNCgkJdGhpcy5pc0luaXQgPSBpc0luaXQ7DQoJCXRoaXMuY2FsbENvdW50cy5pbml0Kys7DQoJCWZvckVhY2godGhpcy5vbkNoYW5nZUxpc3RlbmVyLCAobGlzdGVuZXIpID0+IGxpc3RlbmVyKCJpbml0IiwgdGhpcy5pc0luaXQpKTsNCg0KCQlpZihpc0luaXQpDQoJCQlmb3JFYWNoKHRoaXMub25Jbml0TGlzdGVuZXIsIChsaXN0ZW5lcikgPT4gbGlzdGVuZXIoaXNJbml0KSk7DQoJfSwNCg0KCS8qKg0KCSAqIEdldCB0aGUgc3RhdHVzIG9mIHJlYWRpbmVzcyBvZiA8Yj5TR05VSUtpdDwvYj4uDQoJICoNCgkgKiBAcmV0dXJuIHtib29sZWFufSA8Yj48aT5UUlVFPC9pPjwvYj4gaWYgPGI+U0dOVUlLaXQ8L2I+IGlzIHJlYWR5LCA8Yj48aT5GQUxTRTwvaT48L2I+IG90aGVyd2lzZS4NCgkgKi8NCglnZXQgaW5pdCgpIHsNCgkJcmV0dXJuIHRoaXMuaXNJbml0Ow0KCX0sDQoNCgkvKioNCgkgKiBTZXQgdGhlIHN0YXR1cyBvZiByZWFkaW5lc3Mgb2YgPGI+U0dOVUlLaXQ8L2I+Lg0KCSAqDQoJICogQHBhcmFtIHtib29sZWFufSBpc1JlYWR5IFRoZSB0aGUgc3RhdHVzIG9mIHJlYWRpbmVzcyBvZiA8Yj5TR05VSUtpdDwvYj4uDQoJICovDQoJc2V0IHJlYWR5KGlzUmVhZHkpIHsNCgkJdGhpcy5pc1JlYWR5ID0gaXNSZWFkeTsNCgkJdGhpcy5jYWxsQ291bnRzLnJlYWR5Kys7DQoJCWZvckVhY2godGhpcy5vbkNoYW5nZUxpc3RlbmVyLCAobGlzdGVuZXIpID0+IGxpc3RlbmVyKCJyZWFkeSIsIHRoaXMuaXNSZWFkeSkpOw0KCQkvL3RoaXMub25DaGFuZ2VMaXN0ZW5lci5mb3JFYWNoKChsaXN0ZW5lcikgPT4gbGlzdGVuZXIoInJlYWR5IiwgdGhpcy5pc1JlYWR5KSk7DQoNCgkJaWYoaXNSZWFkeSkNCgkJCWZvckVhY2godGhpcy5vblJlYWR5TGlzdGVuZXIsIChsaXN0ZW5lcikgPT4gbGlzdGVuZXIoaXNSZWFkeSkpOw0KCQkvL3RoaXMub25SZWFkeUxpc3RlbmVyLmZvckVhY2goKGxpc3RlbmVyKSA9PiBsaXN0ZW5lcihpc1JlYWR5KSk7DQoJfSwNCg0KCS8qKg0KCSAqIEdldCB0aGUgc3RhdHVzIG9mIHJlYWRpbmVzcyBvZiA8Yj5TR05VSUtpdDwvYj4uDQoJICoNCgkgKiBAcmV0dXJuIHtib29sZWFufSA8Yj48aT5UUlVFPC9pPjwvYj4gaWYgPGI+U0dOVUlLaXQ8L2I+IGlzIHJlYWR5LCA8Yj48aT5GQUxTRTwvaT48L2I+IG90aGVyd2lzZS4NCgkgKi8NCglnZXQgcmVhZHkoKSB7DQoJCXJldHVybiB0aGlzLmlzUmVhZHk7DQoJfSwNCg0KCS8qKg0KCSAqIEhvbGQgdGhlIDxiPlNHTlVJS2l0PC9iPiBwcmVsb2FkZXIgZXZlbiBhZnRlciAgPGI+U0dOVUlLaXQ8L2I+IGhhcyBmaW5pc2hlZCBsb2FkaW5nIHRoZSBjb21wb25lbnRzLg0KCSAqDQoJICogQHBhcmFtIHtib29sZWFufSBob2xkIFRoZSB0aGUgc3RhdHVzIG9mIHJlYWRpbmVzcyBvZiA8Yj5TR05VSUtpdDwvYj4uDQoJICovDQoJc2V0IGhvbGRQcmVsb2FkZXIoaG9sZCkgew0KCQl0aGlzLmlzUHJlbG9hZGVySGVsZCA9IGhvbGQ7DQoJCXRoaXMuY2FsbENvdW50cy5ob2xkUHJlbG9hZGVyKys7DQoJCWZvckVhY2godGhpcy5vbkNoYW5nZUxpc3RlbmVyLCAobGlzdGVuZXIpID0+IGxpc3RlbmVyKCJob2xkUHJlbG9hZGVyIiwgdGhpcy5pc1ByZWxvYWRlckhlbGQpKTsNCgkJLy90aGlzLm9uQ2hhbmdlTGlzdGVuZXIuZm9yRWFjaCgobGlzdGVuZXIpID0+IGxpc3RlbmVyKCJob2xkUHJlbG9hZGVyIiwgdGhpcy5pc1ByZWxvYWRlckhlbGQpKTsNCgl9LA0KDQoJLyoqDQoJICogR2V0IHRoZSBzdGF0dXMgb2YgcmVhZGluZXNzIG9mIDxiPlNHTlVJS2l0PC9iPi4NCgkgKg0KCSAqIEByZXR1cm4ge2Jvb2xlYW59IDxiPjxpPlRSVUU8L2k+PC9iPiBpZiA8Yj5TR05VSUtpdDwvYj4gaXMgcmVhZHksIDxiPjxpPkZBTFNFPC9pPjwvYj4gb3RoZXJ3aXNlLg0KCSAqLw0KCWdldCBob2xkUHJlbG9hZGVyKCkgew0KCQlyZXR1cm4gdGhpcy5pc1ByZWxvYWRlckhlbGQ7DQoJfSwNCg0KCS8qKg0KCSAqIFNldCB0aGUgaGFuZGxlciBmb3IgPGI+U0dOVUlLaXQ8L2I+IDxiPjxpPk9uQ2hhbmdlPC9pPjwvYj4gZXZlbnQsIHdoaWNoIHdpbGwgYmUgdHJpZ2dlcmVkIHdoZW4gYSBjb21wb25lbnQgaXMgbG9hZGVkL3JlbW92ZWQgb3IgdGhlIHN0YXR1cyBvZiByZWFkaW5lc3MgaXMgY2hhbmdlZC4NCgkgKg0KCSAqIEBwYXJhbSB7U0dOVUlLaXRDaGFuZ2VDYWxsYmFja31saXN0ZW5lcg0KCSAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn1baWQ9dW5kZWZpbmVkXQ0KCSAqLw0KCXNldE9uQ2hhbmdlTGlzdGVuZXI6IGZ1bmN0aW9uKGxpc3RlbmVyLCBpZCkgew0KCQlpZih0eXBlb2YgaWQgIT09ICdzdHJpbmcnIHx8ICQuaXNOdW1lcmljKGlkKSkNCgkJCXRoaXMub25DaGFuZ2VMaXN0ZW5lcltpZF0gPSBsaXN0ZW5lcjsNCgkJZWxzZQ0KCQkJcHVzaCh0aGlzLm9uQ2hhbmdlTGlzdGVuZXIsIGxpc3RlbmVyKTsNCgl9LA0KDQoJLyoqDQoJICogU2V0IHRoZSBoYW5kbGVyIGZvciA8Yj5TR05VSUtpdDwvYj4gPGI+PGk+T25SZWFkeTwvaT48L2I+IGV2ZW50LCB3aGljaCB3aWxsIGJlIHRyaWdnZXJlZCB3aGVuIHRoZSA8Yj5TR05VSUtpdDwvYj4gaXMgcmVhZHkuDQoJICoNCgkgKiBAcGFyYW0ge1NHTlVJS2l0UmVhZHlDYWxsYmFja31saXN0ZW5lcg0KCSAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn1baWQ9dW5kZWZpbmVkXQ0KCSAqLw0KCXNldE9uSW5pdExpc3RlbmVyOiBmdW5jdGlvbihsaXN0ZW5lciwgaWQpIHsNCgkJaWYodHlwZW9mIGlkICE9PSAnc3RyaW5nJyB8fCAkLmlzTnVtZXJpYyhpZCkpDQoJCQl0aGlzLm9uSW5pdExpc3RlbmVyW2lkXSA9IGxpc3RlbmVyOw0KCQllbHNlDQoJCQlwdXNoKHRoaXMub25Jbml0TGlzdGVuZXIsIGxpc3RlbmVyKTsNCg0KCQlpZih0aGlzLmluaXQpDQoJCQlmb3JFYWNoKHRoaXMub25Jbml0TGlzdGVuZXIsIChsaXN0ZW5lcikgPT4gbGlzdGVuZXIodGhpcy5pc0luaXQpKTsNCgl9LA0KDQoJLyoqDQoJICogU2V0IHRoZSBoYW5kbGVyIGZvciA8Yj5TR05VSUtpdDwvYj4gPGI+PGk+T25SZWFkeTwvaT48L2I+IGV2ZW50LCB3aGljaCB3aWxsIGJlIHRyaWdnZXJlZCB3aGVuIHRoZSA8Yj5TR05VSUtpdDwvYj4gaXMgcmVhZHkuDQoJICoNCgkgKiBAcGFyYW0ge1NHTlVJS2l0UmVhZHlDYWxsYmFja31saXN0ZW5lcg0KCSAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn1baWQ9dW5kZWZpbmVkXQ0KCSAqLw0KCXNldE9uUmVhZHlMaXN0ZW5lcjogZnVuY3Rpb24obGlzdGVuZXIsIGlkKSB7DQoJCWlmKHR5cGVvZiBpZCAhPT0gJ3N0cmluZycgfHwgJC5pc051bWVyaWMoaWQpKQ0KCQkJdGhpcy5vblJlYWR5TGlzdGVuZXJbaWRdID0gbGlzdGVuZXI7DQoJCWVsc2UNCgkJCXB1c2godGhpcy5vblJlYWR5TGlzdGVuZXIsIGxpc3RlbmVyKTsNCg0KCQlpZih0aGlzLnJlYWR5KQ0KCQkJZm9yRWFjaCh0aGlzLm9uUmVhZHlMaXN0ZW5lciwgKGxpc3RlbmVyKSA9PiBsaXN0ZW5lcih0aGlzLmlzUmVhZHkpKTsNCgkJLy90aGlzLm9uUmVhZHlMaXN0ZW5lci5mb3JFYWNoKChsaXN0ZW5lcikgPT4gbGlzdGVuZXIodGhpcy5yZWFkeSkpOw0KCX0sDQp9Ow0Kd2luZG93LlNHTlVJS2l0ID0gU0dOVUlLaXQ7DQoNCmlmKHR5cGVvZiBqUXVlcnkgPT09ICd1bmRlZmluZWQnKSB7DQoJLyohIGpRdWVyeSB2My42LjAgfCAoYykgT3BlbkpTIEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycyB8IGpxdWVyeS5vcmcvbGljZW5zZSAqLw0KCSFmdW5jdGlvbihlLCB0KSB7DQoJCSJ1c2Ugc3RyaWN0IjsNCgkJIm9iamVjdCIgPT0gdHlwZW9mIG1vZHVsZSAmJiAib2JqZWN0IiA9PSB0eXBlb2YgbW9kdWxlLmV4cG9ydHMgPyBtb2R1bGUuZXhwb3J0cyA9IGUuZG9jdW1lbnQgPyB0KGUsICEwKSA6IGZ1bmN0aW9uKGUpIHsNCgkJCWlmKCFlLmRvY3VtZW50KSB0aHJvdyBuZXcgRXJyb3IoImpRdWVyeSByZXF1aXJlcyBhIHdpbmRvdyB3aXRoIGEgZG9jdW1lbnQiKTsNCgkJCXJldHVybiB0KGUpDQoJCX0gOiB0KGUpDQoJfSgidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ID8gd2luZG93IDogdGhpcywgZnVuY3Rpb24oQywgZSkgew0KCQkidXNlIHN0cmljdCI7DQoJCXZhciB0ID0gW10sDQoJCSAgICByID0gT2JqZWN0LmdldFByb3RvdHlwZU9mLA0KCQkgICAgcyA9IHQuc2xpY2UsDQoJCSAgICBnID0gdC5mbGF0ID8gZnVuY3Rpb24oZSkge3JldHVybiB0LmZsYXQuY2FsbChlKX0gOiBmdW5jdGlvbihlKSB7cmV0dXJuIHQuY29uY2F0LmFwcGx5KFtdLCBlKX0sDQoJCSAgICB1ID0gdC5wdXNoLA0KCQkgICAgaSA9IHQuaW5kZXhPZiwNCgkJICAgIG4gPSB7fSwNCgkJICAgIG8gPSBuLnRvU3RyaW5nLA0KCQkgICAgdiA9IG4uaGFzT3duUHJvcGVydHksDQoJCSAgICBhID0gdi50b1N0cmluZywNCgkJICAgIGwgPSBhLmNhbGwoT2JqZWN0KSwNCgkJICAgIHkgPSB7fSwNCgkJICAgIG0gPSBmdW5jdGlvbihlKSB7cmV0dXJuICJmdW5jdGlvbiIgPT0gdHlwZW9mIGUgJiYgIm51bWJlciIgIT0gdHlwZW9mIGUubm9kZVR5cGUgJiYgImZ1bmN0aW9uIiAhPSB0eXBlb2YgZS5pdGVtfSwNCgkJICAgIHggPSBmdW5jdGlvbihlKSB7cmV0dXJuIG51bGwgIT0gZSAmJiBlID09PSBlLndpbmRvd30sDQoJCSAgICBFID0gQy5kb2N1bWVudCwNCgkJICAgIGMgPSB7dHlwZTogITAsIHNyYzogITAsIG5vbmNlOiAhMCwgbm9Nb2R1bGU6ICEwfTsNCg0KCQlmdW5jdGlvbiBiKGUsIHQsIG4pIHsNCgkJCXZhciByLCBpLCBvID0gKG4gPSBuIHx8IEUpLmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOw0KCQkJaWYoby50ZXh0ID0gZSwgdCkgZm9yKHIgaW4gYykgKGkgPSB0W3JdIHx8IHQuZ2V0QXR0cmlidXRlICYmIHQuZ2V0QXR0cmlidXRlKHIpKSAmJiBvLnNldEF0dHJpYnV0ZShyLCBpKTsNCgkJCW4uaGVhZC5hcHBlbmRDaGlsZChvKS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG8pDQoJCX0NCg0KCQlmdW5jdGlvbiB3KGUpIHtyZXR1cm4gbnVsbCA9PSBlID8gZSArICIiIDogIm9iamVjdCIgPT0gdHlwZW9mIGUgfHwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgZSA/IG5bby5jYWxsKGUpXSB8fCAib2JqZWN0IiA6IHR5cGVvZiBlfQ0KDQoJCXZhciBmID0gIjMuNi4wIiwgUyA9IGZ1bmN0aW9uKGUsIHQpIHtyZXR1cm4gbmV3IFMuZm4uaW5pdChlLCB0KX07DQoNCgkJZnVuY3Rpb24gcChlKSB7DQoJCQl2YXIgdCA9ICEhZSAmJiAibGVuZ3RoIiBpbiBlICYmIGUubGVuZ3RoLCBuID0gdyhlKTsNCgkJCXJldHVybiAhbShlKSAmJiAheChlKSAmJiAoImFycmF5IiA9PT0gbiB8fCAwID09PSB0IHx8ICJudW1iZXIiID09IHR5cGVvZiB0ICYmIDAgPCB0ICYmIHQgLSAxIGluIGUpDQoJCX0NCg0KCQlTLmZuID0gUy5wcm90b3R5cGUgPSB7DQoJCQlqcXVlcnk6IGYsDQoJCQljb25zdHJ1Y3RvcjogUywNCgkJCWxlbmd0aDogMCwNCgkJCXRvQXJyYXk6IGZ1bmN0aW9uKCkge3JldHVybiBzLmNhbGwodGhpcyl9LA0KCQkJZ2V0OiBmdW5jdGlvbihlKSB7cmV0dXJuIG51bGwgPT0gZSA/IHMuY2FsbCh0aGlzKSA6IGUgPCAwID8gdGhpc1tlICsgdGhpcy5sZW5ndGhdIDogdGhpc1tlXX0sDQoJCQlwdXNoU3RhY2s6IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCA9IFMubWVyZ2UodGhpcy5jb25zdHJ1Y3RvcigpLCBlKTsNCgkJCQlyZXR1cm4gdC5wcmV2T2JqZWN0ID0gdGhpcywgdA0KCQkJfSwNCgkJCWVhY2g6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gUy5lYWNoKHRoaXMsIGUpfSwNCgkJCW1hcDogZnVuY3Rpb24obikge3JldHVybiB0aGlzLnB1c2hTdGFjayhTLm1hcCh0aGlzLCBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIG4uY2FsbChlLCB0LCBlKX0pKX0sDQoJCQlzbGljZTogZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMucHVzaFN0YWNrKHMuYXBwbHkodGhpcywgYXJndW1lbnRzKSl9LA0KCQkJZmlyc3Q6IGZ1bmN0aW9uKCkge3JldHVybiB0aGlzLmVxKDApfSwNCgkJCWxhc3Q6IGZ1bmN0aW9uKCkge3JldHVybiB0aGlzLmVxKC0xKX0sDQoJCQlldmVuOiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5wdXNoU3RhY2soUy5ncmVwKHRoaXMsIGZ1bmN0aW9uKGUsIHQpIHtyZXR1cm4gKHQgKyAxKSAlIDJ9KSl9LA0KCQkJb2RkOiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5wdXNoU3RhY2soUy5ncmVwKHRoaXMsIGZ1bmN0aW9uKGUsIHQpIHtyZXR1cm4gdCAlIDJ9KSl9LA0KCQkJZXE6IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCA9IHRoaXMubGVuZ3RoLCBuID0gK2UgKyAoZSA8IDAgPyB0IDogMCk7DQoJCQkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKDAgPD0gbiAmJiBuIDwgdCA/IFt0aGlzW25dXSA6IFtdKQ0KCQkJfSwNCgkJCWVuZDogZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMucHJldk9iamVjdCB8fCB0aGlzLmNvbnN0cnVjdG9yKCl9LA0KCQkJcHVzaDogdSwNCgkJCXNvcnQ6IHQuc29ydCwNCgkJCXNwbGljZTogdC5zcGxpY2UNCgkJfSwgUy5leHRlbmQgPSBTLmZuLmV4dGVuZCA9IGZ1bmN0aW9uKCkgew0KCQkJdmFyIGUsIHQsIG4sIHIsIGksIG8sIGEgPSBhcmd1bWVudHNbMF0gfHwge30sIHMgPSAxLCB1ID0gYXJndW1lbnRzLmxlbmd0aCwgbCA9ICExOw0KCQkJZm9yKCJib29sZWFuIiA9PSB0eXBlb2YgYSAmJiAobCA9IGEsIGEgPSBhcmd1bWVudHNbc10gfHwge30sIHMrKyksICJvYmplY3QiID09IHR5cGVvZiBhIHx8IG0oYSkgfHwgKGEgPSB7fSksIHMgPT09IHUgJiYgKGEgPSB0aGlzLCBzLS0pOyBzIDwgdTsgcysrKSBpZihudWxsICE9IChlID0gYXJndW1lbnRzW3NdKSkgZm9yKHQgaW4gZSkgciA9IGVbdF0sICJfX3Byb3RvX18iICE9PSB0ICYmIGEgIT09IHIgJiYgKGwgJiYgciAmJiAoUy5pc1BsYWluT2JqZWN0KHIpIHx8IChpID0gQXJyYXkuaXNBcnJheShyKSkpID8gKG4gPSBhW3RdLCBvID0gaSAmJiAhQXJyYXkuaXNBcnJheShuKSA/IFtdIDogaSB8fCBTLmlzUGxhaW5PYmplY3QobikgPyBuIDoge30sIGkgPSAhMSwgYVt0XSA9IFMuZXh0ZW5kKGwsIG8sIHIpKSA6IHZvaWQgMCAhPT0gciAmJiAoYVt0XSA9IHIpKTsNCgkJCXJldHVybiBhDQoJCX0sIFMuZXh0ZW5kKHsNCgkJCWV4cGFuZG86ICJqUXVlcnkiICsgKGYgKyBNYXRoLnJhbmRvbSgpKS5yZXBsYWNlKC9cRC9nLCAiIiksIGlzUmVhZHk6ICEwLCBlcnJvcjogZnVuY3Rpb24oZSkge3Rocm93IG5ldyBFcnJvcihlKX0sIG5vb3A6IGZ1bmN0aW9uKCkge30sIGlzUGxhaW5PYmplY3Q6IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCwgbjsNCgkJCQlyZXR1cm4gISghZSB8fCAiW29iamVjdCBPYmplY3RdIiAhPT0gby5jYWxsKGUpKSAmJiAoISh0ID0gcihlKSkgfHwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgKG4gPSB2LmNhbGwodCwgImNvbnN0cnVjdG9yIikgJiYgdC5jb25zdHJ1Y3RvcikgJiYgYS5jYWxsKG4pID09PSBsKQ0KCQkJfSwgaXNFbXB0eU9iamVjdDogZnVuY3Rpb24oZSkgew0KCQkJCXZhciB0Ow0KCQkJCWZvcih0IGluIGUpIHJldHVybiAhMTsNCgkJCQlyZXR1cm4gITANCgkJCX0sIGdsb2JhbEV2YWw6IGZ1bmN0aW9uKGUsIHQsIG4pIHtiKGUsIHtub25jZTogdCAmJiB0Lm5vbmNlfSwgbil9LCBlYWNoOiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4sIHIgPSAwOw0KCQkJCWlmKHAoZSkpIHtmb3IobiA9IGUubGVuZ3RoOyByIDwgbjsgcisrKSBpZighMSA9PT0gdC5jYWxsKGVbcl0sIHIsIGVbcl0pKSBicmVha30gZWxzZSBmb3IociBpbiBlKSBpZighMSA9PT0gdC5jYWxsKGVbcl0sIHIsIGVbcl0pKSBicmVhazsNCgkJCQlyZXR1cm4gZQ0KCQkJfSwgbWFrZUFycmF5OiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4gPSB0IHx8IFtdOw0KCQkJCXJldHVybiBudWxsICE9IGUgJiYgKHAoT2JqZWN0KGUpKSA/IFMubWVyZ2UobiwgInN0cmluZyIgPT0gdHlwZW9mIGUgPyBbZV0gOiBlKSA6IHUuY2FsbChuLCBlKSksIG4NCgkJCX0sIGluQXJyYXk6IGZ1bmN0aW9uKGUsIHQsIG4pIHtyZXR1cm4gbnVsbCA9PSB0ID8gLTEgOiBpLmNhbGwodCwgZSwgbil9LCBtZXJnZTogZnVuY3Rpb24oZSwgdCkgew0KCQkJCWZvcih2YXIgbiA9ICt0Lmxlbmd0aCwgciA9IDAsIGkgPSBlLmxlbmd0aDsgciA8IG47IHIrKykgZVtpKytdID0gdFtyXTsNCgkJCQlyZXR1cm4gZS5sZW5ndGggPSBpLCBlDQoJCQl9LCBncmVwOiBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJZm9yKHZhciByID0gW10sIGkgPSAwLCBvID0gZS5sZW5ndGgsIGEgPSAhbjsgaSA8IG87IGkrKykgIXQoZVtpXSwgaSkgIT09IGEgJiYgci5wdXNoKGVbaV0pOw0KCQkJCXJldHVybiByDQoJCQl9LCBtYXA6IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQl2YXIgciwgaSwgbyA9IDAsIGEgPSBbXTsNCgkJCQlpZihwKGUpKSBmb3IociA9IGUubGVuZ3RoOyBvIDwgcjsgbysrKSBudWxsICE9IChpID0gdChlW29dLCBvLCBuKSkgJiYgYS5wdXNoKGkpOyBlbHNlIGZvcihvIGluIGUpIG51bGwgIT0gKGkgPSB0KGVbb10sIG8sIG4pKSAmJiBhLnB1c2goaSk7DQoJCQkJcmV0dXJuIGcoYSkNCgkJCX0sIGd1aWQ6IDEsIHN1cHBvcnQ6IHkNCgkJfSksICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiAoUy5mbltTeW1ib2wuaXRlcmF0b3JdID0gdFtTeW1ib2wuaXRlcmF0b3JdKSwgUy5lYWNoKCJCb29sZWFuIE51bWJlciBTdHJpbmcgRnVuY3Rpb24gQXJyYXkgRGF0ZSBSZWdFeHAgT2JqZWN0IEVycm9yIFN5bWJvbCIuc3BsaXQoIiAiKSwgZnVuY3Rpb24oZSwgdCkge25bIltvYmplY3QgIiArIHQgKyAiXSJdID0gdC50b0xvd2VyQ2FzZSgpfSk7DQoJCXZhciBkID0gZnVuY3Rpb24obikgew0KCQkJdmFyIGUsDQoJCQkgICAgZCwNCgkJCSAgICBiLA0KCQkJICAgIG8sDQoJCQkgICAgaSwNCgkJCSAgICBoLA0KCQkJICAgIGYsDQoJCQkgICAgZywNCgkJCSAgICB3LA0KCQkJICAgIHUsDQoJCQkgICAgbCwNCgkJCSAgICBULA0KCQkJICAgIEMsDQoJCQkgICAgYSwNCgkJCSAgICBFLA0KCQkJICAgIHYsDQoJCQkgICAgcywNCgkJCSAgICBjLA0KCQkJICAgIHksDQoJCQkgICAgUyAgPSAic2l6emxlIiArIDEgKiBuZXcgRGF0ZSwNCgkJCSAgICBwICA9IG4uZG9jdW1lbnQsDQoJCQkgICAgayAgPSAwLA0KCQkJICAgIHIgID0gMCwNCgkJCSAgICBtICA9IHVlKCksDQoJCQkgICAgeCAgPSB1ZSgpLA0KCQkJICAgIEEgID0gdWUoKSwNCgkJCSAgICBOICA9IHVlKCksDQoJCQkgICAgaiAgPSBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIGUgPT09IHQgJiYgKGwgPSAhMCksIDB9LA0KCQkJICAgIEQgID0ge30uaGFzT3duUHJvcGVydHksDQoJCQkgICAgdCAgPSBbXSwNCgkJCSAgICBxICA9IHQucG9wLA0KCQkJICAgIEwgID0gdC5wdXNoLA0KCQkJICAgIEggID0gdC5wdXNoLA0KCQkJICAgIE8gID0gdC5zbGljZSwNCgkJCSAgICBQICA9IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkgICAgZm9yKHZhciBuID0gMCwgciA9IGUubGVuZ3RoOyBuIDwgcjsgbisrKSBpZihlW25dID09PSB0KSByZXR1cm4gbjsNCgkJCQkgICAgcmV0dXJuIC0xDQoJCQkgICAgfSwNCgkJCSAgICBSICA9ICJjaGVja2VkfHNlbGVjdGVkfGFzeW5jfGF1dG9mb2N1c3xhdXRvcGxheXxjb250cm9sc3xkZWZlcnxkaXNhYmxlZHxoaWRkZW58aXNtYXB8bG9vcHxtdWx0aXBsZXxvcGVufHJlYWRvbmx5fHJlcXVpcmVkfHNjb3BlZCIsDQoJCQkgICAgTSAgPSAiW1xceDIwXFx0XFxyXFxuXFxmXSIsDQoJCQkgICAgSSAgPSAiKD86XFxcXFtcXGRhLWZBLUZdezEsNn0iICsgTSArICI/fFxcXFxbXlxcclxcblxcZl18W1xcdy1dfFteXDAtXFx4N2ZdKSsiLA0KCQkJICAgIFcgID0gIlxcWyIgKyBNICsgIiooIiArIEkgKyAiKSg/OiIgKyBNICsgIiooWypeJHwhfl0/PSkiICsgTSArICIqKD86JygoPzpcXFxcLnxbXlxcXFwnXSkqKSd8XCIoKD86XFxcXC58W15cXFxcXCJdKSopXCJ8KCIgKyBJICsgIikpfCkiICsgTSArICIqXFxdIiwNCgkJCSAgICBGICA9ICI6KCIgKyBJICsgIikoPzpcXCgoKCcoKD86XFxcXC58W15cXFxcJ10pKiknfFwiKCg/OlxcXFwufFteXFxcXFwiXSkqKVwiKXwoKD86XFxcXC58W15cXFxcKClbXFxdXXwiICsgVyArICIpKil8LiopXFwpfCkiLA0KCQkJICAgIEIgID0gbmV3IFJlZ0V4cChNICsgIisiLCAiZyIpLA0KCQkJICAgICQgID0gbmV3IFJlZ0V4cCgiXiIgKyBNICsgIit8KCg/Ol58W15cXFxcXSkoPzpcXFxcLikqKSIgKyBNICsgIiskIiwgImciKSwNCgkJCSAgICBfICA9IG5ldyBSZWdFeHAoIl4iICsgTSArICIqLCIgKyBNICsgIioiKSwNCgkJCSAgICB6ICA9IG5ldyBSZWdFeHAoIl4iICsgTSArICIqKFs+K35dfCIgKyBNICsgIikiICsgTSArICIqIiksDQoJCQkgICAgVSAgPSBuZXcgUmVnRXhwKE0gKyAifD4iKSwNCgkJCSAgICBYICA9IG5ldyBSZWdFeHAoRiksDQoJCQkgICAgViAgPSBuZXcgUmVnRXhwKCJeIiArIEkgKyAiJCIpLA0KCQkJICAgIEcgID0gew0KCQkJCSAgICBJRDogbmV3IFJlZ0V4cCgiXiMoIiArIEkgKyAiKSIpLA0KCQkJCSAgICBDTEFTUzogbmV3IFJlZ0V4cCgiXlxcLigiICsgSSArICIpIiksDQoJCQkJICAgIFRBRzogbmV3IFJlZ0V4cCgiXigiICsgSSArICJ8WypdKSIpLA0KCQkJCSAgICBBVFRSOiBuZXcgUmVnRXhwKCJeIiArIFcpLA0KCQkJCSAgICBQU0VVRE86IG5ldyBSZWdFeHAoIl4iICsgRiksDQoJCQkJICAgIENISUxEOiBuZXcgUmVnRXhwKCJeOihvbmx5fGZpcnN0fGxhc3R8bnRofG50aC1sYXN0KS0oY2hpbGR8b2YtdHlwZSkoPzpcXCgiICsgTSArICIqKGV2ZW58b2RkfCgoWystXXwpKFxcZCopbnwpIiArIE0gKyAiKig/OihbKy1dfCkiICsgTSArICIqKFxcZCspfCkpIiArIE0gKyAiKlxcKXwpIiwgImkiKSwNCgkJCQkgICAgYm9vbDogbmV3IFJlZ0V4cCgiXig/OiIgKyBSICsgIikkIiwgImkiKSwNCgkJCQkgICAgbmVlZHNDb250ZXh0OiBuZXcgUmVnRXhwKCJeIiArIE0gKyAiKls+K35dfDooZXZlbnxvZGR8ZXF8Z3R8bHR8bnRofGZpcnN0fGxhc3QpKD86XFwoIiArIE0gKyAiKigoPzotXFxkKT9cXGQqKSIgKyBNICsgIipcXCl8KSg/PVteLV18JCkiLCAiaSIpDQoJCQkgICAgfSwNCgkJCSAgICBZICA9IC9IVE1MJC9pLA0KCQkJICAgIFEgID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uKSQvaSwNCgkJCSAgICBKICA9IC9eaFxkJC9pLA0KCQkJICAgIEsgID0gL15bXntdK1x7XHMqXFtuYXRpdmUgXHcvLA0KCQkJICAgIFogID0gL14oPzojKFtcdy1dKyl8KFx3Kyl8XC4oW1x3LV0rKSkkLywNCgkJCSAgICBlZSA9IC9bK35dLywNCgkJCSAgICB0ZSA9IG5ldyBSZWdFeHAoIlxcXFxbXFxkYS1mQS1GXXsxLDZ9IiArIE0gKyAiP3xcXFxcKFteXFxyXFxuXFxmXSkiLCAiZyIpLA0KCQkJICAgIG5lID0gZnVuY3Rpb24oZSwgdCkgew0KCQkJCSAgICB2YXIgbiA9ICIweCIgKyBlLnNsaWNlKDEpIC0gNjU1MzY7DQoJCQkJICAgIHJldHVybiB0IHx8IChuIDwgMCA/IFN0cmluZy5mcm9tQ2hhckNvZGUobiArIDY1NTM2KSA6IFN0cmluZy5mcm9tQ2hhckNvZGUobiA+PiAxMCB8IDU1Mjk2LCAxMDIzICYgbiB8IDU2MzIwKSkNCgkJCSAgICB9LA0KCQkJICAgIHJlID0gLyhbXDAtXHgxZlx4N2ZdfF4tP1xkKXxeLSR8W15cMC1ceDFmXHg3Zi1cdUZGRkZcdy1dL2csDQoJCQkgICAgaWUgPSBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIHQgPyAiXDAiID09PSBlID8gIlx1ZmZmZCIgOiBlLnNsaWNlKDAsIC0xKSArICJcXCIgKyBlLmNoYXJDb2RlQXQoZS5sZW5ndGggLSAxKS50b1N0cmluZygxNikgKyAiICIgOiAiXFwiICsgZX0sDQoJCQkgICAgb2UgPSBmdW5jdGlvbigpIHtUKCl9LA0KCQkJICAgIGFlID0gYmUoZnVuY3Rpb24oZSkge3JldHVybiAhMCA9PT0gZS5kaXNhYmxlZCAmJiAiZmllbGRzZXQiID09PSBlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCl9LCB7ZGlyOiAicGFyZW50Tm9kZSIsIG5leHQ6ICJsZWdlbmQifSk7DQoJCQl0cnkge0guYXBwbHkodCA9IE8uY2FsbChwLmNoaWxkTm9kZXMpLCBwLmNoaWxkTm9kZXMpLCB0W3AuY2hpbGROb2Rlcy5sZW5ndGhdLm5vZGVUeXBlfSBjYXRjaChlKSB7DQoJCQkJSCA9IHsNCgkJCQkJYXBwbHk6IHQubGVuZ3RoID8gZnVuY3Rpb24oZSwgdCkge0wuYXBwbHkoZSwgTy5jYWxsKHQpKX0gOiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJCQl2YXIgbiA9IGUubGVuZ3RoLCByID0gMDsNCgkJCQkJCXdoaWxlKGVbbisrXSA9IHRbcisrXSkgOw0KCQkJCQkJZS5sZW5ndGggPSBuIC0gMQ0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBzZSh0LCBlLCBuLCByKSB7DQoJCQkJdmFyIGksIG8sIGEsIHMsIHUsIGwsIGMsIGYgPSBlICYmIGUub3duZXJEb2N1bWVudCwgcCA9IGUgPyBlLm5vZGVUeXBlIDogOTsNCgkJCQlpZihuID0gbiB8fCBbXSwgInN0cmluZyIgIT0gdHlwZW9mIHQgfHwgIXQgfHwgMSAhPT0gcCAmJiA5ICE9PSBwICYmIDExICE9PSBwKSByZXR1cm4gbjsNCgkJCQlpZighciAmJiAoVChlKSwgZSA9IGUgfHwgQywgRSkpIHsNCgkJCQkJaWYoMTEgIT09IHAgJiYgKHUgPSBaLmV4ZWModCkpKSBpZihpID0gdVsxXSkgew0KCQkJCQkJaWYoOSA9PT0gcCkgew0KCQkJCQkJCWlmKCEoYSA9IGUuZ2V0RWxlbWVudEJ5SWQoaSkpKSByZXR1cm4gbjsNCgkJCQkJCQlpZihhLmlkID09PSBpKSByZXR1cm4gbi5wdXNoKGEpLCBuDQoJCQkJCQl9IGVsc2UgaWYoZiAmJiAoYSA9IGYuZ2V0RWxlbWVudEJ5SWQoaSkpICYmIHkoZSwgYSkgJiYgYS5pZCA9PT0gaSkgcmV0dXJuIG4ucHVzaChhKSwgbg0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJaWYodVsyXSkgcmV0dXJuIEguYXBwbHkobiwgZS5nZXRFbGVtZW50c0J5VGFnTmFtZSh0KSksIG47DQoJCQkJCQlpZigoaSA9IHVbM10pICYmIGQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSAmJiBlLmdldEVsZW1lbnRzQnlDbGFzc05hbWUpIHJldHVybiBILmFwcGx5KG4sIGUuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShpKSksIG4NCgkJCQkJfQ0KCQkJCQlpZihkLnFzYSAmJiAhTlt0ICsgIiAiXSAmJiAoIXYgfHwgIXYudGVzdCh0KSkgJiYgKDEgIT09IHAgfHwgIm9iamVjdCIgIT09IGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSkpIHsNCgkJCQkJCWlmKGMgPSB0LCBmID0gZSwgMSA9PT0gcCAmJiAoVS50ZXN0KHQpIHx8IHoudGVzdCh0KSkpIHsNCgkJCQkJCQkoZiA9IGVlLnRlc3QodCkgJiYgeWUoZS5wYXJlbnROb2RlKSB8fCBlKSA9PT0gZSAmJiBkLnNjb3BlIHx8ICgocyA9IGUuZ2V0QXR0cmlidXRlKCJpZCIpKSA/IHMgPSBzLnJlcGxhY2UocmUsIGllKSA6IGUuc2V0QXR0cmlidXRlKCJpZCIsIHMgPSBTKSksIG8gPSAobCA9IGgodCkpLmxlbmd0aDsNCgkJCQkJCQl3aGlsZShvLS0pIGxbb10gPSAocyA/ICIjIiArIHMgOiAiOnNjb3BlIikgKyAiICIgKyB4ZShsW29dKTsNCgkJCQkJCQljID0gbC5qb2luKCIsIikNCgkJCQkJCX0NCgkJCQkJCXRyeSB7cmV0dXJuIEguYXBwbHkobiwgZi5xdWVyeVNlbGVjdG9yQWxsKGMpKSwgbn0gY2F0Y2goZSkge04odCwgITApfSBmaW5hbGx5IHtzID09PSBTICYmIGUucmVtb3ZlQXR0cmlidXRlKCJpZCIpfQ0KCQkJCQl9DQoJCQkJfQ0KCQkJCXJldHVybiBnKHQucmVwbGFjZSgkLCAiJDEiKSwgZSwgbiwgcikNCgkJCX0NCg0KCQkJZnVuY3Rpb24gdWUoKSB7DQoJCQkJdmFyIHIgPSBbXTsNCgkJCQlyZXR1cm4gZnVuY3Rpb24gZSh0LCBuKSB7cmV0dXJuIHIucHVzaCh0ICsgIiAiKSA+IGIuY2FjaGVMZW5ndGggJiYgZGVsZXRlIGVbci5zaGlmdCgpXSwgZVt0ICsgIiAiXSA9IG59DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGxlKGUpIHtyZXR1cm4gZVtTXSA9ICEwLCBlfQ0KDQoJCQlmdW5jdGlvbiBjZShlKSB7DQoJCQkJdmFyIHQgPSBDLmNyZWF0ZUVsZW1lbnQoImZpZWxkc2V0Iik7DQoJCQkJdHJ5IHtyZXR1cm4gISFlKHQpfSBjYXRjaChlKSB7cmV0dXJuICExfSBmaW5hbGx5IHt0LnBhcmVudE5vZGUgJiYgdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHQpLCB0ID0gbnVsbH0NCgkJCX0NCg0KCQkJZnVuY3Rpb24gZmUoZSwgdCkgew0KCQkJCXZhciBuID0gZS5zcGxpdCgifCIpLCByID0gbi5sZW5ndGg7DQoJCQkJd2hpbGUoci0tKSBiLmF0dHJIYW5kbGVbbltyXV0gPSB0DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHBlKGUsIHQpIHsNCgkJCQl2YXIgbiA9IHQgJiYgZSwgciA9IG4gJiYgMSA9PT0gZS5ub2RlVHlwZSAmJiAxID09PSB0Lm5vZGVUeXBlICYmIGUuc291cmNlSW5kZXggLSB0LnNvdXJjZUluZGV4Ow0KCQkJCWlmKHIpIHJldHVybiByOw0KCQkJCWlmKG4pIHdoaWxlKG4gPSBuLm5leHRTaWJsaW5nKSBpZihuID09PSB0KSByZXR1cm4gLTE7DQoJCQkJcmV0dXJuIGUgPyAxIDogLTENCgkJCX0NCg0KCQkJZnVuY3Rpb24gZGUodCkge3JldHVybiBmdW5jdGlvbihlKSB7cmV0dXJuICJpbnB1dCIgPT09IGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAmJiBlLnR5cGUgPT09IHR9fQ0KDQoJCQlmdW5jdGlvbiBoZShuKSB7DQoJCQkJcmV0dXJuIGZ1bmN0aW9uKGUpIHsNCgkJCQkJdmFyIHQgPSBlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7DQoJCQkJCXJldHVybiAoImlucHV0IiA9PT0gdCB8fCAiYnV0dG9uIiA9PT0gdCkgJiYgZS50eXBlID09PSBuDQoJCQkJfQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBnZSh0KSB7cmV0dXJuIGZ1bmN0aW9uKGUpIHtyZXR1cm4gImZvcm0iIGluIGUgPyBlLnBhcmVudE5vZGUgJiYgITEgPT09IGUuZGlzYWJsZWQgPyAibGFiZWwiIGluIGUgPyAibGFiZWwiIGluIGUucGFyZW50Tm9kZSA/IGUucGFyZW50Tm9kZS5kaXNhYmxlZCA9PT0gdCA6IGUuZGlzYWJsZWQgPT09IHQgOiBlLmlzRGlzYWJsZWQgPT09IHQgfHwgZS5pc0Rpc2FibGVkICE9PSAhdCAmJiBhZShlKSA9PT0gdCA6IGUuZGlzYWJsZWQgPT09IHQgOiAibGFiZWwiIGluIGUgJiYgZS5kaXNhYmxlZCA9PT0gdH19DQoNCgkJCWZ1bmN0aW9uIHZlKGEpIHsNCgkJCQlyZXR1cm4gbGUoZnVuY3Rpb24obykgew0KCQkJCQlyZXR1cm4gbyA9ICtvLCBsZShmdW5jdGlvbihlLCB0KSB7DQoJCQkJCQl2YXIgbiwgciA9IGEoW10sIGUubGVuZ3RoLCBvKSwgaSA9IHIubGVuZ3RoOw0KCQkJCQkJd2hpbGUoaS0tKSBlW24gPSByW2ldXSAmJiAoZVtuXSA9ICEodFtuXSA9IGVbbl0pKQ0KCQkJCQl9KQ0KCQkJCX0pDQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHllKGUpIHtyZXR1cm4gZSAmJiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZS5nZXRFbGVtZW50c0J5VGFnTmFtZSAmJiBlfQ0KDQoJCQlmb3IoZSBpbiBkID0gc2Uuc3VwcG9ydCA9IHt9LCBpID0gc2UuaXNYTUwgPSBmdW5jdGlvbihlKSB7DQoJCQkJdmFyIHQgPSBlICYmIGUubmFtZXNwYWNlVVJJLCBuID0gZSAmJiAoZS5vd25lckRvY3VtZW50IHx8IGUpLmRvY3VtZW50RWxlbWVudDsNCgkJCQlyZXR1cm4gIVkudGVzdCh0IHx8IG4gJiYgbi5ub2RlTmFtZSB8fCAiSFRNTCIpDQoJCQl9LCBUID0gc2Uuc2V0RG9jdW1lbnQgPSBmdW5jdGlvbihlKSB7DQoJCQkJdmFyIHQsIG4sIHIgPSBlID8gZS5vd25lckRvY3VtZW50IHx8IGUgOiBwOw0KCQkJCXJldHVybiByICE9IEMgJiYgOSA9PT0gci5ub2RlVHlwZSAmJiByLmRvY3VtZW50RWxlbWVudCAmJiAoYSA9IChDID0gcikuZG9jdW1lbnRFbGVtZW50LCBFID0gIWkoQyksIHAgIT0gQyAmJiAobiA9IEMuZGVmYXVsdFZpZXcpICYmIG4udG9wICE9PSBuICYmIChuLmFkZEV2ZW50TGlzdGVuZXIgPyBuLmFkZEV2ZW50TGlzdGVuZXIoInVubG9hZCIsIG9lLCAhMSkgOiBuLmF0dGFjaEV2ZW50ICYmIG4uYXR0YWNoRXZlbnQoIm9udW5sb2FkIiwgb2UpKSwgZC5zY29wZSA9IGNlKGZ1bmN0aW9uKGUpIHtyZXR1cm4gYS5hcHBlbmRDaGlsZChlKS5hcHBlbmRDaGlsZChDLmNyZWF0ZUVsZW1lbnQoImRpdiIpKSwgInVuZGVmaW5lZCIgIT0gdHlwZW9mIGUucXVlcnlTZWxlY3RvckFsbCAmJiAhZS5xdWVyeVNlbGVjdG9yQWxsKCI6c2NvcGUgZmllbGRzZXQgZGl2IikubGVuZ3RofSksIGQuYXR0cmlidXRlcyA9IGNlKGZ1bmN0aW9uKGUpIHtyZXR1cm4gZS5jbGFzc05hbWUgPSAiaSIsICFlLmdldEF0dHJpYnV0ZSgiY2xhc3NOYW1lIil9KSwgZC5nZXRFbGVtZW50c0J5VGFnTmFtZSA9IGNlKGZ1bmN0aW9uKGUpIHtyZXR1cm4gZS5hcHBlbmRDaGlsZChDLmNyZWF0ZUNvbW1lbnQoIiIpKSwgIWUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKS5sZW5ndGh9KSwgZC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lID0gSy50ZXN0KEMuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSksIGQuZ2V0QnlJZCA9IGNlKGZ1bmN0aW9uKGUpIHtyZXR1cm4gYS5hcHBlbmRDaGlsZChlKS5pZCA9IFMsICFDLmdldEVsZW1lbnRzQnlOYW1lIHx8ICFDLmdldEVsZW1lbnRzQnlOYW1lKFMpLmxlbmd0aH0pLCBkLmdldEJ5SWQgPyAoYi5maWx0ZXIuSUQgPSBmdW5jdGlvbihlKSB7DQoJCQkJCXZhciB0ID0gZS5yZXBsYWNlKHRlLCBuZSk7DQoJCQkJCXJldHVybiBmdW5jdGlvbihlKSB7cmV0dXJuIGUuZ2V0QXR0cmlidXRlKCJpZCIpID09PSB0fQ0KCQkJCX0sIGIuZmluZC5JRCA9IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJaWYoInVuZGVmaW5lZCIgIT0gdHlwZW9mIHQuZ2V0RWxlbWVudEJ5SWQgJiYgRSkgew0KCQkJCQkJdmFyIG4gPSB0LmdldEVsZW1lbnRCeUlkKGUpOw0KCQkJCQkJcmV0dXJuIG4gPyBbbl0gOiBbXQ0KCQkJCQl9DQoJCQkJfSkgOiAoYi5maWx0ZXIuSUQgPSBmdW5jdGlvbihlKSB7DQoJCQkJCXZhciBuID0gZS5yZXBsYWNlKHRlLCBuZSk7DQoJCQkJCXJldHVybiBmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgdCA9ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBlLmdldEF0dHJpYnV0ZU5vZGUgJiYgZS5nZXRBdHRyaWJ1dGVOb2RlKCJpZCIpOw0KCQkJCQkJcmV0dXJuIHQgJiYgdC52YWx1ZSA9PT0gbg0KCQkJCQl9DQoJCQkJfSwgYi5maW5kLklEID0gZnVuY3Rpb24oZSwgdCkgew0KCQkJCQlpZigidW5kZWZpbmVkIiAhPSB0eXBlb2YgdC5nZXRFbGVtZW50QnlJZCAmJiBFKSB7DQoJCQkJCQl2YXIgbiwgciwgaSwgbyA9IHQuZ2V0RWxlbWVudEJ5SWQoZSk7DQoJCQkJCQlpZihvKSB7DQoJCQkJCQkJaWYoKG4gPSBvLmdldEF0dHJpYnV0ZU5vZGUoImlkIikpICYmIG4udmFsdWUgPT09IGUpIHJldHVybiBbb107DQoJCQkJCQkJaSA9IHQuZ2V0RWxlbWVudHNCeU5hbWUoZSksIHIgPSAwOw0KCQkJCQkJCXdoaWxlKG8gPSBpW3IrK10pIGlmKChuID0gby5nZXRBdHRyaWJ1dGVOb2RlKCJpZCIpKSAmJiBuLnZhbHVlID09PSBlKSByZXR1cm4gW29dDQoJCQkJCQl9DQoJCQkJCQlyZXR1cm4gW10NCgkJCQkJfQ0KCQkJCX0pLCBiLmZpbmQuVEFHID0gZC5nZXRFbGVtZW50c0J5VGFnTmFtZSA/IGZ1bmN0aW9uKGUsIHQpIHtyZXR1cm4gInVuZGVmaW5lZCIgIT0gdHlwZW9mIHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUgPyB0LmdldEVsZW1lbnRzQnlUYWdOYW1lKGUpIDogZC5xc2EgPyB0LnF1ZXJ5U2VsZWN0b3JBbGwoZSkgOiB2b2lkIDB9IDogZnVuY3Rpb24oZSwgdCkgew0KCQkJCQl2YXIgbiwgciA9IFtdLCBpID0gMCwgbyA9IHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoZSk7DQoJCQkJCWlmKCIqIiA9PT0gZSkgew0KCQkJCQkJd2hpbGUobiA9IG9baSsrXSkgMSA9PT0gbi5ub2RlVHlwZSAmJiByLnB1c2gobik7DQoJCQkJCQlyZXR1cm4gcg0KCQkJCQl9DQoJCQkJCXJldHVybiBvDQoJCQkJfSwgYi5maW5kLkNMQVNTID0gZC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICYmIGZ1bmN0aW9uKGUsIHQpIHtpZigidW5kZWZpbmVkIiAhPSB0eXBlb2YgdC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICYmIEUpIHJldHVybiB0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoZSl9LCBzID0gW10sIHYgPSBbXSwgKGQucXNhID0gSy50ZXN0KEMucXVlcnlTZWxlY3RvckFsbCkpICYmIChjZShmdW5jdGlvbihlKSB7DQoJCQkJCXZhciB0Ow0KCQkJCQlhLmFwcGVuZENoaWxkKGUpLmlubmVySFRNTCA9ICI8YSBpZD0nIiArIFMgKyAiJz48L2E+PHNlbGVjdCBpZD0nIiArIFMgKyAiLVxyXFwnIG1zYWxsb3djYXB0dXJlPScnPjxvcHRpb24gc2VsZWN0ZWQ9Jyc+PC9vcHRpb24+PC9zZWxlY3Q+IiwgZS5xdWVyeVNlbGVjdG9yQWxsKCJbbXNhbGxvd2NhcHR1cmVePScnXSIpLmxlbmd0aCAmJiB2LnB1c2goIlsqXiRdPSIgKyBNICsgIiooPzonJ3xcIlwiKSIpLCBlLnF1ZXJ5U2VsZWN0b3JBbGwoIltzZWxlY3RlZF0iKS5sZW5ndGggfHwgdi5wdXNoKCJcXFsiICsgTSArICIqKD86dmFsdWV8IiArIFIgKyAiKSIpLCBlLnF1ZXJ5U2VsZWN0b3JBbGwoIltpZH49IiArIFMgKyAiLV0iKS5sZW5ndGggfHwgdi5wdXNoKCJ+PSIpLCAodCA9IEMuY3JlYXRlRWxlbWVudCgiaW5wdXQiKSkuc2V0QXR0cmlidXRlKCJuYW1lIiwgIiIpLCBlLmFwcGVuZENoaWxkKHQpLCBlLnF1ZXJ5U2VsZWN0b3JBbGwoIltuYW1lPScnXSIpLmxlbmd0aCB8fCB2LnB1c2goIlxcWyIgKyBNICsgIipuYW1lIiArIE0gKyAiKj0iICsgTSArICIqKD86Jyd8XCJcIikiKSwgZS5xdWVyeVNlbGVjdG9yQWxsKCI6Y2hlY2tlZCIpLmxlbmd0aCB8fCB2LnB1c2goIjpjaGVja2VkIiksIGUucXVlcnlTZWxlY3RvckFsbCgiYSMiICsgUyArICIrKiIpLmxlbmd0aCB8fCB2LnB1c2goIi4jLitbK35dIiksIGUucXVlcnlTZWxlY3RvckFsbCgiXFxcZiIpLCB2LnB1c2goIltcXHJcXG5cXGZdIikNCgkJCQl9KSwgY2UoZnVuY3Rpb24oZSkgew0KCQkJCQllLmlubmVySFRNTCA9ICI8YSBocmVmPScnIGRpc2FibGVkPSdkaXNhYmxlZCc+PC9hPjxzZWxlY3QgZGlzYWJsZWQ9J2Rpc2FibGVkJz48b3B0aW9uLz48L3NlbGVjdD4iOw0KCQkJCQl2YXIgdCA9IEMuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsNCgkJCQkJdC5zZXRBdHRyaWJ1dGUoInR5cGUiLCAiaGlkZGVuIiksIGUuYXBwZW5kQ2hpbGQodCkuc2V0QXR0cmlidXRlKCJuYW1lIiwgIkQiKSwgZS5xdWVyeVNlbGVjdG9yQWxsKCJbbmFtZT1kXSIpLmxlbmd0aCAmJiB2LnB1c2goIm5hbWUiICsgTSArICIqWypeJHwhfl0/PSIpLCAyICE9PSBlLnF1ZXJ5U2VsZWN0b3JBbGwoIjplbmFibGVkIikubGVuZ3RoICYmIHYucHVzaCgiOmVuYWJsZWQiLCAiOmRpc2FibGVkIiksIGEuYXBwZW5kQ2hpbGQoZSkuZGlzYWJsZWQgPSAhMCwgMiAhPT0gZS5xdWVyeVNlbGVjdG9yQWxsKCI6ZGlzYWJsZWQiKS5sZW5ndGggJiYgdi5wdXNoKCI6ZW5hYmxlZCIsICI6ZGlzYWJsZWQiKSwgZS5xdWVyeVNlbGVjdG9yQWxsKCIqLDp4IiksIHYucHVzaCgiLC4qOiIpDQoJCQkJfSkpLCAoZC5tYXRjaGVzU2VsZWN0b3IgPSBLLnRlc3QoYyA9IGEubWF0Y2hlcyB8fCBhLndlYmtpdE1hdGNoZXNTZWxlY3RvciB8fCBhLm1vek1hdGNoZXNTZWxlY3RvciB8fCBhLm9NYXRjaGVzU2VsZWN0b3IgfHwgYS5tc01hdGNoZXNTZWxlY3RvcikpICYmIGNlKGZ1bmN0aW9uKGUpIHtkLmRpc2Nvbm5lY3RlZE1hdGNoID0gYy5jYWxsKGUsICIqIiksIGMuY2FsbChlLCAiW3MhPScnXTp4IiksIHMucHVzaCgiIT0iLCBGKX0pLCB2ID0gdi5sZW5ndGggJiYgbmV3IFJlZ0V4cCh2LmpvaW4oInwiKSksIHMgPSBzLmxlbmd0aCAmJiBuZXcgUmVnRXhwKHMuam9pbigifCIpKSwgdCA9IEsudGVzdChhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKSwgeSA9IHQgfHwgSy50ZXN0KGEuY29udGFpbnMpID8gZnVuY3Rpb24oZSwgdCkgew0KCQkJCQl2YXIgbiA9IDkgPT09IGUubm9kZVR5cGUgPyBlLmRvY3VtZW50RWxlbWVudCA6IGUsDQoJCQkJCSAgICByID0gdCAmJiB0LnBhcmVudE5vZGU7DQoJCQkJCXJldHVybiBlID09PSByIHx8ICEoIXIgfHwgMSAhPT0gci5ub2RlVHlwZSB8fCAhKG4uY29udGFpbnMgPyBuLmNvbnRhaW5zKHIpIDogZS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAmJiAxNiAmIGUuY29tcGFyZURvY3VtZW50UG9zaXRpb24ocikpKQ0KCQkJCX0gOiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJCWlmKHQpIHdoaWxlKHQgPSB0LnBhcmVudE5vZGUpIGlmKHQgPT09IGUpIHJldHVybiAhMDsNCgkJCQkJcmV0dXJuICExDQoJCQkJfSwgaiA9IHQgPyBmdW5jdGlvbihlLCB0KSB7DQoJCQkJCWlmKGUgPT09IHQpIHJldHVybiBsID0gITAsIDA7DQoJCQkJCXZhciBuID0gIWUuY29tcGFyZURvY3VtZW50UG9zaXRpb24gLSAhdC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbjsNCgkJCQkJcmV0dXJuIG4gfHwgKDEgJiAobiA9IChlLm93bmVyRG9jdW1lbnQgfHwgZSkgPT0gKHQub3duZXJEb2N1bWVudCB8fCB0KSA/IGUuY29tcGFyZURvY3VtZW50UG9zaXRpb24odCkgOiAxKSB8fCAhZC5zb3J0RGV0YWNoZWQgJiYgdC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihlKSA9PT0gbiA/IGUgPT0gQyB8fCBlLm93bmVyRG9jdW1lbnQgPT0gcCAmJiB5KHAsIGUpID8gLTEgOiB0ID09IEMgfHwgdC5vd25lckRvY3VtZW50ID09IHAgJiYgeShwLCB0KSA/IDEgOiB1ID8gUCh1LCBlKSAtIFAodSwgdCkgOiAwIDogNCAmIG4gPyAtMSA6IDEpDQoJCQkJfSA6IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJaWYoZSA9PT0gdCkgcmV0dXJuIGwgPSAhMCwgMDsNCgkJCQkJdmFyIG4sIHIgPSAwLCBpID0gZS5wYXJlbnROb2RlLCBvID0gdC5wYXJlbnROb2RlLCBhID0gW2VdLCBzID0gW3RdOw0KCQkJCQlpZighaSB8fCAhbykgcmV0dXJuIGUgPT0gQyA/IC0xIDogdCA9PSBDID8gMSA6IGkgPyAtMSA6IG8gPyAxIDogdSA/IFAodSwgZSkgLSBQKHUsIHQpIDogMDsNCgkJCQkJaWYoaSA9PT0gbykgcmV0dXJuIHBlKGUsIHQpOw0KCQkJCQluID0gZTsNCgkJCQkJd2hpbGUobiA9IG4ucGFyZW50Tm9kZSkgYS51bnNoaWZ0KG4pOw0KCQkJCQluID0gdDsNCgkJCQkJd2hpbGUobiA9IG4ucGFyZW50Tm9kZSkgcy51bnNoaWZ0KG4pOw0KCQkJCQl3aGlsZShhW3JdID09PSBzW3JdKSByKys7DQoJCQkJCXJldHVybiByID8gcGUoYVtyXSwgc1tyXSkgOiBhW3JdID09IHAgPyAtMSA6IHNbcl0gPT0gcCA/IDEgOiAwDQoJCQkJfSksIEMNCgkJCX0sIHNlLm1hdGNoZXMgPSBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIHNlKGUsIG51bGwsIG51bGwsIHQpfSwgc2UubWF0Y2hlc1NlbGVjdG9yID0gZnVuY3Rpb24oZSwgdCkgew0KCQkJCWlmKFQoZSksIGQubWF0Y2hlc1NlbGVjdG9yICYmIEUgJiYgIU5bdCArICIgIl0gJiYgKCFzIHx8ICFzLnRlc3QodCkpICYmICghdiB8fCAhdi50ZXN0KHQpKSkgdHJ5IHsNCgkJCQkJdmFyIG4gPSBjLmNhbGwoZSwgdCk7DQoJCQkJCWlmKG4gfHwgZC5kaXNjb25uZWN0ZWRNYXRjaCB8fCBlLmRvY3VtZW50ICYmIDExICE9PSBlLmRvY3VtZW50Lm5vZGVUeXBlKSByZXR1cm4gbg0KCQkJCX0gY2F0Y2goZSkge04odCwgITApfQ0KCQkJCXJldHVybiAwIDwgc2UodCwgQywgbnVsbCwgW2VdKS5sZW5ndGgNCgkJCX0sIHNlLmNvbnRhaW5zID0gZnVuY3Rpb24oZSwgdCkge3JldHVybiAoZS5vd25lckRvY3VtZW50IHx8IGUpICE9IEMgJiYgVChlKSwgeShlLCB0KX0sIHNlLmF0dHIgPSBmdW5jdGlvbihlLCB0KSB7DQoJCQkJKGUub3duZXJEb2N1bWVudCB8fCBlKSAhPSBDICYmIFQoZSk7DQoJCQkJdmFyIG4gPSBiLmF0dHJIYW5kbGVbdC50b0xvd2VyQ2FzZSgpXSwgciA9IG4gJiYgRC5jYWxsKGIuYXR0ckhhbmRsZSwgdC50b0xvd2VyQ2FzZSgpKSA/IG4oZSwgdCwgIUUpIDogdm9pZCAwOw0KCQkJCXJldHVybiB2b2lkIDAgIT09IHIgPyByIDogZC5hdHRyaWJ1dGVzIHx8ICFFID8gZS5nZXRBdHRyaWJ1dGUodCkgOiAociA9IGUuZ2V0QXR0cmlidXRlTm9kZSh0KSkgJiYgci5zcGVjaWZpZWQgPyByLnZhbHVlIDogbnVsbA0KCQkJfSwgc2UuZXNjYXBlID0gZnVuY3Rpb24oZSkge3JldHVybiAoZSArICIiKS5yZXBsYWNlKHJlLCBpZSl9LCBzZS5lcnJvciA9IGZ1bmN0aW9uKGUpIHt0aHJvdyBuZXcgRXJyb3IoIlN5bnRheCBlcnJvciwgdW5yZWNvZ25pemVkIGV4cHJlc3Npb246ICIgKyBlKX0sIHNlLnVuaXF1ZVNvcnQgPSBmdW5jdGlvbihlKSB7DQoJCQkJdmFyIHQsIG4gPSBbXSwgciA9IDAsIGkgPSAwOw0KCQkJCWlmKGwgPSAhZC5kZXRlY3REdXBsaWNhdGVzLCB1ID0gIWQuc29ydFN0YWJsZSAmJiBlLnNsaWNlKDApLCBlLnNvcnQoaiksIGwpIHsNCgkJCQkJd2hpbGUodCA9IGVbaSsrXSkgdCA9PT0gZVtpXSAmJiAociA9IG4ucHVzaChpKSk7DQoJCQkJCXdoaWxlKHItLSkgZS5zcGxpY2UobltyXSwgMSkNCgkJCQl9DQoJCQkJcmV0dXJuIHUgPSBudWxsLCBlDQoJCQl9LCBvID0gc2UuZ2V0VGV4dCA9IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCwgbiA9ICIiLCByID0gMCwgaSA9IGUubm9kZVR5cGU7DQoJCQkJaWYoaSkgew0KCQkJCQlpZigxID09PSBpIHx8IDkgPT09IGkgfHwgMTEgPT09IGkpIHsNCgkJCQkJCWlmKCJzdHJpbmciID09IHR5cGVvZiBlLnRleHRDb250ZW50KSByZXR1cm4gZS50ZXh0Q29udGVudDsNCgkJCQkJCWZvcihlID0gZS5maXJzdENoaWxkOyBlOyBlID0gZS5uZXh0U2libGluZykgbiArPSBvKGUpDQoJCQkJCX0gZWxzZSBpZigzID09PSBpIHx8IDQgPT09IGkpIHJldHVybiBlLm5vZGVWYWx1ZQ0KCQkJCX0gZWxzZSB3aGlsZSh0ID0gZVtyKytdKSBuICs9IG8odCk7DQoJCQkJcmV0dXJuIG4NCgkJCX0sIChiID0gc2Uuc2VsZWN0b3JzID0gew0KCQkJCWNhY2hlTGVuZ3RoOiA1MCwNCgkJCQljcmVhdGVQc2V1ZG86IGxlLA0KCQkJCW1hdGNoOiBHLA0KCQkJCWF0dHJIYW5kbGU6IHt9LA0KCQkJCWZpbmQ6IHt9LA0KCQkJCXJlbGF0aXZlOiB7Ij4iOiB7ZGlyOiAicGFyZW50Tm9kZSIsIGZpcnN0OiAhMH0sICIgIjoge2RpcjogInBhcmVudE5vZGUifSwgIisiOiB7ZGlyOiAicHJldmlvdXNTaWJsaW5nIiwgZmlyc3Q6ICEwfSwgIn4iOiB7ZGlyOiAicHJldmlvdXNTaWJsaW5nIn19LA0KCQkJCXByZUZpbHRlcjogew0KCQkJCQlBVFRSOiBmdW5jdGlvbihlKSB7cmV0dXJuIGVbMV0gPSBlWzFdLnJlcGxhY2UodGUsIG5lKSwgZVszXSA9IChlWzNdIHx8IGVbNF0gfHwgZVs1XSB8fCAiIikucmVwbGFjZSh0ZSwgbmUpLCAifj0iID09PSBlWzJdICYmIChlWzNdID0gIiAiICsgZVszXSArICIgIiksIGUuc2xpY2UoMCwgNCl9LA0KCQkJCQlDSElMRDogZnVuY3Rpb24oZSkge3JldHVybiBlWzFdID0gZVsxXS50b0xvd2VyQ2FzZSgpLCAibnRoIiA9PT0gZVsxXS5zbGljZSgwLCAzKSA/IChlWzNdIHx8IHNlLmVycm9yKGVbMF0pLCBlWzRdID0gKyhlWzRdID8gZVs1XSArIChlWzZdIHx8IDEpIDogMiAqICgiZXZlbiIgPT09IGVbM10gfHwgIm9kZCIgPT09IGVbM10pKSwgZVs1XSA9ICsoZVs3XSArIGVbOF0gfHwgIm9kZCIgPT09IGVbM10pKSA6IGVbM10gJiYgc2UuZXJyb3IoZVswXSksIGV9LA0KCQkJCQlQU0VVRE86IGZ1bmN0aW9uKGUpIHsNCgkJCQkJCXZhciB0LCBuID0gIWVbNl0gJiYgZVsyXTsNCgkJCQkJCXJldHVybiBHLkNISUxELnRlc3QoZVswXSkgPyBudWxsIDogKGVbM10gPyBlWzJdID0gZVs0XSB8fCBlWzVdIHx8ICIiIDogbiAmJiBYLnRlc3QobikgJiYgKHQgPSBoKG4sICEwKSkgJiYgKHQgPSBuLmluZGV4T2YoIikiLCBuLmxlbmd0aCAtIHQpIC0gbi5sZW5ndGgpICYmIChlWzBdID0gZVswXS5zbGljZSgwLCB0KSwgZVsyXSA9IG4uc2xpY2UoMCwgdCkpLCBlLnNsaWNlKDAsIDMpKQ0KCQkJCQl9DQoJCQkJfSwNCgkJCQlmaWx0ZXI6IHsNCgkJCQkJVEFHOiBmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgdCA9IGUucmVwbGFjZSh0ZSwgbmUpLnRvTG93ZXJDYXNlKCk7DQoJCQkJCQlyZXR1cm4gIioiID09PSBlID8gZnVuY3Rpb24oKSB7cmV0dXJuICEwfSA6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gZS5ub2RlTmFtZSAmJiBlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IHR9DQoJCQkJCX0sIENMQVNTOiBmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgdCA9IG1bZSArICIgIl07DQoJCQkJCQlyZXR1cm4gdCB8fCAodCA9IG5ldyBSZWdFeHAoIihefCIgKyBNICsgIikiICsgZSArICIoIiArIE0gKyAifCQpIikpICYmIG0oZSwgZnVuY3Rpb24oZSkge3JldHVybiB0LnRlc3QoInN0cmluZyIgPT0gdHlwZW9mIGUuY2xhc3NOYW1lICYmIGUuY2xhc3NOYW1lIHx8ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBlLmdldEF0dHJpYnV0ZSAmJiBlLmdldEF0dHJpYnV0ZSgiY2xhc3MiKSB8fCAiIil9KQ0KCQkJCQl9LCBBVFRSOiBmdW5jdGlvbihuLCByLCBpKSB7DQoJCQkJCQlyZXR1cm4gZnVuY3Rpb24oZSkgew0KCQkJCQkJCXZhciB0ID0gc2UuYXR0cihlLCBuKTsNCgkJCQkJCQlyZXR1cm4gbnVsbCA9PSB0ID8gIiE9IiA9PT0gciA6ICFyIHx8ICh0ICs9ICIiLCAiPSIgPT09IHIgPyB0ID09PSBpIDogIiE9IiA9PT0gciA/IHQgIT09IGkgOiAiXj0iID09PSByID8gaSAmJiAwID09PSB0LmluZGV4T2YoaSkgOiAiKj0iID09PSByID8gaSAmJiAtMSA8IHQuaW5kZXhPZihpKSA6ICIkPSIgPT09IHIgPyBpICYmIHQuc2xpY2UoLWkubGVuZ3RoKSA9PT0gaSA6ICJ+PSIgPT09IHIgPyAtMSA8ICgiICIgKyB0LnJlcGxhY2UoQiwgIiAiKSArICIgIikuaW5kZXhPZihpKSA6ICJ8PSIgPT09IHIgJiYgKHQgPT09IGkgfHwgdC5zbGljZSgwLCBpLmxlbmd0aCArIDEpID09PSBpICsgIi0iKSkNCgkJCQkJCX0NCgkJCQkJfSwgQ0hJTEQ6IGZ1bmN0aW9uKGgsIGUsIHQsIGcsIHYpIHsNCgkJCQkJCXZhciB5ID0gIm50aCIgIT09IGguc2xpY2UoMCwgMyksIG0gPSAibGFzdCIgIT09IGguc2xpY2UoLTQpLCB4ID0gIm9mLXR5cGUiID09PSBlOw0KCQkJCQkJcmV0dXJuIDEgPT09IGcgJiYgMCA9PT0gdiA/IGZ1bmN0aW9uKGUpIHtyZXR1cm4gISFlLnBhcmVudE5vZGV9IDogZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCQkJCXZhciByLCBpLCBvLCBhLCBzLCB1LCBsID0geSAhPT0gbSA/ICJuZXh0U2libGluZyIgOiAicHJldmlvdXNTaWJsaW5nIiwgYyA9IGUucGFyZW50Tm9kZSwgZiA9IHggJiYgZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLCBwID0gIW4gJiYgIXgsIGQgPSAhMTsNCgkJCQkJCQlpZihjKSB7DQoJCQkJCQkJCWlmKHkpIHsNCgkJCQkJCQkJCXdoaWxlKGwpIHsNCgkJCQkJCQkJCQlhID0gZTsNCgkJCQkJCQkJCQl3aGlsZShhID0gYVtsXSkgaWYoeCA/IGEubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gZiA6IDEgPT09IGEubm9kZVR5cGUpIHJldHVybiAhMTsNCgkJCQkJCQkJCQl1ID0gbCA9ICJvbmx5IiA9PT0gaCAmJiAhdSAmJiAibmV4dFNpYmxpbmciDQoJCQkJCQkJCQl9DQoJCQkJCQkJCQlyZXR1cm4gITANCgkJCQkJCQkJfQ0KCQkJCQkJCQlpZih1ID0gW20gPyBjLmZpcnN0Q2hpbGQgOiBjLmxhc3RDaGlsZF0sIG0gJiYgcCkgew0KCQkJCQkJCQkJZCA9IChzID0gKHIgPSAoaSA9IChvID0gKGEgPSBjKVtTXSB8fCAoYVtTXSA9IHt9KSlbYS51bmlxdWVJRF0gfHwgKG9bYS51bmlxdWVJRF0gPSB7fSkpW2hdIHx8IFtdKVswXSA9PT0gayAmJiByWzFdKSAmJiByWzJdLCBhID0gcyAmJiBjLmNoaWxkTm9kZXNbc107DQoJCQkJCQkJCQl3aGlsZShhID0gKytzICYmIGEgJiYgYVtsXSB8fCAoZCA9IHMgPSAwKSB8fCB1LnBvcCgpKSBpZigxID09PSBhLm5vZGVUeXBlICYmICsrZCAmJiBhID09PSBlKSB7DQoJCQkJCQkJCQkJaVtoXSA9IFtrLCBzLCBkXTsNCgkJCQkJCQkJCQlicmVhaw0KCQkJCQkJCQkJfQ0KCQkJCQkJCQl9IGVsc2UgaWYocCAmJiAoZCA9IHMgPSAociA9IChpID0gKG8gPSAoYSA9IGUpW1NdIHx8IChhW1NdID0ge30pKVthLnVuaXF1ZUlEXSB8fCAob1thLnVuaXF1ZUlEXSA9IHt9KSlbaF0gfHwgW10pWzBdID09PSBrICYmIHJbMV0pLCAhMSA9PT0gZCkgd2hpbGUoYSA9ICsrcyAmJiBhICYmIGFbbF0gfHwgKGQgPSBzID0gMCkgfHwgdS5wb3AoKSkgaWYoKHggPyBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IGYgOiAxID09PSBhLm5vZGVUeXBlKSAmJiArK2QgJiYgKHAgJiYgKChpID0gKG8gPSBhW1NdIHx8IChhW1NdID0ge30pKVthLnVuaXF1ZUlEXSB8fCAob1thLnVuaXF1ZUlEXSA9IHt9KSlbaF0gPSBbaywgZF0pLCBhID09PSBlKSkgYnJlYWs7DQoJCQkJCQkJCXJldHVybiAoZCAtPSB2KSA9PT0gZyB8fCBkICUgZyA9PSAwICYmIDAgPD0gZCAvIGcNCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJCX0sIFBTRVVETzogZnVuY3Rpb24oZSwgbykgew0KCQkJCQkJdmFyIHQsIGEgPSBiLnBzZXVkb3NbZV0gfHwgYi5zZXRGaWx0ZXJzW2UudG9Mb3dlckNhc2UoKV0gfHwgc2UuZXJyb3IoInVuc3VwcG9ydGVkIHBzZXVkbzogIiArIGUpOw0KCQkJCQkJcmV0dXJuIGFbU10gPyBhKG8pIDogMSA8IGEubGVuZ3RoID8gKHQgPSBbZSwgZSwgIiIsIG9dLCBiLnNldEZpbHRlcnMuaGFzT3duUHJvcGVydHkoZS50b0xvd2VyQ2FzZSgpKSA/IGxlKGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJCQl2YXIgbiwgciA9IGEoZSwgbyksIGkgPSByLmxlbmd0aDsNCgkJCQkJCQl3aGlsZShpLS0pIGVbbiA9IFAoZSwgcltpXSldID0gISh0W25dID0gcltpXSkNCgkJCQkJCX0pIDogZnVuY3Rpb24oZSkge3JldHVybiBhKGUsIDAsIHQpfSkgOiBhDQoJCQkJCX0NCgkJCQl9LA0KCQkJCXBzZXVkb3M6IHsNCgkJCQkJbm90OiBsZShmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgciA9IFtdLCBpID0gW10sIHMgPSBmKGUucmVwbGFjZSgkLCAiJDEiKSk7DQoJCQkJCQlyZXR1cm4gc1tTXSA/IGxlKGZ1bmN0aW9uKGUsIHQsIG4sIHIpIHsNCgkJCQkJCQl2YXIgaSwgbyA9IHMoZSwgbnVsbCwgciwgW10pLCBhID0gZS5sZW5ndGg7DQoJCQkJCQkJd2hpbGUoYS0tKSAoaSA9IG9bYV0pICYmIChlW2FdID0gISh0W2FdID0gaSkpDQoJCQkJCQl9KSA6IGZ1bmN0aW9uKGUsIHQsIG4pIHtyZXR1cm4gclswXSA9IGUsIHMociwgbnVsbCwgbiwgaSksIHJbMF0gPSBudWxsLCAhaS5wb3AoKX0NCgkJCQkJfSksDQoJCQkJCWhhczogbGUoZnVuY3Rpb24odCkge3JldHVybiBmdW5jdGlvbihlKSB7cmV0dXJuIDAgPCBzZSh0LCBlKS5sZW5ndGh9fSksDQoJCQkJCWNvbnRhaW5zOiBsZShmdW5jdGlvbih0KSB7cmV0dXJuIHQgPSB0LnJlcGxhY2UodGUsIG5lKSwgZnVuY3Rpb24oZSkge3JldHVybiAtMSA8IChlLnRleHRDb250ZW50IHx8IG8oZSkpLmluZGV4T2YodCl9fSksDQoJCQkJCWxhbmc6IGxlKGZ1bmN0aW9uKG4pIHsNCgkJCQkJCXJldHVybiBWLnRlc3QobiB8fCAiIikgfHwgc2UuZXJyb3IoInVuc3VwcG9ydGVkIGxhbmc6ICIgKyBuKSwgbiA9IG4ucmVwbGFjZSh0ZSwgbmUpLnRvTG93ZXJDYXNlKCksIGZ1bmN0aW9uKGUpIHsNCgkJCQkJCQl2YXIgdDsNCgkJCQkJCQlkbyB7aWYodCA9IEUgPyBlLmxhbmcgOiBlLmdldEF0dHJpYnV0ZSgieG1sOmxhbmciKSB8fCBlLmdldEF0dHJpYnV0ZSgibGFuZyIpKSByZXR1cm4gKHQgPSB0LnRvTG93ZXJDYXNlKCkpID09PSBuIHx8IDAgPT09IHQuaW5kZXhPZihuICsgIi0iKX0gd2hpbGUoKGUgPSBlLnBhcmVudE5vZGUpICYmIDEgPT09IGUubm9kZVR5cGUpOw0KCQkJCQkJCXJldHVybiAhMQ0KCQkJCQkJfQ0KCQkJCQl9KSwNCgkJCQkJdGFyZ2V0OiBmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgdCA9IG4ubG9jYXRpb24gJiYgbi5sb2NhdGlvbi5oYXNoOw0KCQkJCQkJcmV0dXJuIHQgJiYgdC5zbGljZSgxKSA9PT0gZS5pZA0KCQkJCQl9LA0KCQkJCQlyb290OiBmdW5jdGlvbihlKSB7cmV0dXJuIGUgPT09IGF9LA0KCQkJCQlmb2N1czogZnVuY3Rpb24oZSkge3JldHVybiBlID09PSBDLmFjdGl2ZUVsZW1lbnQgJiYgKCFDLmhhc0ZvY3VzIHx8IEMuaGFzRm9jdXMoKSkgJiYgISEoZS50eXBlIHx8IGUuaHJlZiB8fCB+ZS50YWJJbmRleCl9LA0KCQkJCQllbmFibGVkOiBnZSghMSksDQoJCQkJCWRpc2FibGVkOiBnZSghMCksDQoJCQkJCWNoZWNrZWQ6IGZ1bmN0aW9uKGUpIHsNCgkJCQkJCXZhciB0ID0gZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOw0KCQkJCQkJcmV0dXJuICJpbnB1dCIgPT09IHQgJiYgISFlLmNoZWNrZWQgfHwgIm9wdGlvbiIgPT09IHQgJiYgISFlLnNlbGVjdGVkDQoJCQkJCX0sDQoJCQkJCXNlbGVjdGVkOiBmdW5jdGlvbihlKSB7cmV0dXJuIGUucGFyZW50Tm9kZSAmJiBlLnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleCwgITAgPT09IGUuc2VsZWN0ZWR9LA0KCQkJCQllbXB0eTogZnVuY3Rpb24oZSkgew0KCQkJCQkJZm9yKGUgPSBlLmZpcnN0Q2hpbGQ7IGU7IGUgPSBlLm5leHRTaWJsaW5nKSBpZihlLm5vZGVUeXBlIDwgNikgcmV0dXJuICExOw0KCQkJCQkJcmV0dXJuICEwDQoJCQkJCX0sDQoJCQkJCXBhcmVudDogZnVuY3Rpb24oZSkge3JldHVybiAhYi5wc2V1ZG9zLmVtcHR5KGUpfSwNCgkJCQkJaGVhZGVyOiBmdW5jdGlvbihlKSB7cmV0dXJuIEoudGVzdChlLm5vZGVOYW1lKX0sDQoJCQkJCWlucHV0OiBmdW5jdGlvbihlKSB7cmV0dXJuIFEudGVzdChlLm5vZGVOYW1lKX0sDQoJCQkJCWJ1dHRvbjogZnVuY3Rpb24oZSkgew0KCQkJCQkJdmFyIHQgPSBlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7DQoJCQkJCQlyZXR1cm4gImlucHV0IiA9PT0gdCAmJiAiYnV0dG9uIiA9PT0gZS50eXBlIHx8ICJidXR0b24iID09PSB0DQoJCQkJCX0sDQoJCQkJCXRleHQ6IGZ1bmN0aW9uKGUpIHsNCgkJCQkJCXZhciB0Ow0KCQkJCQkJcmV0dXJuICJpbnB1dCIgPT09IGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAmJiAidGV4dCIgPT09IGUudHlwZSAmJiAobnVsbCA9PSAodCA9IGUuZ2V0QXR0cmlidXRlKCJ0eXBlIikpIHx8ICJ0ZXh0IiA9PT0gdC50b0xvd2VyQ2FzZSgpKQ0KCQkJCQl9LA0KCQkJCQlmaXJzdDogdmUoZnVuY3Rpb24oKSB7cmV0dXJuIFswXX0pLA0KCQkJCQlsYXN0OiB2ZShmdW5jdGlvbihlLCB0KSB7cmV0dXJuIFt0IC0gMV19KSwNCgkJCQkJZXE6IHZlKGZ1bmN0aW9uKGUsIHQsIG4pIHtyZXR1cm4gW24gPCAwID8gbiArIHQgOiBuXX0pLA0KCQkJCQlldmVuOiB2ZShmdW5jdGlvbihlLCB0KSB7DQoJCQkJCQlmb3IodmFyIG4gPSAwOyBuIDwgdDsgbiArPSAyKSBlLnB1c2gobik7DQoJCQkJCQlyZXR1cm4gZQ0KCQkJCQl9KSwNCgkJCQkJb2RkOiB2ZShmdW5jdGlvbihlLCB0KSB7DQoJCQkJCQlmb3IodmFyIG4gPSAxOyBuIDwgdDsgbiArPSAyKSBlLnB1c2gobik7DQoJCQkJCQlyZXR1cm4gZQ0KCQkJCQl9KSwNCgkJCQkJbHQ6IHZlKGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQkJCWZvcih2YXIgciA9IG4gPCAwID8gbiArIHQgOiB0IDwgbiA/IHQgOiBuOyAwIDw9IC0tcjspIGUucHVzaChyKTsNCgkJCQkJCXJldHVybiBlDQoJCQkJCX0pLA0KCQkJCQlndDogdmUoZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCQkJZm9yKHZhciByID0gbiA8IDAgPyBuICsgdCA6IG47ICsrciA8IHQ7KSBlLnB1c2gocik7DQoJCQkJCQlyZXR1cm4gZQ0KCQkJCQl9KQ0KCQkJCX0NCgkJCX0pLnBzZXVkb3MubnRoID0gYi5wc2V1ZG9zLmVxLCB7cmFkaW86ICEwLCBjaGVja2JveDogITAsIGZpbGU6ICEwLCBwYXNzd29yZDogITAsIGltYWdlOiAhMH0pIGIucHNldWRvc1tlXSA9IGRlKGUpOw0KCQkJZm9yKGUgaW4ge3N1Ym1pdDogITAsIHJlc2V0OiAhMH0pIGIucHNldWRvc1tlXSA9IGhlKGUpOw0KDQoJCQlmdW5jdGlvbiBtZSgpIHt9DQoNCgkJCWZ1bmN0aW9uIHhlKGUpIHsNCgkJCQlmb3IodmFyIHQgPSAwLCBuID0gZS5sZW5ndGgsIHIgPSAiIjsgdCA8IG47IHQrKykgciArPSBlW3RdLnZhbHVlOw0KCQkJCXJldHVybiByDQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGJlKHMsIGUsIHQpIHsNCgkJCQl2YXIgdSA9IGUuZGlyLCBsID0gZS5uZXh0LCBjID0gbCB8fCB1LCBmID0gdCAmJiAicGFyZW50Tm9kZSIgPT09IGMsIHAgPSByKys7DQoJCQkJcmV0dXJuIGUuZmlyc3QgPyBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJCXdoaWxlKGUgPSBlW3VdKSBpZigxID09PSBlLm5vZGVUeXBlIHx8IGYpIHJldHVybiBzKGUsIHQsIG4pOw0KCQkJCQlyZXR1cm4gITENCgkJCQl9IDogZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCQl2YXIgciwgaSwgbywgYSA9IFtrLCBwXTsNCgkJCQkJaWYobikge3doaWxlKGUgPSBlW3VdKSBpZigoMSA9PT0gZS5ub2RlVHlwZSB8fCBmKSAmJiBzKGUsIHQsIG4pKSByZXR1cm4gITB9IGVsc2Ugd2hpbGUoZSA9IGVbdV0pIGlmKDEgPT09IGUubm9kZVR5cGUgfHwgZikgaWYoaSA9IChvID0gZVtTXSB8fCAoZVtTXSA9IHt9KSlbZS51bmlxdWVJRF0gfHwgKG9bZS51bmlxdWVJRF0gPSB7fSksIGwgJiYgbCA9PT0gZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKSBlID0gZVt1XSB8fCBlOyBlbHNlIHsNCgkJCQkJCWlmKChyID0gaVtjXSkgJiYgclswXSA9PT0gayAmJiByWzFdID09PSBwKSByZXR1cm4gYVsyXSA9IHJbMl07DQoJCQkJCQlpZigoaVtjXSA9IGEpWzJdID0gcyhlLCB0LCBuKSkgcmV0dXJuICEwDQoJCQkJCX0NCgkJCQkJcmV0dXJuICExDQoJCQkJfQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiB3ZShpKSB7DQoJCQkJcmV0dXJuIDEgPCBpLmxlbmd0aCA/IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQkJdmFyIHIgPSBpLmxlbmd0aDsNCgkJCQkJd2hpbGUoci0tKSBpZighaVtyXShlLCB0LCBuKSkgcmV0dXJuICExOw0KCQkJCQlyZXR1cm4gITANCgkJCQl9IDogaVswXQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBUZShlLCB0LCBuLCByLCBpKSB7DQoJCQkJZm9yKHZhciBvLCBhID0gW10sIHMgPSAwLCB1ID0gZS5sZW5ndGgsIGwgPSBudWxsICE9IHQ7IHMgPCB1OyBzKyspIChvID0gZVtzXSkgJiYgKG4gJiYgIW4obywgciwgaSkgfHwgKGEucHVzaChvKSwgbCAmJiB0LnB1c2gocykpKTsNCgkJCQlyZXR1cm4gYQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBDZShkLCBoLCBnLCB2LCB5LCBlKSB7DQoJCQkJcmV0dXJuIHYgJiYgIXZbU10gJiYgKHYgPSBDZSh2KSksIHkgJiYgIXlbU10gJiYgKHkgPSBDZSh5LCBlKSksIGxlKGZ1bmN0aW9uKGUsIHQsIG4sIHIpIHsNCgkJCQkJdmFyIGksIG8sIGEsIHMgICAgICAgICAgICAgICAgICAgICAgICAgICA9IFtdLCB1ID0gW10sIGwgPSB0Lmxlbmd0aCwgYyA9IGUgfHwgZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCQkJZm9yKHZhciByID0gMCwgaSA9IHQubGVuZ3RoOyByIDwgaTsgcisrKSBzZShlLCB0W3JdLCBuKTsNCgkJCQkJCXJldHVybiBuDQoJCQkJCX0oaCB8fCAiKiIsIG4ubm9kZVR5cGUgPyBbbl0gOiBuLCBbXSksIGYgPSAhZCB8fCAhZSAmJiBoID8gYyA6IFRlKGMsIHMsIGQsIG4sIHIpLCBwID0gZyA/IHkgfHwgKGUgPyBkIDogbCB8fCB2KSA/IFtdIDogdCA6IGY7DQoJCQkJCWlmKGcgJiYgZyhmLCBwLCBuLCByKSwgdikgew0KCQkJCQkJaSA9IFRlKHAsIHUpLCB2KGksIFtdLCBuLCByKSwgbyA9IGkubGVuZ3RoOw0KCQkJCQkJd2hpbGUoby0tKSAoYSA9IGlbb10pICYmIChwW3Vbb11dID0gIShmW3Vbb11dID0gYSkpDQoJCQkJCX0NCgkJCQkJaWYoZSkgew0KCQkJCQkJaWYoeSB8fCBkKSB7DQoJCQkJCQkJaWYoeSkgew0KCQkJCQkJCQlpID0gW10sIG8gPSBwLmxlbmd0aDsNCgkJCQkJCQkJd2hpbGUoby0tKSAoYSA9IHBbb10pICYmIGkucHVzaChmW29dID0gYSk7DQoJCQkJCQkJCXkobnVsbCwgcCA9IFtdLCBpLCByKQ0KCQkJCQkJCX0NCgkJCQkJCQlvID0gcC5sZW5ndGg7DQoJCQkJCQkJd2hpbGUoby0tKSAoYSA9IHBbb10pICYmIC0xIDwgKGkgPSB5ID8gUChlLCBhKSA6IHNbb10pICYmIChlW2ldID0gISh0W2ldID0gYSkpDQoJCQkJCQl9DQoJCQkJCX0gZWxzZSBwID0gVGUocCA9PT0gdCA/IHAuc3BsaWNlKGwsIHAubGVuZ3RoKSA6IHApLCB5ID8geShudWxsLCB0LCBwLCByKSA6IEguYXBwbHkodCwgcCkNCgkJCQl9KQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBFZShlKSB7DQoJCQkJZm9yKHZhciBpLCB0LCBuLCByID0gZS5sZW5ndGgsIG8gPSBiLnJlbGF0aXZlW2VbMF0udHlwZV0sIGEgPSBvIHx8IGIucmVsYXRpdmVbIiAiXSwgcyA9IG8gPyAxIDogMCwgdSA9IGJlKGZ1bmN0aW9uKGUpIHtyZXR1cm4gZSA9PT0gaX0sIGEsICEwKSwgbCA9IGJlKGZ1bmN0aW9uKGUpIHtyZXR1cm4gLTEgPCBQKGksIGUpfSwgYSwgITApLCBjID0gW2Z1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQkJdmFyIHIgPSAhbyAmJiAobiB8fCB0ICE9PSB3KSB8fCAoKGkgPSB0KS5ub2RlVHlwZSA/IHUoZSwgdCwgbikgOiBsKGUsIHQsIG4pKTsNCgkJCQkJcmV0dXJuIGkgPSBudWxsLCByDQoJCQkJfV07IHMgPCByOyBzKyspIGlmKHQgPSBiLnJlbGF0aXZlW2Vbc10udHlwZV0pIGMgPSBbYmUod2UoYyksIHQpXTsgZWxzZSB7DQoJCQkJCWlmKCh0ID0gYi5maWx0ZXJbZVtzXS50eXBlXS5hcHBseShudWxsLCBlW3NdLm1hdGNoZXMpKVtTXSkgew0KCQkJCQkJZm9yKG4gPSArK3M7IG4gPCByOyBuKyspIGlmKGIucmVsYXRpdmVbZVtuXS50eXBlXSkgYnJlYWs7DQoJCQkJCQlyZXR1cm4gQ2UoMSA8IHMgJiYgd2UoYyksIDEgPCBzICYmIHhlKGUuc2xpY2UoMCwgcyAtIDEpLmNvbmNhdCh7dmFsdWU6ICIgIiA9PT0gZVtzIC0gMl0udHlwZSA/ICIqIiA6ICIifSkpLnJlcGxhY2UoJCwgIiQxIiksIHQsIHMgPCBuICYmIEVlKGUuc2xpY2UocywgbikpLCBuIDwgciAmJiBFZShlID0gZS5zbGljZShuKSksIG4gPCByICYmIHhlKGUpKQ0KCQkJCQl9DQoJCQkJCWMucHVzaCh0KQ0KCQkJCX0NCgkJCQlyZXR1cm4gd2UoYykNCgkJCX0NCg0KCQkJcmV0dXJuIG1lLnByb3RvdHlwZSA9IGIuZmlsdGVycyA9IGIucHNldWRvcywgYi5zZXRGaWx0ZXJzID0gbmV3IG1lLCBoID0gc2UudG9rZW5pemUgPSBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4sIHIsIGksIG8sIGEsIHMsIHUsIGwgPSB4W2UgKyAiICJdOw0KCQkJCWlmKGwpIHJldHVybiB0ID8gMCA6IGwuc2xpY2UoMCk7DQoJCQkJYSA9IGUsIHMgPSBbXSwgdSA9IGIucHJlRmlsdGVyOw0KCQkJCXdoaWxlKGEpIHsNCgkJCQkJZm9yKG8gaW4gbiAmJiAhKHIgPSBfLmV4ZWMoYSkpIHx8IChyICYmIChhID0gYS5zbGljZShyWzBdLmxlbmd0aCkgfHwgYSksIHMucHVzaChpID0gW10pKSwgbiA9ICExLCAociA9IHouZXhlYyhhKSkgJiYgKG4gPSByLnNoaWZ0KCksIGkucHVzaCh7DQoJCQkJCQl2YWx1ZTogbiwNCgkJCQkJCXR5cGU6IHJbMF0ucmVwbGFjZSgkLCAiICIpDQoJCQkJCX0pLCBhID0gYS5zbGljZShuLmxlbmd0aCkpLCBiLmZpbHRlcikgIShyID0gR1tvXS5leGVjKGEpKSB8fCB1W29dICYmICEociA9IHVbb10ocikpIHx8IChuID0gci5zaGlmdCgpLCBpLnB1c2goe3ZhbHVlOiBuLCB0eXBlOiBvLCBtYXRjaGVzOiByfSksIGEgPSBhLnNsaWNlKG4ubGVuZ3RoKSk7DQoJCQkJCWlmKCFuKSBicmVhaw0KCQkJCX0NCgkJCQlyZXR1cm4gdCA/IGEubGVuZ3RoIDogYSA/IHNlLmVycm9yKGUpIDogeChlLCBzKS5zbGljZSgwKQ0KCQkJfSwgZiA9IHNlLmNvbXBpbGUgPSBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4sIHYsIHksIG0sIHgsIHIsIGkgPSBbXSwgbyA9IFtdLCBhID0gQVtlICsgIiAiXTsNCgkJCQlpZighYSkgew0KCQkJCQl0IHx8ICh0ID0gaChlKSksIG4gPSB0Lmxlbmd0aDsNCgkJCQkJd2hpbGUobi0tKSAoYSA9IEVlKHRbbl0pKVtTXSA/IGkucHVzaChhKSA6IG8ucHVzaChhKTsNCgkJCQkJKGEgPSBBKGUsICh2ID0gbywgbSA9IDAgPCAoeSA9IGkpLmxlbmd0aCwgeCA9IDAgPCB2Lmxlbmd0aCwgciA9IGZ1bmN0aW9uKGUsIHQsIG4sIHIsIGkpIHsNCgkJCQkJCXZhciBvLCBhLCBzLCB1ID0gMCwgbCA9ICIwIiwgYyA9IGUgJiYgW10sIGYgPSBbXSwgcCA9IHcsIGQgPSBlIHx8IHggJiYgYi5maW5kLlRBRygiKiIsIGkpLCBoID0gayArPSBudWxsID09IHAgPyAxIDogTWF0aC5yYW5kb20oKSB8fCAuMSwgZyA9IGQubGVuZ3RoOw0KCQkJCQkJZm9yKGkgJiYgKHcgPSB0ID09IEMgfHwgdCB8fCBpKTsgbCAhPT0gZyAmJiBudWxsICE9IChvID0gZFtsXSk7IGwrKykgew0KCQkJCQkJCWlmKHggJiYgbykgew0KCQkJCQkJCQlhID0gMCwgdCB8fCBvLm93bmVyRG9jdW1lbnQgPT0gQyB8fCAoVChvKSwgbiA9ICFFKTsNCgkJCQkJCQkJd2hpbGUocyA9IHZbYSsrXSkgaWYocyhvLCB0IHx8IEMsIG4pKSB7DQoJCQkJCQkJCQlyLnB1c2gobyk7DQoJCQkJCQkJCQlicmVhaw0KCQkJCQkJCQl9DQoJCQkJCQkJCWkgJiYgKGsgPSBoKQ0KCQkJCQkJCX0NCgkJCQkJCQltICYmICgobyA9ICFzICYmIG8pICYmIHUtLSwgZSAmJiBjLnB1c2gobykpDQoJCQkJCQl9DQoJCQkJCQlpZih1ICs9IGwsIG0gJiYgbCAhPT0gdSkgew0KCQkJCQkJCWEgPSAwOw0KCQkJCQkJCXdoaWxlKHMgPSB5W2ErK10pIHMoYywgZiwgdCwgbik7DQoJCQkJCQkJaWYoZSkgew0KCQkJCQkJCQlpZigwIDwgdSkgd2hpbGUobC0tKSBjW2xdIHx8IGZbbF0gfHwgKGZbbF0gPSBxLmNhbGwocikpOw0KCQkJCQkJCQlmID0gVGUoZikNCgkJCQkJCQl9DQoJCQkJCQkJSC5hcHBseShyLCBmKSwgaSAmJiAhZSAmJiAwIDwgZi5sZW5ndGggJiYgMSA8IHUgKyB5Lmxlbmd0aCAmJiBzZS51bmlxdWVTb3J0KHIpDQoJCQkJCQl9DQoJCQkJCQlyZXR1cm4gaSAmJiAoayA9IGgsIHcgPSBwKSwgYw0KCQkJCQl9LCBtID8gbGUocikgOiByKSkpLnNlbGVjdG9yID0gZQ0KCQkJCX0NCgkJCQlyZXR1cm4gYQ0KCQkJfSwgZyA9IHNlLnNlbGVjdCA9IGZ1bmN0aW9uKGUsIHQsIG4sIHIpIHsNCgkJCQl2YXIgaSwgbywgYSwgcywgdSwgbCA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGUgJiYgZSwgYyA9ICFyICYmIGgoZSA9IGwuc2VsZWN0b3IgfHwgZSk7DQoJCQkJaWYobiA9IG4gfHwgW10sIDEgPT09IGMubGVuZ3RoKSB7DQoJCQkJCWlmKDIgPCAobyA9IGNbMF0gPSBjWzBdLnNsaWNlKDApKS5sZW5ndGggJiYgIklEIiA9PT0gKGEgPSBvWzBdKS50eXBlICYmIDkgPT09IHQubm9kZVR5cGUgJiYgRSAmJiBiLnJlbGF0aXZlW29bMV0udHlwZV0pIHsNCgkJCQkJCWlmKCEodCA9IChiLmZpbmQuSUQoYS5tYXRjaGVzWzBdLnJlcGxhY2UodGUsIG5lKSwgdCkgfHwgW10pWzBdKSkgcmV0dXJuIG47DQoJCQkJCQlsICYmICh0ID0gdC5wYXJlbnROb2RlKSwgZSA9IGUuc2xpY2Uoby5zaGlmdCgpLnZhbHVlLmxlbmd0aCkNCgkJCQkJfQ0KCQkJCQlpID0gRy5uZWVkc0NvbnRleHQudGVzdChlKSA/IDAgOiBvLmxlbmd0aDsNCgkJCQkJd2hpbGUoaS0tKSB7DQoJCQkJCQlpZihhID0gb1tpXSwgYi5yZWxhdGl2ZVtzID0gYS50eXBlXSkgYnJlYWs7DQoJCQkJCQlpZigodSA9IGIuZmluZFtzXSkgJiYgKHIgPSB1KGEubWF0Y2hlc1swXS5yZXBsYWNlKHRlLCBuZSksIGVlLnRlc3Qob1swXS50eXBlKSAmJiB5ZSh0LnBhcmVudE5vZGUpIHx8IHQpKSkgew0KCQkJCQkJCWlmKG8uc3BsaWNlKGksIDEpLCAhKGUgPSByLmxlbmd0aCAmJiB4ZShvKSkpIHJldHVybiBILmFwcGx5KG4sIHIpLCBuOw0KCQkJCQkJCWJyZWFrDQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9DQoJCQkJcmV0dXJuIChsIHx8IGYoZSwgYykpKHIsIHQsICFFLCBuLCAhdCB8fCBlZS50ZXN0KGUpICYmIHllKHQucGFyZW50Tm9kZSkgfHwgdCksIG4NCgkJCX0sIGQuc29ydFN0YWJsZSA9IFMuc3BsaXQoIiIpLnNvcnQoaikuam9pbigiIikgPT09IFMsIGQuZGV0ZWN0RHVwbGljYXRlcyA9ICEhbCwgVCgpLCBkLnNvcnREZXRhY2hlZCA9IGNlKGZ1bmN0aW9uKGUpIHtyZXR1cm4gMSAmIGUuY29tcGFyZURvY3VtZW50UG9zaXRpb24oQy5jcmVhdGVFbGVtZW50KCJmaWVsZHNldCIpKX0pLCBjZShmdW5jdGlvbihlKSB7cmV0dXJuIGUuaW5uZXJIVE1MID0gIjxhIGhyZWY9JyMnPjwvYT4iLCAiIyIgPT09IGUuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoImhyZWYiKX0pIHx8IGZlKCJ0eXBlfGhyZWZ8aGVpZ2h0fHdpZHRoIiwgZnVuY3Rpb24oZSwgdCwgbikge2lmKCFuKSByZXR1cm4gZS5nZXRBdHRyaWJ1dGUodCwgInR5cGUiID09PSB0LnRvTG93ZXJDYXNlKCkgPyAxIDogMil9KSwgZC5hdHRyaWJ1dGVzICYmIGNlKGZ1bmN0aW9uKGUpIHtyZXR1cm4gZS5pbm5lckhUTUwgPSAiPGlucHV0Lz4iLCBlLmZpcnN0Q2hpbGQuc2V0QXR0cmlidXRlKCJ2YWx1ZSIsICIiKSwgIiIgPT09IGUuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoInZhbHVlIil9KSB8fCBmZSgidmFsdWUiLCBmdW5jdGlvbihlLCB0LCBuKSB7aWYoIW4gJiYgImlucHV0IiA9PT0gZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKSByZXR1cm4gZS5kZWZhdWx0VmFsdWV9KSwgY2UoZnVuY3Rpb24oZSkge3JldHVybiBudWxsID09IGUuZ2V0QXR0cmlidXRlKCJkaXNhYmxlZCIpfSkgfHwgZmUoUiwgZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCXZhciByOw0KCQkJCWlmKCFuKSByZXR1cm4gITAgPT09IGVbdF0gPyB0LnRvTG93ZXJDYXNlKCkgOiAociA9IGUuZ2V0QXR0cmlidXRlTm9kZSh0KSkgJiYgci5zcGVjaWZpZWQgPyByLnZhbHVlIDogbnVsbA0KCQkJfSksIHNlDQoJCX0oQyk7DQoJCVMuZmluZCA9IGQsIFMuZXhwciA9IGQuc2VsZWN0b3JzLCBTLmV4cHJbIjoiXSA9IFMuZXhwci5wc2V1ZG9zLCBTLnVuaXF1ZVNvcnQgPSBTLnVuaXF1ZSA9IGQudW5pcXVlU29ydCwgUy50ZXh0ID0gZC5nZXRUZXh0LCBTLmlzWE1MRG9jID0gZC5pc1hNTCwgUy5jb250YWlucyA9IGQuY29udGFpbnMsIFMuZXNjYXBlU2VsZWN0b3IgPSBkLmVzY2FwZTsNCgkJdmFyIGggPSBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQl2YXIgciA9IFtdLCBpID0gdm9pZCAwICE9PSBuOw0KCQkJd2hpbGUoKGUgPSBlW3RdKSAmJiA5ICE9PSBlLm5vZGVUeXBlKSBpZigxID09PSBlLm5vZGVUeXBlKSB7DQoJCQkJaWYoaSAmJiBTKGUpLmlzKG4pKSBicmVhazsNCgkJCQlyLnB1c2goZSkNCgkJCX0NCgkJCXJldHVybiByDQoJCX0sIFQgID0gZnVuY3Rpb24oZSwgdCkgew0KCQkJZm9yKHZhciBuID0gW107IGU7IGUgPSBlLm5leHRTaWJsaW5nKSAxID09PSBlLm5vZGVUeXBlICYmIGUgIT09IHQgJiYgbi5wdXNoKGUpOw0KCQkJcmV0dXJuIG4NCgkJfSwgayAgPSBTLmV4cHIubWF0Y2gubmVlZHNDb250ZXh0Ow0KDQoJCWZ1bmN0aW9uIEEoZSwgdCkge3JldHVybiBlLm5vZGVOYW1lICYmIGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gdC50b0xvd2VyQ2FzZSgpfQ0KDQoJCXZhciBOID0gL148KFthLXpdW15cL1wwPjpceDIwXHRcclxuXGZdKilbXHgyMFx0XHJcblxmXSpcLz8+KD86PFwvXDE+fCkkL2k7DQoNCgkJZnVuY3Rpb24gaihlLCBuLCByKSB7cmV0dXJuIG0obikgPyBTLmdyZXAoZSwgZnVuY3Rpb24oZSwgdCkge3JldHVybiAhIW4uY2FsbChlLCB0LCBlKSAhPT0gcn0pIDogbi5ub2RlVHlwZSA/IFMuZ3JlcChlLCBmdW5jdGlvbihlKSB7cmV0dXJuIGUgPT09IG4gIT09IHJ9KSA6ICJzdHJpbmciICE9IHR5cGVvZiBuID8gUy5ncmVwKGUsIGZ1bmN0aW9uKGUpIHtyZXR1cm4gLTEgPCBpLmNhbGwobiwgZSkgIT09IHJ9KSA6IFMuZmlsdGVyKG4sIGUsIHIpfQ0KDQoJCVMuZmlsdGVyID0gZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJdmFyIHIgPSB0WzBdOw0KCQkJcmV0dXJuIG4gJiYgKGUgPSAiOm5vdCgiICsgZSArICIpIiksIDEgPT09IHQubGVuZ3RoICYmIDEgPT09IHIubm9kZVR5cGUgPyBTLmZpbmQubWF0Y2hlc1NlbGVjdG9yKHIsIGUpID8gW3JdIDogW10gOiBTLmZpbmQubWF0Y2hlcyhlLCBTLmdyZXAodCwgZnVuY3Rpb24oZSkge3JldHVybiAxID09PSBlLm5vZGVUeXBlfSkpDQoJCX0sIFMuZm4uZXh0ZW5kKHsNCgkJCWZpbmQ6IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCwgbiwgciA9IHRoaXMubGVuZ3RoLCBpID0gdGhpczsNCgkJCQlpZigic3RyaW5nIiAhPSB0eXBlb2YgZSkgcmV0dXJuIHRoaXMucHVzaFN0YWNrKFMoZSkuZmlsdGVyKGZ1bmN0aW9uKCkge2Zvcih0ID0gMDsgdCA8IHI7IHQrKykgaWYoUy5jb250YWlucyhpW3RdLCB0aGlzKSkgcmV0dXJuICEwfSkpOw0KCQkJCWZvcihuID0gdGhpcy5wdXNoU3RhY2soW10pLCB0ID0gMDsgdCA8IHI7IHQrKykgUy5maW5kKGUsIGlbdF0sIG4pOw0KCQkJCXJldHVybiAxIDwgciA/IFMudW5pcXVlU29ydChuKSA6IG4NCgkJCX0sIGZpbHRlcjogZnVuY3Rpb24oZSkge3JldHVybiB0aGlzLnB1c2hTdGFjayhqKHRoaXMsIGUgfHwgW10sICExKSl9LCBub3Q6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gdGhpcy5wdXNoU3RhY2soaih0aGlzLCBlIHx8IFtdLCAhMCkpfSwgaXM6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gISFqKHRoaXMsICJzdHJpbmciID09IHR5cGVvZiBlICYmIGsudGVzdChlKSA/IFMoZSkgOiBlIHx8IFtdLCAhMSkubGVuZ3RofQ0KCQl9KTsNCgkJdmFyIEQsIHEgPSAvXig/OlxzKig8W1x3XFddKz4pW14+XSp8IyhbXHctXSspKSQvOw0KCQkoUy5mbi5pbml0ID0gZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJdmFyIHIsIGk7DQoJCQlpZighZSkgcmV0dXJuIHRoaXM7DQoJCQlpZihuID0gbiB8fCBELCAic3RyaW5nIiA9PSB0eXBlb2YgZSkgew0KCQkJCWlmKCEociA9ICI8IiA9PT0gZVswXSAmJiAiPiIgPT09IGVbZS5sZW5ndGggLSAxXSAmJiAzIDw9IGUubGVuZ3RoID8gW251bGwsIGUsIG51bGxdIDogcS5leGVjKGUpKSB8fCAhclsxXSAmJiB0KSByZXR1cm4gIXQgfHwgdC5qcXVlcnkgPyAodCB8fCBuKS5maW5kKGUpIDogdGhpcy5jb25zdHJ1Y3Rvcih0KS5maW5kKGUpOw0KCQkJCWlmKHJbMV0pIHsNCgkJCQkJaWYodCA9IHQgaW5zdGFuY2VvZiBTID8gdFswXSA6IHQsIFMubWVyZ2UodGhpcywgUy5wYXJzZUhUTUwoclsxXSwgdCAmJiB0Lm5vZGVUeXBlID8gdC5vd25lckRvY3VtZW50IHx8IHQgOiBFLCAhMCkpLCBOLnRlc3QoclsxXSkgJiYgUy5pc1BsYWluT2JqZWN0KHQpKSBmb3IociBpbiB0KSBtKHRoaXNbcl0pID8gdGhpc1tyXSh0W3JdKSA6IHRoaXMuYXR0cihyLCB0W3JdKTsNCgkJCQkJcmV0dXJuIHRoaXMNCgkJCQl9DQoJCQkJcmV0dXJuIChpID0gRS5nZXRFbGVtZW50QnlJZChyWzJdKSkgJiYgKHRoaXNbMF0gPSBpLCB0aGlzLmxlbmd0aCA9IDEpLCB0aGlzDQoJCQl9DQoJCQlyZXR1cm4gZS5ub2RlVHlwZSA/ICh0aGlzWzBdID0gZSwgdGhpcy5sZW5ndGggPSAxLCB0aGlzKSA6IG0oZSkgPyB2b2lkIDAgIT09IG4ucmVhZHkgPyBuLnJlYWR5KGUpIDogZShTKSA6IFMubWFrZUFycmF5KGUsIHRoaXMpDQoJCX0pLnByb3RvdHlwZSA9IFMuZm4sIEQgPSBTKEUpOw0KCQl2YXIgTCA9IC9eKD86cGFyZW50c3xwcmV2KD86VW50aWx8QWxsKSkvLCBIID0ge2NoaWxkcmVuOiAhMCwgY29udGVudHM6ICEwLCBuZXh0OiAhMCwgcHJldjogITB9Ow0KDQoJCWZ1bmN0aW9uIE8oZSwgdCkgew0KCQkJd2hpbGUoKGUgPSBlW3RdKSAmJiAxICE9PSBlLm5vZGVUeXBlKSA7DQoJCQlyZXR1cm4gZQ0KCQl9DQoNCgkJUy5mbi5leHRlbmQoew0KCQkJaGFzOiBmdW5jdGlvbihlKSB7DQoJCQkJdmFyIHQgPSBTKGUsIHRoaXMpLCBuID0gdC5sZW5ndGg7DQoJCQkJcmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uKCkge2Zvcih2YXIgZSA9IDA7IGUgPCBuOyBlKyspIGlmKFMuY29udGFpbnModGhpcywgdFtlXSkpIHJldHVybiAhMH0pDQoJCQl9LA0KCQkJY2xvc2VzdDogZnVuY3Rpb24oZSwgdCkgew0KCQkJCXZhciBuLCByID0gMCwgaSA9IHRoaXMubGVuZ3RoLCBvID0gW10sIGEgPSAic3RyaW5nIiAhPSB0eXBlb2YgZSAmJiBTKGUpOw0KCQkJCWlmKCFrLnRlc3QoZSkpIGZvcig7IHIgPCBpOyByKyspIGZvcihuID0gdGhpc1tyXTsgbiAmJiBuICE9PSB0OyBuID0gbi5wYXJlbnROb2RlKSBpZihuLm5vZGVUeXBlIDwgMTEgJiYgKGEgPyAtMSA8IGEuaW5kZXgobikgOiAxID09PSBuLm5vZGVUeXBlICYmIFMuZmluZC5tYXRjaGVzU2VsZWN0b3IobiwgZSkpKSB7DQoJCQkJCW8ucHVzaChuKTsNCgkJCQkJYnJlYWsNCgkJCQl9DQoJCQkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKDEgPCBvLmxlbmd0aCA/IFMudW5pcXVlU29ydChvKSA6IG8pDQoJCQl9LA0KCQkJaW5kZXg6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gZSA/ICJzdHJpbmciID09IHR5cGVvZiBlID8gaS5jYWxsKFMoZSksIHRoaXNbMF0pIDogaS5jYWxsKHRoaXMsIGUuanF1ZXJ5ID8gZVswXSA6IGUpIDogdGhpc1swXSAmJiB0aGlzWzBdLnBhcmVudE5vZGUgPyB0aGlzLmZpcnN0KCkucHJldkFsbCgpLmxlbmd0aCA6IC0xfSwNCgkJCWFkZDogZnVuY3Rpb24oZSwgdCkge3JldHVybiB0aGlzLnB1c2hTdGFjayhTLnVuaXF1ZVNvcnQoUy5tZXJnZSh0aGlzLmdldCgpLCBTKGUsIHQpKSkpfSwNCgkJCWFkZEJhY2s6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gdGhpcy5hZGQobnVsbCA9PSBlID8gdGhpcy5wcmV2T2JqZWN0IDogdGhpcy5wcmV2T2JqZWN0LmZpbHRlcihlKSl9DQoJCX0pLCBTLmVhY2goew0KCQkJcGFyZW50OiBmdW5jdGlvbihlKSB7DQoJCQkJdmFyIHQgPSBlLnBhcmVudE5vZGU7DQoJCQkJcmV0dXJuIHQgJiYgMTEgIT09IHQubm9kZVR5cGUgPyB0IDogbnVsbA0KCQkJfSwNCgkJCXBhcmVudHM6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gaChlLCAicGFyZW50Tm9kZSIpfSwNCgkJCXBhcmVudHNVbnRpbDogZnVuY3Rpb24oZSwgdCwgbikge3JldHVybiBoKGUsICJwYXJlbnROb2RlIiwgbil9LA0KCQkJbmV4dDogZnVuY3Rpb24oZSkge3JldHVybiBPKGUsICJuZXh0U2libGluZyIpfSwNCgkJCXByZXY6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gTyhlLCAicHJldmlvdXNTaWJsaW5nIil9LA0KCQkJbmV4dEFsbDogZnVuY3Rpb24oZSkge3JldHVybiBoKGUsICJuZXh0U2libGluZyIpfSwNCgkJCXByZXZBbGw6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gaChlLCAicHJldmlvdXNTaWJsaW5nIil9LA0KCQkJbmV4dFVudGlsOiBmdW5jdGlvbihlLCB0LCBuKSB7cmV0dXJuIGgoZSwgIm5leHRTaWJsaW5nIiwgbil9LA0KCQkJcHJldlVudGlsOiBmdW5jdGlvbihlLCB0LCBuKSB7cmV0dXJuIGgoZSwgInByZXZpb3VzU2libGluZyIsIG4pfSwNCgkJCXNpYmxpbmdzOiBmdW5jdGlvbihlKSB7cmV0dXJuIFQoKGUucGFyZW50Tm9kZSB8fCB7fSkuZmlyc3RDaGlsZCwgZSl9LA0KCQkJY2hpbGRyZW46IGZ1bmN0aW9uKGUpIHtyZXR1cm4gVChlLmZpcnN0Q2hpbGQpfSwNCgkJCWNvbnRlbnRzOiBmdW5jdGlvbihlKSB7cmV0dXJuIG51bGwgIT0gZS5jb250ZW50RG9jdW1lbnQgJiYgcihlLmNvbnRlbnREb2N1bWVudCkgPyBlLmNvbnRlbnREb2N1bWVudCA6IChBKGUsICJ0ZW1wbGF0ZSIpICYmIChlID0gZS5jb250ZW50IHx8IGUpLCBTLm1lcmdlKFtdLCBlLmNoaWxkTm9kZXMpKX0NCgkJfSwgZnVuY3Rpb24ociwgaSkgew0KCQkJUy5mbltyXSA9IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQl2YXIgbiA9IFMubWFwKHRoaXMsIGksIGUpOw0KCQkJCXJldHVybiAiVW50aWwiICE9PSByLnNsaWNlKC01KSAmJiAodCA9IGUpLCB0ICYmICJzdHJpbmciID09IHR5cGVvZiB0ICYmIChuID0gUy5maWx0ZXIodCwgbikpLCAxIDwgdGhpcy5sZW5ndGggJiYgKEhbcl0gfHwgUy51bmlxdWVTb3J0KG4pLCBMLnRlc3QocikgJiYgbi5yZXZlcnNlKCkpLCB0aGlzLnB1c2hTdGFjayhuKQ0KCQkJfQ0KCQl9KTsNCgkJdmFyIFAgPSAvW15ceDIwXHRcclxuXGZdKy9nOw0KDQoJCWZ1bmN0aW9uIFIoZSkge3JldHVybiBlfQ0KDQoJCWZ1bmN0aW9uIE0oZSkge3Rocm93IGV9DQoNCgkJZnVuY3Rpb24gSShlLCB0LCBuLCByKSB7DQoJCQl2YXIgaTsNCgkJCXRyeSB7ZSAmJiBtKGkgPSBlLnByb21pc2UpID8gaS5jYWxsKGUpLmRvbmUodCkuZmFpbChuKSA6IGUgJiYgbShpID0gZS50aGVuKSA/IGkuY2FsbChlLCB0LCBuKSA6IHQuYXBwbHkodm9pZCAwLCBbZV0uc2xpY2UocikpfSBjYXRjaChlKSB7bi5hcHBseSh2b2lkIDAsIFtlXSl9DQoJCX0NCg0KCQlTLkNhbGxiYWNrcyA9IGZ1bmN0aW9uKHIpIHsNCgkJCXZhciBlLCBuOw0KCQkJciA9ICJzdHJpbmciID09IHR5cGVvZiByID8gKGUgPSByLCBuID0ge30sIFMuZWFjaChlLm1hdGNoKFApIHx8IFtdLCBmdW5jdGlvbihlLCB0KSB7blt0XSA9ICEwfSksIG4pIDogUy5leHRlbmQoe30sIHIpOw0KCQkJdmFyIGksDQoJCQkgICAgdCwNCgkJCSAgICBvLA0KCQkJICAgIGEsDQoJCQkgICAgcyA9IFtdLA0KCQkJICAgIHUgPSBbXSwNCgkJCSAgICBsID0gLTEsDQoJCQkgICAgYyA9IGZ1bmN0aW9uKCkgew0KCQkJCSAgICBmb3IoYSA9IGEgfHwgci5vbmNlLCBvID0gaSA9ICEwOyB1Lmxlbmd0aDsgbCA9IC0xKSB7DQoJCQkJCSAgICB0ID0gdS5zaGlmdCgpOw0KCQkJCQkgICAgd2hpbGUoKytsIDwgcy5sZW5ndGgpICExID09PSBzW2xdLmFwcGx5KHRbMF0sIHRbMV0pICYmIHIuc3RvcE9uRmFsc2UgJiYgKGwgPSBzLmxlbmd0aCwgdCA9ICExKQ0KCQkJCSAgICB9DQoJCQkJICAgIHIubWVtb3J5IHx8ICh0ID0gITEpLCBpID0gITEsIGEgJiYgKHMgPSB0ID8gW10gOiAiIikNCgkJCSAgICB9LA0KCQkJICAgIGYgPSB7DQoJCQkJICAgIGFkZDogZnVuY3Rpb24oKSB7cmV0dXJuIHMgJiYgKHQgJiYgIWkgJiYgKGwgPSBzLmxlbmd0aCAtIDEsIHUucHVzaCh0KSksIGZ1bmN0aW9uIG4oZSkge1MuZWFjaChlLCBmdW5jdGlvbihlLCB0KSB7bSh0KSA/IHIudW5pcXVlICYmIGYuaGFzKHQpIHx8IHMucHVzaCh0KSA6IHQgJiYgdC5sZW5ndGggJiYgInN0cmluZyIgIT09IHcodCkgJiYgbih0KX0pfShhcmd1bWVudHMpLCB0ICYmICFpICYmIGMoKSksIHRoaXN9LA0KCQkJCSAgICByZW1vdmU6IGZ1bmN0aW9uKCkgew0KCQkJCQkgICAgcmV0dXJuIFMuZWFjaChhcmd1bWVudHMsIGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJCSAgICB2YXIgbjsNCgkJCQkJCSAgICB3aGlsZSgtMSA8IChuID0gUy5pbkFycmF5KHQsIHMsIG4pKSkgcy5zcGxpY2UobiwgMSksIG4gPD0gbCAmJiBsLS0NCgkJCQkJICAgIH0pLCB0aGlzDQoJCQkJICAgIH0sDQoJCQkJICAgIGhhczogZnVuY3Rpb24oZSkge3JldHVybiBlID8gLTEgPCBTLmluQXJyYXkoZSwgcykgOiAwIDwgcy5sZW5ndGh9LA0KCQkJCSAgICBlbXB0eTogZnVuY3Rpb24oKSB7cmV0dXJuIHMgJiYgKHMgPSBbXSksIHRoaXN9LA0KCQkJCSAgICBkaXNhYmxlOiBmdW5jdGlvbigpIHtyZXR1cm4gYSA9IHUgPSBbXSwgcyA9IHQgPSAiIiwgdGhpc30sDQoJCQkJICAgIGRpc2FibGVkOiBmdW5jdGlvbigpIHtyZXR1cm4gIXN9LA0KCQkJCSAgICBsb2NrOiBmdW5jdGlvbigpIHtyZXR1cm4gYSA9IHUgPSBbXSwgdCB8fCBpIHx8IChzID0gdCA9ICIiKSwgdGhpc30sDQoJCQkJICAgIGxvY2tlZDogZnVuY3Rpb24oKSB7cmV0dXJuICEhYX0sDQoJCQkJICAgIGZpcmVXaXRoOiBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIGEgfHwgKHQgPSBbZSwgKHQgPSB0IHx8IFtdKS5zbGljZSA/IHQuc2xpY2UoKSA6IHRdLCB1LnB1c2godCksIGkgfHwgYygpKSwgdGhpc30sDQoJCQkJICAgIGZpcmU6IGZ1bmN0aW9uKCkge3JldHVybiBmLmZpcmVXaXRoKHRoaXMsIGFyZ3VtZW50cyksIHRoaXN9LA0KCQkJCSAgICBmaXJlZDogZnVuY3Rpb24oKSB7cmV0dXJuICEhb30NCgkJCSAgICB9Ow0KCQkJcmV0dXJuIGYNCgkJfSwgUy5leHRlbmQoew0KCQkJRGVmZXJyZWQ6IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgbyA9IFtbIm5vdGlmeSIsICJwcm9ncmVzcyIsIFMuQ2FsbGJhY2tzKCJtZW1vcnkiKSwgUy5DYWxsYmFja3MoIm1lbW9yeSIpLCAyXSwgWyJyZXNvbHZlIiwgImRvbmUiLCBTLkNhbGxiYWNrcygib25jZSBtZW1vcnkiKSwgUy5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksIDAsICJyZXNvbHZlZCJdLCBbInJlamVjdCIsICJmYWlsIiwgUy5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksIFMuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLCAxLCAicmVqZWN0ZWQiXV0sDQoJCQkJICAgIGkgPSAicGVuZGluZyIsDQoJCQkJICAgIGEgPSB7DQoJCQkJCSAgICBzdGF0ZTogZnVuY3Rpb24oKSB7cmV0dXJuIGl9LCBhbHdheXM6IGZ1bmN0aW9uKCkge3JldHVybiBzLmRvbmUoYXJndW1lbnRzKS5mYWlsKGFyZ3VtZW50cyksIHRoaXN9LCAiY2F0Y2giOiBmdW5jdGlvbihlKSB7cmV0dXJuIGEudGhlbihudWxsLCBlKX0sIHBpcGU6IGZ1bmN0aW9uKCkgew0KCQkJCQkJICAgIHZhciBpID0gYXJndW1lbnRzOw0KCQkJCQkJICAgIHJldHVybiBTLkRlZmVycmVkKGZ1bmN0aW9uKHIpIHsNCgkJCQkJCQkgICAgUy5lYWNoKG8sIGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJCQkJICAgIHZhciBuID0gbShpW3RbNF1dKSAmJiBpW3RbNF1dOw0KCQkJCQkJCQkgICAgc1t0WzFdXShmdW5jdGlvbigpIHsNCgkJCQkJCQkJCSAgICB2YXIgZSA9IG4gJiYgbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOw0KCQkJCQkJCQkJICAgIGUgJiYgbShlLnByb21pc2UpID8gZS5wcm9taXNlKCkucHJvZ3Jlc3Moci5ub3RpZnkpLmRvbmUoci5yZXNvbHZlKS5mYWlsKHIucmVqZWN0KSA6IHJbdFswXSArICJXaXRoIl0odGhpcywgbiA/IFtlXSA6IGFyZ3VtZW50cykNCgkJCQkJCQkJICAgIH0pDQoJCQkJCQkJICAgIH0pLCBpID0gbnVsbA0KCQkJCQkJICAgIH0pLnByb21pc2UoKQ0KCQkJCQkgICAgfSwgdGhlbjogZnVuY3Rpb24odCwgbiwgcikgew0KCQkJCQkJICAgIHZhciB1ID0gMDsNCg0KCQkJCQkJICAgIGZ1bmN0aW9uIGwoaSwgbywgYSwgcykgew0KCQkJCQkJCSAgICByZXR1cm4gZnVuY3Rpb24oKSB7DQoJCQkJCQkJCSAgICB2YXIgbiA9IHRoaXMsIHIgPSBhcmd1bWVudHMsIGUgPSBmdW5jdGlvbigpIHsNCgkJCQkJCQkJCSAgICB2YXIgZSwgdDsNCgkJCQkJCQkJCSAgICBpZighKGkgPCB1KSkgew0KCQkJCQkJCQkJCSAgICBpZigoZSA9IGEuYXBwbHkobiwgcikpID09PSBvLnByb21pc2UoKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiVGhlbmFibGUgc2VsZi1yZXNvbHV0aW9uIik7DQoJCQkJCQkJCQkJICAgIHQgPSBlICYmICgib2JqZWN0IiA9PSB0eXBlb2YgZSB8fCAiZnVuY3Rpb24iID09IHR5cGVvZiBlKSAmJiBlLnRoZW4sIG0odCkgPyBzID8gdC5jYWxsKGUsIGwodSwgbywgUiwgcyksIGwodSwgbywgTSwgcykpIDogKHUrKywgdC5jYWxsKGUsIGwodSwgbywgUiwgcyksIGwodSwgbywgTSwgcyksIGwodSwgbywgUiwgby5ub3RpZnlXaXRoKSkpIDogKGEgIT09IFIgJiYgKG4gPSB2b2lkIDAsIHIgPSBbZV0pLCAocyB8fCBvLnJlc29sdmVXaXRoKShuLCByKSkNCgkJCQkJCQkJCSAgICB9DQoJCQkJCQkJCSAgICB9LCB0ICAgICAgICAgICAgICAgICAgICAgICAgICAgPSBzID8gZSA6IGZ1bmN0aW9uKCkge3RyeSB7ZSgpfSBjYXRjaChlKSB7Uy5EZWZlcnJlZC5leGNlcHRpb25Ib29rICYmIFMuRGVmZXJyZWQuZXhjZXB0aW9uSG9vayhlLCB0LnN0YWNrVHJhY2UpLCB1IDw9IGkgKyAxICYmIChhICE9PSBNICYmIChuID0gdm9pZCAwLCByID0gW2VdKSwgby5yZWplY3RXaXRoKG4sIHIpKX19Ow0KCQkJCQkJCQkgICAgaSA/IHQoKSA6IChTLkRlZmVycmVkLmdldFN0YWNrSG9vayAmJiAodC5zdGFja1RyYWNlID0gUy5EZWZlcnJlZC5nZXRTdGFja0hvb2soKSksIEMuc2V0VGltZW91dCh0KSkNCgkJCQkJCQkgICAgfQ0KCQkJCQkJICAgIH0NCg0KCQkJCQkJICAgIHJldHVybiBTLkRlZmVycmVkKGZ1bmN0aW9uKGUpIHtvWzBdWzNdLmFkZChsKDAsIGUsIG0ocikgPyByIDogUiwgZS5ub3RpZnlXaXRoKSksIG9bMV1bM10uYWRkKGwoMCwgZSwgbSh0KSA/IHQgOiBSKSksIG9bMl1bM10uYWRkKGwoMCwgZSwgbShuKSA/IG4gOiBNKSl9KS5wcm9taXNlKCkNCgkJCQkJICAgIH0sIHByb21pc2U6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gbnVsbCAhPSBlID8gUy5leHRlbmQoZSwgYSkgOiBhfQ0KCQkJCSAgICB9LA0KCQkJCSAgICBzID0ge307DQoJCQkJcmV0dXJuIFMuZWFjaChvLCBmdW5jdGlvbihlLCB0KSB7DQoJCQkJCXZhciBuID0gdFsyXSwgciA9IHRbNV07DQoJCQkJCWFbdFsxXV0gPSBuLmFkZCwgciAmJiBuLmFkZChmdW5jdGlvbigpIHtpID0gcn0sIG9bMyAtIGVdWzJdLmRpc2FibGUsIG9bMyAtIGVdWzNdLmRpc2FibGUsIG9bMF1bMl0ubG9jaywgb1swXVszXS5sb2NrKSwgbi5hZGQodFszXS5maXJlKSwgc1t0WzBdXSA9IGZ1bmN0aW9uKCkge3JldHVybiBzW3RbMF0gKyAiV2l0aCJdKHRoaXMgPT09IHMgPyB2b2lkIDAgOiB0aGlzLCBhcmd1bWVudHMpLCB0aGlzfSwgc1t0WzBdICsgIldpdGgiXSA9IG4uZmlyZVdpdGgNCgkJCQl9KSwgYS5wcm9taXNlKHMpLCBlICYmIGUuY2FsbChzLCBzKSwgcw0KCQkJfSwgd2hlbjogZnVuY3Rpb24oZSkgew0KCQkJCXZhciBuID0gYXJndW1lbnRzLmxlbmd0aCwgdCA9IG4sIHIgPSBBcnJheSh0KSwgaSA9IHMuY2FsbChhcmd1bWVudHMpLCBvID0gUy5EZWZlcnJlZCgpLCBhID0gZnVuY3Rpb24odCkge3JldHVybiBmdW5jdGlvbihlKSB7clt0XSA9IHRoaXMsIGlbdF0gPSAxIDwgYXJndW1lbnRzLmxlbmd0aCA/IHMuY2FsbChhcmd1bWVudHMpIDogZSwgLS1uIHx8IG8ucmVzb2x2ZVdpdGgociwgaSl9fTsNCgkJCQlpZihuIDw9IDEgJiYgKEkoZSwgby5kb25lKGEodCkpLnJlc29sdmUsIG8ucmVqZWN0LCAhbiksICJwZW5kaW5nIiA9PT0gby5zdGF0ZSgpIHx8IG0oaVt0XSAmJiBpW3RdLnRoZW4pKSkgcmV0dXJuIG8udGhlbigpOw0KCQkJCXdoaWxlKHQtLSkgSShpW3RdLCBhKHQpLCBvLnJlamVjdCk7DQoJCQkJcmV0dXJuIG8ucHJvbWlzZSgpDQoJCQl9DQoJCX0pOw0KCQl2YXIgVyA9IC9eKEV2YWx8SW50ZXJuYWx8UmFuZ2V8UmVmZXJlbmNlfFN5bnRheHxUeXBlfFVSSSlFcnJvciQvOw0KCQlTLkRlZmVycmVkLmV4Y2VwdGlvbkhvb2sgPSBmdW5jdGlvbihlLCB0KSB7Qy5jb25zb2xlICYmIEMuY29uc29sZS53YXJuICYmIGUgJiYgVy50ZXN0KGUubmFtZSkgJiYgQy5jb25zb2xlLndhcm4oImpRdWVyeS5EZWZlcnJlZCBleGNlcHRpb246ICIgKyBlLm1lc3NhZ2UsIGUuc3RhY2ssIHQpfSwgUy5yZWFkeUV4Y2VwdGlvbiA9IGZ1bmN0aW9uKGUpIHtDLnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7dGhyb3cgZX0pfTsNCgkJdmFyIEYgPSBTLkRlZmVycmVkKCk7DQoNCgkJZnVuY3Rpb24gQigpIHtFLnJlbW92ZUV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBCKSwgQy5yZW1vdmVFdmVudExpc3RlbmVyKCJsb2FkIiwgQiksIFMucmVhZHkoKX0NCg0KCQlTLmZuLnJlYWR5ID0gZnVuY3Rpb24oZSkge3JldHVybiBGLnRoZW4oZSlbImNhdGNoIl0oZnVuY3Rpb24oZSkge1MucmVhZHlFeGNlcHRpb24oZSl9KSwgdGhpc30sIFMuZXh0ZW5kKHsNCgkJCWlzUmVhZHk6ICExLA0KCQkJcmVhZHlXYWl0OiAxLA0KCQkJcmVhZHk6IGZ1bmN0aW9uKGUpIHsoITAgPT09IGUgPyAtLVMucmVhZHlXYWl0IDogUy5pc1JlYWR5KSB8fCAoUy5pc1JlYWR5ID0gITApICE9PSBlICYmIDAgPCAtLVMucmVhZHlXYWl0IHx8IEYucmVzb2x2ZVdpdGgoRSwgW1NdKX0NCgkJfSksIFMucmVhZHkudGhlbiA9IEYudGhlbiwgImNvbXBsZXRlIiA9PT0gRS5yZWFkeVN0YXRlIHx8ICJsb2FkaW5nIiAhPT0gRS5yZWFkeVN0YXRlICYmICFFLmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCA/IEMuc2V0VGltZW91dChTLnJlYWR5KSA6IChFLmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBCKSwgQy5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgQikpOw0KCQl2YXIgJCA9IGZ1bmN0aW9uKGUsIHQsIG4sIHIsIGksIG8sIGEpIHsNCgkJCXZhciBzID0gMCwgdSA9IGUubGVuZ3RoLCBsID0gbnVsbCA9PSBuOw0KCQkJaWYoIm9iamVjdCIgPT09IHcobikpIGZvcihzIGluIGkgPSAhMCwgbikgJChlLCB0LCBzLCBuW3NdLCAhMCwgbywgYSk7IGVsc2UgaWYodm9pZCAwICE9PSByICYmIChpID0gITAsIG0ocikgfHwgKGEgPSAhMCksIGwgJiYgKGEgPyAodC5jYWxsKGUsIHIpLCB0ID0gbnVsbCkgOiAobCA9IHQsIHQgPSBmdW5jdGlvbihlLCB0LCBuKSB7cmV0dXJuIGwuY2FsbChTKGUpLCBuKX0pKSwgdCkpIGZvcig7IHMgPCB1OyBzKyspIHQoZVtzXSwgbiwgYSA/IHIgOiByLmNhbGwoZVtzXSwgcywgdChlW3NdLCBuKSkpOw0KCQkJcmV0dXJuIGkgPyBlIDogbCA/IHQuY2FsbChlKSA6IHUgPyB0KGVbMF0sIG4pIDogbw0KCQl9LCBfICA9IC9eLW1zLS8sIHogPSAvLShbYS16XSkvZzsNCg0KCQlmdW5jdGlvbiBVKGUsIHQpIHtyZXR1cm4gdC50b1VwcGVyQ2FzZSgpfQ0KDQoJCWZ1bmN0aW9uIFgoZSkge3JldHVybiBlLnJlcGxhY2UoXywgIm1zLSIpLnJlcGxhY2UoeiwgVSl9DQoNCgkJdmFyIFYgPSBmdW5jdGlvbihlKSB7cmV0dXJuIDEgPT09IGUubm9kZVR5cGUgfHwgOSA9PT0gZS5ub2RlVHlwZSB8fCAhK2Uubm9kZVR5cGV9Ow0KDQoJCWZ1bmN0aW9uIEcoKSB7dGhpcy5leHBhbmRvID0gUy5leHBhbmRvICsgRy51aWQrK30NCg0KCQlHLnVpZCA9IDEsIEcucHJvdG90eXBlID0gew0KCQkJY2FjaGU6IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCA9IGVbdGhpcy5leHBhbmRvXTsNCgkJCQlyZXR1cm4gdCB8fCAodCA9IHt9LCBWKGUpICYmIChlLm5vZGVUeXBlID8gZVt0aGlzLmV4cGFuZG9dID0gdCA6IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCB0aGlzLmV4cGFuZG8sIHt2YWx1ZTogdCwgY29uZmlndXJhYmxlOiAhMH0pKSksIHQNCgkJCX0sDQoJCQlzZXQ6IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQl2YXIgciwgaSA9IHRoaXMuY2FjaGUoZSk7DQoJCQkJaWYoInN0cmluZyIgPT0gdHlwZW9mIHQpIGlbWCh0KV0gPSBuOyBlbHNlIGZvcihyIGluIHQpIGlbWChyKV0gPSB0W3JdOw0KCQkJCXJldHVybiBpDQoJCQl9LA0KCQkJZ2V0OiBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIHZvaWQgMCA9PT0gdCA/IHRoaXMuY2FjaGUoZSkgOiBlW3RoaXMuZXhwYW5kb10gJiYgZVt0aGlzLmV4cGFuZG9dW1godCldfSwNCgkJCWFjY2VzczogZnVuY3Rpb24oZSwgdCwgbikge3JldHVybiB2b2lkIDAgPT09IHQgfHwgdCAmJiAic3RyaW5nIiA9PSB0eXBlb2YgdCAmJiB2b2lkIDAgPT09IG4gPyB0aGlzLmdldChlLCB0KSA6ICh0aGlzLnNldChlLCB0LCBuKSwgdm9pZCAwICE9PSBuID8gbiA6IHQpfSwNCgkJCXJlbW92ZTogZnVuY3Rpb24oZSwgdCkgew0KCQkJCXZhciBuLCByID0gZVt0aGlzLmV4cGFuZG9dOw0KCQkJCWlmKHZvaWQgMCAhPT0gcikgew0KCQkJCQlpZih2b2lkIDAgIT09IHQpIHsNCgkJCQkJCW4gPSAodCA9IEFycmF5LmlzQXJyYXkodCkgPyB0Lm1hcChYKSA6ICh0ID0gWCh0KSkgaW4gciA/IFt0XSA6IHQubWF0Y2goUCkgfHwgW10pLmxlbmd0aDsNCgkJCQkJCXdoaWxlKG4tLSkgZGVsZXRlIHJbdFtuXV0NCgkJCQkJfQ0KCQkJCQkodm9pZCAwID09PSB0IHx8IFMuaXNFbXB0eU9iamVjdChyKSkgJiYgKGUubm9kZVR5cGUgPyBlW3RoaXMuZXhwYW5kb10gPSB2b2lkIDAgOiBkZWxldGUgZVt0aGlzLmV4cGFuZG9dKQ0KCQkJCX0NCgkJCX0sDQoJCQloYXNEYXRhOiBmdW5jdGlvbihlKSB7DQoJCQkJdmFyIHQgPSBlW3RoaXMuZXhwYW5kb107DQoJCQkJcmV0dXJuIHZvaWQgMCAhPT0gdCAmJiAhUy5pc0VtcHR5T2JqZWN0KHQpDQoJCQl9DQoJCX07DQoJCXZhciBZID0gbmV3IEcsIFEgPSBuZXcgRywgSiA9IC9eKD86XHtbXHdcV10qXH18XFtbXHdcV10qXF0pJC8sIEsgPSAvW0EtWl0vZzsNCg0KCQlmdW5jdGlvbiBaKGUsIHQsIG4pIHsNCgkJCXZhciByLCBpOw0KCQkJaWYodm9pZCAwID09PSBuICYmIDEgPT09IGUubm9kZVR5cGUpIGlmKHIgPSAiZGF0YS0iICsgdC5yZXBsYWNlKEssICItJCYiKS50b0xvd2VyQ2FzZSgpLCAic3RyaW5nIiA9PSB0eXBlb2YgKG4gPSBlLmdldEF0dHJpYnV0ZShyKSkpIHsNCgkJCQl0cnkge24gPSAidHJ1ZSIgPT09IChpID0gbikgfHwgImZhbHNlIiAhPT0gaSAmJiAoIm51bGwiID09PSBpID8gbnVsbCA6IGkgPT09ICtpICsgIiIgPyAraSA6IEoudGVzdChpKSA/IEpTT04ucGFyc2UoaSkgOiBpKX0gY2F0Y2goZSkge30NCgkJCQlRLnNldChlLCB0LCBuKQ0KCQkJfSBlbHNlIG4gPSB2b2lkIDA7DQoJCQlyZXR1cm4gbg0KCQl9DQoNCgkJUy5leHRlbmQoew0KCQkJaGFzRGF0YTogZnVuY3Rpb24oZSkge3JldHVybiBRLmhhc0RhdGEoZSkgfHwgWS5oYXNEYXRhKGUpfSwNCgkJCWRhdGE6IGZ1bmN0aW9uKGUsIHQsIG4pIHtyZXR1cm4gUS5hY2Nlc3MoZSwgdCwgbil9LA0KCQkJcmVtb3ZlRGF0YTogZnVuY3Rpb24oZSwgdCkge1EucmVtb3ZlKGUsIHQpfSwNCgkJCV9kYXRhOiBmdW5jdGlvbihlLCB0LCBuKSB7cmV0dXJuIFkuYWNjZXNzKGUsIHQsIG4pfSwNCgkJCV9yZW1vdmVEYXRhOiBmdW5jdGlvbihlLCB0KSB7WS5yZW1vdmUoZSwgdCl9DQoJCX0pLCBTLmZuLmV4dGVuZCh7DQoJCQlkYXRhOiBmdW5jdGlvbihuLCBlKSB7DQoJCQkJdmFyIHQsIHIsIGksIG8gPSB0aGlzWzBdLCBhID0gbyAmJiBvLmF0dHJpYnV0ZXM7DQoJCQkJaWYodm9pZCAwID09PSBuKSB7DQoJCQkJCWlmKHRoaXMubGVuZ3RoICYmIChpID0gUS5nZXQobyksIDEgPT09IG8ubm9kZVR5cGUgJiYgIVkuZ2V0KG8sICJoYXNEYXRhQXR0cnMiKSkpIHsNCgkJCQkJCXQgPSBhLmxlbmd0aDsNCgkJCQkJCXdoaWxlKHQtLSkgYVt0XSAmJiAwID09PSAociA9IGFbdF0ubmFtZSkuaW5kZXhPZigiZGF0YS0iKSAmJiAociA9IFgoci5zbGljZSg1KSksIFoobywgciwgaVtyXSkpOw0KCQkJCQkJWS5zZXQobywgImhhc0RhdGFBdHRycyIsICEwKQ0KCQkJCQl9DQoJCQkJCXJldHVybiBpDQoJCQkJfQ0KCQkJCXJldHVybiAib2JqZWN0IiA9PSB0eXBlb2YgbiA/IHRoaXMuZWFjaChmdW5jdGlvbigpIHtRLnNldCh0aGlzLCBuKX0pIDogJCh0aGlzLCBmdW5jdGlvbihlKSB7DQoJCQkJCXZhciB0Ow0KCQkJCQlpZihvICYmIHZvaWQgMCA9PT0gZSkgcmV0dXJuIHZvaWQgMCAhPT0gKHQgPSBRLmdldChvLCBuKSkgPyB0IDogdm9pZCAwICE9PSAodCA9IFoobywgbikpID8gdCA6IHZvaWQgMDsNCgkJCQkJdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1Euc2V0KHRoaXMsIG4sIGUpfSkNCgkJCQl9LCBudWxsLCBlLCAxIDwgYXJndW1lbnRzLmxlbmd0aCwgbnVsbCwgITApDQoJCQl9LCByZW1vdmVEYXRhOiBmdW5jdGlvbihlKSB7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtRLnJlbW92ZSh0aGlzLCBlKX0pfQ0KCQl9KSwgUy5leHRlbmQoew0KCQkJcXVldWU6IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQl2YXIgcjsNCgkJCQlpZihlKSByZXR1cm4gdCA9ICh0IHx8ICJmeCIpICsgInF1ZXVlIiwgciA9IFkuZ2V0KGUsIHQpLCBuICYmICghciB8fCBBcnJheS5pc0FycmF5KG4pID8gciA9IFkuYWNjZXNzKGUsIHQsIFMubWFrZUFycmF5KG4pKSA6IHIucHVzaChuKSksIHIgfHwgW10NCgkJCX0sIGRlcXVldWU6IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQl0ID0gdCB8fCAiZngiOw0KCQkJCXZhciBuID0gUy5xdWV1ZShlLCB0KSwgciA9IG4ubGVuZ3RoLCBpID0gbi5zaGlmdCgpLCBvID0gUy5fcXVldWVIb29rcyhlLCB0KTsNCgkJCQkiaW5wcm9ncmVzcyIgPT09IGkgJiYgKGkgPSBuLnNoaWZ0KCksIHItLSksIGkgJiYgKCJmeCIgPT09IHQgJiYgbi51bnNoaWZ0KCJpbnByb2dyZXNzIiksIGRlbGV0ZSBvLnN0b3AsIGkuY2FsbChlLCBmdW5jdGlvbigpIHtTLmRlcXVldWUoZSwgdCl9LCBvKSksICFyICYmIG8gJiYgby5lbXB0eS5maXJlKCkNCgkJCX0sIF9xdWV1ZUhvb2tzOiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4gPSB0ICsgInF1ZXVlSG9va3MiOw0KCQkJCXJldHVybiBZLmdldChlLCBuKSB8fCBZLmFjY2VzcyhlLCBuLCB7ZW1wdHk6IFMuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLmFkZChmdW5jdGlvbigpIHtZLnJlbW92ZShlLCBbdCArICJxdWV1ZSIsIG5dKX0pfSkNCgkJCX0NCgkJfSksIFMuZm4uZXh0ZW5kKHsNCgkJCXF1ZXVlOiBmdW5jdGlvbih0LCBuKSB7DQoJCQkJdmFyIGUgPSAyOw0KCQkJCXJldHVybiAic3RyaW5nIiAhPSB0eXBlb2YgdCAmJiAobiA9IHQsIHQgPSAiZngiLCBlLS0pLCBhcmd1bWVudHMubGVuZ3RoIDwgZSA/IFMucXVldWUodGhpc1swXSwgdCkgOiB2b2lkIDAgPT09IG4gPyB0aGlzIDogdGhpcy5lYWNoKGZ1bmN0aW9uKCkgew0KCQkJCQl2YXIgZSA9IFMucXVldWUodGhpcywgdCwgbik7DQoJCQkJCVMuX3F1ZXVlSG9va3ModGhpcywgdCksICJmeCIgPT09IHQgJiYgImlucHJvZ3Jlc3MiICE9PSBlWzBdICYmIFMuZGVxdWV1ZSh0aGlzLCB0KQ0KCQkJCX0pDQoJCQl9LCBkZXF1ZXVlOiBmdW5jdGlvbihlKSB7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtTLmRlcXVldWUodGhpcywgZSl9KX0sIGNsZWFyUXVldWU6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gdGhpcy5xdWV1ZShlIHx8ICJmeCIsIFtdKX0sIHByb21pc2U6IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQl2YXIgbiwgciA9IDEsIGkgPSBTLkRlZmVycmVkKCksIG8gPSB0aGlzLCBhID0gdGhpcy5sZW5ndGgsIHMgPSBmdW5jdGlvbigpIHstLXIgfHwgaS5yZXNvbHZlV2l0aChvLCBbb10pfTsNCgkJCQkic3RyaW5nIiAhPSB0eXBlb2YgZSAmJiAodCA9IGUsIGUgPSB2b2lkIDApLCBlID0gZSB8fCAiZngiOw0KCQkJCXdoaWxlKGEtLSkgKG4gPSBZLmdldChvW2FdLCBlICsgInF1ZXVlSG9va3MiKSkgJiYgbi5lbXB0eSAmJiAocisrLCBuLmVtcHR5LmFkZChzKSk7DQoJCQkJcmV0dXJuIHMoKSwgaS5wcm9taXNlKHQpDQoJCQl9DQoJCX0pOw0KCQl2YXIgZWUgPSAvWystXT8oPzpcZCpcLnwpXGQrKD86W2VFXVsrLV0/XGQrfCkvLnNvdXJjZSwgdGUgPSBuZXcgUmVnRXhwKCJeKD86KFsrLV0pPXwpKCIgKyBlZSArICIpKFthLXolXSopJCIsICJpIiksIG5lID0gWyJUb3AiLCAiUmlnaHQiLCAiQm90dG9tIiwgIkxlZnQiXSwgcmUgPSBFLmRvY3VtZW50RWxlbWVudCwgaWUgPSBmdW5jdGlvbihlKSB7cmV0dXJuIFMuY29udGFpbnMoZS5vd25lckRvY3VtZW50LCBlKX0sIG9lID0ge2NvbXBvc2VkOiAhMH07DQoJCXJlLmdldFJvb3ROb2RlICYmIChpZSA9IGZ1bmN0aW9uKGUpIHtyZXR1cm4gUy5jb250YWlucyhlLm93bmVyRG9jdW1lbnQsIGUpIHx8IGUuZ2V0Um9vdE5vZGUob2UpID09PSBlLm93bmVyRG9jdW1lbnR9KTsNCgkJdmFyIGFlID0gZnVuY3Rpb24oZSwgdCkge3JldHVybiAibm9uZSIgPT09IChlID0gdCB8fCBlKS5zdHlsZS5kaXNwbGF5IHx8ICIiID09PSBlLnN0eWxlLmRpc3BsYXkgJiYgaWUoZSkgJiYgIm5vbmUiID09PSBTLmNzcyhlLCAiZGlzcGxheSIpfTsNCg0KCQlmdW5jdGlvbiBzZShlLCB0LCBuLCByKSB7DQoJCQl2YXIgaSwgbywgYSA9IDIwLCBzID0gciA/IGZ1bmN0aW9uKCkge3JldHVybiByLmN1cigpfSA6IGZ1bmN0aW9uKCkge3JldHVybiBTLmNzcyhlLCB0LCAiIil9LCB1ID0gcygpLCBsID0gbiAmJiBuWzNdIHx8IChTLmNzc051bWJlclt0XSA/ICIiIDogInB4IiksIGMgPSBlLm5vZGVUeXBlICYmIChTLmNzc051bWJlclt0XSB8fCAicHgiICE9PSBsICYmICt1KSAmJiB0ZS5leGVjKFMuY3NzKGUsIHQpKTsNCgkJCWlmKGMgJiYgY1szXSAhPT0gbCkgew0KCQkJCXUgLz0gMiwgbCA9IGwgfHwgY1szXSwgYyA9ICt1IHx8IDE7DQoJCQkJd2hpbGUoYS0tKSBTLnN0eWxlKGUsIHQsIGMgKyBsKSwgKDEgLSBvKSAqICgxIC0gKG8gPSBzKCkgLyB1IHx8IC41KSkgPD0gMCAmJiAoYSA9IDApLCBjIC89IG87DQoJCQkJYyAqPSAyLCBTLnN0eWxlKGUsIHQsIGMgKyBsKSwgbiA9IG4gfHwgW10NCgkJCX0NCgkJCXJldHVybiBuICYmIChjID0gK2MgfHwgK3UgfHwgMCwgaSA9IG5bMV0gPyBjICsgKG5bMV0gKyAxKSAqIG5bMl0gOiArblsyXSwgciAmJiAoci51bml0ID0gbCwgci5zdGFydCA9IGMsIHIuZW5kID0gaSkpLCBpDQoJCX0NCg0KCQl2YXIgdWUgPSB7fTsNCg0KCQlmdW5jdGlvbiBsZShlLCB0KSB7DQoJCQlmb3IodmFyIG4sIHIsIGksIG8sIGEsIHMsIHUsIGwgPSBbXSwgYyA9IDAsIGYgPSBlLmxlbmd0aDsgYyA8IGY7IGMrKykgKHIgPSBlW2NdKS5zdHlsZSAmJiAobiA9IHIuc3R5bGUuZGlzcGxheSwgdCA/ICgibm9uZSIgPT09IG4gJiYgKGxbY10gPSBZLmdldChyLCAiZGlzcGxheSIpIHx8IG51bGwsIGxbY10gfHwgKHIuc3R5bGUuZGlzcGxheSA9ICIiKSksICIiID09PSByLnN0eWxlLmRpc3BsYXkgJiYgYWUocikgJiYgKGxbY10gPSAodSA9IGEgPSBvID0gdm9pZCAwLCBhID0gKGkgPSByKS5vd25lckRvY3VtZW50LCBzID0gaS5ub2RlTmFtZSwgKHUgPSB1ZVtzXSkgfHwgKG8gPSBhLmJvZHkuYXBwZW5kQ2hpbGQoYS5jcmVhdGVFbGVtZW50KHMpKSwgdSA9IFMuY3NzKG8sICJkaXNwbGF5IiksIG8ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChvKSwgIm5vbmUiID09PSB1ICYmICh1ID0gImJsb2NrIiksIHVlW3NdID0gdSkpKSkgOiAibm9uZSIgIT09IG4gJiYgKGxbY10gPSAibm9uZSIsIFkuc2V0KHIsICJkaXNwbGF5IiwgbikpKTsNCgkJCWZvcihjID0gMDsgYyA8IGY7IGMrKykgbnVsbCAhPSBsW2NdICYmIChlW2NdLnN0eWxlLmRpc3BsYXkgPSBsW2NdKTsNCgkJCXJldHVybiBlDQoJCX0NCg0KCQlTLmZuLmV4dGVuZCh7c2hvdzogZnVuY3Rpb24oKSB7cmV0dXJuIGxlKHRoaXMsICEwKX0sIGhpZGU6IGZ1bmN0aW9uKCkge3JldHVybiBsZSh0aGlzKX0sIHRvZ2dsZTogZnVuY3Rpb24oZSkge3JldHVybiAiYm9vbGVhbiIgPT0gdHlwZW9mIGUgPyBlID8gdGhpcy5zaG93KCkgOiB0aGlzLmhpZGUoKSA6IHRoaXMuZWFjaChmdW5jdGlvbigpIHthZSh0aGlzKSA/IFModGhpcykuc2hvdygpIDogUyh0aGlzKS5oaWRlKCl9KX19KTsNCgkJdmFyIGNlLCBmZSwgcGUgPSAvXig/OmNoZWNrYm94fHJhZGlvKSQvaSwgZGUgPSAvPChbYS16XVteXC9cMD5ceDIwXHRcclxuXGZdKikvaSwgaGUgPSAvXiR8Xm1vZHVsZSR8XC8oPzpqYXZhfGVjbWEpc2NyaXB0L2k7DQoJCWNlID0gRS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCkuYXBwZW5kQ2hpbGQoRS5jcmVhdGVFbGVtZW50KCJkaXYiKSksIChmZSA9IEUuY3JlYXRlRWxlbWVudCgiaW5wdXQiKSkuc2V0QXR0cmlidXRlKCJ0eXBlIiwgInJhZGlvIiksIGZlLnNldEF0dHJpYnV0ZSgiY2hlY2tlZCIsICJjaGVja2VkIiksIGZlLnNldEF0dHJpYnV0ZSgibmFtZSIsICJ0IiksIGNlLmFwcGVuZENoaWxkKGZlKSwgeS5jaGVja0Nsb25lID0gY2UuY2xvbmVOb2RlKCEwKS5jbG9uZU5vZGUoITApLmxhc3RDaGlsZC5jaGVja2VkLCBjZS5pbm5lckhUTUwgPSAiPHRleHRhcmVhPng8L3RleHRhcmVhPiIsIHkubm9DbG9uZUNoZWNrZWQgPSAhIWNlLmNsb25lTm9kZSghMCkubGFzdENoaWxkLmRlZmF1bHRWYWx1ZSwgY2UuaW5uZXJIVE1MID0gIjxvcHRpb24+PC9vcHRpb24+IiwgeS5vcHRpb24gPSAhIWNlLmxhc3RDaGlsZDsNCgkJdmFyIGdlID0ge3RoZWFkOiBbMSwgIjx0YWJsZT4iLCAiPC90YWJsZT4iXSwgY29sOiBbMiwgIjx0YWJsZT48Y29sZ3JvdXA+IiwgIjwvY29sZ3JvdXA+PC90YWJsZT4iXSwgdHI6IFsyLCAiPHRhYmxlPjx0Ym9keT4iLCAiPC90Ym9keT48L3RhYmxlPiJdLCB0ZDogWzMsICI8dGFibGU+PHRib2R5Pjx0cj4iLCAiPC90cj48L3Rib2R5PjwvdGFibGU+Il0sIF9kZWZhdWx0OiBbMCwgIiIsICIiXX07DQoNCgkJZnVuY3Rpb24gdmUoZSwgdCkgew0KCQkJdmFyIG47DQoJCQlyZXR1cm4gbiA9ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBlLmdldEVsZW1lbnRzQnlUYWdOYW1lID8gZS5nZXRFbGVtZW50c0J5VGFnTmFtZSh0IHx8ICIqIikgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZS5xdWVyeVNlbGVjdG9yQWxsID8gZS5xdWVyeVNlbGVjdG9yQWxsKHQgfHwgIioiKSA6IFtdLCB2b2lkIDAgPT09IHQgfHwgdCAmJiBBKGUsIHQpID8gUy5tZXJnZShbZV0sIG4pIDogbg0KCQl9DQoNCgkJZnVuY3Rpb24geWUoZSwgdCkge2Zvcih2YXIgbiA9IDAsIHIgPSBlLmxlbmd0aDsgbiA8IHI7IG4rKykgWS5zZXQoZVtuXSwgImdsb2JhbEV2YWwiLCAhdCB8fCBZLmdldCh0W25dLCAiZ2xvYmFsRXZhbCIpKX0NCg0KCQlnZS50Ym9keSA9IGdlLnRmb290ID0gZ2UuY29sZ3JvdXAgPSBnZS5jYXB0aW9uID0gZ2UudGhlYWQsIGdlLnRoID0gZ2UudGQsIHkub3B0aW9uIHx8IChnZS5vcHRncm91cCA9IGdlLm9wdGlvbiA9IFsxLCAiPHNlbGVjdCBtdWx0aXBsZT0nbXVsdGlwbGUnPiIsICI8L3NlbGVjdD4iXSk7DQoJCXZhciBtZSA9IC88fCYjP1x3KzsvOw0KDQoJCWZ1bmN0aW9uIHhlKGUsIHQsIG4sIHIsIGkpIHsNCgkJCWZvcih2YXIgbywgYSwgcywgdSwgbCwgYywgZiA9IHQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLCBwID0gW10sIGQgPSAwLCBoID0gZS5sZW5ndGg7IGQgPCBoOyBkKyspIGlmKChvID0gZVtkXSkgfHwgMCA9PT0gbykgaWYoIm9iamVjdCIgPT09IHcobykpIFMubWVyZ2UocCwgby5ub2RlVHlwZSA/IFtvXSA6IG8pOyBlbHNlIGlmKG1lLnRlc3QobykpIHsNCgkJCQlhID0gYSB8fCBmLmFwcGVuZENoaWxkKHQuY3JlYXRlRWxlbWVudCgiZGl2IikpLCBzID0gKGRlLmV4ZWMobykgfHwgWyIiLCAiIl0pWzFdLnRvTG93ZXJDYXNlKCksIHUgPSBnZVtzXSB8fCBnZS5fZGVmYXVsdCwgYS5pbm5lckhUTUwgPSB1WzFdICsgUy5odG1sUHJlZmlsdGVyKG8pICsgdVsyXSwgYyA9IHVbMF07DQoJCQkJd2hpbGUoYy0tKSBhID0gYS5sYXN0Q2hpbGQ7DQoJCQkJUy5tZXJnZShwLCBhLmNoaWxkTm9kZXMpLCAoYSA9IGYuZmlyc3RDaGlsZCkudGV4dENvbnRlbnQgPSAiIg0KCQkJfSBlbHNlIHAucHVzaCh0LmNyZWF0ZVRleHROb2RlKG8pKTsNCgkJCWYudGV4dENvbnRlbnQgPSAiIiwgZCA9IDA7DQoJCQl3aGlsZShvID0gcFtkKytdKSBpZihyICYmIC0xIDwgUy5pbkFycmF5KG8sIHIpKSBpICYmIGkucHVzaChvKTsgZWxzZSBpZihsID0gaWUobyksIGEgPSB2ZShmLmFwcGVuZENoaWxkKG8pLCAic2NyaXB0IiksIGwgJiYgeWUoYSksIG4pIHsNCgkJCQljID0gMDsNCgkJCQl3aGlsZShvID0gYVtjKytdKSBoZS50ZXN0KG8udHlwZSB8fCAiIikgJiYgbi5wdXNoKG8pDQoJCQl9DQoJCQlyZXR1cm4gZg0KCQl9DQoNCgkJdmFyIGJlID0gL14oW14uXSopKD86XC4oLispfCkvOw0KDQoJCWZ1bmN0aW9uIHdlKCkge3JldHVybiAhMH0NCg0KCQlmdW5jdGlvbiBUZSgpIHtyZXR1cm4gITF9DQoNCgkJZnVuY3Rpb24gQ2UoZSwgdCkge3JldHVybiBlID09PSBmdW5jdGlvbigpIHt0cnkge3JldHVybiBFLmFjdGl2ZUVsZW1lbnR9IGNhdGNoKGUpIHt9fSgpID09ICgiZm9jdXMiID09PSB0KX0NCg0KCQlmdW5jdGlvbiBFZShlLCB0LCBuLCByLCBpLCBvKSB7DQoJCQl2YXIgYSwgczsNCgkJCWlmKCJvYmplY3QiID09IHR5cGVvZiB0KSB7DQoJCQkJZm9yKHMgaW4gInN0cmluZyIgIT0gdHlwZW9mIG4gJiYgKHIgPSByIHx8IG4sIG4gPSB2b2lkIDApLCB0KSBFZShlLCBzLCBuLCByLCB0W3NdLCBvKTsNCgkJCQlyZXR1cm4gZQ0KCQkJfQ0KCQkJaWYobnVsbCA9PSByICYmIG51bGwgPT0gaSA/IChpID0gbiwgciA9IG4gPSB2b2lkIDApIDogbnVsbCA9PSBpICYmICgic3RyaW5nIiA9PSB0eXBlb2YgbiA/IChpID0gciwgciA9IHZvaWQgMCkgOiAoaSA9IHIsIHIgPSBuLCBuID0gdm9pZCAwKSksICExID09PSBpKSBpID0gVGU7IGVsc2UgaWYoIWkpIHJldHVybiBlOw0KCQkJcmV0dXJuIDEgPT09IG8gJiYgKGEgPSBpLCAoaSA9IGZ1bmN0aW9uKGUpIHtyZXR1cm4gUygpLm9mZihlKSwgYS5hcHBseSh0aGlzLCBhcmd1bWVudHMpfSkuZ3VpZCA9IGEuZ3VpZCB8fCAoYS5ndWlkID0gUy5ndWlkKyspKSwgZS5lYWNoKGZ1bmN0aW9uKCkge1MuZXZlbnQuYWRkKHRoaXMsIHQsIGksIHIsIG4pfSkNCgkJfQ0KDQoJCWZ1bmN0aW9uIFNlKGUsIGksIG8pIHsNCgkJCW8gPyAoWS5zZXQoZSwgaSwgITEpLCBTLmV2ZW50LmFkZChlLCBpLCB7DQoJCQkJbmFtZXNwYWNlOiAhMSwgaGFuZGxlcjogZnVuY3Rpb24oZSkgew0KCQkJCQl2YXIgdCwgbiwgciA9IFkuZ2V0KHRoaXMsIGkpOw0KCQkJCQlpZigxICYgZS5pc1RyaWdnZXIgJiYgdGhpc1tpXSkge2lmKHIubGVuZ3RoKSAoUy5ldmVudC5zcGVjaWFsW2ldIHx8IHt9KS5kZWxlZ2F0ZVR5cGUgJiYgZS5zdG9wUHJvcGFnYXRpb24oKTsgZWxzZSBpZihyID0gcy5jYWxsKGFyZ3VtZW50cyksIFkuc2V0KHRoaXMsIGksIHIpLCB0ID0gbyh0aGlzLCBpKSwgdGhpc1tpXSgpLCByICE9PSAobiA9IFkuZ2V0KHRoaXMsIGkpKSB8fCB0ID8gWS5zZXQodGhpcywgaSwgITEpIDogbiA9IHt9LCByICE9PSBuKSByZXR1cm4gZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSwgZS5wcmV2ZW50RGVmYXVsdCgpLCBuICYmIG4udmFsdWV9IGVsc2Ugci5sZW5ndGggJiYgKFkuc2V0KHRoaXMsIGksIHt2YWx1ZTogUy5ldmVudC50cmlnZ2VyKFMuZXh0ZW5kKHJbMF0sIFMuRXZlbnQucHJvdG90eXBlKSwgci5zbGljZSgxKSwgdGhpcyl9KSwgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSkNCgkJCQl9DQoJCQl9KSkgOiB2b2lkIDAgPT09IFkuZ2V0KGUsIGkpICYmIFMuZXZlbnQuYWRkKGUsIGksIHdlKQ0KCQl9DQoNCgkJUy5ldmVudCA9IHsNCgkJCWdsb2JhbDoge30sDQoJCQlhZGQ6IGZ1bmN0aW9uKHQsIGUsIG4sIHIsIGkpIHsNCgkJCQl2YXIgbywgYSwgcywgdSwgbCwgYywgZiwgcCwgZCwgaCwgZywgdiA9IFkuZ2V0KHQpOw0KCQkJCWlmKFYodCkpIHsNCgkJCQkJbi5oYW5kbGVyICYmIChuID0gKG8gPSBuKS5oYW5kbGVyLCBpID0gby5zZWxlY3RvciksIGkgJiYgUy5maW5kLm1hdGNoZXNTZWxlY3RvcihyZSwgaSksIG4uZ3VpZCB8fCAobi5ndWlkID0gUy5ndWlkKyspLCAodSA9IHYuZXZlbnRzKSB8fCAodSA9IHYuZXZlbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKSksIChhID0gdi5oYW5kbGUpIHx8IChhID0gdi5oYW5kbGUgPSBmdW5jdGlvbihlKSB7cmV0dXJuICJ1bmRlZmluZWQiICE9IHR5cGVvZiBTICYmIFMuZXZlbnQudHJpZ2dlcmVkICE9PSBlLnR5cGUgPyBTLmV2ZW50LmRpc3BhdGNoLmFwcGx5KHQsIGFyZ3VtZW50cykgOiB2b2lkIDB9KSwgbCA9IChlID0gKGUgfHwgIiIpLm1hdGNoKFApIHx8IFsiIl0pLmxlbmd0aDsNCgkJCQkJd2hpbGUobC0tKSBkID0gZyA9IChzID0gYmUuZXhlYyhlW2xdKSB8fCBbXSlbMV0sIGggPSAoc1syXSB8fCAiIikuc3BsaXQoIi4iKS5zb3J0KCksIGQgJiYgKGYgPSBTLmV2ZW50LnNwZWNpYWxbZF0gfHwge30sIGQgPSAoaSA/IGYuZGVsZWdhdGVUeXBlIDogZi5iaW5kVHlwZSkgfHwgZCwgZiA9IFMuZXZlbnQuc3BlY2lhbFtkXSB8fCB7fSwgYyA9IFMuZXh0ZW5kKHsNCgkJCQkJCXR5cGU6IGQsDQoJCQkJCQlvcmlnVHlwZTogZywNCgkJCQkJCWRhdGE6IHIsDQoJCQkJCQloYW5kbGVyOiBuLA0KCQkJCQkJZ3VpZDogbi5ndWlkLA0KCQkJCQkJc2VsZWN0b3I6IGksDQoJCQkJCQluZWVkc0NvbnRleHQ6IGkgJiYgUy5leHByLm1hdGNoLm5lZWRzQ29udGV4dC50ZXN0KGkpLA0KCQkJCQkJbmFtZXNwYWNlOiBoLmpvaW4oIi4iKQ0KCQkJCQl9LCBvKSwgKHAgPSB1W2RdKSB8fCAoKHAgPSB1W2RdID0gW10pLmRlbGVnYXRlQ291bnQgPSAwLCBmLnNldHVwICYmICExICE9PSBmLnNldHVwLmNhbGwodCwgciwgaCwgYSkgfHwgdC5hZGRFdmVudExpc3RlbmVyICYmIHQuYWRkRXZlbnRMaXN0ZW5lcihkLCBhKSksIGYuYWRkICYmIChmLmFkZC5jYWxsKHQsIGMpLCBjLmhhbmRsZXIuZ3VpZCB8fCAoYy5oYW5kbGVyLmd1aWQgPSBuLmd1aWQpKSwgaSA/IHAuc3BsaWNlKHAuZGVsZWdhdGVDb3VudCsrLCAwLCBjKSA6IHAucHVzaChjKSwgUy5ldmVudC5nbG9iYWxbZF0gPSAhMCkNCgkJCQl9DQoJCQl9LA0KCQkJcmVtb3ZlOiBmdW5jdGlvbihlLCB0LCBuLCByLCBpKSB7DQoJCQkJdmFyIG8sIGEsIHMsIHUsIGwsIGMsIGYsIHAsIGQsIGgsIGcsIHYgPSBZLmhhc0RhdGEoZSkgJiYgWS5nZXQoZSk7DQoJCQkJaWYodiAmJiAodSA9IHYuZXZlbnRzKSkgew0KCQkJCQlsID0gKHQgPSAodCB8fCAiIikubWF0Y2goUCkgfHwgWyIiXSkubGVuZ3RoOw0KCQkJCQl3aGlsZShsLS0pIGlmKGQgPSBnID0gKHMgPSBiZS5leGVjKHRbbF0pIHx8IFtdKVsxXSwgaCA9IChzWzJdIHx8ICIiKS5zcGxpdCgiLiIpLnNvcnQoKSwgZCkgew0KCQkJCQkJZiA9IFMuZXZlbnQuc3BlY2lhbFtkXSB8fCB7fSwgcCA9IHVbZCA9IChyID8gZi5kZWxlZ2F0ZVR5cGUgOiBmLmJpbmRUeXBlKSB8fCBkXSB8fCBbXSwgcyA9IHNbMl0gJiYgbmV3IFJlZ0V4cCgiKF58XFwuKSIgKyBoLmpvaW4oIlxcLig/Oi4qXFwufCkiKSArICIoXFwufCQpIiksIGEgPSBvID0gcC5sZW5ndGg7DQoJCQkJCQl3aGlsZShvLS0pIGMgPSBwW29dLCAhaSAmJiBnICE9PSBjLm9yaWdUeXBlIHx8IG4gJiYgbi5ndWlkICE9PSBjLmd1aWQgfHwgcyAmJiAhcy50ZXN0KGMubmFtZXNwYWNlKSB8fCByICYmIHIgIT09IGMuc2VsZWN0b3IgJiYgKCIqKiIgIT09IHIgfHwgIWMuc2VsZWN0b3IpIHx8IChwLnNwbGljZShvLCAxKSwgYy5zZWxlY3RvciAmJiBwLmRlbGVnYXRlQ291bnQtLSwgZi5yZW1vdmUgJiYgZi5yZW1vdmUuY2FsbChlLCBjKSk7DQoJCQkJCQlhICYmICFwLmxlbmd0aCAmJiAoZi50ZWFyZG93biAmJiAhMSAhPT0gZi50ZWFyZG93bi5jYWxsKGUsIGgsIHYuaGFuZGxlKSB8fCBTLnJlbW92ZUV2ZW50KGUsIGQsIHYuaGFuZGxlKSwgZGVsZXRlIHVbZF0pDQoJCQkJCX0gZWxzZSBmb3IoZCBpbiB1KSBTLmV2ZW50LnJlbW92ZShlLCBkICsgdFtsXSwgbiwgciwgITApOw0KCQkJCQlTLmlzRW1wdHlPYmplY3QodSkgJiYgWS5yZW1vdmUoZSwgImhhbmRsZSBldmVudHMiKQ0KCQkJCX0NCgkJCX0sDQoJCQlkaXNwYXRjaDogZnVuY3Rpb24oZSkgew0KCQkJCXZhciB0LCBuLCByLCBpLCBvLCBhLCBzID0gbmV3IEFycmF5KGFyZ3VtZW50cy5sZW5ndGgpLCB1ID0gUy5ldmVudC5maXgoZSksIGwgPSAoWS5nZXQodGhpcywgImV2ZW50cyIpIHx8IE9iamVjdC5jcmVhdGUobnVsbCkpW3UudHlwZV0gfHwgW10sIGMgPSBTLmV2ZW50LnNwZWNpYWxbdS50eXBlXSB8fCB7fTsNCgkJCQlmb3Ioc1swXSA9IHUsIHQgPSAxOyB0IDwgYXJndW1lbnRzLmxlbmd0aDsgdCsrKSBzW3RdID0gYXJndW1lbnRzW3RdOw0KCQkJCWlmKHUuZGVsZWdhdGVUYXJnZXQgPSB0aGlzLCAhYy5wcmVEaXNwYXRjaCB8fCAhMSAhPT0gYy5wcmVEaXNwYXRjaC5jYWxsKHRoaXMsIHUpKSB7DQoJCQkJCWEgPSBTLmV2ZW50LmhhbmRsZXJzLmNhbGwodGhpcywgdSwgbCksIHQgPSAwOw0KCQkJCQl3aGlsZSgoaSA9IGFbdCsrXSkgJiYgIXUuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSkgew0KCQkJCQkJdS5jdXJyZW50VGFyZ2V0ID0gaS5lbGVtLCBuID0gMDsNCgkJCQkJCXdoaWxlKChvID0gaS5oYW5kbGVyc1tuKytdKSAmJiAhdS5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCgpKSB1LnJuYW1lc3BhY2UgJiYgITEgIT09IG8ubmFtZXNwYWNlICYmICF1LnJuYW1lc3BhY2UudGVzdChvLm5hbWVzcGFjZSkgfHwgKHUuaGFuZGxlT2JqID0gbywgdS5kYXRhID0gby5kYXRhLCB2b2lkIDAgIT09IChyID0gKChTLmV2ZW50LnNwZWNpYWxbby5vcmlnVHlwZV0gfHwge30pLmhhbmRsZSB8fCBvLmhhbmRsZXIpLmFwcGx5KGkuZWxlbSwgcykpICYmICExID09PSAodS5yZXN1bHQgPSByKSAmJiAodS5wcmV2ZW50RGVmYXVsdCgpLCB1LnN0b3BQcm9wYWdhdGlvbigpKSkNCgkJCQkJfQ0KCQkJCQlyZXR1cm4gYy5wb3N0RGlzcGF0Y2ggJiYgYy5wb3N0RGlzcGF0Y2guY2FsbCh0aGlzLCB1KSwgdS5yZXN1bHQNCgkJCQl9DQoJCQl9LA0KCQkJaGFuZGxlcnM6IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQl2YXIgbiwgciwgaSwgbywgYSwgcyA9IFtdLCB1ID0gdC5kZWxlZ2F0ZUNvdW50LCBsID0gZS50YXJnZXQ7DQoJCQkJaWYodSAmJiBsLm5vZGVUeXBlICYmICEoImNsaWNrIiA9PT0gZS50eXBlICYmIDEgPD0gZS5idXR0b24pKSBmb3IoOyBsICE9PSB0aGlzOyBsID0gbC5wYXJlbnROb2RlIHx8IHRoaXMpIGlmKDEgPT09IGwubm9kZVR5cGUgJiYgKCJjbGljayIgIT09IGUudHlwZSB8fCAhMCAhPT0gbC5kaXNhYmxlZCkpIHsNCgkJCQkJZm9yKG8gPSBbXSwgYSA9IHt9LCBuID0gMDsgbiA8IHU7IG4rKykgdm9pZCAwID09PSBhW2kgPSAociA9IHRbbl0pLnNlbGVjdG9yICsgIiAiXSAmJiAoYVtpXSA9IHIubmVlZHNDb250ZXh0ID8gLTEgPCBTKGksIHRoaXMpLmluZGV4KGwpIDogUy5maW5kKGksIHRoaXMsIG51bGwsIFtsXSkubGVuZ3RoKSwgYVtpXSAmJiBvLnB1c2gocik7DQoJCQkJCW8ubGVuZ3RoICYmIHMucHVzaCh7ZWxlbTogbCwgaGFuZGxlcnM6IG99KQ0KCQkJCX0NCgkJCQlyZXR1cm4gbCA9IHRoaXMsIHUgPCB0Lmxlbmd0aCAmJiBzLnB1c2goe2VsZW06IGwsIGhhbmRsZXJzOiB0LnNsaWNlKHUpfSksIHMNCgkJCX0sDQoJCQlhZGRQcm9wOiBmdW5jdGlvbih0LCBlKSB7DQoJCQkJT2JqZWN0LmRlZmluZVByb3BlcnR5KFMuRXZlbnQucHJvdG90eXBlLCB0LCB7DQoJCQkJCWVudW1lcmFibGU6ICEwLA0KCQkJCQljb25maWd1cmFibGU6ICEwLA0KCQkJCQlnZXQ6IG0oZSkgPyBmdW5jdGlvbigpIHtpZih0aGlzLm9yaWdpbmFsRXZlbnQpIHJldHVybiBlKHRoaXMub3JpZ2luYWxFdmVudCl9IDogZnVuY3Rpb24oKSB7aWYodGhpcy5vcmlnaW5hbEV2ZW50KSByZXR1cm4gdGhpcy5vcmlnaW5hbEV2ZW50W3RdfSwNCgkJCQkJc2V0OiBmdW5jdGlvbihlKSB7T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIHQsIHtlbnVtZXJhYmxlOiAhMCwgY29uZmlndXJhYmxlOiAhMCwgd3JpdGFibGU6ICEwLCB2YWx1ZTogZX0pfQ0KCQkJCX0pDQoJCQl9LA0KCQkJZml4OiBmdW5jdGlvbihlKSB7cmV0dXJuIGVbUy5leHBhbmRvXSA/IGUgOiBuZXcgUy5FdmVudChlKX0sDQoJCQlzcGVjaWFsOiB7DQoJCQkJbG9hZDoge25vQnViYmxlOiAhMH0sIGNsaWNrOiB7DQoJCQkJCXNldHVwOiBmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgdCA9IHRoaXMgfHwgZTsNCgkJCQkJCXJldHVybiBwZS50ZXN0KHQudHlwZSkgJiYgdC5jbGljayAmJiBBKHQsICJpbnB1dCIpICYmIFNlKHQsICJjbGljayIsIHdlKSwgITENCgkJCQkJfSwgdHJpZ2dlcjogZnVuY3Rpb24oZSkgew0KCQkJCQkJdmFyIHQgPSB0aGlzIHx8IGU7DQoJCQkJCQlyZXR1cm4gcGUudGVzdCh0LnR5cGUpICYmIHQuY2xpY2sgJiYgQSh0LCAiaW5wdXQiKSAmJiBTZSh0LCAiY2xpY2siKSwgITANCgkJCQkJfSwgX2RlZmF1bHQ6IGZ1bmN0aW9uKGUpIHsNCgkJCQkJCXZhciB0ID0gZS50YXJnZXQ7DQoJCQkJCQlyZXR1cm4gcGUudGVzdCh0LnR5cGUpICYmIHQuY2xpY2sgJiYgQSh0LCAiaW5wdXQiKSAmJiBZLmdldCh0LCAiY2xpY2siKSB8fCBBKHQsICJhIikNCgkJCQkJfQ0KCQkJCX0sIGJlZm9yZXVubG9hZDoge3Bvc3REaXNwYXRjaDogZnVuY3Rpb24oZSkge3ZvaWQgMCAhPT0gZS5yZXN1bHQgJiYgZS5vcmlnaW5hbEV2ZW50ICYmIChlLm9yaWdpbmFsRXZlbnQucmV0dXJuVmFsdWUgPSBlLnJlc3VsdCl9fQ0KCQkJfQ0KCQl9LCBTLnJlbW92ZUV2ZW50ID0gZnVuY3Rpb24oZSwgdCwgbikge2UucmVtb3ZlRXZlbnRMaXN0ZW5lciAmJiBlLnJlbW92ZUV2ZW50TGlzdGVuZXIodCwgbil9LCBTLkV2ZW50ID0gZnVuY3Rpb24oZSwgdCkgew0KCQkJaWYoISh0aGlzIGluc3RhbmNlb2YgUy5FdmVudCkpIHJldHVybiBuZXcgUy5FdmVudChlLCB0KTsNCgkJCWUgJiYgZS50eXBlID8gKHRoaXMub3JpZ2luYWxFdmVudCA9IGUsIHRoaXMudHlwZSA9IGUudHlwZSwgdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSBlLmRlZmF1bHRQcmV2ZW50ZWQgfHwgdm9pZCAwID09PSBlLmRlZmF1bHRQcmV2ZW50ZWQgJiYgITEgPT09IGUucmV0dXJuVmFsdWUgPyB3ZSA6IFRlLCB0aGlzLnRhcmdldCA9IGUudGFyZ2V0ICYmIDMgPT09IGUudGFyZ2V0Lm5vZGVUeXBlID8gZS50YXJnZXQucGFyZW50Tm9kZSA6IGUudGFyZ2V0LCB0aGlzLmN1cnJlbnRUYXJnZXQgPSBlLmN1cnJlbnRUYXJnZXQsIHRoaXMucmVsYXRlZFRhcmdldCA9IGUucmVsYXRlZFRhcmdldCkgOiB0aGlzLnR5cGUgPSBlLCB0ICYmIFMuZXh0ZW5kKHRoaXMsIHQpLCB0aGlzLnRpbWVTdGFtcCA9IGUgJiYgZS50aW1lU3RhbXAgfHwgRGF0ZS5ub3coKSwgdGhpc1tTLmV4cGFuZG9dID0gITANCgkJfSwgUy5FdmVudC5wcm90b3R5cGUgPSB7DQoJCQljb25zdHJ1Y3RvcjogUy5FdmVudCwgaXNEZWZhdWx0UHJldmVudGVkOiBUZSwgaXNQcm9wYWdhdGlvblN0b3BwZWQ6IFRlLCBpc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZDogVGUsIGlzU2ltdWxhdGVkOiAhMSwgcHJldmVudERlZmF1bHQ6IGZ1bmN0aW9uKCkgew0KCQkJCXZhciBlID0gdGhpcy5vcmlnaW5hbEV2ZW50Ow0KCQkJCXRoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gd2UsIGUgJiYgIXRoaXMuaXNTaW11bGF0ZWQgJiYgZS5wcmV2ZW50RGVmYXVsdCgpDQoJCQl9LCBzdG9wUHJvcGFnYXRpb246IGZ1bmN0aW9uKCkgew0KCQkJCXZhciBlID0gdGhpcy5vcmlnaW5hbEV2ZW50Ow0KCQkJCXRoaXMuaXNQcm9wYWdhdGlvblN0b3BwZWQgPSB3ZSwgZSAmJiAhdGhpcy5pc1NpbXVsYXRlZCAmJiBlLnN0b3BQcm9wYWdhdGlvbigpDQoJCQl9LCBzdG9wSW1tZWRpYXRlUHJvcGFnYXRpb246IGZ1bmN0aW9uKCkgew0KCQkJCXZhciBlID0gdGhpcy5vcmlnaW5hbEV2ZW50Ow0KCQkJCXRoaXMuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQgPSB3ZSwgZSAmJiAhdGhpcy5pc1NpbXVsYXRlZCAmJiBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLCB0aGlzLnN0b3BQcm9wYWdhdGlvbigpDQoJCQl9DQoJCX0sIFMuZWFjaCh7DQoJCQlhbHRLZXk6ICEwLA0KCQkJYnViYmxlczogITAsDQoJCQljYW5jZWxhYmxlOiAhMCwNCgkJCWNoYW5nZWRUb3VjaGVzOiAhMCwNCgkJCWN0cmxLZXk6ICEwLA0KCQkJZGV0YWlsOiAhMCwNCgkJCWV2ZW50UGhhc2U6ICEwLA0KCQkJbWV0YUtleTogITAsDQoJCQlwYWdlWDogITAsDQoJCQlwYWdlWTogITAsDQoJCQlzaGlmdEtleTogITAsDQoJCQl2aWV3OiAhMCwNCgkJCSJjaGFyIjogITAsDQoJCQljb2RlOiAhMCwNCgkJCWNoYXJDb2RlOiAhMCwNCgkJCWtleTogITAsDQoJCQlrZXlDb2RlOiAhMCwNCgkJCWJ1dHRvbjogITAsDQoJCQlidXR0b25zOiAhMCwNCgkJCWNsaWVudFg6ICEwLA0KCQkJY2xpZW50WTogITAsDQoJCQlvZmZzZXRYOiAhMCwNCgkJCW9mZnNldFk6ICEwLA0KCQkJcG9pbnRlcklkOiAhMCwNCgkJCXBvaW50ZXJUeXBlOiAhMCwNCgkJCXNjcmVlblg6ICEwLA0KCQkJc2NyZWVuWTogITAsDQoJCQl0YXJnZXRUb3VjaGVzOiAhMCwNCgkJCXRvRWxlbWVudDogITAsDQoJCQl0b3VjaGVzOiAhMCwNCgkJCXdoaWNoOiAhMA0KCQl9LCBTLmV2ZW50LmFkZFByb3ApLCBTLmVhY2goe2ZvY3VzOiAiZm9jdXNpbiIsIGJsdXI6ICJmb2N1c291dCJ9LCBmdW5jdGlvbihlLCB0KSB7Uy5ldmVudC5zcGVjaWFsW2VdID0ge3NldHVwOiBmdW5jdGlvbigpIHtyZXR1cm4gU2UodGhpcywgZSwgQ2UpLCAhMX0sIHRyaWdnZXI6IGZ1bmN0aW9uKCkge3JldHVybiBTZSh0aGlzLCBlKSwgITB9LCBfZGVmYXVsdDogZnVuY3Rpb24oKSB7cmV0dXJuICEwfSwgZGVsZWdhdGVUeXBlOiB0fX0pLCBTLmVhY2goew0KCQkJbW91c2VlbnRlcjogIm1vdXNlb3ZlciIsDQoJCQltb3VzZWxlYXZlOiAibW91c2VvdXQiLA0KCQkJcG9pbnRlcmVudGVyOiAicG9pbnRlcm92ZXIiLA0KCQkJcG9pbnRlcmxlYXZlOiAicG9pbnRlcm91dCINCgkJfSwgZnVuY3Rpb24oZSwgaSkgew0KCQkJUy5ldmVudC5zcGVjaWFsW2VdID0gew0KCQkJCWRlbGVnYXRlVHlwZTogaSwgYmluZFR5cGU6IGksIGhhbmRsZTogZnVuY3Rpb24oZSkgew0KCQkJCQl2YXIgdCwgbiA9IGUucmVsYXRlZFRhcmdldCwgciA9IGUuaGFuZGxlT2JqOw0KCQkJCQlyZXR1cm4gbiAmJiAobiA9PT0gdGhpcyB8fCBTLmNvbnRhaW5zKHRoaXMsIG4pKSB8fCAoZS50eXBlID0gci5vcmlnVHlwZSwgdCA9IHIuaGFuZGxlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCBlLnR5cGUgPSBpKSwgdA0KCQkJCX0NCgkJCX0NCgkJfSksIFMuZm4uZXh0ZW5kKHsNCgkJCW9uOiBmdW5jdGlvbihlLCB0LCBuLCByKSB7cmV0dXJuIEVlKHRoaXMsIGUsIHQsIG4sIHIpfSwgb25lOiBmdW5jdGlvbihlLCB0LCBuLCByKSB7cmV0dXJuIEVlKHRoaXMsIGUsIHQsIG4sIHIsIDEpfSwgb2ZmOiBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJdmFyIHIsIGk7DQoJCQkJaWYoZSAmJiBlLnByZXZlbnREZWZhdWx0ICYmIGUuaGFuZGxlT2JqKSByZXR1cm4gciA9IGUuaGFuZGxlT2JqLCBTKGUuZGVsZWdhdGVUYXJnZXQpLm9mZihyLm5hbWVzcGFjZSA/IHIub3JpZ1R5cGUgKyAiLiIgKyByLm5hbWVzcGFjZSA6IHIub3JpZ1R5cGUsIHIuc2VsZWN0b3IsIHIuaGFuZGxlciksIHRoaXM7DQoJCQkJaWYoIm9iamVjdCIgPT0gdHlwZW9mIGUpIHsNCgkJCQkJZm9yKGkgaW4gZSkgdGhpcy5vZmYoaSwgdCwgZVtpXSk7DQoJCQkJCXJldHVybiB0aGlzDQoJCQkJfQ0KCQkJCXJldHVybiAhMSAhPT0gdCAmJiAiZnVuY3Rpb24iICE9IHR5cGVvZiB0IHx8IChuID0gdCwgdCA9IHZvaWQgMCksICExID09PSBuICYmIChuID0gVGUpLCB0aGlzLmVhY2goZnVuY3Rpb24oKSB7Uy5ldmVudC5yZW1vdmUodGhpcywgZSwgbiwgdCl9KQ0KCQkJfQ0KCQl9KTsNCgkJdmFyIGtlID0gLzxzY3JpcHR8PHN0eWxlfDxsaW5rL2ksIEFlID0gL2NoZWNrZWRccyooPzpbXj1dfD1ccyouY2hlY2tlZC4pL2ksIE5lID0gL15ccyo8ISg/OlxbQ0RBVEFcW3wtLSl8KD86XF1cXXwtLSk+XHMqJC9nOw0KDQoJCWZ1bmN0aW9uIGplKGUsIHQpIHtyZXR1cm4gQShlLCAidGFibGUiKSAmJiBBKDExICE9PSB0Lm5vZGVUeXBlID8gdCA6IHQuZmlyc3RDaGlsZCwgInRyIikgJiYgUyhlKS5jaGlsZHJlbigidGJvZHkiKVswXSB8fCBlfQ0KDQoJCWZ1bmN0aW9uIERlKGUpIHtyZXR1cm4gZS50eXBlID0gKG51bGwgIT09IGUuZ2V0QXR0cmlidXRlKCJ0eXBlIikpICsgIi8iICsgZS50eXBlLCBlfQ0KDQoJCWZ1bmN0aW9uIHFlKGUpIHtyZXR1cm4gInRydWUvIiA9PT0gKGUudHlwZSB8fCAiIikuc2xpY2UoMCwgNSkgPyBlLnR5cGUgPSBlLnR5cGUuc2xpY2UoNSkgOiBlLnJlbW92ZUF0dHJpYnV0ZSgidHlwZSIpLCBlfQ0KDQoJCWZ1bmN0aW9uIExlKGUsIHQpIHsNCgkJCXZhciBuLCByLCBpLCBvLCBhLCBzOw0KCQkJaWYoMSA9PT0gdC5ub2RlVHlwZSkgew0KCQkJCWlmKFkuaGFzRGF0YShlKSAmJiAocyA9IFkuZ2V0KGUpLmV2ZW50cykpIGZvcihpIGluIFkucmVtb3ZlKHQsICJoYW5kbGUgZXZlbnRzIiksIHMpIGZvcihuID0gMCwgciA9IHNbaV0ubGVuZ3RoOyBuIDwgcjsgbisrKSBTLmV2ZW50LmFkZCh0LCBpLCBzW2ldW25dKTsNCgkJCQlRLmhhc0RhdGEoZSkgJiYgKG8gPSBRLmFjY2VzcyhlKSwgYSA9IFMuZXh0ZW5kKHt9LCBvKSwgUS5zZXQodCwgYSkpDQoJCQl9DQoJCX0NCg0KCQlmdW5jdGlvbiBIZShuLCByLCBpLCBvKSB7DQoJCQlyID0gZyhyKTsNCgkJCXZhciBlLCB0LCBhLCBzLCB1LCBsLCBjID0gMCwgZiA9IG4ubGVuZ3RoLCBwID0gZiAtIDEsIGQgPSByWzBdLCBoID0gbShkKTsNCgkJCWlmKGggfHwgMSA8IGYgJiYgInN0cmluZyIgPT0gdHlwZW9mIGQgJiYgIXkuY2hlY2tDbG9uZSAmJiBBZS50ZXN0KGQpKSByZXR1cm4gbi5lYWNoKGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCA9IG4uZXEoZSk7DQoJCQkJaCAmJiAoclswXSA9IGQuY2FsbCh0aGlzLCBlLCB0Lmh0bWwoKSkpLCBIZSh0LCByLCBpLCBvKQ0KCQkJfSk7DQoJCQlpZihmICYmICh0ID0gKGUgPSB4ZShyLCBuWzBdLm93bmVyRG9jdW1lbnQsICExLCBuLCBvKSkuZmlyc3RDaGlsZCwgMSA9PT0gZS5jaGlsZE5vZGVzLmxlbmd0aCAmJiAoZSA9IHQpLCB0IHx8IG8pKSB7DQoJCQkJZm9yKHMgPSAoYSA9IFMubWFwKHZlKGUsICJzY3JpcHQiKSwgRGUpKS5sZW5ndGg7IGMgPCBmOyBjKyspIHUgPSBlLCBjICE9PSBwICYmICh1ID0gUy5jbG9uZSh1LCAhMCwgITApLCBzICYmIFMubWVyZ2UoYSwgdmUodSwgInNjcmlwdCIpKSksIGkuY2FsbChuW2NdLCB1LCBjKTsNCgkJCQlpZihzKSBmb3IobCA9IGFbYS5sZW5ndGggLSAxXS5vd25lckRvY3VtZW50LCBTLm1hcChhLCBxZSksIGMgPSAwOyBjIDwgczsgYysrKSB1ID0gYVtjXSwgaGUudGVzdCh1LnR5cGUgfHwgIiIpICYmICFZLmFjY2Vzcyh1LCAiZ2xvYmFsRXZhbCIpICYmIFMuY29udGFpbnMobCwgdSkgJiYgKHUuc3JjICYmICJtb2R1bGUiICE9PSAodS50eXBlIHx8ICIiKS50b0xvd2VyQ2FzZSgpID8gUy5fZXZhbFVybCAmJiAhdS5ub01vZHVsZSAmJiBTLl9ldmFsVXJsKHUuc3JjLCB7bm9uY2U6IHUubm9uY2UgfHwgdS5nZXRBdHRyaWJ1dGUoIm5vbmNlIil9LCBsKSA6IGIodS50ZXh0Q29udGVudC5yZXBsYWNlKE5lLCAiIiksIHUsIGwpKQ0KCQkJfQ0KCQkJcmV0dXJuIG4NCgkJfQ0KDQoJCWZ1bmN0aW9uIE9lKGUsIHQsIG4pIHsNCgkJCWZvcih2YXIgciwgaSA9IHQgPyBTLmZpbHRlcih0LCBlKSA6IGUsIG8gPSAwOyBudWxsICE9IChyID0gaVtvXSk7IG8rKykgbiB8fCAxICE9PSByLm5vZGVUeXBlIHx8IFMuY2xlYW5EYXRhKHZlKHIpKSwgci5wYXJlbnROb2RlICYmIChuICYmIGllKHIpICYmIHllKHZlKHIsICJzY3JpcHQiKSksIHIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChyKSk7DQoJCQlyZXR1cm4gZQ0KCQl9DQoNCgkJUy5leHRlbmQoew0KCQkJaHRtbFByZWZpbHRlcjogZnVuY3Rpb24oZSkge3JldHVybiBlfSwgY2xvbmU6IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQl2YXIgciwgaSwgbywgYSwgcywgdSwgbCwgYyA9IGUuY2xvbmVOb2RlKCEwKSwgZiA9IGllKGUpOw0KCQkJCWlmKCEoeS5ub0Nsb25lQ2hlY2tlZCB8fCAxICE9PSBlLm5vZGVUeXBlICYmIDExICE9PSBlLm5vZGVUeXBlIHx8IFMuaXNYTUxEb2MoZSkpKSBmb3IoYSA9IHZlKGMpLCByID0gMCwgaSA9IChvID0gdmUoZSkpLmxlbmd0aDsgciA8IGk7IHIrKykgcyA9IG9bcl0sIHUgPSBhW3JdLCB2b2lkIDAsICJpbnB1dCIgPT09IChsID0gdS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKSAmJiBwZS50ZXN0KHMudHlwZSkgPyB1LmNoZWNrZWQgPSBzLmNoZWNrZWQgOiAiaW5wdXQiICE9PSBsICYmICJ0ZXh0YXJlYSIgIT09IGwgfHwgKHUuZGVmYXVsdFZhbHVlID0gcy5kZWZhdWx0VmFsdWUpOw0KCQkJCWlmKHQpIGlmKG4pIGZvcihvID0gbyB8fCB2ZShlKSwgYSA9IGEgfHwgdmUoYyksIHIgPSAwLCBpID0gby5sZW5ndGg7IHIgPCBpOyByKyspIExlKG9bcl0sIGFbcl0pOyBlbHNlIExlKGUsIGMpOw0KCQkJCXJldHVybiAwIDwgKGEgPSB2ZShjLCAic2NyaXB0IikpLmxlbmd0aCAmJiB5ZShhLCAhZiAmJiB2ZShlLCAic2NyaXB0IikpLCBjDQoJCQl9LCBjbGVhbkRhdGE6IGZ1bmN0aW9uKGUpIHsNCgkJCQlmb3IodmFyIHQsIG4sIHIsIGkgPSBTLmV2ZW50LnNwZWNpYWwsIG8gPSAwOyB2b2lkIDAgIT09IChuID0gZVtvXSk7IG8rKykgaWYoVihuKSkgew0KCQkJCQlpZih0ID0gbltZLmV4cGFuZG9dKSB7DQoJCQkJCQlpZih0LmV2ZW50cykgZm9yKHIgaW4gdC5ldmVudHMpIGlbcl0gPyBTLmV2ZW50LnJlbW92ZShuLCByKSA6IFMucmVtb3ZlRXZlbnQobiwgciwgdC5oYW5kbGUpOw0KCQkJCQkJbltZLmV4cGFuZG9dID0gdm9pZCAwDQoJCQkJCX0NCgkJCQkJbltRLmV4cGFuZG9dICYmIChuW1EuZXhwYW5kb10gPSB2b2lkIDApDQoJCQkJfQ0KCQkJfQ0KCQl9KSwgUy5mbi5leHRlbmQoew0KCQkJZGV0YWNoOiBmdW5jdGlvbihlKSB7cmV0dXJuIE9lKHRoaXMsIGUsICEwKX0sDQoJCQlyZW1vdmU6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gT2UodGhpcywgZSl9LA0KCQkJdGV4dDogZnVuY3Rpb24oZSkge3JldHVybiAkKHRoaXMsIGZ1bmN0aW9uKGUpIHtyZXR1cm4gdm9pZCAwID09PSBlID8gUy50ZXh0KHRoaXMpIDogdGhpcy5lbXB0eSgpLmVhY2goZnVuY3Rpb24oKSB7MSAhPT0gdGhpcy5ub2RlVHlwZSAmJiAxMSAhPT0gdGhpcy5ub2RlVHlwZSAmJiA5ICE9PSB0aGlzLm5vZGVUeXBlIHx8ICh0aGlzLnRleHRDb250ZW50ID0gZSl9KX0sIG51bGwsIGUsIGFyZ3VtZW50cy5sZW5ndGgpfSwNCgkJCWFwcGVuZDogZnVuY3Rpb24oKSB7cmV0dXJuIEhlKHRoaXMsIGFyZ3VtZW50cywgZnVuY3Rpb24oZSkgezEgIT09IHRoaXMubm9kZVR5cGUgJiYgMTEgIT09IHRoaXMubm9kZVR5cGUgJiYgOSAhPT0gdGhpcy5ub2RlVHlwZSB8fCBqZSh0aGlzLCBlKS5hcHBlbmRDaGlsZChlKX0pfSwNCgkJCXByZXBlbmQ6IGZ1bmN0aW9uKCkgew0KCQkJCXJldHVybiBIZSh0aGlzLCBhcmd1bWVudHMsIGZ1bmN0aW9uKGUpIHsNCgkJCQkJaWYoMSA9PT0gdGhpcy5ub2RlVHlwZSB8fCAxMSA9PT0gdGhpcy5ub2RlVHlwZSB8fCA5ID09PSB0aGlzLm5vZGVUeXBlKSB7DQoJCQkJCQl2YXIgdCA9IGplKHRoaXMsIGUpOw0KCQkJCQkJdC5pbnNlcnRCZWZvcmUoZSwgdC5maXJzdENoaWxkKQ0KCQkJCQl9DQoJCQkJfSkNCgkJCX0sDQoJCQliZWZvcmU6IGZ1bmN0aW9uKCkge3JldHVybiBIZSh0aGlzLCBhcmd1bWVudHMsIGZ1bmN0aW9uKGUpIHt0aGlzLnBhcmVudE5vZGUgJiYgdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlLCB0aGlzKX0pfSwNCgkJCWFmdGVyOiBmdW5jdGlvbigpIHtyZXR1cm4gSGUodGhpcywgYXJndW1lbnRzLCBmdW5jdGlvbihlKSB7dGhpcy5wYXJlbnROb2RlICYmIHRoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZSwgdGhpcy5uZXh0U2libGluZyl9KX0sDQoJCQllbXB0eTogZnVuY3Rpb24oKSB7DQoJCQkJZm9yKHZhciBlLCB0ID0gMDsgbnVsbCAhPSAoZSA9IHRoaXNbdF0pOyB0KyspIDEgPT09IGUubm9kZVR5cGUgJiYgKFMuY2xlYW5EYXRhKHZlKGUsICExKSksIGUudGV4dENvbnRlbnQgPSAiIik7DQoJCQkJcmV0dXJuIHRoaXMNCgkJCX0sDQoJCQljbG9uZTogZnVuY3Rpb24oZSwgdCkge3JldHVybiBlID0gbnVsbCAhPSBlICYmIGUsIHQgPSBudWxsID09IHQgPyBlIDogdCwgdGhpcy5tYXAoZnVuY3Rpb24oKSB7cmV0dXJuIFMuY2xvbmUodGhpcywgZSwgdCl9KX0sDQoJCQlodG1sOiBmdW5jdGlvbihlKSB7DQoJCQkJcmV0dXJuICQodGhpcywgZnVuY3Rpb24oZSkgew0KCQkJCQl2YXIgdCA9IHRoaXNbMF0gfHwge30sIG4gPSAwLCByID0gdGhpcy5sZW5ndGg7DQoJCQkJCWlmKHZvaWQgMCA9PT0gZSAmJiAxID09PSB0Lm5vZGVUeXBlKSByZXR1cm4gdC5pbm5lckhUTUw7DQoJCQkJCWlmKCJzdHJpbmciID09IHR5cGVvZiBlICYmICFrZS50ZXN0KGUpICYmICFnZVsoZGUuZXhlYyhlKSB8fCBbIiIsICIiXSlbMV0udG9Mb3dlckNhc2UoKV0pIHsNCgkJCQkJCWUgPSBTLmh0bWxQcmVmaWx0ZXIoZSk7DQoJCQkJCQl0cnkgew0KCQkJCQkJCWZvcig7IG4gPCByOyBuKyspIDEgPT09ICh0ID0gdGhpc1tuXSB8fCB7fSkubm9kZVR5cGUgJiYgKFMuY2xlYW5EYXRhKHZlKHQsICExKSksIHQuaW5uZXJIVE1MID0gZSk7DQoJCQkJCQkJdCA9IDANCgkJCQkJCX0gY2F0Y2goZSkge30NCgkJCQkJfQ0KCQkJCQl0ICYmIHRoaXMuZW1wdHkoKS5hcHBlbmQoZSkNCgkJCQl9LCBudWxsLCBlLCBhcmd1bWVudHMubGVuZ3RoKQ0KCQkJfSwNCgkJCXJlcGxhY2VXaXRoOiBmdW5jdGlvbigpIHsNCgkJCQl2YXIgbiA9IFtdOw0KCQkJCXJldHVybiBIZSh0aGlzLCBhcmd1bWVudHMsIGZ1bmN0aW9uKGUpIHsNCgkJCQkJdmFyIHQgPSB0aGlzLnBhcmVudE5vZGU7DQoJCQkJCVMuaW5BcnJheSh0aGlzLCBuKSA8IDAgJiYgKFMuY2xlYW5EYXRhKHZlKHRoaXMpKSwgdCAmJiB0LnJlcGxhY2VDaGlsZChlLCB0aGlzKSkNCgkJCQl9LCBuKQ0KCQkJfQ0KCQl9KSwgUy5lYWNoKHsNCgkJCWFwcGVuZFRvOiAiYXBwZW5kIiwNCgkJCXByZXBlbmRUbzogInByZXBlbmQiLA0KCQkJaW5zZXJ0QmVmb3JlOiAiYmVmb3JlIiwNCgkJCWluc2VydEFmdGVyOiAiYWZ0ZXIiLA0KCQkJcmVwbGFjZUFsbDogInJlcGxhY2VXaXRoIg0KCQl9LCBmdW5jdGlvbihlLCBhKSB7DQoJCQlTLmZuW2VdID0gZnVuY3Rpb24oZSkgew0KCQkJCWZvcih2YXIgdCwgbiA9IFtdLCByID0gUyhlKSwgaSA9IHIubGVuZ3RoIC0gMSwgbyA9IDA7IG8gPD0gaTsgbysrKSB0ID0gbyA9PT0gaSA/IHRoaXMgOiB0aGlzLmNsb25lKCEwKSwgUyhyW29dKVthXSh0KSwgdS5hcHBseShuLCB0LmdldCgpKTsNCgkJCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2sobikNCgkJCX0NCgkJfSk7DQoJCXZhciBQZSA9IG5ldyBSZWdFeHAoIl4oIiArIGVlICsgIikoPyFweClbYS16JV0rJCIsICJpIiksIFJlID0gZnVuY3Rpb24oZSkgew0KCQkJdmFyIHQgPSBlLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXc7DQoJCQlyZXR1cm4gdCAmJiB0Lm9wZW5lciB8fCAodCA9IEMpLCB0LmdldENvbXB1dGVkU3R5bGUoZSkNCgkJfSwgTWUgID0gZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJdmFyIHIsIGksIG8gPSB7fTsNCgkJCWZvcihpIGluIHQpIG9baV0gPSBlLnN0eWxlW2ldLCBlLnN0eWxlW2ldID0gdFtpXTsNCgkJCWZvcihpIGluIHIgPSBuLmNhbGwoZSksIHQpIGUuc3R5bGVbaV0gPSBvW2ldOw0KCQkJcmV0dXJuIHINCgkJfSwgSWUgID0gbmV3IFJlZ0V4cChuZS5qb2luKCJ8IiksICJpIik7DQoNCgkJZnVuY3Rpb24gV2UoZSwgdCwgbikgew0KCQkJdmFyIHIsIGksIG8sIGEsIHMgPSBlLnN0eWxlOw0KCQkJcmV0dXJuIChuID0gbiB8fCBSZShlKSkgJiYgKCIiICE9PSAoYSA9IG4uZ2V0UHJvcGVydHlWYWx1ZSh0KSB8fCBuW3RdKSB8fCBpZShlKSB8fCAoYSA9IFMuc3R5bGUoZSwgdCkpLCAheS5waXhlbEJveFN0eWxlcygpICYmIFBlLnRlc3QoYSkgJiYgSWUudGVzdCh0KSAmJiAociA9IHMud2lkdGgsIGkgPSBzLm1pbldpZHRoLCBvID0gcy5tYXhXaWR0aCwgcy5taW5XaWR0aCA9IHMubWF4V2lkdGggPSBzLndpZHRoID0gYSwgYSA9IG4ud2lkdGgsIHMud2lkdGggPSByLCBzLm1pbldpZHRoID0gaSwgcy5tYXhXaWR0aCA9IG8pKSwgdm9pZCAwICE9PSBhID8gYSArICIiIDogYQ0KCQl9DQoNCgkJZnVuY3Rpb24gRmUoZSwgdCkgew0KCQkJcmV0dXJuIHsNCgkJCQlnZXQ6IGZ1bmN0aW9uKCkgew0KCQkJCQlpZighZSgpKSByZXR1cm4gKHRoaXMuZ2V0ID0gdCkuYXBwbHkodGhpcywgYXJndW1lbnRzKTsNCgkJCQkJZGVsZXRlIHRoaXMuZ2V0DQoJCQkJfQ0KCQkJfQ0KCQl9DQoNCgkJIWZ1bmN0aW9uKCkgew0KCQkJZnVuY3Rpb24gZSgpIHsNCgkJCQlpZihsKSB7DQoJCQkJCXUuc3R5bGUuY3NzVGV4dCA9ICJwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0Oi0xMTExMXB4O3dpZHRoOjYwcHg7bWFyZ2luLXRvcDoxcHg7cGFkZGluZzowO2JvcmRlcjowIiwgbC5zdHlsZS5jc3NUZXh0ID0gInBvc2l0aW9uOnJlbGF0aXZlO2Rpc3BsYXk6YmxvY2s7Ym94LXNpemluZzpib3JkZXItYm94O292ZXJmbG93OnNjcm9sbDttYXJnaW46YXV0bztib3JkZXI6MXB4O3BhZGRpbmc6MXB4O3dpZHRoOjYwJTt0b3A6MSUiLCByZS5hcHBlbmRDaGlsZCh1KS5hcHBlbmRDaGlsZChsKTsNCgkJCQkJdmFyIGUgPSBDLmdldENvbXB1dGVkU3R5bGUobCk7DQoJCQkJCW4gPSAiMSUiICE9PSBlLnRvcCwgcyA9IDEyID09PSB0KGUubWFyZ2luTGVmdCksIGwuc3R5bGUucmlnaHQgPSAiNjAlIiwgbyA9IDM2ID09PSB0KGUucmlnaHQpLCByID0gMzYgPT09IHQoZS53aWR0aCksIGwuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiLCBpID0gMTIgPT09IHQobC5vZmZzZXRXaWR0aCAvIDMpLCByZS5yZW1vdmVDaGlsZCh1KSwgbCA9IG51bGwNCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHQoZSkge3JldHVybiBNYXRoLnJvdW5kKHBhcnNlRmxvYXQoZSkpfQ0KDQoJCQl2YXIgbiwgciwgaSwgbywgYSwgcywgdSA9IEUuY3JlYXRlRWxlbWVudCgiZGl2IiksIGwgPSBFLmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KCQkJbC5zdHlsZSAmJiAobC5zdHlsZS5iYWNrZ3JvdW5kQ2xpcCA9ICJjb250ZW50LWJveCIsIGwuY2xvbmVOb2RlKCEwKS5zdHlsZS5iYWNrZ3JvdW5kQ2xpcCA9ICIiLCB5LmNsZWFyQ2xvbmVTdHlsZSA9ICJjb250ZW50LWJveCIgPT09IGwuc3R5bGUuYmFja2dyb3VuZENsaXAsIFMuZXh0ZW5kKHksIHsNCgkJCQlib3hTaXppbmdSZWxpYWJsZTogZnVuY3Rpb24oKSB7cmV0dXJuIGUoKSwgcn0sDQoJCQkJcGl4ZWxCb3hTdHlsZXM6IGZ1bmN0aW9uKCkge3JldHVybiBlKCksIG99LA0KCQkJCXBpeGVsUG9zaXRpb246IGZ1bmN0aW9uKCkge3JldHVybiBlKCksIG59LA0KCQkJCXJlbGlhYmxlTWFyZ2luTGVmdDogZnVuY3Rpb24oKSB7cmV0dXJuIGUoKSwgc30sDQoJCQkJc2Nyb2xsYm94U2l6ZTogZnVuY3Rpb24oKSB7cmV0dXJuIGUoKSwgaX0sDQoJCQkJcmVsaWFibGVUckRpbWVuc2lvbnM6IGZ1bmN0aW9uKCkgew0KCQkJCQl2YXIgZSwgdCwgbiwgcjsNCgkJCQkJcmV0dXJuIG51bGwgPT0gYSAmJiAoZSA9IEUuY3JlYXRlRWxlbWVudCgidGFibGUiKSwgdCA9IEUuY3JlYXRlRWxlbWVudCgidHIiKSwgbiA9IEUuY3JlYXRlRWxlbWVudCgiZGl2IiksIGUuc3R5bGUuY3NzVGV4dCA9ICJwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0Oi0xMTExMXB4O2JvcmRlci1jb2xsYXBzZTpzZXBhcmF0ZSIsIHQuc3R5bGUuY3NzVGV4dCA9ICJib3JkZXI6MXB4IHNvbGlkIiwgdC5zdHlsZS5oZWlnaHQgPSAiMXB4Iiwgbi5zdHlsZS5oZWlnaHQgPSAiOXB4Iiwgbi5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIiwgcmUuYXBwZW5kQ2hpbGQoZSkuYXBwZW5kQ2hpbGQodCkuYXBwZW5kQ2hpbGQobiksIHIgPSBDLmdldENvbXB1dGVkU3R5bGUodCksIGEgPSBwYXJzZUludChyLmhlaWdodCwgMTApICsgcGFyc2VJbnQoci5ib3JkZXJUb3BXaWR0aCwgMTApICsgcGFyc2VJbnQoci5ib3JkZXJCb3R0b21XaWR0aCwgMTApID09PSB0Lm9mZnNldEhlaWdodCwgcmUucmVtb3ZlQ2hpbGQoZSkpLCBhDQoJCQkJfQ0KCQkJfSkpDQoJCX0oKTsNCgkJdmFyIEJlID0gWyJXZWJraXQiLCAiTW96IiwgIm1zIl0sICRlID0gRS5jcmVhdGVFbGVtZW50KCJkaXYiKS5zdHlsZSwgX2UgPSB7fTsNCg0KCQlmdW5jdGlvbiB6ZShlKSB7DQoJCQl2YXIgdCA9IFMuY3NzUHJvcHNbZV0gfHwgX2VbZV07DQoJCQlyZXR1cm4gdCB8fCAoZSBpbiAkZSA/IGUgOiBfZVtlXSA9IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCA9IGVbMF0udG9VcHBlckNhc2UoKSArIGUuc2xpY2UoMSksIG4gPSBCZS5sZW5ndGg7DQoJCQkJd2hpbGUobi0tKSBpZigoZSA9IEJlW25dICsgdCkgaW4gJGUpIHJldHVybiBlDQoJCQl9KGUpIHx8IGUpDQoJCX0NCg0KCQl2YXIgVWUgPSAvXihub25lfHRhYmxlKD8hLWNbZWFdKS4rKS8sIFhlID0gL14tLS8sIFZlID0ge3Bvc2l0aW9uOiAiYWJzb2x1dGUiLCB2aXNpYmlsaXR5OiAiaGlkZGVuIiwgZGlzcGxheTogImJsb2NrIn0sIEdlID0ge2xldHRlclNwYWNpbmc6ICIwIiwgZm9udFdlaWdodDogIjQwMCJ9Ow0KDQoJCWZ1bmN0aW9uIFllKGUsIHQsIG4pIHsNCgkJCXZhciByID0gdGUuZXhlYyh0KTsNCgkJCXJldHVybiByID8gTWF0aC5tYXgoMCwgclsyXSAtIChuIHx8IDApKSArIChyWzNdIHx8ICJweCIpIDogdA0KCQl9DQoNCgkJZnVuY3Rpb24gUWUoZSwgdCwgbiwgciwgaSwgbykgew0KCQkJdmFyIGEgPSAid2lkdGgiID09PSB0ID8gMSA6IDAsIHMgPSAwLCB1ID0gMDsNCgkJCWlmKG4gPT09IChyID8gImJvcmRlciIgOiAiY29udGVudCIpKSByZXR1cm4gMDsNCgkJCWZvcig7IGEgPCA0OyBhICs9IDIpICJtYXJnaW4iID09PSBuICYmICh1ICs9IFMuY3NzKGUsIG4gKyBuZVthXSwgITAsIGkpKSwgciA/ICgiY29udGVudCIgPT09IG4gJiYgKHUgLT0gUy5jc3MoZSwgInBhZGRpbmciICsgbmVbYV0sICEwLCBpKSksICJtYXJnaW4iICE9PSBuICYmICh1IC09IFMuY3NzKGUsICJib3JkZXIiICsgbmVbYV0gKyAiV2lkdGgiLCAhMCwgaSkpKSA6ICh1ICs9IFMuY3NzKGUsICJwYWRkaW5nIiArIG5lW2FdLCAhMCwgaSksICJwYWRkaW5nIiAhPT0gbiA/IHUgKz0gUy5jc3MoZSwgImJvcmRlciIgKyBuZVthXSArICJXaWR0aCIsICEwLCBpKSA6IHMgKz0gUy5jc3MoZSwgImJvcmRlciIgKyBuZVthXSArICJXaWR0aCIsICEwLCBpKSk7DQoJCQlyZXR1cm4gIXIgJiYgMCA8PSBvICYmICh1ICs9IE1hdGgubWF4KDAsIE1hdGguY2VpbChlWyJvZmZzZXQiICsgdFswXS50b1VwcGVyQ2FzZSgpICsgdC5zbGljZSgxKV0gLSBvIC0gdSAtIHMgLSAuNSkpIHx8IDApLCB1DQoJCX0NCg0KCQlmdW5jdGlvbiBKZShlLCB0LCBuKSB7DQoJCQl2YXIgciA9IFJlKGUpLCBpID0gKCF5LmJveFNpemluZ1JlbGlhYmxlKCkgfHwgbikgJiYgImJvcmRlci1ib3giID09PSBTLmNzcyhlLCAiYm94U2l6aW5nIiwgITEsIHIpLCBvID0gaSwgYSA9IFdlKGUsIHQsIHIpLCBzID0gIm9mZnNldCIgKyB0WzBdLnRvVXBwZXJDYXNlKCkgKyB0LnNsaWNlKDEpOw0KCQkJaWYoUGUudGVzdChhKSkgew0KCQkJCWlmKCFuKSByZXR1cm4gYTsNCgkJCQlhID0gImF1dG8iDQoJCQl9DQoJCQlyZXR1cm4gKCF5LmJveFNpemluZ1JlbGlhYmxlKCkgJiYgaSB8fCAheS5yZWxpYWJsZVRyRGltZW5zaW9ucygpICYmIEEoZSwgInRyIikgfHwgImF1dG8iID09PSBhIHx8ICFwYXJzZUZsb2F0KGEpICYmICJpbmxpbmUiID09PSBTLmNzcyhlLCAiZGlzcGxheSIsICExLCByKSkgJiYgZS5nZXRDbGllbnRSZWN0cygpLmxlbmd0aCAmJiAoaSA9ICJib3JkZXItYm94IiA9PT0gUy5jc3MoZSwgImJveFNpemluZyIsICExLCByKSwgKG8gPSBzIGluIGUpICYmIChhID0gZVtzXSkpLCAoYSA9IHBhcnNlRmxvYXQoYSkgfHwgMCkgKyBRZShlLCB0LCBuIHx8IChpID8gImJvcmRlciIgOiAiY29udGVudCIpLCBvLCByLCBhKSArICJweCINCgkJfQ0KDQoJCWZ1bmN0aW9uIEtlKGUsIHQsIG4sIHIsIGkpIHtyZXR1cm4gbmV3IEtlLnByb3RvdHlwZS5pbml0KGUsIHQsIG4sIHIsIGkpfQ0KDQoJCVMuZXh0ZW5kKHsNCgkJCWNzc0hvb2tzOiB7DQoJCQkJb3BhY2l0eTogew0KCQkJCQlnZXQ6IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJCWlmKHQpIHsNCgkJCQkJCQl2YXIgbiA9IFdlKGUsICJvcGFjaXR5Iik7DQoJCQkJCQkJcmV0dXJuICIiID09PSBuID8gIjEiIDogbg0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfQ0KCQkJfSwNCgkJCWNzc051bWJlcjogew0KCQkJCWFuaW1hdGlvbkl0ZXJhdGlvbkNvdW50OiAhMCwNCgkJCQljb2x1bW5Db3VudDogITAsDQoJCQkJZmlsbE9wYWNpdHk6ICEwLA0KCQkJCWZsZXhHcm93OiAhMCwNCgkJCQlmbGV4U2hyaW5rOiAhMCwNCgkJCQlmb250V2VpZ2h0OiAhMCwNCgkJCQlncmlkQXJlYTogITAsDQoJCQkJZ3JpZENvbHVtbjogITAsDQoJCQkJZ3JpZENvbHVtbkVuZDogITAsDQoJCQkJZ3JpZENvbHVtblN0YXJ0OiAhMCwNCgkJCQlncmlkUm93OiAhMCwNCgkJCQlncmlkUm93RW5kOiAhMCwNCgkJCQlncmlkUm93U3RhcnQ6ICEwLA0KCQkJCWxpbmVIZWlnaHQ6ICEwLA0KCQkJCW9wYWNpdHk6ICEwLA0KCQkJCW9yZGVyOiAhMCwNCgkJCQlvcnBoYW5zOiAhMCwNCgkJCQl3aWRvd3M6ICEwLA0KCQkJCXpJbmRleDogITAsDQoJCQkJem9vbTogITANCgkJCX0sDQoJCQljc3NQcm9wczoge30sDQoJCQlzdHlsZTogZnVuY3Rpb24oZSwgdCwgbiwgcikgew0KCQkJCWlmKGUgJiYgMyAhPT0gZS5ub2RlVHlwZSAmJiA4ICE9PSBlLm5vZGVUeXBlICYmIGUuc3R5bGUpIHsNCgkJCQkJdmFyIGksIG8sIGEsIHMgPSBYKHQpLCB1ID0gWGUudGVzdCh0KSwgbCA9IGUuc3R5bGU7DQoJCQkJCWlmKHUgfHwgKHQgPSB6ZShzKSksIGEgPSBTLmNzc0hvb2tzW3RdIHx8IFMuY3NzSG9va3Nbc10sIHZvaWQgMCA9PT0gbikgcmV0dXJuIGEgJiYgImdldCIgaW4gYSAmJiB2b2lkIDAgIT09IChpID0gYS5nZXQoZSwgITEsIHIpKSA/IGkgOiBsW3RdOw0KCQkJCQkic3RyaW5nIiA9PT0gKG8gPSB0eXBlb2YgbikgJiYgKGkgPSB0ZS5leGVjKG4pKSAmJiBpWzFdICYmIChuID0gc2UoZSwgdCwgaSksIG8gPSAibnVtYmVyIiksIG51bGwgIT0gbiAmJiBuID09IG4gJiYgKCJudW1iZXIiICE9PSBvIHx8IHUgfHwgKG4gKz0gaSAmJiBpWzNdIHx8IChTLmNzc051bWJlcltzXSA/ICIiIDogInB4IikpLCB5LmNsZWFyQ2xvbmVTdHlsZSB8fCAiIiAhPT0gbiB8fCAwICE9PSB0LmluZGV4T2YoImJhY2tncm91bmQiKSB8fCAobFt0XSA9ICJpbmhlcml0IiksIGEgJiYgInNldCIgaW4gYSAmJiB2b2lkIDAgPT09IChuID0gYS5zZXQoZSwgbiwgcikpIHx8ICh1ID8gbC5zZXRQcm9wZXJ0eSh0LCBuKSA6IGxbdF0gPSBuKSkNCgkJCQl9DQoJCQl9LA0KCQkJY3NzOiBmdW5jdGlvbihlLCB0LCBuLCByKSB7DQoJCQkJdmFyIGksIG8sIGEsIHMgPSBYKHQpOw0KCQkJCXJldHVybiBYZS50ZXN0KHQpIHx8ICh0ID0gemUocykpLCAoYSA9IFMuY3NzSG9va3NbdF0gfHwgUy5jc3NIb29rc1tzXSkgJiYgImdldCIgaW4gYSAmJiAoaSA9IGEuZ2V0KGUsICEwLCBuKSksIHZvaWQgMCA9PT0gaSAmJiAoaSA9IFdlKGUsIHQsIHIpKSwgIm5vcm1hbCIgPT09IGkgJiYgdCBpbiBHZSAmJiAoaSA9IEdlW3RdKSwgIiIgPT09IG4gfHwgbiA/IChvID0gcGFyc2VGbG9hdChpKSwgITAgPT09IG4gfHwgaXNGaW5pdGUobykgPyBvIHx8IDAgOiBpKSA6IGkNCgkJCX0NCgkJfSksIFMuZWFjaChbImhlaWdodCIsICJ3aWR0aCJdLCBmdW5jdGlvbihlLCB1KSB7DQoJCQlTLmNzc0hvb2tzW3VdID0gew0KCQkJCWdldDogZnVuY3Rpb24oZSwgdCwgbikge2lmKHQpIHJldHVybiAhVWUudGVzdChTLmNzcyhlLCAiZGlzcGxheSIpKSB8fCBlLmdldENsaWVudFJlY3RzKCkubGVuZ3RoICYmIGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGggPyBKZShlLCB1LCBuKSA6IE1lKGUsIFZlLCBmdW5jdGlvbigpIHtyZXR1cm4gSmUoZSwgdSwgbil9KX0sDQoJCQkJc2V0OiBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJCXZhciByLCBpID0gUmUoZSksIG8gPSAheS5zY3JvbGxib3hTaXplKCkgJiYgImFic29sdXRlIiA9PT0gaS5wb3NpdGlvbiwgYSA9IChvIHx8IG4pICYmICJib3JkZXItYm94IiA9PT0gUy5jc3MoZSwgImJveFNpemluZyIsICExLCBpKSwgcyA9IG4gPyBRZShlLCB1LCBuLCBhLCBpKSA6IDA7DQoJCQkJCXJldHVybiBhICYmIG8gJiYgKHMgLT0gTWF0aC5jZWlsKGVbIm9mZnNldCIgKyB1WzBdLnRvVXBwZXJDYXNlKCkgKyB1LnNsaWNlKDEpXSAtIHBhcnNlRmxvYXQoaVt1XSkgLSBRZShlLCB1LCAiYm9yZGVyIiwgITEsIGkpIC0gLjUpKSwgcyAmJiAociA9IHRlLmV4ZWModCkpICYmICJweCIgIT09IChyWzNdIHx8ICJweCIpICYmIChlLnN0eWxlW3VdID0gdCwgdCA9IFMuY3NzKGUsIHUpKSwgWWUoMCwgdCwgcykNCgkJCQl9DQoJCQl9DQoJCX0pLCBTLmNzc0hvb2tzLm1hcmdpbkxlZnQgPSBGZSh5LnJlbGlhYmxlTWFyZ2luTGVmdCwgZnVuY3Rpb24oZSwgdCkge2lmKHQpIHJldHVybiAocGFyc2VGbG9hdChXZShlLCAibWFyZ2luTGVmdCIpKSB8fCBlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQgLSBNZShlLCB7bWFyZ2luTGVmdDogMH0sIGZ1bmN0aW9uKCkge3JldHVybiBlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnR9KSkgKyAicHgifSksIFMuZWFjaCh7DQoJCQltYXJnaW46ICIiLA0KCQkJcGFkZGluZzogIiIsDQoJCQlib3JkZXI6ICJXaWR0aCINCgkJfSwgZnVuY3Rpb24oaSwgbykgew0KCQkJUy5jc3NIb29rc1tpICsgb10gPSB7DQoJCQkJZXhwYW5kOiBmdW5jdGlvbihlKSB7DQoJCQkJCWZvcih2YXIgdCA9IDAsIG4gPSB7fSwgciA9ICJzdHJpbmciID09IHR5cGVvZiBlID8gZS5zcGxpdCgiICIpIDogW2VdOyB0IDwgNDsgdCsrKSBuW2kgKyBuZVt0XSArIG9dID0gclt0XSB8fCByW3QgLSAyXSB8fCByWzBdOw0KCQkJCQlyZXR1cm4gbg0KCQkJCX0NCgkJCX0sICJtYXJnaW4iICE9PSBpICYmIChTLmNzc0hvb2tzW2kgKyBvXS5zZXQgPSBZZSkNCgkJfSksIFMuZm4uZXh0ZW5kKHsNCgkJCWNzczogZnVuY3Rpb24oZSwgdCkgew0KCQkJCXJldHVybiAkKHRoaXMsIGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQkJdmFyIHIsIGksIG8gPSB7fSwgYSA9IDA7DQoJCQkJCWlmKEFycmF5LmlzQXJyYXkodCkpIHsNCgkJCQkJCWZvcihyID0gUmUoZSksIGkgPSB0Lmxlbmd0aDsgYSA8IGk7IGErKykgb1t0W2FdXSA9IFMuY3NzKGUsIHRbYV0sICExLCByKTsNCgkJCQkJCXJldHVybiBvDQoJCQkJCX0NCgkJCQkJcmV0dXJuIHZvaWQgMCAhPT0gbiA/IFMuc3R5bGUoZSwgdCwgbikgOiBTLmNzcyhlLCB0KQ0KCQkJCX0sIGUsIHQsIDEgPCBhcmd1bWVudHMubGVuZ3RoKQ0KCQkJfQ0KCQl9KSwgKChTLlR3ZWVuID0gS2UpLnByb3RvdHlwZSA9IHsNCgkJCWNvbnN0cnVjdG9yOiBLZSwNCgkJCWluaXQ6IGZ1bmN0aW9uKGUsIHQsIG4sIHIsIGksIG8pIHt0aGlzLmVsZW0gPSBlLCB0aGlzLnByb3AgPSBuLCB0aGlzLmVhc2luZyA9IGkgfHwgUy5lYXNpbmcuX2RlZmF1bHQsIHRoaXMub3B0aW9ucyA9IHQsIHRoaXMuc3RhcnQgPSB0aGlzLm5vdyA9IHRoaXMuY3VyKCksIHRoaXMuZW5kID0gciwgdGhpcy51bml0ID0gbyB8fCAoUy5jc3NOdW1iZXJbbl0gPyAiIiA6ICJweCIpfSwNCgkJCWN1cjogZnVuY3Rpb24oKSB7DQoJCQkJdmFyIGUgPSBLZS5wcm9wSG9va3NbdGhpcy5wcm9wXTsNCgkJCQlyZXR1cm4gZSAmJiBlLmdldCA/IGUuZ2V0KHRoaXMpIDogS2UucHJvcEhvb2tzLl9kZWZhdWx0LmdldCh0aGlzKQ0KCQkJfSwNCgkJCXJ1bjogZnVuY3Rpb24oZSkgew0KCQkJCXZhciB0LCBuID0gS2UucHJvcEhvb2tzW3RoaXMucHJvcF07DQoJCQkJcmV0dXJuIHRoaXMub3B0aW9ucy5kdXJhdGlvbiA/IHRoaXMucG9zID0gdCA9IFMuZWFzaW5nW3RoaXMuZWFzaW5nXShlLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24gKiBlLCAwLCAxLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24pIDogdGhpcy5wb3MgPSB0ID0gZSwgdGhpcy5ub3cgPSAodGhpcy5lbmQgLSB0aGlzLnN0YXJ0KSAqIHQgKyB0aGlzLnN0YXJ0LCB0aGlzLm9wdGlvbnMuc3RlcCAmJiB0aGlzLm9wdGlvbnMuc3RlcC5jYWxsKHRoaXMuZWxlbSwgdGhpcy5ub3csIHRoaXMpLCBuICYmIG4uc2V0ID8gbi5zZXQodGhpcykgOiBLZS5wcm9wSG9va3MuX2RlZmF1bHQuc2V0KHRoaXMpLCB0aGlzDQoJCQl9DQoJCX0pLmluaXQucHJvdG90eXBlID0gS2UucHJvdG90eXBlLCAoS2UucHJvcEhvb2tzID0gew0KCQkJX2RlZmF1bHQ6IHsNCgkJCQlnZXQ6IGZ1bmN0aW9uKGUpIHsNCgkJCQkJdmFyIHQ7DQoJCQkJCXJldHVybiAxICE9PSBlLmVsZW0ubm9kZVR5cGUgfHwgbnVsbCAhPSBlLmVsZW1bZS5wcm9wXSAmJiBudWxsID09IGUuZWxlbS5zdHlsZVtlLnByb3BdID8gZS5lbGVtW2UucHJvcF0gOiAodCA9IFMuY3NzKGUuZWxlbSwgZS5wcm9wLCAiIikpICYmICJhdXRvIiAhPT0gdCA/IHQgOiAwDQoJCQkJfSwgc2V0OiBmdW5jdGlvbihlKSB7Uy5meC5zdGVwW2UucHJvcF0gPyBTLmZ4LnN0ZXBbZS5wcm9wXShlKSA6IDEgIT09IGUuZWxlbS5ub2RlVHlwZSB8fCAhUy5jc3NIb29rc1tlLnByb3BdICYmIG51bGwgPT0gZS5lbGVtLnN0eWxlW3plKGUucHJvcCldID8gZS5lbGVtW2UucHJvcF0gPSBlLm5vdyA6IFMuc3R5bGUoZS5lbGVtLCBlLnByb3AsIGUubm93ICsgZS51bml0KX0NCgkJCX0NCgkJfSkuc2Nyb2xsVG9wID0gS2UucHJvcEhvb2tzLnNjcm9sbExlZnQgPSB7c2V0OiBmdW5jdGlvbihlKSB7ZS5lbGVtLm5vZGVUeXBlICYmIGUuZWxlbS5wYXJlbnROb2RlICYmIChlLmVsZW1bZS5wcm9wXSA9IGUubm93KX19LCBTLmVhc2luZyA9IHsNCgkJCWxpbmVhcjogZnVuY3Rpb24oZSkge3JldHVybiBlfSwNCgkJCXN3aW5nOiBmdW5jdGlvbihlKSB7cmV0dXJuIC41IC0gTWF0aC5jb3MoZSAqIE1hdGguUEkpIC8gMn0sDQoJCQlfZGVmYXVsdDogInN3aW5nIg0KCQl9LCBTLmZ4ID0gS2UucHJvdG90eXBlLmluaXQsIFMuZnguc3RlcCA9IHt9Ow0KCQl2YXIgWmUsIGV0LCB0dCwgbnQsIHJ0ID0gL14oPzp0b2dnbGV8c2hvd3xoaWRlKSQvLCBpdCA9IC9xdWV1ZUhvb2tzJC87DQoNCgkJZnVuY3Rpb24gb3QoKSB7ZXQgJiYgKCExID09PSBFLmhpZGRlbiAmJiBDLnJlcXVlc3RBbmltYXRpb25GcmFtZSA/IEMucmVxdWVzdEFuaW1hdGlvbkZyYW1lKG90KSA6IEMuc2V0VGltZW91dChvdCwgUy5meC5pbnRlcnZhbCksIFMuZngudGljaygpKX0NCg0KCQlmdW5jdGlvbiBhdCgpIHtyZXR1cm4gQy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1plID0gdm9pZCAwfSksIFplID0gRGF0ZS5ub3coKX0NCg0KCQlmdW5jdGlvbiBzdChlLCB0KSB7DQoJCQl2YXIgbiwgciA9IDAsIGkgPSB7aGVpZ2h0OiBlfTsNCgkJCWZvcih0ID0gdCA/IDEgOiAwOyByIDwgNDsgciArPSAyIC0gdCkgaVsibWFyZ2luIiArIChuID0gbmVbcl0pXSA9IGlbInBhZGRpbmciICsgbl0gPSBlOw0KCQkJcmV0dXJuIHQgJiYgKGkub3BhY2l0eSA9IGkud2lkdGggPSBlKSwgaQ0KCQl9DQoNCgkJZnVuY3Rpb24gdXQoZSwgdCwgbikge2Zvcih2YXIgciwgaSA9IChsdC50d2VlbmVyc1t0XSB8fCBbXSkuY29uY2F0KGx0LnR3ZWVuZXJzWyIqIl0pLCBvID0gMCwgYSA9IGkubGVuZ3RoOyBvIDwgYTsgbysrKSBpZihyID0gaVtvXS5jYWxsKG4sIHQsIGUpKSByZXR1cm4gcn0NCg0KCQlmdW5jdGlvbiBsdChvLCBlLCB0KSB7DQoJCQl2YXIgbiwNCgkJCSAgICBhLA0KCQkJICAgIHIgPSAwLA0KCQkJICAgIGkgPSBsdC5wcmVmaWx0ZXJzLmxlbmd0aCwNCgkJCSAgICBzID0gUy5EZWZlcnJlZCgpLmFsd2F5cyhmdW5jdGlvbigpIHtkZWxldGUgdS5lbGVtfSksDQoJCQkgICAgdSA9IGZ1bmN0aW9uKCkgew0KCQkJCSAgICBpZihhKSByZXR1cm4gITE7DQoJCQkJICAgIGZvcih2YXIgZSA9IFplIHx8IGF0KCksIHQgPSBNYXRoLm1heCgwLCBsLnN0YXJ0VGltZSArIGwuZHVyYXRpb24gLSBlKSwgbiA9IDEgLSAodCAvIGwuZHVyYXRpb24gfHwgMCksIHIgPSAwLCBpID0gbC50d2VlbnMubGVuZ3RoOyByIDwgaTsgcisrKSBsLnR3ZWVuc1tyXS5ydW4obik7DQoJCQkJICAgIHJldHVybiBzLm5vdGlmeVdpdGgobywgW2wsIG4sIHRdKSwgbiA8IDEgJiYgaSA/IHQgOiAoaSB8fCBzLm5vdGlmeVdpdGgobywgW2wsIDEsIDBdKSwgcy5yZXNvbHZlV2l0aChvLCBbbF0pLCAhMSkNCgkJCSAgICB9LA0KCQkJICAgIGwgPSBzLnByb21pc2Uoew0KCQkJCSAgICBlbGVtOiBvLA0KCQkJCSAgICBwcm9wczogUy5leHRlbmQoe30sIGUpLA0KCQkJCSAgICBvcHRzOiBTLmV4dGVuZCghMCwge3NwZWNpYWxFYXNpbmc6IHt9LCBlYXNpbmc6IFMuZWFzaW5nLl9kZWZhdWx0fSwgdCksDQoJCQkJICAgIG9yaWdpbmFsUHJvcGVydGllczogZSwNCgkJCQkgICAgb3JpZ2luYWxPcHRpb25zOiB0LA0KCQkJCSAgICBzdGFydFRpbWU6IFplIHx8IGF0KCksDQoJCQkJICAgIGR1cmF0aW9uOiB0LmR1cmF0aW9uLA0KCQkJCSAgICB0d2VlbnM6IFtdLA0KCQkJCSAgICBjcmVhdGVUd2VlbjogZnVuY3Rpb24oZSwgdCkgew0KCQkJCQkgICAgdmFyIG4gPSBTLlR3ZWVuKG8sIGwub3B0cywgZSwgdCwgbC5vcHRzLnNwZWNpYWxFYXNpbmdbZV0gfHwgbC5vcHRzLmVhc2luZyk7DQoJCQkJCSAgICByZXR1cm4gbC50d2VlbnMucHVzaChuKSwgbg0KCQkJCSAgICB9LA0KCQkJCSAgICBzdG9wOiBmdW5jdGlvbihlKSB7DQoJCQkJCSAgICB2YXIgdCA9IDAsIG4gPSBlID8gbC50d2VlbnMubGVuZ3RoIDogMDsNCgkJCQkJICAgIGlmKGEpIHJldHVybiB0aGlzOw0KCQkJCQkgICAgZm9yKGEgPSAhMDsgdCA8IG47IHQrKykgbC50d2VlbnNbdF0ucnVuKDEpOw0KCQkJCQkgICAgcmV0dXJuIGUgPyAocy5ub3RpZnlXaXRoKG8sIFtsLCAxLCAwXSksIHMucmVzb2x2ZVdpdGgobywgW2wsIGVdKSkgOiBzLnJlamVjdFdpdGgobywgW2wsIGVdKSwgdGhpcw0KCQkJCSAgICB9DQoJCQkgICAgfSksDQoJCQkgICAgYyA9IGwucHJvcHM7DQoJCQlmb3IoIWZ1bmN0aW9uKGUsIHQpIHsNCgkJCQl2YXIgbiwgciwgaSwgbywgYTsNCgkJCQlmb3IobiBpbiBlKSBpZihpID0gdFtyID0gWChuKV0sIG8gPSBlW25dLCBBcnJheS5pc0FycmF5KG8pICYmIChpID0gb1sxXSwgbyA9IGVbbl0gPSBvWzBdKSwgbiAhPT0gciAmJiAoZVtyXSA9IG8sIGRlbGV0ZSBlW25dKSwgKGEgPSBTLmNzc0hvb2tzW3JdKSAmJiAiZXhwYW5kIiBpbiBhKSBmb3IobiBpbiBvID0gYS5leHBhbmQobyksIGRlbGV0ZSBlW3JdLCBvKSBuIGluIGUgfHwgKGVbbl0gPSBvW25dLCB0W25dID0gaSk7IGVsc2UgdFtyXSA9IGkNCgkJCX0oYywgbC5vcHRzLnNwZWNpYWxFYXNpbmcpOyByIDwgaTsgcisrKSBpZihuID0gbHQucHJlZmlsdGVyc1tyXS5jYWxsKGwsIG8sIGMsIGwub3B0cykpIHJldHVybiBtKG4uc3RvcCkgJiYgKFMuX3F1ZXVlSG9va3MobC5lbGVtLCBsLm9wdHMucXVldWUpLnN0b3AgPSBuLnN0b3AuYmluZChuKSksIG47DQoJCQlyZXR1cm4gUy5tYXAoYywgdXQsIGwpLCBtKGwub3B0cy5zdGFydCkgJiYgbC5vcHRzLnN0YXJ0LmNhbGwobywgbCksIGwucHJvZ3Jlc3MobC5vcHRzLnByb2dyZXNzKS5kb25lKGwub3B0cy5kb25lLCBsLm9wdHMuY29tcGxldGUpLmZhaWwobC5vcHRzLmZhaWwpLmFsd2F5cyhsLm9wdHMuYWx3YXlzKSwgUy5meC50aW1lcihTLmV4dGVuZCh1LCB7ZWxlbTogbywgYW5pbTogbCwgcXVldWU6IGwub3B0cy5xdWV1ZX0pKSwgbA0KCQl9DQoNCgkJUy5BbmltYXRpb24gPSBTLmV4dGVuZChsdCwgew0KCQkJdHdlZW5lcnM6IHsNCgkJCQkiKiI6IFtmdW5jdGlvbihlLCB0KSB7DQoJCQkJCXZhciBuID0gdGhpcy5jcmVhdGVUd2VlbihlLCB0KTsNCgkJCQkJcmV0dXJuIHNlKG4uZWxlbSwgZSwgdGUuZXhlYyh0KSwgbiksIG4NCgkJCQl9XQ0KCQkJfSwgdHdlZW5lcjogZnVuY3Rpb24oZSwgdCkgew0KCQkJCW0oZSkgPyAodCA9IGUsIGUgPSBbIioiXSkgOiBlID0gZS5tYXRjaChQKTsNCgkJCQlmb3IodmFyIG4sIHIgPSAwLCBpID0gZS5sZW5ndGg7IHIgPCBpOyByKyspIG4gPSBlW3JdLCBsdC50d2VlbmVyc1tuXSA9IGx0LnR3ZWVuZXJzW25dIHx8IFtdLCBsdC50d2VlbmVyc1tuXS51bnNoaWZ0KHQpDQoJCQl9LCBwcmVmaWx0ZXJzOiBbZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCXZhciByLCBpLCBvLCBhLCBzLCB1LCBsLCBjLCBmID0gIndpZHRoIiBpbiB0IHx8ICJoZWlnaHQiIGluIHQsIHAgPSB0aGlzLCBkID0ge30sIGggPSBlLnN0eWxlLCBnID0gZS5ub2RlVHlwZSAmJiBhZShlKSwgdiA9IFkuZ2V0KGUsICJmeHNob3ciKTsNCgkJCQlmb3IociBpbiBuLnF1ZXVlIHx8IChudWxsID09IChhID0gUy5fcXVldWVIb29rcyhlLCAiZngiKSkudW5xdWV1ZWQgJiYgKGEudW5xdWV1ZWQgPSAwLCBzID0gYS5lbXB0eS5maXJlLCBhLmVtcHR5LmZpcmUgPSBmdW5jdGlvbigpIHthLnVucXVldWVkIHx8IHMoKX0pLCBhLnVucXVldWVkKyssIHAuYWx3YXlzKGZ1bmN0aW9uKCkge3AuYWx3YXlzKGZ1bmN0aW9uKCkge2EudW5xdWV1ZWQtLSwgUy5xdWV1ZShlLCAiZngiKS5sZW5ndGggfHwgYS5lbXB0eS5maXJlKCl9KX0pKSwgdCkgaWYoaSA9IHRbcl0sIHJ0LnRlc3QoaSkpIHsNCgkJCQkJaWYoZGVsZXRlIHRbcl0sIG8gPSBvIHx8ICJ0b2dnbGUiID09PSBpLCBpID09PSAoZyA/ICJoaWRlIiA6ICJzaG93IikpIHsNCgkJCQkJCWlmKCJzaG93IiAhPT0gaSB8fCAhdiB8fCB2b2lkIDAgPT09IHZbcl0pIGNvbnRpbnVlOw0KCQkJCQkJZyA9ICEwDQoJCQkJCX0NCgkJCQkJZFtyXSA9IHYgJiYgdltyXSB8fCBTLnN0eWxlKGUsIHIpDQoJCQkJfQ0KCQkJCWlmKCh1ID0gIVMuaXNFbXB0eU9iamVjdCh0KSkgfHwgIVMuaXNFbXB0eU9iamVjdChkKSkgZm9yKHIgaW4gZiAmJiAxID09PSBlLm5vZGVUeXBlICYmIChuLm92ZXJmbG93ID0gW2gub3ZlcmZsb3csIGgub3ZlcmZsb3dYLCBoLm92ZXJmbG93WV0sIG51bGwgPT0gKGwgPSB2ICYmIHYuZGlzcGxheSkgJiYgKGwgPSBZLmdldChlLCAiZGlzcGxheSIpKSwgIm5vbmUiID09PSAoYyA9IFMuY3NzKGUsICJkaXNwbGF5IikpICYmIChsID8gYyA9IGwgOiAobGUoW2VdLCAhMCksIGwgPSBlLnN0eWxlLmRpc3BsYXkgfHwgbCwgYyA9IFMuY3NzKGUsICJkaXNwbGF5IiksIGxlKFtlXSkpKSwgKCJpbmxpbmUiID09PSBjIHx8ICJpbmxpbmUtYmxvY2siID09PSBjICYmIG51bGwgIT0gbCkgJiYgIm5vbmUiID09PSBTLmNzcyhlLCAiZmxvYXQiKSAmJiAodSB8fCAocC5kb25lKGZ1bmN0aW9uKCkge2guZGlzcGxheSA9IGx9KSwgbnVsbCA9PSBsICYmIChjID0gaC5kaXNwbGF5LCBsID0gIm5vbmUiID09PSBjID8gIiIgOiBjKSksIGguZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siKSksIG4ub3ZlcmZsb3cgJiYgKGgub3ZlcmZsb3cgPSAiaGlkZGVuIiwgcC5hbHdheXMoZnVuY3Rpb24oKSB7aC5vdmVyZmxvdyA9IG4ub3ZlcmZsb3dbMF0sIGgub3ZlcmZsb3dYID0gbi5vdmVyZmxvd1sxXSwgaC5vdmVyZmxvd1kgPSBuLm92ZXJmbG93WzJdfSkpLCB1ID0gITEsIGQpIHUgfHwgKHYgPyAiaGlkZGVuIiBpbiB2ICYmIChnID0gdi5oaWRkZW4pIDogdiA9IFkuYWNjZXNzKGUsICJmeHNob3ciLCB7ZGlzcGxheTogbH0pLCBvICYmICh2LmhpZGRlbiA9ICFnKSwgZyAmJiBsZShbZV0sICEwKSwgcC5kb25lKGZ1bmN0aW9uKCkge2ZvcihyIGluIGcgfHwgbGUoW2VdKSwgWS5yZW1vdmUoZSwgImZ4c2hvdyIpLCBkKSBTLnN0eWxlKGUsIHIsIGRbcl0pfSkpLCB1ID0gdXQoZyA/IHZbcl0gOiAwLCByLCBwKSwgciBpbiB2IHx8ICh2W3JdID0gdS5zdGFydCwgZyAmJiAodS5lbmQgPSB1LnN0YXJ0LCB1LnN0YXJ0ID0gMCkpDQoJCQl9XSwgcHJlZmlsdGVyOiBmdW5jdGlvbihlLCB0KSB7dCA/IGx0LnByZWZpbHRlcnMudW5zaGlmdChlKSA6IGx0LnByZWZpbHRlcnMucHVzaChlKX0NCgkJfSksIFMuc3BlZWQgPSBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQl2YXIgciA9IGUgJiYgIm9iamVjdCIgPT0gdHlwZW9mIGUgPyBTLmV4dGVuZCh7fSwgZSkgOiB7Y29tcGxldGU6IG4gfHwgIW4gJiYgdCB8fCBtKGUpICYmIGUsIGR1cmF0aW9uOiBlLCBlYXNpbmc6IG4gJiYgdCB8fCB0ICYmICFtKHQpICYmIHR9Ow0KCQkJcmV0dXJuIFMuZngub2ZmID8gci5kdXJhdGlvbiA9IDAgOiAibnVtYmVyIiAhPSB0eXBlb2Ygci5kdXJhdGlvbiAmJiAoci5kdXJhdGlvbiBpbiBTLmZ4LnNwZWVkcyA/IHIuZHVyYXRpb24gPSBTLmZ4LnNwZWVkc1tyLmR1cmF0aW9uXSA6IHIuZHVyYXRpb24gPSBTLmZ4LnNwZWVkcy5fZGVmYXVsdCksIG51bGwgIT0gci5xdWV1ZSAmJiAhMCAhPT0gci5xdWV1ZSB8fCAoci5xdWV1ZSA9ICJmeCIpLCByLm9sZCA9IHIuY29tcGxldGUsIHIuY29tcGxldGUgPSBmdW5jdGlvbigpIHttKHIub2xkKSAmJiByLm9sZC5jYWxsKHRoaXMpLCByLnF1ZXVlICYmIFMuZGVxdWV1ZSh0aGlzLCByLnF1ZXVlKX0sIHINCgkJfSwgUy5mbi5leHRlbmQoew0KCQkJZmFkZVRvOiBmdW5jdGlvbihlLCB0LCBuLCByKSB7cmV0dXJuIHRoaXMuZmlsdGVyKGFlKS5jc3MoIm9wYWNpdHkiLCAwKS5zaG93KCkuZW5kKCkuYW5pbWF0ZSh7b3BhY2l0eTogdH0sIGUsIG4sIHIpfSwgYW5pbWF0ZTogZnVuY3Rpb24odCwgZSwgbiwgcikgew0KCQkJCXZhciBpID0gUy5pc0VtcHR5T2JqZWN0KHQpLCBvID0gUy5zcGVlZChlLCBuLCByKSwgYSA9IGZ1bmN0aW9uKCkgew0KCQkJCQl2YXIgZSA9IGx0KHRoaXMsIFMuZXh0ZW5kKHt9LCB0KSwgbyk7DQoJCQkJCShpIHx8IFkuZ2V0KHRoaXMsICJmaW5pc2giKSkgJiYgZS5zdG9wKCEwKQ0KCQkJCX07DQoJCQkJcmV0dXJuIGEuZmluaXNoID0gYSwgaSB8fCAhMSA9PT0gby5xdWV1ZSA/IHRoaXMuZWFjaChhKSA6IHRoaXMucXVldWUoby5xdWV1ZSwgYSkNCgkJCX0sIHN0b3A6IGZ1bmN0aW9uKGksIGUsIG8pIHsNCgkJCQl2YXIgYSA9IGZ1bmN0aW9uKGUpIHsNCgkJCQkJdmFyIHQgPSBlLnN0b3A7DQoJCQkJCWRlbGV0ZSBlLnN0b3AsIHQobykNCgkJCQl9Ow0KCQkJCXJldHVybiAic3RyaW5nIiAhPSB0eXBlb2YgaSAmJiAobyA9IGUsIGUgPSBpLCBpID0gdm9pZCAwKSwgZSAmJiB0aGlzLnF1ZXVlKGkgfHwgImZ4IiwgW10pLCB0aGlzLmVhY2goZnVuY3Rpb24oKSB7DQoJCQkJCXZhciBlID0gITAsIHQgPSBudWxsICE9IGkgJiYgaSArICJxdWV1ZUhvb2tzIiwgbiA9IFMudGltZXJzLCByID0gWS5nZXQodGhpcyk7DQoJCQkJCWlmKHQpIHJbdF0gJiYgclt0XS5zdG9wICYmIGEoclt0XSk7IGVsc2UgZm9yKHQgaW4gcikgclt0XSAmJiByW3RdLnN0b3AgJiYgaXQudGVzdCh0KSAmJiBhKHJbdF0pOw0KCQkJCQlmb3IodCA9IG4ubGVuZ3RoOyB0LS07KSBuW3RdLmVsZW0gIT09IHRoaXMgfHwgbnVsbCAhPSBpICYmIG5bdF0ucXVldWUgIT09IGkgfHwgKG5bdF0uYW5pbS5zdG9wKG8pLCBlID0gITEsIG4uc3BsaWNlKHQsIDEpKTsNCgkJCQkJIWUgJiYgbyB8fCBTLmRlcXVldWUodGhpcywgaSkNCgkJCQl9KQ0KCQkJfSwgZmluaXNoOiBmdW5jdGlvbihhKSB7DQoJCQkJcmV0dXJuICExICE9PSBhICYmIChhID0gYSB8fCAiZngiKSwgdGhpcy5lYWNoKGZ1bmN0aW9uKCkgew0KCQkJCQl2YXIgZSwgdCA9IFkuZ2V0KHRoaXMpLCBuID0gdFthICsgInF1ZXVlIl0sIHIgPSB0W2EgKyAicXVldWVIb29rcyJdLCBpID0gUy50aW1lcnMsIG8gPSBuID8gbi5sZW5ndGggOiAwOw0KCQkJCQlmb3IodC5maW5pc2ggPSAhMCwgUy5xdWV1ZSh0aGlzLCBhLCBbXSksIHIgJiYgci5zdG9wICYmIHIuc3RvcC5jYWxsKHRoaXMsICEwKSwgZSA9IGkubGVuZ3RoOyBlLS07KSBpW2VdLmVsZW0gPT09IHRoaXMgJiYgaVtlXS5xdWV1ZSA9PT0gYSAmJiAoaVtlXS5hbmltLnN0b3AoITApLCBpLnNwbGljZShlLCAxKSk7DQoJCQkJCWZvcihlID0gMDsgZSA8IG87IGUrKykgbltlXSAmJiBuW2VdLmZpbmlzaCAmJiBuW2VdLmZpbmlzaC5jYWxsKHRoaXMpOw0KCQkJCQlkZWxldGUgdC5maW5pc2gNCgkJCQl9KQ0KCQkJfQ0KCQl9KSwgUy5lYWNoKFsidG9nZ2xlIiwgInNob3ciLCAiaGlkZSJdLCBmdW5jdGlvbihlLCByKSB7DQoJCQl2YXIgaSA9IFMuZm5bcl07DQoJCQlTLmZuW3JdID0gZnVuY3Rpb24oZSwgdCwgbikge3JldHVybiBudWxsID09IGUgfHwgImJvb2xlYW4iID09IHR5cGVvZiBlID8gaS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIDogdGhpcy5hbmltYXRlKHN0KHIsICEwKSwgZSwgdCwgbil9DQoJCX0pLCBTLmVhY2goew0KCQkJc2xpZGVEb3duOiBzdCgic2hvdyIpLA0KCQkJc2xpZGVVcDogc3QoImhpZGUiKSwNCgkJCXNsaWRlVG9nZ2xlOiBzdCgidG9nZ2xlIiksDQoJCQlmYWRlSW46IHtvcGFjaXR5OiAic2hvdyJ9LA0KCQkJZmFkZU91dDoge29wYWNpdHk6ICJoaWRlIn0sDQoJCQlmYWRlVG9nZ2xlOiB7b3BhY2l0eTogInRvZ2dsZSJ9DQoJCX0sIGZ1bmN0aW9uKGUsIHIpIHtTLmZuW2VdID0gZnVuY3Rpb24oZSwgdCwgbikge3JldHVybiB0aGlzLmFuaW1hdGUociwgZSwgdCwgbil9fSksIFMudGltZXJzID0gW10sIFMuZngudGljayA9IGZ1bmN0aW9uKCkgew0KCQkJdmFyIGUsIHQgPSAwLCBuID0gUy50aW1lcnM7DQoJCQlmb3IoWmUgPSBEYXRlLm5vdygpOyB0IDwgbi5sZW5ndGg7IHQrKykgKGUgPSBuW3RdKSgpIHx8IG5bdF0gIT09IGUgfHwgbi5zcGxpY2UodC0tLCAxKTsNCgkJCW4ubGVuZ3RoIHx8IFMuZnguc3RvcCgpLCBaZSA9IHZvaWQgMA0KCQl9LCBTLmZ4LnRpbWVyID0gZnVuY3Rpb24oZSkge1MudGltZXJzLnB1c2goZSksIFMuZnguc3RhcnQoKX0sIFMuZnguaW50ZXJ2YWwgPSAxMywgUy5meC5zdGFydCA9IGZ1bmN0aW9uKCkge2V0IHx8IChldCA9ICEwLCBvdCgpKX0sIFMuZnguc3RvcCA9IGZ1bmN0aW9uKCkge2V0ID0gbnVsbH0sIFMuZnguc3BlZWRzID0gew0KCQkJc2xvdzogNjAwLA0KCQkJZmFzdDogMjAwLA0KCQkJX2RlZmF1bHQ6IDQwMA0KCQl9LCBTLmZuLmRlbGF5ID0gZnVuY3Rpb24ociwgZSkgew0KCQkJcmV0dXJuIHIgPSBTLmZ4ICYmIFMuZnguc3BlZWRzW3JdIHx8IHIsIGUgPSBlIHx8ICJmeCIsIHRoaXMucXVldWUoZSwgZnVuY3Rpb24oZSwgdCkgew0KCQkJCXZhciBuID0gQy5zZXRUaW1lb3V0KGUsIHIpOw0KCQkJCXQuc3RvcCA9IGZ1bmN0aW9uKCkge0MuY2xlYXJUaW1lb3V0KG4pfQ0KCQkJfSkNCgkJfSwgdHQgPSBFLmNyZWF0ZUVsZW1lbnQoImlucHV0IiksIG50ID0gRS5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKS5hcHBlbmRDaGlsZChFLmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpKSwgdHQudHlwZSA9ICJjaGVja2JveCIsIHkuY2hlY2tPbiA9ICIiICE9PSB0dC52YWx1ZSwgeS5vcHRTZWxlY3RlZCA9IG50LnNlbGVjdGVkLCAodHQgPSBFLmNyZWF0ZUVsZW1lbnQoImlucHV0IikpLnZhbHVlID0gInQiLCB0dC50eXBlID0gInJhZGlvIiwgeS5yYWRpb1ZhbHVlID0gInQiID09PSB0dC52YWx1ZTsNCgkJdmFyIGN0LCBmdCA9IFMuZXhwci5hdHRySGFuZGxlOw0KCQlTLmZuLmV4dGVuZCh7YXR0cjogZnVuY3Rpb24oZSwgdCkge3JldHVybiAkKHRoaXMsIFMuYXR0ciwgZSwgdCwgMSA8IGFyZ3VtZW50cy5sZW5ndGgpfSwgcmVtb3ZlQXR0cjogZnVuY3Rpb24oZSkge3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7Uy5yZW1vdmVBdHRyKHRoaXMsIGUpfSl9fSksIFMuZXh0ZW5kKHsNCgkJCWF0dHI6IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQl2YXIgciwgaSwgbyA9IGUubm9kZVR5cGU7DQoJCQkJaWYoMyAhPT0gbyAmJiA4ICE9PSBvICYmIDIgIT09IG8pIHJldHVybiAidW5kZWZpbmVkIiA9PSB0eXBlb2YgZS5nZXRBdHRyaWJ1dGUgPyBTLnByb3AoZSwgdCwgbikgOiAoMSA9PT0gbyAmJiBTLmlzWE1MRG9jKGUpIHx8IChpID0gUy5hdHRySG9va3NbdC50b0xvd2VyQ2FzZSgpXSB8fCAoUy5leHByLm1hdGNoLmJvb2wudGVzdCh0KSA/IGN0IDogdm9pZCAwKSksIHZvaWQgMCAhPT0gbiA/IG51bGwgPT09IG4gPyB2b2lkIFMucmVtb3ZlQXR0cihlLCB0KSA6IGkgJiYgInNldCIgaW4gaSAmJiB2b2lkIDAgIT09IChyID0gaS5zZXQoZSwgbiwgdCkpID8gciA6IChlLnNldEF0dHJpYnV0ZSh0LCBuICsgIiIpLCBuKSA6IGkgJiYgImdldCIgaW4gaSAmJiBudWxsICE9PSAociA9IGkuZ2V0KGUsIHQpKSA/IHIgOiBudWxsID09IChyID0gUy5maW5kLmF0dHIoZSwgdCkpID8gdm9pZCAwIDogcikNCgkJCX0sIGF0dHJIb29rczogew0KCQkJCXR5cGU6IHsNCgkJCQkJc2V0OiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJCQlpZigheS5yYWRpb1ZhbHVlICYmICJyYWRpbyIgPT09IHQgJiYgQShlLCAiaW5wdXQiKSkgew0KCQkJCQkJCXZhciBuID0gZS52YWx1ZTsNCgkJCQkJCQlyZXR1cm4gZS5zZXRBdHRyaWJ1dGUoInR5cGUiLCB0KSwgbiAmJiAoZS52YWx1ZSA9IG4pLCB0DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9DQoJCQl9LCByZW1vdmVBdHRyOiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4sIHIgPSAwLCBpID0gdCAmJiB0Lm1hdGNoKFApOw0KCQkJCWlmKGkgJiYgMSA9PT0gZS5ub2RlVHlwZSkgd2hpbGUobiA9IGlbcisrXSkgZS5yZW1vdmVBdHRyaWJ1dGUobikNCgkJCX0NCgkJfSksIGN0ID0ge3NldDogZnVuY3Rpb24oZSwgdCwgbikge3JldHVybiAhMSA9PT0gdCA/IFMucmVtb3ZlQXR0cihlLCBuKSA6IGUuc2V0QXR0cmlidXRlKG4sIG4pLCBufX0sIFMuZWFjaChTLmV4cHIubWF0Y2guYm9vbC5zb3VyY2UubWF0Y2goL1x3Ky9nKSwgZnVuY3Rpb24oZSwgdCkgew0KCQkJdmFyIGEgPSBmdFt0XSB8fCBTLmZpbmQuYXR0cjsNCgkJCWZ0W3RdID0gZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCXZhciByLCBpLCBvID0gdC50b0xvd2VyQ2FzZSgpOw0KCQkJCXJldHVybiBuIHx8IChpID0gZnRbb10sIGZ0W29dID0gciwgciA9IG51bGwgIT0gYShlLCB0LCBuKSA/IG8gOiBudWxsLCBmdFtvXSA9IGkpLCByDQoJCQl9DQoJCX0pOw0KCQl2YXIgcHQgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b24pJC9pLCBkdCA9IC9eKD86YXxhcmVhKSQvaTsNCg0KCQlmdW5jdGlvbiBodChlKSB7cmV0dXJuIChlLm1hdGNoKFApIHx8IFtdKS5qb2luKCIgIil9DQoNCgkJZnVuY3Rpb24gZ3QoZSkge3JldHVybiBlLmdldEF0dHJpYnV0ZSAmJiBlLmdldEF0dHJpYnV0ZSgiY2xhc3MiKSB8fCAiIn0NCg0KCQlmdW5jdGlvbiB2dChlKSB7cmV0dXJuIEFycmF5LmlzQXJyYXkoZSkgPyBlIDogInN0cmluZyIgPT0gdHlwZW9mIGUgJiYgZS5tYXRjaChQKSB8fCBbXX0NCg0KCQlTLmZuLmV4dGVuZCh7cHJvcDogZnVuY3Rpb24oZSwgdCkge3JldHVybiAkKHRoaXMsIFMucHJvcCwgZSwgdCwgMSA8IGFyZ3VtZW50cy5sZW5ndGgpfSwgcmVtb3ZlUHJvcDogZnVuY3Rpb24oZSkge3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7ZGVsZXRlIHRoaXNbUy5wcm9wRml4W2VdIHx8IGVdfSl9fSksIFMuZXh0ZW5kKHsNCgkJCXByb3A6IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQl2YXIgciwgaSwgbyA9IGUubm9kZVR5cGU7DQoJCQkJaWYoMyAhPT0gbyAmJiA4ICE9PSBvICYmIDIgIT09IG8pIHJldHVybiAxID09PSBvICYmIFMuaXNYTUxEb2MoZSkgfHwgKHQgPSBTLnByb3BGaXhbdF0gfHwgdCwgaSA9IFMucHJvcEhvb2tzW3RdKSwgdm9pZCAwICE9PSBuID8gaSAmJiAic2V0IiBpbiBpICYmIHZvaWQgMCAhPT0gKHIgPSBpLnNldChlLCBuLCB0KSkgPyByIDogZVt0XSA9IG4gOiBpICYmICJnZXQiIGluIGkgJiYgbnVsbCAhPT0gKHIgPSBpLmdldChlLCB0KSkgPyByIDogZVt0XQ0KCQkJfSwgcHJvcEhvb2tzOiB7DQoJCQkJdGFiSW5kZXg6IHsNCgkJCQkJZ2V0OiBmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgdCA9IFMuZmluZC5hdHRyKGUsICJ0YWJpbmRleCIpOw0KCQkJCQkJcmV0dXJuIHQgPyBwYXJzZUludCh0LCAxMCkgOiBwdC50ZXN0KGUubm9kZU5hbWUpIHx8IGR0LnRlc3QoZS5ub2RlTmFtZSkgJiYgZS5ocmVmID8gMCA6IC0xDQoJCQkJCX0NCgkJCQl9DQoJCQl9LCBwcm9wRml4OiB7ImZvciI6ICJodG1sRm9yIiwgImNsYXNzIjogImNsYXNzTmFtZSJ9DQoJCX0pLCB5Lm9wdFNlbGVjdGVkIHx8IChTLnByb3BIb29rcy5zZWxlY3RlZCA9IHsNCgkJCWdldDogZnVuY3Rpb24oZSkgew0KCQkJCXZhciB0ID0gZS5wYXJlbnROb2RlOw0KCQkJCXJldHVybiB0ICYmIHQucGFyZW50Tm9kZSAmJiB0LnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleCwgbnVsbA0KCQkJfSwgc2V0OiBmdW5jdGlvbihlKSB7DQoJCQkJdmFyIHQgPSBlLnBhcmVudE5vZGU7DQoJCQkJdCAmJiAodC5zZWxlY3RlZEluZGV4LCB0LnBhcmVudE5vZGUgJiYgdC5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXgpDQoJCQl9DQoJCX0pLCBTLmVhY2goWyJ0YWJJbmRleCIsICJyZWFkT25seSIsICJtYXhMZW5ndGgiLCAiY2VsbFNwYWNpbmciLCAiY2VsbFBhZGRpbmciLCAicm93U3BhbiIsICJjb2xTcGFuIiwgInVzZU1hcCIsICJmcmFtZUJvcmRlciIsICJjb250ZW50RWRpdGFibGUiXSwgZnVuY3Rpb24oKSB7Uy5wcm9wRml4W3RoaXMudG9Mb3dlckNhc2UoKV0gPSB0aGlzfSksIFMuZm4uZXh0ZW5kKHsNCgkJCWFkZENsYXNzOiBmdW5jdGlvbih0KSB7DQoJCQkJdmFyIGUsIG4sIHIsIGksIG8sIGEsIHMsIHUgPSAwOw0KCQkJCWlmKG0odCkpIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oZSkge1ModGhpcykuYWRkQ2xhc3ModC5jYWxsKHRoaXMsIGUsIGd0KHRoaXMpKSl9KTsNCgkJCQlpZigoZSA9IHZ0KHQpKS5sZW5ndGgpIHdoaWxlKG4gPSB0aGlzW3UrK10pIGlmKGkgPSBndChuKSwgciA9IDEgPT09IG4ubm9kZVR5cGUgJiYgIiAiICsgaHQoaSkgKyAiICIpIHsNCgkJCQkJYSA9IDA7DQoJCQkJCXdoaWxlKG8gPSBlW2ErK10pIHIuaW5kZXhPZigiICIgKyBvICsgIiAiKSA8IDAgJiYgKHIgKz0gbyArICIgIik7DQoJCQkJCWkgIT09IChzID0gaHQocikpICYmIG4uc2V0QXR0cmlidXRlKCJjbGFzcyIsIHMpDQoJCQkJfQ0KCQkJCXJldHVybiB0aGlzDQoJCQl9LCByZW1vdmVDbGFzczogZnVuY3Rpb24odCkgew0KCQkJCXZhciBlLCBuLCByLCBpLCBvLCBhLCBzLCB1ID0gMDsNCgkJCQlpZihtKHQpKSByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGUpIHtTKHRoaXMpLnJlbW92ZUNsYXNzKHQuY2FsbCh0aGlzLCBlLCBndCh0aGlzKSkpfSk7DQoJCQkJaWYoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB0aGlzLmF0dHIoImNsYXNzIiwgIiIpOw0KCQkJCWlmKChlID0gdnQodCkpLmxlbmd0aCkgd2hpbGUobiA9IHRoaXNbdSsrXSkgaWYoaSA9IGd0KG4pLCByID0gMSA9PT0gbi5ub2RlVHlwZSAmJiAiICIgKyBodChpKSArICIgIikgew0KCQkJCQlhID0gMDsNCgkJCQkJd2hpbGUobyA9IGVbYSsrXSkgd2hpbGUoLTEgPCByLmluZGV4T2YoIiAiICsgbyArICIgIikpIHIgPSByLnJlcGxhY2UoIiAiICsgbyArICIgIiwgIiAiKTsNCgkJCQkJaSAhPT0gKHMgPSBodChyKSkgJiYgbi5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgcykNCgkJCQl9DQoJCQkJcmV0dXJuIHRoaXMNCgkJCX0sIHRvZ2dsZUNsYXNzOiBmdW5jdGlvbihpLCB0KSB7DQoJCQkJdmFyIG8gPSB0eXBlb2YgaSwgYSA9ICJzdHJpbmciID09PSBvIHx8IEFycmF5LmlzQXJyYXkoaSk7DQoJCQkJcmV0dXJuICJib29sZWFuIiA9PSB0eXBlb2YgdCAmJiBhID8gdCA/IHRoaXMuYWRkQ2xhc3MoaSkgOiB0aGlzLnJlbW92ZUNsYXNzKGkpIDogbShpKSA/IHRoaXMuZWFjaChmdW5jdGlvbihlKSB7Uyh0aGlzKS50b2dnbGVDbGFzcyhpLmNhbGwodGhpcywgZSwgZ3QodGhpcyksIHQpLCB0KX0pIDogdGhpcy5lYWNoKGZ1bmN0aW9uKCkgew0KCQkJCQl2YXIgZSwgdCwgbiwgcjsNCgkJCQkJaWYoYSkgew0KCQkJCQkJdCA9IDAsIG4gPSBTKHRoaXMpLCByID0gdnQoaSk7DQoJCQkJCQl3aGlsZShlID0gclt0KytdKSBuLmhhc0NsYXNzKGUpID8gbi5yZW1vdmVDbGFzcyhlKSA6IG4uYWRkQ2xhc3MoZSkNCgkJCQkJfSBlbHNlIHZvaWQgMCAhPT0gaSAmJiAiYm9vbGVhbiIgIT09IG8gfHwgKChlID0gZ3QodGhpcykpICYmIFkuc2V0KHRoaXMsICJfX2NsYXNzTmFtZV9fIiwgZSksIHRoaXMuc2V0QXR0cmlidXRlICYmIHRoaXMuc2V0QXR0cmlidXRlKCJjbGFzcyIsIGUgfHwgITEgPT09IGkgPyAiIiA6IFkuZ2V0KHRoaXMsICJfX2NsYXNzTmFtZV9fIikgfHwgIiIpKQ0KCQkJCX0pDQoJCQl9LCBoYXNDbGFzczogZnVuY3Rpb24oZSkgew0KCQkJCXZhciB0LCBuLCByID0gMDsNCgkJCQl0ID0gIiAiICsgZSArICIgIjsNCgkJCQl3aGlsZShuID0gdGhpc1tyKytdKSBpZigxID09PSBuLm5vZGVUeXBlICYmIC0xIDwgKCIgIiArIGh0KGd0KG4pKSArICIgIikuaW5kZXhPZih0KSkgcmV0dXJuICEwOw0KCQkJCXJldHVybiAhMQ0KCQkJfQ0KCQl9KTsNCgkJdmFyIHl0ID0gL1xyL2c7DQoJCVMuZm4uZXh0ZW5kKHsNCgkJCXZhbDogZnVuY3Rpb24obikgew0KCQkJCXZhciByLCBlLCBpLCB0ID0gdGhpc1swXTsNCgkJCQlyZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChpID0gbShuKSwgdGhpcy5lYWNoKGZ1bmN0aW9uKGUpIHsNCgkJCQkJdmFyIHQ7DQoJCQkJCTEgPT09IHRoaXMubm9kZVR5cGUgJiYgKG51bGwgPT0gKHQgPSBpID8gbi5jYWxsKHRoaXMsIGUsIFModGhpcykudmFsKCkpIDogbikgPyB0ID0gIiIgOiAibnVtYmVyIiA9PSB0eXBlb2YgdCA/IHQgKz0gIiIgOiBBcnJheS5pc0FycmF5KHQpICYmICh0ID0gUy5tYXAodCwgZnVuY3Rpb24oZSkge3JldHVybiBudWxsID09IGUgPyAiIiA6IGUgKyAiIn0pKSwgKHIgPSBTLnZhbEhvb2tzW3RoaXMudHlwZV0gfHwgUy52YWxIb29rc1t0aGlzLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKSAmJiAic2V0IiBpbiByICYmIHZvaWQgMCAhPT0gci5zZXQodGhpcywgdCwgInZhbHVlIikgfHwgKHRoaXMudmFsdWUgPSB0KSkNCgkJCQl9KSkgOiB0ID8gKHIgPSBTLnZhbEhvb2tzW3QudHlwZV0gfHwgUy52YWxIb29rc1t0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKSAmJiAiZ2V0IiBpbiByICYmIHZvaWQgMCAhPT0gKGUgPSByLmdldCh0LCAidmFsdWUiKSkgPyBlIDogInN0cmluZyIgPT0gdHlwZW9mIChlID0gdC52YWx1ZSkgPyBlLnJlcGxhY2UoeXQsICIiKSA6IG51bGwgPT0gZSA/ICIiIDogZSA6IHZvaWQgMA0KCQkJfQ0KCQl9KSwgUy5leHRlbmQoew0KCQkJdmFsSG9va3M6IHsNCgkJCQlvcHRpb246IHsNCgkJCQkJZ2V0OiBmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgdCA9IFMuZmluZC5hdHRyKGUsICJ2YWx1ZSIpOw0KCQkJCQkJcmV0dXJuIG51bGwgIT0gdCA/IHQgOiBodChTLnRleHQoZSkpDQoJCQkJCX0NCgkJCQl9LCBzZWxlY3Q6IHsNCgkJCQkJZ2V0OiBmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgdCwgbiwgciwgaSA9IGUub3B0aW9ucywgbyA9IGUuc2VsZWN0ZWRJbmRleCwgYSA9ICJzZWxlY3Qtb25lIiA9PT0gZS50eXBlLCBzID0gYSA/IG51bGwgOiBbXSwgdSA9IGEgPyBvICsgMSA6IGkubGVuZ3RoOw0KCQkJCQkJZm9yKHIgPSBvIDwgMCA/IHUgOiBhID8gbyA6IDA7IHIgPCB1OyByKyspIGlmKCgobiA9IGlbcl0pLnNlbGVjdGVkIHx8IHIgPT09IG8pICYmICFuLmRpc2FibGVkICYmICghbi5wYXJlbnROb2RlLmRpc2FibGVkIHx8ICFBKG4ucGFyZW50Tm9kZSwgIm9wdGdyb3VwIikpKSB7DQoJCQkJCQkJaWYodCA9IFMobikudmFsKCksIGEpIHJldHVybiB0Ow0KCQkJCQkJCXMucHVzaCh0KQ0KCQkJCQkJfQ0KCQkJCQkJcmV0dXJuIHMNCgkJCQkJfSwgc2V0OiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJCQl2YXIgbiwgciwgaSA9IGUub3B0aW9ucywgbyA9IFMubWFrZUFycmF5KHQpLCBhID0gaS5sZW5ndGg7DQoJCQkJCQl3aGlsZShhLS0pICgociA9IGlbYV0pLnNlbGVjdGVkID0gLTEgPCBTLmluQXJyYXkoUy52YWxIb29rcy5vcHRpb24uZ2V0KHIpLCBvKSkgJiYgKG4gPSAhMCk7DQoJCQkJCQlyZXR1cm4gbiB8fCAoZS5zZWxlY3RlZEluZGV4ID0gLTEpLCBvDQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCX0pLCBTLmVhY2goWyJyYWRpbyIsICJjaGVja2JveCJdLCBmdW5jdGlvbigpIHtTLnZhbEhvb2tzW3RoaXNdID0ge3NldDogZnVuY3Rpb24oZSwgdCkge2lmKEFycmF5LmlzQXJyYXkodCkpIHJldHVybiBlLmNoZWNrZWQgPSAtMSA8IFMuaW5BcnJheShTKGUpLnZhbCgpLCB0KX19LCB5LmNoZWNrT24gfHwgKFMudmFsSG9va3NbdGhpc10uZ2V0ID0gZnVuY3Rpb24oZSkge3JldHVybiBudWxsID09PSBlLmdldEF0dHJpYnV0ZSgidmFsdWUiKSA/ICJvbiIgOiBlLnZhbHVlfSl9KSwgeS5mb2N1c2luID0gIm9uZm9jdXNpbiIgaW4gQzsNCgkJdmFyIG10ID0gL14oPzpmb2N1c2luZm9jdXN8Zm9jdXNvdXRibHVyKSQvLCB4dCA9IGZ1bmN0aW9uKGUpIHtlLnN0b3BQcm9wYWdhdGlvbigpfTsNCgkJUy5leHRlbmQoUy5ldmVudCwgew0KCQkJdHJpZ2dlcjogZnVuY3Rpb24oZSwgdCwgbiwgcikgew0KCQkJCXZhciBpLCBvLCBhLCBzLCB1LCBsLCBjLCBmLCBwID0gW24gfHwgRV0sIGQgPSB2LmNhbGwoZSwgInR5cGUiKSA/IGUudHlwZSA6IGUsIGggPSB2LmNhbGwoZSwgIm5hbWVzcGFjZSIpID8gZS5uYW1lc3BhY2Uuc3BsaXQoIi4iKSA6IFtdOw0KCQkJCWlmKG8gPSBmID0gYSA9IG4gPSBuIHx8IEUsIDMgIT09IG4ubm9kZVR5cGUgJiYgOCAhPT0gbi5ub2RlVHlwZSAmJiAhbXQudGVzdChkICsgUy5ldmVudC50cmlnZ2VyZWQpICYmICgtMSA8IGQuaW5kZXhPZigiLiIpICYmIChkID0gKGggPSBkLnNwbGl0KCIuIikpLnNoaWZ0KCksIGguc29ydCgpKSwgdSA9IGQuaW5kZXhPZigiOiIpIDwgMCAmJiAib24iICsgZCwgKGUgPSBlW1MuZXhwYW5kb10gPyBlIDogbmV3IFMuRXZlbnQoZCwgIm9iamVjdCIgPT0gdHlwZW9mIGUgJiYgZSkpLmlzVHJpZ2dlciA9IHIgPyAyIDogMywgZS5uYW1lc3BhY2UgPSBoLmpvaW4oIi4iKSwgZS5ybmFtZXNwYWNlID0gZS5uYW1lc3BhY2UgPyBuZXcgUmVnRXhwKCIoXnxcXC4pIiArIGguam9pbigiXFwuKD86LipcXC58KSIpICsgIihcXC58JCkiKSA6IG51bGwsIGUucmVzdWx0ID0gdm9pZCAwLCBlLnRhcmdldCB8fCAoZS50YXJnZXQgPSBuKSwgdCA9IG51bGwgPT0gdCA/IFtlXSA6IFMubWFrZUFycmF5KHQsIFtlXSksIGMgPSBTLmV2ZW50LnNwZWNpYWxbZF0gfHwge30sIHIgfHwgIWMudHJpZ2dlciB8fCAhMSAhPT0gYy50cmlnZ2VyLmFwcGx5KG4sIHQpKSkgew0KCQkJCQlpZighciAmJiAhYy5ub0J1YmJsZSAmJiAheChuKSkgew0KCQkJCQkJZm9yKHMgPSBjLmRlbGVnYXRlVHlwZSB8fCBkLCBtdC50ZXN0KHMgKyBkKSB8fCAobyA9IG8ucGFyZW50Tm9kZSk7IG87IG8gPSBvLnBhcmVudE5vZGUpIHAucHVzaChvKSwgYSA9IG87DQoJCQkJCQlhID09PSAobi5vd25lckRvY3VtZW50IHx8IEUpICYmIHAucHVzaChhLmRlZmF1bHRWaWV3IHx8IGEucGFyZW50V2luZG93IHx8IEMpDQoJCQkJCX0NCgkJCQkJaSA9IDA7DQoJCQkJCXdoaWxlKChvID0gcFtpKytdKSAmJiAhZS5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKSBmID0gbywgZS50eXBlID0gMSA8IGkgPyBzIDogYy5iaW5kVHlwZSB8fCBkLCAobCA9IChZLmdldChvLCAiZXZlbnRzIikgfHwgT2JqZWN0LmNyZWF0ZShudWxsKSlbZS50eXBlXSAmJiBZLmdldChvLCAiaGFuZGxlIikpICYmIGwuYXBwbHkobywgdCksIChsID0gdSAmJiBvW3VdKSAmJiBsLmFwcGx5ICYmIFYobykgJiYgKGUucmVzdWx0ID0gbC5hcHBseShvLCB0KSwgITEgPT09IGUucmVzdWx0ICYmIGUucHJldmVudERlZmF1bHQoKSk7DQoJCQkJCXJldHVybiBlLnR5cGUgPSBkLCByIHx8IGUuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgYy5fZGVmYXVsdCAmJiAhMSAhPT0gYy5fZGVmYXVsdC5hcHBseShwLnBvcCgpLCB0KSB8fCAhVihuKSB8fCB1ICYmIG0obltkXSkgJiYgIXgobikgJiYgKChhID0gblt1XSkgJiYgKG5bdV0gPSBudWxsKSwgUy5ldmVudC50cmlnZ2VyZWQgPSBkLCBlLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgJiYgZi5hZGRFdmVudExpc3RlbmVyKGQsIHh0KSwgbltkXSgpLCBlLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgJiYgZi5yZW1vdmVFdmVudExpc3RlbmVyKGQsIHh0KSwgUy5ldmVudC50cmlnZ2VyZWQgPSB2b2lkIDAsIGEgJiYgKG5bdV0gPSBhKSksIGUucmVzdWx0DQoJCQkJfQ0KCQkJfSwgc2ltdWxhdGU6IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQl2YXIgciA9IFMuZXh0ZW5kKG5ldyBTLkV2ZW50LCBuLCB7dHlwZTogZSwgaXNTaW11bGF0ZWQ6ICEwfSk7DQoJCQkJUy5ldmVudC50cmlnZ2VyKHIsIG51bGwsIHQpDQoJCQl9DQoJCX0pLCBTLmZuLmV4dGVuZCh7DQoJCQl0cmlnZ2VyOiBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtTLmV2ZW50LnRyaWdnZXIoZSwgdCwgdGhpcyl9KX0sIHRyaWdnZXJIYW5kbGVyOiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4gPSB0aGlzWzBdOw0KCQkJCWlmKG4pIHJldHVybiBTLmV2ZW50LnRyaWdnZXIoZSwgdCwgbiwgITApDQoJCQl9DQoJCX0pLCB5LmZvY3VzaW4gfHwgUy5lYWNoKHtmb2N1czogImZvY3VzaW4iLCBibHVyOiAiZm9jdXNvdXQifSwgZnVuY3Rpb24obiwgcikgew0KCQkJdmFyIGkgPSBmdW5jdGlvbihlKSB7Uy5ldmVudC5zaW11bGF0ZShyLCBlLnRhcmdldCwgUy5ldmVudC5maXgoZSkpfTsNCgkJCVMuZXZlbnQuc3BlY2lhbFtyXSA9IHsNCgkJCQlzZXR1cDogZnVuY3Rpb24oKSB7DQoJCQkJCXZhciBlID0gdGhpcy5vd25lckRvY3VtZW50IHx8IHRoaXMuZG9jdW1lbnQgfHwgdGhpcywgdCA9IFkuYWNjZXNzKGUsIHIpOw0KCQkJCQl0IHx8IGUuYWRkRXZlbnRMaXN0ZW5lcihuLCBpLCAhMCksIFkuYWNjZXNzKGUsIHIsICh0IHx8IDApICsgMSkNCgkJCQl9LCB0ZWFyZG93bjogZnVuY3Rpb24oKSB7DQoJCQkJCXZhciBlID0gdGhpcy5vd25lckRvY3VtZW50IHx8IHRoaXMuZG9jdW1lbnQgfHwgdGhpcywgdCA9IFkuYWNjZXNzKGUsIHIpIC0gMTsNCgkJCQkJdCA/IFkuYWNjZXNzKGUsIHIsIHQpIDogKGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihuLCBpLCAhMCksIFkucmVtb3ZlKGUsIHIpKQ0KCQkJCX0NCgkJCX0NCgkJfSk7DQoJCXZhciBidCA9IEMubG9jYXRpb24sIHd0ID0ge2d1aWQ6IERhdGUubm93KCl9LCBUdCA9IC9cPy87DQoJCVMucGFyc2VYTUwgPSBmdW5jdGlvbihlKSB7DQoJCQl2YXIgdCwgbjsNCgkJCWlmKCFlIHx8ICJzdHJpbmciICE9IHR5cGVvZiBlKSByZXR1cm4gbnVsbDsNCgkJCXRyeSB7dCA9IChuZXcgQy5ET01QYXJzZXIpLnBhcnNlRnJvbVN0cmluZyhlLCAidGV4dC94bWwiKX0gY2F0Y2goZSkge30NCgkJCXJldHVybiBuID0gdCAmJiB0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJwYXJzZXJlcnJvciIpWzBdLCB0ICYmICFuIHx8IFMuZXJyb3IoIkludmFsaWQgWE1MOiAiICsgKG4gPyBTLm1hcChuLmNoaWxkTm9kZXMsIGZ1bmN0aW9uKGUpIHtyZXR1cm4gZS50ZXh0Q29udGVudH0pLmpvaW4oIlxuIikgOiBlKSksIHQNCgkJfTsNCgkJdmFyIEN0ID0gL1xbXF0kLywgRXQgPSAvXHI/XG4vZywgU3QgPSAvXig/OnN1Ym1pdHxidXR0b258aW1hZ2V8cmVzZXR8ZmlsZSkkL2ksIGt0ID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8a2V5Z2VuKS9pOw0KDQoJCWZ1bmN0aW9uIEF0KG4sIGUsIHIsIGkpIHsNCgkJCXZhciB0Ow0KCQkJaWYoQXJyYXkuaXNBcnJheShlKSkgUy5lYWNoKGUsIGZ1bmN0aW9uKGUsIHQpIHtyIHx8IEN0LnRlc3QobikgPyBpKG4sIHQpIDogQXQobiArICJbIiArICgib2JqZWN0IiA9PSB0eXBlb2YgdCAmJiBudWxsICE9IHQgPyBlIDogIiIpICsgIl0iLCB0LCByLCBpKX0pOyBlbHNlIGlmKHIgfHwgIm9iamVjdCIgIT09IHcoZSkpIGkobiwgZSk7IGVsc2UgZm9yKHQgaW4gZSkgQXQobiArICJbIiArIHQgKyAiXSIsIGVbdF0sIHIsIGkpDQoJCX0NCg0KCQlTLnBhcmFtID0gZnVuY3Rpb24oZSwgdCkgew0KCQkJdmFyIG4sIHIgPSBbXSwgaSA9IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQl2YXIgbiA9IG0odCkgPyB0KCkgOiB0Ow0KCQkJCXJbci5sZW5ndGhdID0gZW5jb2RlVVJJQ29tcG9uZW50KGUpICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KG51bGwgPT0gbiA/ICIiIDogbikNCgkJCX07DQoJCQlpZihudWxsID09IGUpIHJldHVybiAiIjsNCgkJCWlmKEFycmF5LmlzQXJyYXkoZSkgfHwgZS5qcXVlcnkgJiYgIVMuaXNQbGFpbk9iamVjdChlKSkgUy5lYWNoKGUsIGZ1bmN0aW9uKCkge2kodGhpcy5uYW1lLCB0aGlzLnZhbHVlKX0pOyBlbHNlIGZvcihuIGluIGUpIEF0KG4sIGVbbl0sIHQsIGkpOw0KCQkJcmV0dXJuIHIuam9pbigiJiIpDQoJCX0sIFMuZm4uZXh0ZW5kKHsNCgkJCXNlcmlhbGl6ZTogZnVuY3Rpb24oKSB7cmV0dXJuIFMucGFyYW0odGhpcy5zZXJpYWxpemVBcnJheSgpKX0sIHNlcmlhbGl6ZUFycmF5OiBmdW5jdGlvbigpIHsNCgkJCQlyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKSB7DQoJCQkJCXZhciBlID0gUy5wcm9wKHRoaXMsICJlbGVtZW50cyIpOw0KCQkJCQlyZXR1cm4gZSA/IFMubWFrZUFycmF5KGUpIDogdGhpcw0KCQkJCX0pLmZpbHRlcihmdW5jdGlvbigpIHsNCgkJCQkJdmFyIGUgPSB0aGlzLnR5cGU7DQoJCQkJCXJldHVybiB0aGlzLm5hbWUgJiYgIVModGhpcykuaXMoIjpkaXNhYmxlZCIpICYmIGt0LnRlc3QodGhpcy5ub2RlTmFtZSkgJiYgIVN0LnRlc3QoZSkgJiYgKHRoaXMuY2hlY2tlZCB8fCAhcGUudGVzdChlKSkNCgkJCQl9KS5tYXAoZnVuY3Rpb24oZSwgdCkgew0KCQkJCQl2YXIgbiA9IFModGhpcykudmFsKCk7DQoJCQkJCXJldHVybiBudWxsID09IG4gPyBudWxsIDogQXJyYXkuaXNBcnJheShuKSA/IFMubWFwKG4sIGZ1bmN0aW9uKGUpIHtyZXR1cm4ge25hbWU6IHQubmFtZSwgdmFsdWU6IGUucmVwbGFjZShFdCwgIlxyXG4iKX19KSA6IHtuYW1lOiB0Lm5hbWUsIHZhbHVlOiBuLnJlcGxhY2UoRXQsICJcclxuIil9DQoJCQkJfSkuZ2V0KCkNCgkJCX0NCgkJfSk7DQoJCXZhciBOdCA9IC8lMjAvZywganQgPSAvIy4qJC8sIER0ID0gLyhbPyZdKV89W14mXSovLCBxdCA9IC9eKC4qPyk6WyBcdF0qKFteXHJcbl0qKSQvZ20sIEx0ID0gL14oPzpHRVR8SEVBRCkkLywgSHQgPSAvXlwvXC8vLCBPdCA9IHt9LCBQdCA9IHt9LCBSdCA9ICIqLyIuY29uY2F0KCIqIiksIE10ID0gRS5jcmVhdGVFbGVtZW50KCJhIik7DQoNCgkJZnVuY3Rpb24gSXQobykgew0KCQkJcmV0dXJuIGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkic3RyaW5nIiAhPSB0eXBlb2YgZSAmJiAodCA9IGUsIGUgPSAiKiIpOw0KCQkJCXZhciBuLCByID0gMCwgaSA9IGUudG9Mb3dlckNhc2UoKS5tYXRjaChQKSB8fCBbXTsNCgkJCQlpZihtKHQpKSB3aGlsZShuID0gaVtyKytdKSAiKyIgPT09IG5bMF0gPyAobiA9IG4uc2xpY2UoMSkgfHwgIioiLCAob1tuXSA9IG9bbl0gfHwgW10pLnVuc2hpZnQodCkpIDogKG9bbl0gPSBvW25dIHx8IFtdKS5wdXNoKHQpDQoJCQl9DQoJCX0NCg0KCQlmdW5jdGlvbiBXdCh0LCBpLCBvLCBhKSB7DQoJCQl2YXIgcyA9IHt9LCB1ID0gdCA9PT0gUHQ7DQoNCgkJCWZ1bmN0aW9uIGwoZSkgew0KCQkJCXZhciByOw0KCQkJCXJldHVybiBzW2VdID0gITAsIFMuZWFjaCh0W2VdIHx8IFtdLCBmdW5jdGlvbihlLCB0KSB7DQoJCQkJCXZhciBuID0gdChpLCBvLCBhKTsNCgkJCQkJcmV0dXJuICJzdHJpbmciICE9IHR5cGVvZiBuIHx8IHUgfHwgc1tuXSA/IHUgPyAhKHIgPSBuKSA6IHZvaWQgMCA6IChpLmRhdGFUeXBlcy51bnNoaWZ0KG4pLCBsKG4pLCAhMSkNCgkJCQl9KSwgcg0KCQkJfQ0KDQoJCQlyZXR1cm4gbChpLmRhdGFUeXBlc1swXSkgfHwgIXNbIioiXSAmJiBsKCIqIikNCgkJfQ0KDQoJCWZ1bmN0aW9uIEZ0KGUsIHQpIHsNCgkJCXZhciBuLCByLCBpID0gUy5hamF4U2V0dGluZ3MuZmxhdE9wdGlvbnMgfHwge307DQoJCQlmb3IobiBpbiB0KSB2b2lkIDAgIT09IHRbbl0gJiYgKChpW25dID8gZSA6IHIgfHwgKHIgPSB7fSkpW25dID0gdFtuXSk7DQoJCQlyZXR1cm4gciAmJiBTLmV4dGVuZCghMCwgZSwgciksIGUNCgkJfQ0KDQoJCU10LmhyZWYgPSBidC5ocmVmLCBTLmV4dGVuZCh7DQoJCQlhY3RpdmU6IDAsDQoJCQlsYXN0TW9kaWZpZWQ6IHt9LA0KCQkJZXRhZzoge30sDQoJCQlhamF4U2V0dGluZ3M6IHsNCgkJCQl1cmw6IGJ0LmhyZWYsDQoJCQkJdHlwZTogIkdFVCIsDQoJCQkJaXNMb2NhbDogL14oPzphYm91dHxhcHB8YXBwLXN0b3JhZ2V8ListZXh0ZW5zaW9ufGZpbGV8cmVzfHdpZGdldCk6JC8udGVzdChidC5wcm90b2NvbCksDQoJCQkJZ2xvYmFsOiAhMCwNCgkJCQlwcm9jZXNzRGF0YTogITAsDQoJCQkJYXN5bmM6ICEwLA0KCQkJCWNvbnRlbnRUeXBlOiAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04IiwNCgkJCQlhY2NlcHRzOiB7IioiOiBSdCwgdGV4dDogInRleHQvcGxhaW4iLCBodG1sOiAidGV4dC9odG1sIiwgeG1sOiAiYXBwbGljYXRpb24veG1sLCB0ZXh0L3htbCIsIGpzb246ICJhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L2phdmFzY3JpcHQifSwNCgkJCQljb250ZW50czoge3htbDogL1xieG1sXGIvLCBodG1sOiAvXGJodG1sLywganNvbjogL1xianNvblxiL30sDQoJCQkJcmVzcG9uc2VGaWVsZHM6IHt4bWw6ICJyZXNwb25zZVhNTCIsIHRleHQ6ICJyZXNwb25zZVRleHQiLCBqc29uOiAicmVzcG9uc2VKU09OIn0sDQoJCQkJY29udmVydGVyczogeyIqIHRleHQiOiBTdHJpbmcsICJ0ZXh0IGh0bWwiOiAhMCwgInRleHQganNvbiI6IEpTT04ucGFyc2UsICJ0ZXh0IHhtbCI6IFMucGFyc2VYTUx9LA0KCQkJCWZsYXRPcHRpb25zOiB7dXJsOiAhMCwgY29udGV4dDogITB9DQoJCQl9LA0KCQkJYWpheFNldHVwOiBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIHQgPyBGdChGdChlLCBTLmFqYXhTZXR0aW5ncyksIHQpIDogRnQoUy5hamF4U2V0dGluZ3MsIGUpfSwNCgkJCWFqYXhQcmVmaWx0ZXI6IEl0KE90KSwNCgkJCWFqYXhUcmFuc3BvcnQ6IEl0KFB0KSwNCgkJCWFqYXg6IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkib2JqZWN0IiA9PSB0eXBlb2YgZSAmJiAodCA9IGUsIGUgPSB2b2lkIDApLCB0ID0gdCB8fCB7fTsNCgkJCQl2YXIgYywNCgkJCQkgICAgZiwNCgkJCQkgICAgcCwNCgkJCQkgICAgbiwNCgkJCQkgICAgZCwNCgkJCQkgICAgciwNCgkJCQkgICAgaCwNCgkJCQkgICAgZywNCgkJCQkgICAgaSwNCgkJCQkgICAgbywNCgkJCQkgICAgdiA9IFMuYWpheFNldHVwKHt9LCB0KSwNCgkJCQkgICAgeSA9IHYuY29udGV4dCB8fCB2LA0KCQkJCSAgICBtID0gdi5jb250ZXh0ICYmICh5Lm5vZGVUeXBlIHx8IHkuanF1ZXJ5KSA/IFMoeSkgOiBTLmV2ZW50LA0KCQkJCSAgICB4ID0gUy5EZWZlcnJlZCgpLA0KCQkJCSAgICBiID0gUy5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksDQoJCQkJICAgIHcgPSB2LnN0YXR1c0NvZGUgfHwge30sDQoJCQkJICAgIGEgPSB7fSwNCgkJCQkgICAgcyA9IHt9LA0KCQkJCSAgICB1ID0gImNhbmNlbGVkIiwNCgkJCQkgICAgVCA9IHsNCgkJCQkJICAgIHJlYWR5U3RhdGU6IDAsDQoJCQkJCSAgICBnZXRSZXNwb25zZUhlYWRlcjogZnVuY3Rpb24oZSkgew0KCQkJCQkJICAgIHZhciB0Ow0KCQkJCQkJICAgIGlmKGgpIHsNCgkJCQkJCQkgICAgaWYoIW4pIHsNCgkJCQkJCQkJICAgIG4gPSB7fTsNCgkJCQkJCQkJICAgIHdoaWxlKHQgPSBxdC5leGVjKHApKSBuW3RbMV0udG9Mb3dlckNhc2UoKSArICIgIl0gPSAoblt0WzFdLnRvTG93ZXJDYXNlKCkgKyAiICJdIHx8IFtdKS5jb25jYXQodFsyXSkNCgkJCQkJCQkgICAgfQ0KCQkJCQkJCSAgICB0ID0gbltlLnRvTG93ZXJDYXNlKCkgKyAiICJdDQoJCQkJCQkgICAgfQ0KCQkJCQkJICAgIHJldHVybiBudWxsID09IHQgPyBudWxsIDogdC5qb2luKCIsICIpDQoJCQkJCSAgICB9LA0KCQkJCQkgICAgZ2V0QWxsUmVzcG9uc2VIZWFkZXJzOiBmdW5jdGlvbigpIHtyZXR1cm4gaCA/IHAgOiBudWxsfSwNCgkJCQkJICAgIHNldFJlcXVlc3RIZWFkZXI6IGZ1bmN0aW9uKGUsIHQpIHtyZXR1cm4gbnVsbCA9PSBoICYmIChlID0gc1tlLnRvTG93ZXJDYXNlKCldID0gc1tlLnRvTG93ZXJDYXNlKCldIHx8IGUsIGFbZV0gPSB0KSwgdGhpc30sDQoJCQkJCSAgICBvdmVycmlkZU1pbWVUeXBlOiBmdW5jdGlvbihlKSB7cmV0dXJuIG51bGwgPT0gaCAmJiAodi5taW1lVHlwZSA9IGUpLCB0aGlzfSwNCgkJCQkJICAgIHN0YXR1c0NvZGU6IGZ1bmN0aW9uKGUpIHsNCgkJCQkJCSAgICB2YXIgdDsNCgkJCQkJCSAgICBpZihlKSBpZihoKSBULmFsd2F5cyhlW1Quc3RhdHVzXSk7IGVsc2UgZm9yKHQgaW4gZSkgd1t0XSA9IFt3W3RdLCBlW3RdXTsNCgkJCQkJCSAgICByZXR1cm4gdGhpcw0KCQkJCQkgICAgfSwNCgkJCQkJICAgIGFib3J0OiBmdW5jdGlvbihlKSB7DQoJCQkJCQkgICAgdmFyIHQgPSBlIHx8IHU7DQoJCQkJCQkgICAgcmV0dXJuIGMgJiYgYy5hYm9ydCh0KSwgbCgwLCB0KSwgdGhpcw0KCQkJCQkgICAgfQ0KCQkJCSAgICB9Ow0KCQkJCWlmKHgucHJvbWlzZShUKSwgdi51cmwgPSAoKGUgfHwgdi51cmwgfHwgYnQuaHJlZikgKyAiIikucmVwbGFjZShIdCwgYnQucHJvdG9jb2wgKyAiLy8iKSwgdi50eXBlID0gdC5tZXRob2QgfHwgdC50eXBlIHx8IHYubWV0aG9kIHx8IHYudHlwZSwgdi5kYXRhVHlwZXMgPSAodi5kYXRhVHlwZSB8fCAiKiIpLnRvTG93ZXJDYXNlKCkubWF0Y2goUCkgfHwgWyIiXSwgbnVsbCA9PSB2LmNyb3NzRG9tYWluKSB7DQoJCQkJCXIgPSBFLmNyZWF0ZUVsZW1lbnQoImEiKTsNCgkJCQkJdHJ5IHtyLmhyZWYgPSB2LnVybCwgci5ocmVmID0gci5ocmVmLCB2LmNyb3NzRG9tYWluID0gTXQucHJvdG9jb2wgKyAiLy8iICsgTXQuaG9zdCAhPSByLnByb3RvY29sICsgIi8vIiArIHIuaG9zdH0gY2F0Y2goZSkge3YuY3Jvc3NEb21haW4gPSAhMH0NCgkJCQl9DQoJCQkJaWYodi5kYXRhICYmIHYucHJvY2Vzc0RhdGEgJiYgInN0cmluZyIgIT0gdHlwZW9mIHYuZGF0YSAmJiAodi5kYXRhID0gUy5wYXJhbSh2LmRhdGEsIHYudHJhZGl0aW9uYWwpKSwgV3QoT3QsIHYsIHQsIFQpLCBoKSByZXR1cm4gVDsNCgkJCQlmb3IoaSBpbiAoZyA9IFMuZXZlbnQgJiYgdi5nbG9iYWwpICYmIDAgPT0gUy5hY3RpdmUrKyAmJiBTLmV2ZW50LnRyaWdnZXIoImFqYXhTdGFydCIpLCB2LnR5cGUgPSB2LnR5cGUudG9VcHBlckNhc2UoKSwgdi5oYXNDb250ZW50ID0gIUx0LnRlc3Qodi50eXBlKSwgZiA9IHYudXJsLnJlcGxhY2UoanQsICIiKSwgdi5oYXNDb250ZW50ID8gdi5kYXRhICYmIHYucHJvY2Vzc0RhdGEgJiYgMCA9PT0gKHYuY29udGVudFR5cGUgfHwgIiIpLmluZGV4T2YoImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIpICYmICh2LmRhdGEgPSB2LmRhdGEucmVwbGFjZShOdCwgIisiKSkgOiAobyA9IHYudXJsLnNsaWNlKGYubGVuZ3RoKSwgdi5kYXRhICYmICh2LnByb2Nlc3NEYXRhIHx8ICJzdHJpbmciID09IHR5cGVvZiB2LmRhdGEpICYmIChmICs9IChUdC50ZXN0KGYpID8gIiYiIDogIj8iKSArIHYuZGF0YSwgZGVsZXRlIHYuZGF0YSksICExID09PSB2LmNhY2hlICYmIChmID0gZi5yZXBsYWNlKER0LCAiJDEiKSwgbyA9IChUdC50ZXN0KGYpID8gIiYiIDogIj8iKSArICJfPSIgKyB3dC5ndWlkKysgKyBvKSwgdi51cmwgPSBmICsgbyksIHYuaWZNb2RpZmllZCAmJiAoUy5sYXN0TW9kaWZpZWRbZl0gJiYgVC5zZXRSZXF1ZXN0SGVhZGVyKCJJZi1Nb2RpZmllZC1TaW5jZSIsIFMubGFzdE1vZGlmaWVkW2ZdKSwgUy5ldGFnW2ZdICYmIFQuc2V0UmVxdWVzdEhlYWRlcigiSWYtTm9uZS1NYXRjaCIsIFMuZXRhZ1tmXSkpLCAodi5kYXRhICYmIHYuaGFzQ29udGVudCAmJiAhMSAhPT0gdi5jb250ZW50VHlwZSB8fCB0LmNvbnRlbnRUeXBlKSAmJiBULnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtVHlwZSIsIHYuY29udGVudFR5cGUpLCBULnNldFJlcXVlc3RIZWFkZXIoIkFjY2VwdCIsIHYuZGF0YVR5cGVzWzBdICYmIHYuYWNjZXB0c1t2LmRhdGFUeXBlc1swXV0gPyB2LmFjY2VwdHNbdi5kYXRhVHlwZXNbMF1dICsgKCIqIiAhPT0gdi5kYXRhVHlwZXNbMF0gPyAiLCAiICsgUnQgKyAiOyBxPTAuMDEiIDogIiIpIDogdi5hY2NlcHRzWyIqIl0pLCB2LmhlYWRlcnMpIFQuc2V0UmVxdWVzdEhlYWRlcihpLCB2LmhlYWRlcnNbaV0pOw0KCQkJCWlmKHYuYmVmb3JlU2VuZCAmJiAoITEgPT09IHYuYmVmb3JlU2VuZC5jYWxsKHksIFQsIHYpIHx8IGgpKSByZXR1cm4gVC5hYm9ydCgpOw0KCQkJCWlmKHUgPSAiYWJvcnQiLCBiLmFkZCh2LmNvbXBsZXRlKSwgVC5kb25lKHYuc3VjY2VzcyksIFQuZmFpbCh2LmVycm9yKSwgYyA9IFd0KFB0LCB2LCB0LCBUKSkgew0KCQkJCQlpZihULnJlYWR5U3RhdGUgPSAxLCBnICYmIG0udHJpZ2dlcigiYWpheFNlbmQiLCBbVCwgdl0pLCBoKSByZXR1cm4gVDsNCgkJCQkJdi5hc3luYyAmJiAwIDwgdi50aW1lb3V0ICYmIChkID0gQy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1QuYWJvcnQoInRpbWVvdXQiKX0sIHYudGltZW91dCkpOw0KCQkJCQl0cnkge2ggPSAhMSwgYy5zZW5kKGEsIGwpfSBjYXRjaChlKSB7DQoJCQkJCQlpZihoKSB0aHJvdyBlOw0KCQkJCQkJbCgtMSwgZSkNCgkJCQkJfQ0KCQkJCX0gZWxzZSBsKC0xLCAiTm8gVHJhbnNwb3J0Iik7DQoNCgkJCQlmdW5jdGlvbiBsKGUsIHQsIG4sIHIpIHsNCgkJCQkJdmFyIGksIG8sIGEsIHMsIHUsIGwgPSB0Ow0KCQkJCQloIHx8IChoID0gITAsIGQgJiYgQy5jbGVhclRpbWVvdXQoZCksIGMgPSB2b2lkIDAsIHAgPSByIHx8ICIiLCBULnJlYWR5U3RhdGUgPSAwIDwgZSA/IDQgOiAwLCBpID0gMjAwIDw9IGUgJiYgZSA8IDMwMCB8fCAzMDQgPT09IGUsIG4gJiYgKHMgPSBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJCQl2YXIgciwgaSwgbywgYSwgcyA9IGUuY29udGVudHMsIHUgPSBlLmRhdGFUeXBlczsNCgkJCQkJCXdoaWxlKCIqIiA9PT0gdVswXSkgdS5zaGlmdCgpLCB2b2lkIDAgPT09IHIgJiYgKHIgPSBlLm1pbWVUeXBlIHx8IHQuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtVHlwZSIpKTsNCgkJCQkJCWlmKHIpIGZvcihpIGluIHMpIGlmKHNbaV0gJiYgc1tpXS50ZXN0KHIpKSB7DQoJCQkJCQkJdS51bnNoaWZ0KGkpOw0KCQkJCQkJCWJyZWFrDQoJCQkJCQl9DQoJCQkJCQlpZih1WzBdIGluIG4pIG8gPSB1WzBdOyBlbHNlIHsNCgkJCQkJCQlmb3IoaSBpbiBuKSB7DQoJCQkJCQkJCWlmKCF1WzBdIHx8IGUuY29udmVydGVyc1tpICsgIiAiICsgdVswXV0pIHsNCgkJCQkJCQkJCW8gPSBpOw0KCQkJCQkJCQkJYnJlYWsNCgkJCQkJCQkJfQ0KCQkJCQkJCQlhIHx8IChhID0gaSkNCgkJCQkJCQl9DQoJCQkJCQkJbyA9IG8gfHwgYQ0KCQkJCQkJfQ0KCQkJCQkJaWYobykgcmV0dXJuIG8gIT09IHVbMF0gJiYgdS51bnNoaWZ0KG8pLCBuW29dDQoJCQkJCX0odiwgVCwgbikpLCAhaSAmJiAtMSA8IFMuaW5BcnJheSgic2NyaXB0Iiwgdi5kYXRhVHlwZXMpICYmIFMuaW5BcnJheSgianNvbiIsIHYuZGF0YVR5cGVzKSA8IDAgJiYgKHYuY29udmVydGVyc1sidGV4dCBzY3JpcHQiXSA9IGZ1bmN0aW9uKCkge30pLCBzID0gZnVuY3Rpb24oZSwgdCwgbiwgcikgew0KCQkJCQkJdmFyIGksIG8sIGEsIHMsIHUsIGwgPSB7fSwgYyA9IGUuZGF0YVR5cGVzLnNsaWNlKCk7DQoJCQkJCQlpZihjWzFdKSBmb3IoYSBpbiBlLmNvbnZlcnRlcnMpIGxbYS50b0xvd2VyQ2FzZSgpXSA9IGUuY29udmVydGVyc1thXTsNCgkJCQkJCW8gPSBjLnNoaWZ0KCk7DQoJCQkJCQl3aGlsZShvKSBpZihlLnJlc3BvbnNlRmllbGRzW29dICYmIChuW2UucmVzcG9uc2VGaWVsZHNbb11dID0gdCksICF1ICYmIHIgJiYgZS5kYXRhRmlsdGVyICYmICh0ID0gZS5kYXRhRmlsdGVyKHQsIGUuZGF0YVR5cGUpKSwgdSA9IG8sIG8gPSBjLnNoaWZ0KCkpIGlmKCIqIiA9PT0gbykgbyA9IHU7IGVsc2UgaWYoIioiICE9PSB1ICYmIHUgIT09IG8pIHsNCgkJCQkJCQlpZighKGEgPSBsW3UgKyAiICIgKyBvXSB8fCBsWyIqICIgKyBvXSkpIGZvcihpIGluIGwpIGlmKChzID0gaS5zcGxpdCgiICIpKVsxXSA9PT0gbyAmJiAoYSA9IGxbdSArICIgIiArIHNbMF1dIHx8IGxbIiogIiArIHNbMF1dKSkgew0KCQkJCQkJCQkhMCA9PT0gYSA/IGEgPSBsW2ldIDogITAgIT09IGxbaV0gJiYgKG8gPSBzWzBdLCBjLnVuc2hpZnQoc1sxXSkpOw0KCQkJCQkJCQlicmVhaw0KCQkJCQkJCX0NCgkJCQkJCQlpZighMCAhPT0gYSkgaWYoYSAmJiBlWyJ0aHJvd3MiXSkgdCA9IGEodCk7IGVsc2UgdHJ5IHt0ID0gYSh0KX0gY2F0Y2goZSkge3JldHVybiB7c3RhdGU6ICJwYXJzZXJlcnJvciIsIGVycm9yOiBhID8gZSA6ICJObyBjb252ZXJzaW9uIGZyb20gIiArIHUgKyAiIHRvICIgKyBvfX0NCgkJCQkJCX0NCgkJCQkJCXJldHVybiB7c3RhdGU6ICJzdWNjZXNzIiwgZGF0YTogdH0NCgkJCQkJfSh2LCBzLCBULCBpKSwgaSA/ICh2LmlmTW9kaWZpZWQgJiYgKCh1ID0gVC5nZXRSZXNwb25zZUhlYWRlcigiTGFzdC1Nb2RpZmllZCIpKSAmJiAoUy5sYXN0TW9kaWZpZWRbZl0gPSB1KSwgKHUgPSBULmdldFJlc3BvbnNlSGVhZGVyKCJldGFnIikpICYmIChTLmV0YWdbZl0gPSB1KSksIDIwNCA9PT0gZSB8fCAiSEVBRCIgPT09IHYudHlwZSA/IGwgPSAibm9jb250ZW50IiA6IDMwNCA9PT0gZSA/IGwgPSAibm90bW9kaWZpZWQiIDogKGwgPSBzLnN0YXRlLCBvID0gcy5kYXRhLCBpID0gIShhID0gcy5lcnJvcikpKSA6IChhID0gbCwgIWUgJiYgbCB8fCAobCA9ICJlcnJvciIsIGUgPCAwICYmIChlID0gMCkpKSwgVC5zdGF0dXMgPSBlLCBULnN0YXR1c1RleHQgPSAodCB8fCBsKSArICIiLCBpID8geC5yZXNvbHZlV2l0aCh5LCBbbywgbCwgVF0pIDogeC5yZWplY3RXaXRoKHksIFtULCBsLCBhXSksIFQuc3RhdHVzQ29kZSh3KSwgdyA9IHZvaWQgMCwgZyAmJiBtLnRyaWdnZXIoaSA/ICJhamF4U3VjY2VzcyIgOiAiYWpheEVycm9yIiwgW1QsIHYsIGkgPyBvIDogYV0pLCBiLmZpcmVXaXRoKHksIFtULCBsXSksIGcgJiYgKG0udHJpZ2dlcigiYWpheENvbXBsZXRlIiwgW1QsIHZdKSwgLS1TLmFjdGl2ZSB8fCBTLmV2ZW50LnRyaWdnZXIoImFqYXhTdG9wIikpKQ0KCQkJCX0NCg0KCQkJCXJldHVybiBUDQoJCQl9LA0KCQkJZ2V0SlNPTjogZnVuY3Rpb24oZSwgdCwgbikge3JldHVybiBTLmdldChlLCB0LCBuLCAianNvbiIpfSwNCgkJCWdldFNjcmlwdDogZnVuY3Rpb24oZSwgdCkge3JldHVybiBTLmdldChlLCB2b2lkIDAsIHQsICJzY3JpcHQiKX0NCgkJfSksIFMuZWFjaChbImdldCIsICJwb3N0Il0sIGZ1bmN0aW9uKGUsIGkpIHtTW2ldID0gZnVuY3Rpb24oZSwgdCwgbiwgcikge3JldHVybiBtKHQpICYmIChyID0gciB8fCBuLCBuID0gdCwgdCA9IHZvaWQgMCksIFMuYWpheChTLmV4dGVuZCh7dXJsOiBlLCB0eXBlOiBpLCBkYXRhVHlwZTogciwgZGF0YTogdCwgc3VjY2Vzczogbn0sIFMuaXNQbGFpbk9iamVjdChlKSAmJiBlKSl9fSksIFMuYWpheFByZWZpbHRlcihmdW5jdGlvbihlKSB7DQoJCQl2YXIgdDsNCgkJCWZvcih0IGluIGUuaGVhZGVycykgImNvbnRlbnQtdHlwZSIgPT09IHQudG9Mb3dlckNhc2UoKSAmJiAoZS5jb250ZW50VHlwZSA9IGUuaGVhZGVyc1t0XSB8fCAiIikNCgkJfSksIFMuX2V2YWxVcmwgPSBmdW5jdGlvbihlLCB0LCBuKSB7cmV0dXJuIFMuYWpheCh7dXJsOiBlLCB0eXBlOiAiR0VUIiwgZGF0YVR5cGU6ICJzY3JpcHQiLCBjYWNoZTogITAsIGFzeW5jOiAhMSwgZ2xvYmFsOiAhMSwgY29udmVydGVyczogeyJ0ZXh0IHNjcmlwdCI6IGZ1bmN0aW9uKCkge319LCBkYXRhRmlsdGVyOiBmdW5jdGlvbihlKSB7Uy5nbG9iYWxFdmFsKGUsIHQsIG4pfX0pfSwgUy5mbi5leHRlbmQoew0KCQkJd3JhcEFsbDogZnVuY3Rpb24oZSkgew0KCQkJCXZhciB0Ow0KCQkJCXJldHVybiB0aGlzWzBdICYmIChtKGUpICYmIChlID0gZS5jYWxsKHRoaXNbMF0pKSwgdCA9IFMoZSwgdGhpc1swXS5vd25lckRvY3VtZW50KS5lcSgwKS5jbG9uZSghMCksIHRoaXNbMF0ucGFyZW50Tm9kZSAmJiB0Lmluc2VydEJlZm9yZSh0aGlzWzBdKSwgdC5tYXAoZnVuY3Rpb24oKSB7DQoJCQkJCXZhciBlID0gdGhpczsNCgkJCQkJd2hpbGUoZS5maXJzdEVsZW1lbnRDaGlsZCkgZSA9IGUuZmlyc3RFbGVtZW50Q2hpbGQ7DQoJCQkJCXJldHVybiBlDQoJCQkJfSkuYXBwZW5kKHRoaXMpKSwgdGhpcw0KCQkJfSwgd3JhcElubmVyOiBmdW5jdGlvbihuKSB7DQoJCQkJcmV0dXJuIG0obikgPyB0aGlzLmVhY2goZnVuY3Rpb24oZSkge1ModGhpcykud3JhcElubmVyKG4uY2FsbCh0aGlzLCBlKSl9KSA6IHRoaXMuZWFjaChmdW5jdGlvbigpIHsNCgkJCQkJdmFyIGUgPSBTKHRoaXMpLCB0ID0gZS5jb250ZW50cygpOw0KCQkJCQl0Lmxlbmd0aCA/IHQud3JhcEFsbChuKSA6IGUuYXBwZW5kKG4pDQoJCQkJfSkNCgkJCX0sIHdyYXA6IGZ1bmN0aW9uKHQpIHsNCgkJCQl2YXIgbiA9IG0odCk7DQoJCQkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihlKSB7Uyh0aGlzKS53cmFwQWxsKG4gPyB0LmNhbGwodGhpcywgZSkgOiB0KX0pDQoJCQl9LCB1bndyYXA6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gdGhpcy5wYXJlbnQoZSkubm90KCJib2R5IikuZWFjaChmdW5jdGlvbigpIHtTKHRoaXMpLnJlcGxhY2VXaXRoKHRoaXMuY2hpbGROb2Rlcyl9KSwgdGhpc30NCgkJfSksIFMuZXhwci5wc2V1ZG9zLmhpZGRlbiA9IGZ1bmN0aW9uKGUpIHtyZXR1cm4gIVMuZXhwci5wc2V1ZG9zLnZpc2libGUoZSl9LCBTLmV4cHIucHNldWRvcy52aXNpYmxlID0gZnVuY3Rpb24oZSkge3JldHVybiAhIShlLm9mZnNldFdpZHRoIHx8IGUub2Zmc2V0SGVpZ2h0IHx8IGUuZ2V0Q2xpZW50UmVjdHMoKS5sZW5ndGgpfSwgUy5hamF4U2V0dGluZ3MueGhyID0gZnVuY3Rpb24oKSB7dHJ5IHtyZXR1cm4gbmV3IEMuWE1MSHR0cFJlcXVlc3R9IGNhdGNoKGUpIHt9fTsNCgkJdmFyIEJ0ID0gezA6IDIwMCwgMTIyMzogMjA0fSwgJHQgPSBTLmFqYXhTZXR0aW5ncy54aHIoKTsNCgkJeS5jb3JzID0gISEkdCAmJiAid2l0aENyZWRlbnRpYWxzIiBpbiAkdCwgeS5hamF4ID0gJHQgPSAhISR0LCBTLmFqYXhUcmFuc3BvcnQoZnVuY3Rpb24oaSkgew0KCQkJdmFyIG8sIGE7DQoJCQlpZih5LmNvcnMgfHwgJHQgJiYgIWkuY3Jvc3NEb21haW4pIHJldHVybiB7DQoJCQkJc2VuZDogZnVuY3Rpb24oZSwgdCkgew0KCQkJCQl2YXIgbiwgciA9IGkueGhyKCk7DQoJCQkJCWlmKHIub3BlbihpLnR5cGUsIGkudXJsLCBpLmFzeW5jLCBpLnVzZXJuYW1lLCBpLnBhc3N3b3JkKSwgaS54aHJGaWVsZHMpIGZvcihuIGluIGkueGhyRmllbGRzKSByW25dID0gaS54aHJGaWVsZHNbbl07DQoJCQkJCWZvcihuIGluIGkubWltZVR5cGUgJiYgci5vdmVycmlkZU1pbWVUeXBlICYmIHIub3ZlcnJpZGVNaW1lVHlwZShpLm1pbWVUeXBlKSwgaS5jcm9zc0RvbWFpbiB8fCBlWyJYLVJlcXVlc3RlZC1XaXRoIl0gfHwgKGVbIlgtUmVxdWVzdGVkLVdpdGgiXSA9ICJYTUxIdHRwUmVxdWVzdCIpLCBlKSByLnNldFJlcXVlc3RIZWFkZXIobiwgZVtuXSk7DQoJCQkJCW8gPSBmdW5jdGlvbihlKSB7cmV0dXJuIGZ1bmN0aW9uKCkge28gJiYgKG8gPSBhID0gci5vbmxvYWQgPSByLm9uZXJyb3IgPSByLm9uYWJvcnQgPSByLm9udGltZW91dCA9IHIub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbCwgImFib3J0IiA9PT0gZSA/IHIuYWJvcnQoKSA6ICJlcnJvciIgPT09IGUgPyAibnVtYmVyIiAhPSB0eXBlb2Ygci5zdGF0dXMgPyB0KDAsICJlcnJvciIpIDogdChyLnN0YXR1cywgci5zdGF0dXNUZXh0KSA6IHQoQnRbci5zdGF0dXNdIHx8IHIuc3RhdHVzLCByLnN0YXR1c1RleHQsICJ0ZXh0IiAhPT0gKHIucmVzcG9uc2VUeXBlIHx8ICJ0ZXh0IikgfHwgInN0cmluZyIgIT0gdHlwZW9mIHIucmVzcG9uc2VUZXh0ID8ge2JpbmFyeTogci5yZXNwb25zZX0gOiB7dGV4dDogci5yZXNwb25zZVRleHR9LCByLmdldEFsbFJlc3BvbnNlSGVhZGVycygpKSl9fSwgci5vbmxvYWQgPSBvKCksIGEgPSByLm9uZXJyb3IgPSByLm9udGltZW91dCA9IG8oImVycm9yIiksIHZvaWQgMCAhPT0gci5vbmFib3J0ID8gci5vbmFib3J0ID0gYSA6IHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7NCA9PT0gci5yZWFkeVN0YXRlICYmIEMuc2V0VGltZW91dChmdW5jdGlvbigpIHtvICYmIGEoKX0pfSwgbyA9IG8oImFib3J0Iik7DQoJCQkJCXRyeSB7ci5zZW5kKGkuaGFzQ29udGVudCAmJiBpLmRhdGEgfHwgbnVsbCl9IGNhdGNoKGUpIHtpZihvKSB0aHJvdyBlfQ0KCQkJCX0sIGFib3J0OiBmdW5jdGlvbigpIHtvICYmIG8oKX0NCgkJCX0NCgkJfSksIFMuYWpheFByZWZpbHRlcihmdW5jdGlvbihlKSB7ZS5jcm9zc0RvbWFpbiAmJiAoZS5jb250ZW50cy5zY3JpcHQgPSAhMSl9KSwgUy5hamF4U2V0dXAoew0KCQkJYWNjZXB0czoge3NjcmlwdDogInRleHQvamF2YXNjcmlwdCwgYXBwbGljYXRpb24vamF2YXNjcmlwdCwgYXBwbGljYXRpb24vZWNtYXNjcmlwdCwgYXBwbGljYXRpb24veC1lY21hc2NyaXB0In0sDQoJCQljb250ZW50czoge3NjcmlwdDogL1xiKD86amF2YXxlY21hKXNjcmlwdFxiL30sDQoJCQljb252ZXJ0ZXJzOiB7InRleHQgc2NyaXB0IjogZnVuY3Rpb24oZSkge3JldHVybiBTLmdsb2JhbEV2YWwoZSksIGV9fQ0KCQl9KSwgUy5hamF4UHJlZmlsdGVyKCJzY3JpcHQiLCBmdW5jdGlvbihlKSB7dm9pZCAwID09PSBlLmNhY2hlICYmIChlLmNhY2hlID0gITEpLCBlLmNyb3NzRG9tYWluICYmIChlLnR5cGUgPSAiR0VUIil9KSwgUy5hamF4VHJhbnNwb3J0KCJzY3JpcHQiLCBmdW5jdGlvbihuKSB7DQoJCQl2YXIgciwgaTsNCgkJCWlmKG4uY3Jvc3NEb21haW4gfHwgbi5zY3JpcHRBdHRycykgcmV0dXJuIHsNCgkJCQlzZW5kOiBmdW5jdGlvbihlLCB0KSB7ciA9IFMoIjxzY3JpcHQ+IikuYXR0cihuLnNjcmlwdEF0dHJzIHx8IHt9KS5wcm9wKHtjaGFyc2V0OiBuLnNjcmlwdENoYXJzZXQsIHNyYzogbi51cmx9KS5vbigibG9hZCBlcnJvciIsIGkgPSBmdW5jdGlvbihlKSB7ci5yZW1vdmUoKSwgaSA9IG51bGwsIGUgJiYgdCgiZXJyb3IiID09PSBlLnR5cGUgPyA0MDQgOiAyMDAsIGUudHlwZSl9KSwgRS5oZWFkLmFwcGVuZENoaWxkKHJbMF0pfSwNCgkJCQlhYm9ydDogZnVuY3Rpb24oKSB7aSAmJiBpKCl9DQoJCQl9DQoJCX0pOw0KCQl2YXIgX3QsIHp0ID0gW10sIFV0ID0gLyg9KVw/KD89JnwkKXxcP1w/LzsNCgkJUy5hamF4U2V0dXAoew0KCQkJanNvbnA6ICJjYWxsYmFjayIsIGpzb25wQ2FsbGJhY2s6IGZ1bmN0aW9uKCkgew0KCQkJCXZhciBlID0genQucG9wKCkgfHwgUy5leHBhbmRvICsgIl8iICsgd3QuZ3VpZCsrOw0KCQkJCXJldHVybiB0aGlzW2VdID0gITAsIGUNCgkJCX0NCgkJfSksIFMuYWpheFByZWZpbHRlcigianNvbiBqc29ucCIsIGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCXZhciByLCBpLCBvLCBhID0gITEgIT09IGUuanNvbnAgJiYgKFV0LnRlc3QoZS51cmwpID8gInVybCIgOiAic3RyaW5nIiA9PSB0eXBlb2YgZS5kYXRhICYmIDAgPT09IChlLmNvbnRlbnRUeXBlIHx8ICIiKS5pbmRleE9mKCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKSAmJiBVdC50ZXN0KGUuZGF0YSkgJiYgImRhdGEiKTsNCgkJCWlmKGEgfHwgImpzb25wIiA9PT0gZS5kYXRhVHlwZXNbMF0pIHJldHVybiByID0gZS5qc29ucENhbGxiYWNrID0gbShlLmpzb25wQ2FsbGJhY2spID8gZS5qc29ucENhbGxiYWNrKCkgOiBlLmpzb25wQ2FsbGJhY2ssIGEgPyBlW2FdID0gZVthXS5yZXBsYWNlKFV0LCAiJDEiICsgcikgOiAhMSAhPT0gZS5qc29ucCAmJiAoZS51cmwgKz0gKFR0LnRlc3QoZS51cmwpID8gIiYiIDogIj8iKSArIGUuanNvbnAgKyAiPSIgKyByKSwgZS5jb252ZXJ0ZXJzWyJzY3JpcHQganNvbiJdID0gZnVuY3Rpb24oKSB7cmV0dXJuIG8gfHwgUy5lcnJvcihyICsgIiB3YXMgbm90IGNhbGxlZCIpLCBvWzBdfSwgZS5kYXRhVHlwZXNbMF0gPSAianNvbiIsIGkgPSBDW3JdLCBDW3JdID0gZnVuY3Rpb24oKSB7byA9IGFyZ3VtZW50c30sIG4uYWx3YXlzKGZ1bmN0aW9uKCkge3ZvaWQgMCA9PT0gaSA/IFMoQykucmVtb3ZlUHJvcChyKSA6IENbcl0gPSBpLCBlW3JdICYmIChlLmpzb25wQ2FsbGJhY2sgPSB0Lmpzb25wQ2FsbGJhY2ssIHp0LnB1c2gocikpLCBvICYmIG0oaSkgJiYgaShvWzBdKSwgbyA9IGkgPSB2b2lkIDB9KSwgInNjcmlwdCINCgkJfSksIHkuY3JlYXRlSFRNTERvY3VtZW50ID0gKChfdCA9IEUuaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50KCIiKS5ib2R5KS5pbm5lckhUTUwgPSAiPGZvcm0+PC9mb3JtPjxmb3JtPjwvZm9ybT4iLCAyID09PSBfdC5jaGlsZE5vZGVzLmxlbmd0aCksIFMucGFyc2VIVE1MID0gZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJcmV0dXJuICJzdHJpbmciICE9IHR5cGVvZiBlID8gW10gOiAoImJvb2xlYW4iID09IHR5cGVvZiB0ICYmIChuID0gdCwgdCA9ICExKSwgdCB8fCAoeS5jcmVhdGVIVE1MRG9jdW1lbnQgPyAoKHIgPSAodCA9IEUuaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50KCIiKSkuY3JlYXRlRWxlbWVudCgiYmFzZSIpKS5ocmVmID0gRS5sb2NhdGlvbi5ocmVmLCB0LmhlYWQuYXBwZW5kQ2hpbGQocikpIDogdCA9IEUpLCBvID0gIW4gJiYgW10sIChpID0gTi5leGVjKGUpKSA/IFt0LmNyZWF0ZUVsZW1lbnQoaVsxXSldIDogKGkgPSB4ZShbZV0sIHQsIG8pLCBvICYmIG8ubGVuZ3RoICYmIFMobykucmVtb3ZlKCksIFMubWVyZ2UoW10sIGkuY2hpbGROb2RlcykpKTsNCgkJCXZhciByLCBpLCBvDQoJCX0sIFMuZm4ubG9hZCA9IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCXZhciByLCBpLCBvLCBhID0gdGhpcywgcyA9IGUuaW5kZXhPZigiICIpOw0KCQkJcmV0dXJuIC0xIDwgcyAmJiAociA9IGh0KGUuc2xpY2UocykpLCBlID0gZS5zbGljZSgwLCBzKSksIG0odCkgPyAobiA9IHQsIHQgPSB2b2lkIDApIDogdCAmJiAib2JqZWN0IiA9PSB0eXBlb2YgdCAmJiAoaSA9ICJQT1NUIiksIDAgPCBhLmxlbmd0aCAmJiBTLmFqYXgoew0KCQkJCXVybDogZSwNCgkJCQl0eXBlOiBpIHx8ICJHRVQiLA0KCQkJCWRhdGFUeXBlOiAiaHRtbCIsDQoJCQkJZGF0YTogdA0KCQkJfSkuZG9uZShmdW5jdGlvbihlKSB7byA9IGFyZ3VtZW50cywgYS5odG1sKHIgPyBTKCI8ZGl2PiIpLmFwcGVuZChTLnBhcnNlSFRNTChlKSkuZmluZChyKSA6IGUpfSkuYWx3YXlzKG4gJiYgZnVuY3Rpb24oZSwgdCkge2EuZWFjaChmdW5jdGlvbigpIHtuLmFwcGx5KHRoaXMsIG8gfHwgW2UucmVzcG9uc2VUZXh0LCB0LCBlXSl9KX0pLCB0aGlzDQoJCX0sIFMuZXhwci5wc2V1ZG9zLmFuaW1hdGVkID0gZnVuY3Rpb24odCkge3JldHVybiBTLmdyZXAoUy50aW1lcnMsIGZ1bmN0aW9uKGUpIHtyZXR1cm4gdCA9PT0gZS5lbGVtfSkubGVuZ3RofSwgUy5vZmZzZXQgPSB7DQoJCQlzZXRPZmZzZXQ6IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQl2YXIgciwgaSwgbywgYSwgcywgdSwgbCA9IFMuY3NzKGUsICJwb3NpdGlvbiIpLCBjID0gUyhlKSwgZiA9IHt9Ow0KCQkJCSJzdGF0aWMiID09PSBsICYmIChlLnN0eWxlLnBvc2l0aW9uID0gInJlbGF0aXZlIiksIHMgPSBjLm9mZnNldCgpLCBvID0gUy5jc3MoZSwgInRvcCIpLCB1ID0gUy5jc3MoZSwgImxlZnQiKSwgKCJhYnNvbHV0ZSIgPT09IGwgfHwgImZpeGVkIiA9PT0gbCkgJiYgLTEgPCAobyArIHUpLmluZGV4T2YoImF1dG8iKSA/IChhID0gKHIgPSBjLnBvc2l0aW9uKCkpLnRvcCwgaSA9IHIubGVmdCkgOiAoYSA9IHBhcnNlRmxvYXQobykgfHwgMCwgaSA9IHBhcnNlRmxvYXQodSkgfHwgMCksIG0odCkgJiYgKHQgPSB0LmNhbGwoZSwgbiwgUy5leHRlbmQoe30sIHMpKSksIG51bGwgIT0gdC50b3AgJiYgKGYudG9wID0gdC50b3AgLSBzLnRvcCArIGEpLCBudWxsICE9IHQubGVmdCAmJiAoZi5sZWZ0ID0gdC5sZWZ0IC0gcy5sZWZ0ICsgaSksICJ1c2luZyIgaW4gdCA/IHQudXNpbmcuY2FsbChlLCBmKSA6IGMuY3NzKGYpDQoJCQl9DQoJCX0sIFMuZm4uZXh0ZW5kKHsNCgkJCW9mZnNldDogZnVuY3Rpb24odCkgew0KCQkJCWlmKGFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB2b2lkIDAgPT09IHQgPyB0aGlzIDogdGhpcy5lYWNoKGZ1bmN0aW9uKGUpIHtTLm9mZnNldC5zZXRPZmZzZXQodGhpcywgdCwgZSl9KTsNCgkJCQl2YXIgZSwgbiwgciA9IHRoaXNbMF07DQoJCQkJcmV0dXJuIHIgPyByLmdldENsaWVudFJlY3RzKCkubGVuZ3RoID8gKGUgPSByLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLCBuID0gci5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3LCB7dG9wOiBlLnRvcCArIG4ucGFnZVlPZmZzZXQsIGxlZnQ6IGUubGVmdCArIG4ucGFnZVhPZmZzZXR9KSA6IHt0b3A6IDAsIGxlZnQ6IDB9IDogdm9pZCAwDQoJCQl9LCBwb3NpdGlvbjogZnVuY3Rpb24oKSB7DQoJCQkJaWYodGhpc1swXSkgew0KCQkJCQl2YXIgZSwgdCwgbiwgciA9IHRoaXNbMF0sIGkgPSB7dG9wOiAwLCBsZWZ0OiAwfTsNCgkJCQkJaWYoImZpeGVkIiA9PT0gUy5jc3MociwgInBvc2l0aW9uIikpIHQgPSByLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOyBlbHNlIHsNCgkJCQkJCXQgPSB0aGlzLm9mZnNldCgpLCBuID0gci5vd25lckRvY3VtZW50LCBlID0gci5vZmZzZXRQYXJlbnQgfHwgbi5kb2N1bWVudEVsZW1lbnQ7DQoJCQkJCQl3aGlsZShlICYmIChlID09PSBuLmJvZHkgfHwgZSA9PT0gbi5kb2N1bWVudEVsZW1lbnQpICYmICJzdGF0aWMiID09PSBTLmNzcyhlLCAicG9zaXRpb24iKSkgZSA9IGUucGFyZW50Tm9kZTsNCgkJCQkJCWUgJiYgZSAhPT0gciAmJiAxID09PSBlLm5vZGVUeXBlICYmICgoaSA9IFMoZSkub2Zmc2V0KCkpLnRvcCArPSBTLmNzcyhlLCAiYm9yZGVyVG9wV2lkdGgiLCAhMCksIGkubGVmdCArPSBTLmNzcyhlLCAiYm9yZGVyTGVmdFdpZHRoIiwgITApKQ0KCQkJCQl9DQoJCQkJCXJldHVybiB7dG9wOiB0LnRvcCAtIGkudG9wIC0gUy5jc3MociwgIm1hcmdpblRvcCIsICEwKSwgbGVmdDogdC5sZWZ0IC0gaS5sZWZ0IC0gUy5jc3MociwgIm1hcmdpbkxlZnQiLCAhMCl9DQoJCQkJfQ0KCQkJfSwgb2Zmc2V0UGFyZW50OiBmdW5jdGlvbigpIHsNCgkJCQlyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKSB7DQoJCQkJCXZhciBlID0gdGhpcy5vZmZzZXRQYXJlbnQ7DQoJCQkJCXdoaWxlKGUgJiYgInN0YXRpYyIgPT09IFMuY3NzKGUsICJwb3NpdGlvbiIpKSBlID0gZS5vZmZzZXRQYXJlbnQ7DQoJCQkJCXJldHVybiBlIHx8IHJlDQoJCQkJfSkNCgkJCX0NCgkJfSksIFMuZWFjaCh7c2Nyb2xsTGVmdDogInBhZ2VYT2Zmc2V0Iiwgc2Nyb2xsVG9wOiAicGFnZVlPZmZzZXQifSwgZnVuY3Rpb24odCwgaSkgew0KCQkJdmFyIG8gPSAicGFnZVlPZmZzZXQiID09PSBpOw0KCQkJUy5mblt0XSA9IGZ1bmN0aW9uKGUpIHsNCgkJCQlyZXR1cm4gJCh0aGlzLCBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJCXZhciByOw0KCQkJCQlpZih4KGUpID8gciA9IGUgOiA5ID09PSBlLm5vZGVUeXBlICYmIChyID0gZS5kZWZhdWx0VmlldyksIHZvaWQgMCA9PT0gbikgcmV0dXJuIHIgPyByW2ldIDogZVt0XTsNCgkJCQkJciA/IHIuc2Nyb2xsVG8obyA/IHIucGFnZVhPZmZzZXQgOiBuLCBvID8gbiA6IHIucGFnZVlPZmZzZXQpIDogZVt0XSA9IG4NCgkJCQl9LCB0LCBlLCBhcmd1bWVudHMubGVuZ3RoKQ0KCQkJfQ0KCQl9KSwgUy5lYWNoKFsidG9wIiwgImxlZnQiXSwgZnVuY3Rpb24oZSwgbikge1MuY3NzSG9va3Nbbl0gPSBGZSh5LnBpeGVsUG9zaXRpb24sIGZ1bmN0aW9uKGUsIHQpIHtpZih0KSByZXR1cm4gdCA9IFdlKGUsIG4pLCBQZS50ZXN0KHQpID8gUyhlKS5wb3NpdGlvbigpW25dICsgInB4IiA6IHR9KX0pLCBTLmVhY2goe0hlaWdodDogImhlaWdodCIsIFdpZHRoOiAid2lkdGgifSwgZnVuY3Rpb24oYSwgcykgew0KCQkJUy5lYWNoKHsNCgkJCQlwYWRkaW5nOiAiaW5uZXIiICsgYSwNCgkJCQljb250ZW50OiBzLA0KCQkJCSIiOiAib3V0ZXIiICsgYQ0KCQkJfSwgZnVuY3Rpb24ociwgbykgew0KCQkJCVMuZm5bb10gPSBmdW5jdGlvbihlLCB0KSB7DQoJCQkJCXZhciBuID0gYXJndW1lbnRzLmxlbmd0aCAmJiAociB8fCAiYm9vbGVhbiIgIT0gdHlwZW9mIGUpLCBpID0gciB8fCAoITAgPT09IGUgfHwgITAgPT09IHQgPyAibWFyZ2luIiA6ICJib3JkZXIiKTsNCgkJCQkJcmV0dXJuICQodGhpcywgZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCQkJdmFyIHI7DQoJCQkJCQlyZXR1cm4geChlKSA/IDAgPT09IG8uaW5kZXhPZigib3V0ZXIiKSA/IGVbImlubmVyIiArIGFdIDogZS5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbImNsaWVudCIgKyBhXSA6IDkgPT09IGUubm9kZVR5cGUgPyAociA9IGUuZG9jdW1lbnRFbGVtZW50LCBNYXRoLm1heChlLmJvZHlbInNjcm9sbCIgKyBhXSwgclsic2Nyb2xsIiArIGFdLCBlLmJvZHlbIm9mZnNldCIgKyBhXSwgclsib2Zmc2V0IiArIGFdLCByWyJjbGllbnQiICsgYV0pKSA6IHZvaWQgMCA9PT0gbiA/IFMuY3NzKGUsIHQsIGkpIDogUy5zdHlsZShlLCB0LCBuLCBpKQ0KCQkJCQl9LCBzLCBuID8gZSA6IHZvaWQgMCwgbikNCgkJCQl9DQoJCQl9KQ0KCQl9KSwgUy5lYWNoKFsiYWpheFN0YXJ0IiwgImFqYXhTdG9wIiwgImFqYXhDb21wbGV0ZSIsICJhamF4RXJyb3IiLCAiYWpheFN1Y2Nlc3MiLCAiYWpheFNlbmQiXSwgZnVuY3Rpb24oZSwgdCkge1MuZm5bdF0gPSBmdW5jdGlvbihlKSB7cmV0dXJuIHRoaXMub24odCwgZSl9fSksIFMuZm4uZXh0ZW5kKHsNCgkJCWJpbmQ6IGZ1bmN0aW9uKGUsIHQsIG4pIHtyZXR1cm4gdGhpcy5vbihlLCBudWxsLCB0LCBuKX0sDQoJCQl1bmJpbmQ6IGZ1bmN0aW9uKGUsIHQpIHtyZXR1cm4gdGhpcy5vZmYoZSwgbnVsbCwgdCl9LA0KCQkJZGVsZWdhdGU6IGZ1bmN0aW9uKGUsIHQsIG4sIHIpIHtyZXR1cm4gdGhpcy5vbih0LCBlLCBuLCByKX0sDQoJCQl1bmRlbGVnYXRlOiBmdW5jdGlvbihlLCB0LCBuKSB7cmV0dXJuIDEgPT09IGFyZ3VtZW50cy5sZW5ndGggPyB0aGlzLm9mZihlLCAiKioiKSA6IHRoaXMub2ZmKHQsIGUgfHwgIioqIiwgbil9LA0KCQkJaG92ZXI6IGZ1bmN0aW9uKGUsIHQpIHtyZXR1cm4gdGhpcy5tb3VzZWVudGVyKGUpLm1vdXNlbGVhdmUodCB8fCBlKX0NCgkJfSksIFMuZWFjaCgiYmx1ciBmb2N1cyBmb2N1c2luIGZvY3Vzb3V0IHJlc2l6ZSBzY3JvbGwgY2xpY2sgZGJsY2xpY2sgbW91c2Vkb3duIG1vdXNldXAgbW91c2Vtb3ZlIG1vdXNlb3ZlciBtb3VzZW91dCBtb3VzZWVudGVyIG1vdXNlbGVhdmUgY2hhbmdlIHNlbGVjdCBzdWJtaXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBjb250ZXh0bWVudSIuc3BsaXQoIiAiKSwgZnVuY3Rpb24oZSwgbikge1MuZm5bbl0gPSBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIDAgPCBhcmd1bWVudHMubGVuZ3RoID8gdGhpcy5vbihuLCBudWxsLCBlLCB0KSA6IHRoaXMudHJpZ2dlcihuKX19KTsNCgkJdmFyIFh0ID0gL15bXHNcdUZFRkZceEEwXSt8W1xzXHVGRUZGXHhBMF0rJC9nOw0KCQlTLnByb3h5ID0gZnVuY3Rpb24oZSwgdCkgew0KCQkJdmFyIG4sIHIsIGk7DQoJCQlpZigic3RyaW5nIiA9PSB0eXBlb2YgdCAmJiAobiA9IGVbdF0sIHQgPSBlLCBlID0gbiksIG0oZSkpIHJldHVybiByID0gcy5jYWxsKGFyZ3VtZW50cywgMiksIChpID0gZnVuY3Rpb24oKSB7cmV0dXJuIGUuYXBwbHkodCB8fCB0aGlzLCByLmNvbmNhdChzLmNhbGwoYXJndW1lbnRzKSkpfSkuZ3VpZCA9IGUuZ3VpZCA9IGUuZ3VpZCB8fCBTLmd1aWQrKywgaQ0KCQl9LCBTLmhvbGRSZWFkeSA9IGZ1bmN0aW9uKGUpIHtlID8gUy5yZWFkeVdhaXQrKyA6IFMucmVhZHkoITApfSwgUy5pc0FycmF5ID0gQXJyYXkuaXNBcnJheSwgUy5wYXJzZUpTT04gPSBKU09OLnBhcnNlLCBTLm5vZGVOYW1lID0gQSwgUy5pc0Z1bmN0aW9uID0gbSwgUy5pc1dpbmRvdyA9IHgsIFMuY2FtZWxDYXNlID0gWCwgUy50eXBlID0gdywgUy5ub3cgPSBEYXRlLm5vdywgUy5pc051bWVyaWMgPSBmdW5jdGlvbihlKSB7DQoJCQl2YXIgdCA9IFMudHlwZShlKTsNCgkJCXJldHVybiAoIm51bWJlciIgPT09IHQgfHwgInN0cmluZyIgPT09IHQpICYmICFpc05hTihlIC0gcGFyc2VGbG9hdChlKSkNCgkJfSwgUy50cmltID0gZnVuY3Rpb24oZSkge3JldHVybiBudWxsID09IGUgPyAiIiA6IChlICsgIiIpLnJlcGxhY2UoWHQsICIiKX0sICJmdW5jdGlvbiIgPT0gdHlwZW9mIGRlZmluZSAmJiBkZWZpbmUuYW1kICYmIGRlZmluZSgianF1ZXJ5IiwgW10sIGZ1bmN0aW9uKCkge3JldHVybiBTfSk7DQoJCXZhciBWdCA9IEMualF1ZXJ5LCBHdCA9IEMuJDsNCgkJcmV0dXJuIFMubm9Db25mbGljdCA9IGZ1bmN0aW9uKGUpIHtyZXR1cm4gQy4kID09PSBTICYmIChDLiQgPSBHdCksIGUgJiYgQy5qUXVlcnkgPT09IFMgJiYgKEMualF1ZXJ5ID0gVnQpLCBTfSwgInVuZGVmaW5lZCIgPT0gdHlwZW9mIGUgJiYgKEMualF1ZXJ5ID0gQy4kID0gUyksIFMNCgl9KTsNCn0NCg0KY29uc3QgU1VLUkluc3RhbmNlcyA9IHsNCglpbnN0YW5jZXM6IHt9LA0KCW9uQ2hhbmdlTGlzdGVuZXI6IHt9LA0KCW9uQ3JlYXRlTGlzdGVuZXI6IHt9LA0KDQoJLyoqDQoJICogQWRkIGEgbG9hZGVkIDxiPlNHTlVJS2l0PC9iPiBjb21wb25lbnQuDQoJICoNCgkgKiBAcGFyYW0ge3t9fSB2YWx1ZSBUaGUgPGI+PGk+SlNPTjwvaT48L2I+IG9iamVjdCBvZiB0aGUgbG9hZGVkIDxiPlNHTlVJS2l0PC9iPiBjb21wb25lbnQuDQoJICovDQoJc2V0IGluc3RhbmNlKHZhbHVlKSB7DQoJCWlmKHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09ICIiKQ0KCQkJdmFsdWUgPSB7fTsNCgkJcHVzaCh0aGlzLmluc3RhbmNlcywgdmFsdWUpOw0KDQoJCS8vY29uc29sZS5sb2coU0dOVUlLaXQpOw0KDQoJCWZvckVhY2godGhpcy5vbkNoYW5nZUxpc3RlbmVyLCAobGlzdGVuZXIpID0+IGxpc3RlbmVyKHZhbHVlLCB0aGlzLmluc3RhbmNlcykpOw0KCQkvL1NHTlVJS2l0LnNldE9uUmVhZHlMaXN0ZW5lcigoKSA9PiBmb3JFYWNoKHRoaXMub25DcmVhdGVMaXN0ZW5lciwgKGxpc3RlbmVyKSA9PiBsaXN0ZW5lcih0aGlzLmluc3RhbmNlcykpLCAnc2duLXVrci1jcmVhdGUtbGlzdGVuZXInKTsNCgl9LA0KDQoJLyoqDQoJICogR2V0IHRoZSBsaXN0IG9mIGxvYWRlZCA8Yj5TR05VSUtpdDwvYj4gY29tcG9uZW50cy4NCgkgKg0KCSAqIEByZXR1cm4ge29iamVjdH0gVGhlIDxiPjxpPkpTT048L2k+PC9iPiBvYmplY3Qgb2YgbG9hZGVkIDxiPlNHTlVJS2l0PC9iPiBjb21wb25lbnRzLCBvciBhbiBlbXB0eSA8Yj48aT5KU09OPC9pPjwvYj4gb2JqZWN0IGlmIG5vIGNvbXBvbmVudHMgbG9hZGVkLg0KCSAqLw0KCWdldCBpbnN0YW5jZSgpIHsNCgkJcmV0dXJuIHRoaXMuaW5zdGFuY2VzOw0KCX0sDQoJLyoqDQoJICogU2V0IHRoZSBoYW5kbGVyIGZvciA8Yj5TR05VSUtpdDwvYj4gPGI+PGk+T25DaGFuZ2U8L2k+PC9iPiBldmVudCwgd2hpY2ggd2lsbCBiZSB0cmlnZ2VyZWQgd2hlbiBhIGNvbXBvbmVudCBpcyBsb2FkZWQvcmVtb3ZlZCBvciB0aGUgc3RhdHVzIG9mIHJlYWRpbmVzcyBpcyBjaGFuZ2VkLg0KCSAqDQoJICogQHBhcmFtIHsobmV3SW5zdGFuY2U6e30sIGluc3RhbmNlczp7fSk9PnZvaWR9bGlzdGVuZXINCgkgKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ9W2lkPXVuZGVmaW5lZF0NCgkgKi8NCglzZXRPbkNoYW5nZUxpc3RlbmVyOiBmdW5jdGlvbihsaXN0ZW5lciwgaWQpIHsNCgkJaWYodHlwZW9mIGlkICE9PSAnc3RyaW5nJyB8fCAkLmlzTnVtZXJpYyhpZCkpDQoJCQl0aGlzLm9uQ2hhbmdlTGlzdGVuZXJbaWRdID0gbGlzdGVuZXI7DQoJCWVsc2UNCgkJCXB1c2godGhpcy5vbkNoYW5nZUxpc3RlbmVyLCBsaXN0ZW5lcik7DQoNCgkJZm9yRWFjaCh0aGlzLm9uQ2hhbmdlTGlzdGVuZXIsIChsaXN0ZW5lcikgPT4gbGlzdGVuZXIoJycsIHRoaXMuaW5zdGFuY2VzKSk7DQoJfSwNCg0KCS8qKg0KCSAqIFNldCB0aGUgaGFuZGxlciBmb3IgPGI+U0dOVUlLaXQ8L2I+IDxiPjxpPk9uQ2hhbmdlPC9pPjwvYj4gZXZlbnQsIHdoaWNoIHdpbGwgYmUgdHJpZ2dlcmVkIHdoZW4gYSBjb21wb25lbnQgaXMgbG9hZGVkL3JlbW92ZWQgb3IgdGhlIHN0YXR1cyBvZiByZWFkaW5lc3MgaXMgY2hhbmdlZC4NCgkgKg0KCSAqIEBwYXJhbSB7KG5ld0luc3RhbmNlOnt9LCBpbnN0YW5jZXM6e30pPT52b2lkfWxpc3RlbmVyDQoJICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfVtpZD11bmRlZmluZWRdDQoJICovDQoJc2V0T25DcmVhdGVMaXN0ZW5lcjogZnVuY3Rpb24obGlzdGVuZXIsIGlkKSB7DQoJCWlmKHR5cGVvZiBpZCAhPT0gJ3N0cmluZycgfHwgJC5pc051bWVyaWMoaWQpKQ0KCQkJdGhpcy5vbkNyZWF0ZUxpc3RlbmVyW2lkXSA9IGxpc3RlbmVyOw0KCQllbHNlDQoJCQlwdXNoKHRoaXMub25DcmVhdGVMaXN0ZW5lciwgbGlzdGVuZXIpOw0KDQoJCVNHTlVJS2l0LnNldE9uUmVhZHlMaXN0ZW5lcigoKSA9PiBmb3JFYWNoKHRoaXMub25DcmVhdGVMaXN0ZW5lciwgKGxpc3RlbmVyKSA9PiBsaXN0ZW5lcih0aGlzLmluc3RhbmNlcykpLCAnc2duLXVrci1jcmVhdGUtbGlzdGVuZXInKTsNCgl9LA0KfTsNCg0KLyoqKg0KICogU1VLUiAoU0dOVUlLaXQgUmVhZHkpIGNhbGxiYWNrIGlzIHVzZWQgdG8gZGV0ZXJtaW5lIGlmIHRoZSBwYWdlIGlzIGxvYWRlZCBhbmQgcmVhZHkgdG8gdXNlLiBJdCBjb21iaW5lcyBpbnRlcm5hbCA8Yj5TR05VSUtpdDwvYj4gcmVhZHkgZXZlbnRzIGFzIHdlbGwgYXMgalF1ZXJ5IGAkKGZ1bmN0aW9uKCl7fSlgIGNhbGxiYWNrLg0KICogPGJyPg0KICogPGI+Tk9URTo8L2I+IElmIDxiPjxpPlNHTkF0b208L2I+PC9pPiBpcyB1c2VkIHRoZW4sIHRoZSA8Yj48aT5TVUtSPC9iPjwvaT4gY2FsbGJhY2sgd2lsbCBiZSBjYWxsZWQgYWZ0ZXIgdGhlIDxiPjxpPkRPTTwvYj48L2k+IGlzIHJlYWR5IGFuZCB0aGUgPGk+RGVmYXVsdCBQYWdlPC9pPiBpcyBsb2FkZWQgYnkgPGI+PGk+U0dOQXRvbTwvYj48L2k+Lg0KICoNCiAqIEBwYXJhbSB7KHZhbHVlOmJvb2xlYW4pPT52b2lkfSBjYWxsYmFjaw0KICovDQp3aW5kb3cuU1VLUiA9IChjYWxsYmFjaykgPT4gew0KCWNvbnN0IFNVS1Jpbml0ID0gZnVuY3Rpb24oKSB7DQoJCWNvbnN0IHBsdWdpbiA9IHRoaXM7DQoJCXBsdWdpbi5vblJlYWR5TGlzdGVuZXIgPSB7fTsNCg0KCQljb25zdCBjYWxsZXJTdGFjayA9IGdldFN0YWNrKClbMF0sDQoJCSAgICAgIGNhbGxlciAgICAgID0gYCR7Y2FsbGVyU3RhY2suZmlsZS5uYW1lfS4ke2NhbGxlclN0YWNrLnNpZ25hdHVyZX06JHtjYWxsZXJTdGFjay5saW5lfToke2NhbGxlclN0YWNrLmNvbHVtbn1gIHx8IG51bGw7DQoNCgkJaWYoY2FsbGVyKQ0KCQkJcGx1Z2luLm9uUmVhZHlMaXN0ZW5lcltjYWxsZXJdID0gY2FsbGJhY2s7DQoJCWVsc2UNCgkJCXB1c2gocGx1Z2luLm9uUmVhZHlMaXN0ZW5lciwgY2FsbGJhY2spOw0KDQoJCXBsdWdpbi50cmlnZ2VyID0gKCkgPT4gew0KCQkJZm9yRWFjaChwbHVnaW4ub25SZWFkeUxpc3RlbmVyLCAobGlzdGVuZXIpID0+IGxpc3RlbmVyKHRydWUpKTsNCgkJfQ0KCX0NCg0KCWNvbnN0IGdldFN0YWNrID0gKHNlYXJjaCA9IG51bGwpID0+IHsNCgkJY29uc3QgcmVnZXggPSAvXig8PyhcdyspKFwuKFx3KykpPz4/KT8gPyhbYS16QS1aMC05Ki88XSspPyA/QD8oaHR0cHM/OlwvXC9bYS16XGQtX10rXC4/W2EtelxkLV9dK1teXHM6Il0rKTooXGQrKTo/KFxkKyk/JC87DQoJCWNvbnN0IGVycm9ycyA9IFtdLA0KCQkgICAgICBzdGFjayAgPSAobmV3IEVycm9yKCkpLnN0YWNrOw0KDQoJCS8vY29uc29sZS5sb2coc3RhY2spOw0KDQoJCWZ1bmN0aW9uIGdldEZpbGVuYW1lQW5kRXh0ZW5zaW9uKHBhdGgpIHsNCgkJCWlmKHBhdGggIT09IHVuZGVmaW5lZCkgew0KCQkJCWNvbnN0IGZpbGVuYW1lZXh0ZW5zaW9uID0gcGF0aC5yZXBsYWNlKC9eLipbXFxcL10vLCAnJyksDQoJCQkJICAgICAgZmlsZW5hbWUgICAgICAgICAgPSBmaWxlbmFtZWV4dGVuc2lvbi5zdWJzdHJpbmcoMCwgZmlsZW5hbWVleHRlbnNpb24ubGFzdEluZGV4T2YoJy4nKSksDQoJCQkJICAgICAgZXh0ICAgICAgICAgICAgICAgPSBmaWxlbmFtZWV4dGVuc2lvbi5zcGxpdCgnLicpLnBvcCgpOw0KDQoJCQkJcmV0dXJuIHsNCgkJCQkJJ25hbWUnOiBmaWxlbmFtZSwNCgkJCQkJJ2V4dCc6IGV4dA0KCQkJCX07DQoJCQl9DQoJCQlyZXR1cm4gew0KCQkJCSduYW1lJzogJycsDQoJCQkJJ2V4dCc6ICcnDQoJCQl9Ow0KCQl9DQoNCgkJc3RhY2suc3BsaXQoIlxuIikuZm9yRWFjaCgodiwgaSkgPT4gew0KCQkJY29uc3QgbWF0Y2ggPSB2Lm1hdGNoKHJlZ2V4KTsNCgkJCWxldCB2YWw7DQoJCQlpZihtYXRjaCAhPT0gbnVsbCkgew0KCQkJCWlmKHYuc3RhcnRzV2l0aCgnQCcpKSB7DQoJCQkJCXZhbCA9IHsNCgkJCQkJCSJzaWduYXR1cmUiOiAiPGFub255bW91cz4iLA0KCQkJCQkJImNsYXNzIjogbWF0Y2hbMl0sDQoJCQkJCQkiZnVuY3Rpb24iOiAiPGFub255bW91cz4iLA0KCQkJCQkJInVybCI6IG1hdGNoWzZdLA0KCQkJCQkJImxpbmUiOiBtYXRjaFs3XSwNCgkJCQkJCSJjb2x1bW4iOiBtYXRjaFs4XSwNCgkJCQkJCSdzdHInOiB2LA0KCQkJCQkJJ2ZpbGUnOiBnZXRGaWxlbmFtZUFuZEV4dGVuc2lvbihtYXRjaFs2XSksDQoJCQkJCX07DQoJCQkJfSBlbHNlIHsNCgkJCQkJdmFsID0gew0KCQkJCQkJInNpZ25hdHVyZSI6IG1hdGNoWzFdLA0KCQkJCQkJImNsYXNzIjogbWF0Y2hbMl0sDQoJCQkJCQkiZnVuY3Rpb24iOiBtYXRjaFs0XSwNCgkJCQkJCSJ1cmwiOiBtYXRjaFs2XSwNCgkJCQkJCSJsaW5lIjogbWF0Y2hbN10sDQoJCQkJCQkiY29sdW1uIjogbWF0Y2hbOF0sDQoJCQkJCQknc3RyJzogdiwNCgkJCQkJCSdmaWxlJzogZ2V0RmlsZW5hbWVBbmRFeHRlbnNpb24obWF0Y2hbNl0pLA0KCQkJCQl9Ow0KCQkJCX0NCgkJCX0NCgkJCWlmKHNlYXJjaCAhPT0gdW5kZWZpbmVkICYmIHNlYXJjaCAhPT0gbnVsbCkgew0KCQkJCWlmKHYuaW5kZXhPZihzZWFyY2gpICE9PSAtMSkNCgkJCQkJZXJyb3JzLnB1c2godmFsKTsNCgkJCX0gZWxzZSB7DQoJCQkJaWYodmFsICE9PSB1bmRlZmluZWQgJiYgdmFsICE9PSAnJyAmJiB2YWwuc2lnbmF0dXJlICE9PSAnZ2V0U3RhY2snICYmIHZhbC5zaWduYXR1cmUgIT09ICdTVUtSaW5pdCcgJiYgdmFsLnNpZ25hdHVyZSAhPT0gJ1NVS1InICYmIHZhbC5zaWduYXR1cmUgIT09ICd3aW5kb3cuU1VLUicpDQoJCQkJCWVycm9ycy5wdXNoKHZhbCk7DQoJCQl9DQoJCX0pOw0KCQlpZihzZWFyY2ggIT09IHVuZGVmaW5lZCAmJiBzZWFyY2ggIT09IG51bGwpDQoJCQlyZXR1cm4gKGVycm9ycy5sZW5ndGggPiAwKSA/IGVycm9yc1swXSA6IG51bGw7DQoJCWVsc2UNCgkJCXJldHVybiBlcnJvcnM7DQoJfTsNCg0KCVNVS1JJbnN0YW5jZXMuaW5zdGFuY2UgPSBuZXcgU1VLUmluaXQoKTsNCn07DQoNCmNvbnN0IHVudGlsID0gKHByZWRpY2F0ZUZuKSA9PiB7DQoJY29uc3QgcG9sbCA9IChkb25lKSA9PiAocHJlZGljYXRlRm4oKSA/IGRvbmUoKSA6IHNldFRpbWVvdXQoKCkgPT4gcG9sbChkb25lKSwgNTAwKSk7DQoJcmV0dXJuIG5ldyBQcm9taXNlKHBvbGwpOw0KfTsNCg0KYXN5bmMgZnVuY3Rpb24gcGF1c2Uodikgew0KCXdoaWxlKHYgPCAxMDApDQoJCWF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDAwKSk7DQp9DQoNCmNvbnN0IGxvb3AgPSAoYXJyLCBmbiwgYnVzeSwgZXJyLCBpID0gMCkgPT4gew0KCWNvbnN0IGJvZHkgPSAob2ssIGVyKSA9PiB7DQoJCXRyeSB7DQoJCQljb25zdCByID0gZm4oYXJyW2ldLCBpLCBhcnIpOw0KCQkJciAmJiByLnRoZW4gPyByLnRoZW4ob2spLmNhdGNoKGVyKSA6IG9rKHIpDQoJCX0gY2F0Y2goZSkge2VyKGUpfQ0KCX0NCgljb25zdCBuZXh0ID0gKG9rLCBlcikgPT4gKCkgPT4gbG9vcChhcnIsIGZuLCBvaywgZXIsICsraSkNCgljb25zdCBydW4gPSAob2ssIGVyKSA9PiBpIDwgYXJyLmxlbmd0aCA/IG5ldyBQcm9taXNlKGJvZHkpLnRoZW4obmV4dChvaywgZXIpKS5jYXRjaChlcikgOiBvaygpDQoJcmV0dXJuIGJ1c3kgPyBydW4oYnVzeSwgZXJyKSA6IG5ldyBQcm9taXNlKHJ1bikNCn0NCg0KLyoqKg0KICogQHJldHVybiB7U0dOVUtDb25maWd9DQogKi8NCmNvbnN0IFNHTlVLQ29uZmlnID0gZnVuY3Rpb24oY29uZmlnKSB7DQoJY29uc3QgcGx1Z2luID0gdGhpczsNCgljb25zdCBfZGVmYXVsdHMgPSB7DQoJCSd1cmxzJzogew0KCQkJJ2FwaSc6IHsNCgkJCQknZ2VvbmFtZXMnOiAnaHR0cHM6Ly9zZWN1cmUuZ2VvbmFtZXMub3JnLycsDQoJCQkJJ29zbSc6ICdodHRwczovL25vbWluYXRpbS5vcGVuc3RyZWV0bWFwLm9yZy8nDQoJCQl9LA0KCQl9DQoJfQ0KCXBsdWdpbi5jb25maWcgPSB7DQoJCSdhcGknOiB7DQoJCQknZ2VvbmFtZXMnOiB1bmRlZmluZWQgLy91c2VybmFtZQ0KCQl9LA0KCQknZ2VvY29kaW5nJzogew0KCQkJJ2RlZmF1bHRBUEknOiAnb3NtJw0KCQl9DQoJfQ0KDQoJY29uc3QgaW5pdCA9ICgpID0+IHsNCgkJcGx1Z2luLmNvbmZpZyA9IE9iamVjdC5hc3NpZ24ocGx1Z2luLmNvbmZpZywgY29uZmlnKTsNCgkJcGx1Z2luLmNvbmZpZyA9IE9iamVjdC5hc3NpZ24ocGx1Z2luLmNvbmZpZywgX2RlZmF1bHRzKTsNCgl9DQoNCglpbml0KCk7DQoNCglyZXR1cm4gcGx1Z2luOw0KfTsNCg0KKChjYWxsYmFjaykgPT4gew0KCWNvbnN0IGNzcyA9IGAvKg0KICogQ29weXJpZ2h0IChjKSAyMDIyIFNHTmV0d29ya3MuIEFsbCByaWdodHMgcmVzZXJ2ZWQuDQogKg0KICogVGhlIHNvZnR3YXJlIGlzIGFuIGV4Y2x1c2l2ZSBjb3B5cmlnaHQgb2YgIlNHTmV0d29ya3MiIGFuZCBpcyBwcm92aWRlZCBhcyBpcyBleGNsdXNpdmVseSB3aXRoIG9ubHkgIlVTQUdFIiBhY2Nlc3MuICJNb2RpZmljYXRpb24iLCAgIkFsdGVyYXRpb24iLCAiUmUtZGlzdHJpYnV0aW9uIiBpcyBjb21wbGV0ZWx5IHByb2hpYml0ZWQuDQogKiBWSU9MQVRJTkcgVEhFIEFCT1ZFIFRFUk1TIElTIEEgUFVOSVNIQUJMRSBPRkZFTlNFIFdISUNIIE1BWSBMRUFEIFRPIExFR0FMIENPTlNFUVVFTkNFUy4NCiAqLw0KDQouaGFzLXByZWxvYWRlciwNCi5oYXMtcHJlbG9hZGVyICogew0KXHQtLXNnbi1iYWNrZ3JvdW5kOiAjZmZmOw0KXHQtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aDogNnB4Ow0KXHQtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aDogNDRweDsNClx0LS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0OiAyMnB4Ow0KXHQtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW46IDFweDsNClx0LS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtcmFkaXVzOiA2cHg7DQp9DQoNCkBtZWRpYSBhbGwgYW5kIChwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaykgew0KXHQuaGFzLXByZWxvYWRlciwNClx0Lmhhcy1wcmVsb2FkZXIgKiB7DQpcdC0tc2duLWJhY2tncm91bmQ6ICMwMDA7DQpcdH0NCn0NCg0KYm9keSB7DQpcdG1hcmdpbjogMDsNClx0ZGlzcGxheTogbm9uZTsNCn0NCg0KLmhhcy1wcmVsb2FkZXIgew0KXHRvdmVyZmxvdzogaGlkZGVuICFpbXBvcnRhbnQ7DQpcZGlzcGxheTogYmxvY2s7DQp9DQoNCi5zZ24tcHJlbG9hZGVyIHsNClx0cGFkZGluZzogMDsNClx0d2lkdGg6IDEwMCU7DQpcdGhlaWdodDogMTAwJTsNClx0YmFja2dyb3VuZC1jb2xvcjogdmFyKC0tc2duLWJhY2tncm91bmQpOw0KXHRkaXNwbGF5OiBmbGV4Ow0KXHRqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNClx0YWxpZ24taXRlbXM6IGNlbnRlcjsNClx0cG9zaXRpb246IGFic29sdXRlOw0KXHR6LWluZGV4OiA5OTk5OTk7DQp9DQoNCg0KLnNnbi1wcmVsb2FkZXIgPiAucHJlbG9hZGVyIHsNClx0cG9zaXRpb246IHJlbGF0aXZlOw0KXHRkaXNwbGF5OiBpbmxpbmUtZmxleDsNClx0anVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQpcdGFsaWduLWl0ZW1zOiBjZW50ZXI7DQp9DQoNCi5zZ24tcHJlbG9hZGVyID4gLnByZWxvYWRlciA+IC5zcGlubmVyIHsNClx0YW5pbWF0aW9uOiByb3RhdGUgMTBzIGluZmluaXRlIGxpbmVhcjsNClx0cG9zaXRpb246IHJlbGF0aXZlOw0KXHRkaXNwbGF5OiBpbmxpbmUtZmxleDsNClx0anVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQpcdGFsaWduLWl0ZW1zOiBjZW50ZXI7DQpcdHdpZHRoOiAxMDAlOw0KXHRoZWlnaHQ6IDEwMCU7DQp9DQoNCg0KLnNnbi1wcmVsb2FkZXIgPiAucHJlbG9hZGVyID4gaW1nIHsNClx0d2lkdGg6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpKTsNClx0aGVpZ2h0OiBjYWxjKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1oZWlnaHQpICsgKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkpOw0KXHRtYXJnaW46IHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pOw0KXHRkaXNwbGF5OiBmbGV4Ow0KXHRqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNClx0YWxpZ24taXRlbXM6IGNlbnRlcjsNClx0cG9zaXRpb246IHJlbGF0aXZlOw0KXHR0b3A6IDUwJTsNClx0bGVmdDogNTAlOw0KXHRhbmltYXRpb246IHNwaW4gNHMgZWFzZS1pbi1vdXQgZm9yd2FyZHMgaW5maW5pdGU7DQp9DQouc2duLXByZWxvYWRlciA+IC5wcmVsb2FkZXIgPiAuc3Bpbm5lciA+IGltZyB7DQpcdHdpZHRoOiBjYWxjKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkpOw0KXHRoZWlnaHQ6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSk7DQpcdG1hcmdpbjogdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbik7DQp9DQouc2duLXByZWxvYWRlciA+IC5wcmVsb2FkZXIgPiAuc3Bpbm5lciA+IGkgew0KXHRhbmltYXRpb246IHJvdGF0ZSAzcyBpbmZpbml0ZSBjdWJpYy1iZXppZXIoMC4wOSwgMC42LCAwLjgsIDAuMDMpOw0KXHR0cmFuc2Zvcm0tb3JpZ2luOiA1MCUgMTAwJSAwOw0KXHRwb3NpdGlvbjogYWJzb2x1dGU7DQpcdGRpc3BsYXk6IGlubGluZS1mbGV4Ow0KXHRqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNClx0YWxpZ24taXRlbXM6IGNlbnRlcjsNClx0dG9wOiA1MCU7DQpcdGxlZnQ6IDUwJTsNClx0Ym9yZGVyOiBzb2xpZCB2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpIHRyYW5zcGFyZW50Ow0KXHRib3JkZXItYm90dG9tOiBub25lOw0KfQ0KLnNnbi1wcmVsb2FkZXIgPiAucHJlbG9hZGVyID4gLnNwaW5uZXIgPiBpOm50aC1jaGlsZCgxKSB7DQpcdC1tb3otYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMDksIDAuMywgMC4xMiwgMC4wMyk7DQpcdC13ZWJraXQtYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMDksIDAuMywgMC4xMiwgMC4wMyk7DQpcdGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAwLjMsIDAuMTIsIDAuMDMpOw0KXHR3aWR0aDogdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKTsNClx0aGVpZ2h0OiB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KTsNClx0bWFyZ2luLXRvcDogY2FsYygwcHggLSB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSk7DQpcdG1hcmdpbi1sZWZ0OiBjYWxjKDBweCAtIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1oZWlnaHQpKTsNClx0Ym9yZGVyLWNvbG9yOiAjMjE3MmI4Ow0KXHRib3JkZXItdG9wLWxlZnQtcmFkaXVzOiBjYWxjKCh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikgKiAxKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1yYWRpdXMpKTsNClx0Ym9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IGNhbGMoKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDEpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXJhZGl1cykpOw0KfQ0KLnNnbi1wcmVsb2FkZXIgPiAucHJlbG9hZGVyID4gLnNwaW5uZXIgPiBpOm50aC1jaGlsZCgyKSB7DQpcdC1tb3otYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMDksIDAuNiwgMC4yNCwgMC4wMyk7DQpcdC13ZWJraXQtYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMDksIDAuNiwgMC4yNCwgMC4wMyk7DQpcdGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAwLjYsIDAuMjQsIDAuMDMpOw0KXHR3aWR0aDogY2FsYyh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikpOw0KXHRoZWlnaHQ6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSk7DQpcdG1hcmdpbi10b3A6IGNhbGMoMHB4IC0gKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1oZWlnaHQpICsgKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkpKTsNClx0bWFyZ2luLWxlZnQ6IGNhbGMoMHB4IC0gKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1oZWlnaHQpICsgKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkpKTsNClx0Ym9yZGVyLWNvbG9yOiAjMThhMzliOw0KXHRib3JkZXItdG9wLWxlZnQtcmFkaXVzOiBjYWxjKCh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikgKiAyKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1yYWRpdXMpKTsNClx0Ym9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IGNhbGMoKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDIpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXJhZGl1cykpOw0KfQ0KLnNnbi1wcmVsb2FkZXIgPiAucHJlbG9hZGVyID4gLnNwaW5uZXIgPiBpOm50aC1jaGlsZCgzKSB7DQpcdC1tb3otYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMDksIDAuOSwgMC4zNiwgMC4wMyk7DQpcdC13ZWJraXQtYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMDksIDAuOSwgMC4zNiwgMC4wMyk7DQpcdGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAwLjksIDAuMzYsIDAuMDMpOw0KXHR3aWR0aDogY2FsYyh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikgKiAyKTsNClx0aGVpZ2h0OiBjYWxjKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1oZWlnaHQpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikpOw0KXHRtYXJnaW4tdG9wOiBjYWxjKDBweCAtICh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpKSk7DQpcdG1hcmdpbi1sZWZ0OiBjYWxjKDBweCAtICh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpKSk7DQpcdGJvcmRlci1jb2xvcjogIzgyYzU0NTsNClx0Ym9yZGVyLXRvcC1sZWZ0LXJhZGl1czogY2FsYygodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogMikgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtcmFkaXVzKSk7DQpcdGJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiBjYWxjKCh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikgKiAyKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1yYWRpdXMpKTsNCn0NCi5zZ24tcHJlbG9hZGVyID4gLnByZWxvYWRlciA+IC5zcGlubmVyID4gaTpudGgtY2hpbGQoNCkgew0KXHQtbW96LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAxLjIsIDAuNDgsIDAuMDMpOw0KXHQtd2Via2l0LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAxLjIsIDAuNDgsIDAuMDMpOw0KXHRhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4wOSwgMS4yLCAwLjQ4LCAwLjAzKTsNClx0d2lkdGg6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogMyk7DQpcdGhlaWdodDogY2FsYyh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogMS41KTsNClx0bWFyZ2luLXRvcDogY2FsYygwcHggLSAodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAzKSkpOw0KXHRtYXJnaW4tbGVmdDogY2FsYygwcHggLSAodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAzKSkpOw0KXHRib3JkZXItY29sb3I6ICNmOGI3Mzk7DQpcdGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IGNhbGMoKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDMpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXJhZGl1cykpOw0KXHRib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogY2FsYygodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogMykgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtcmFkaXVzKSk7DQp9DQouc2duLXByZWxvYWRlciA+IC5wcmVsb2FkZXIgPiAuc3Bpbm5lciA+IGk6bnRoLWNoaWxkKDUpIHsNClx0LW1vei1hbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4wOSwgMS41LCAwLjYsIDAuMDMpOw0KXHQtd2Via2l0LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAxLjUsIDAuNiwgMC4wMyk7DQpcdGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAxLjUsIDAuNiwgMC4wMyk7DQpcdHdpZHRoOiBjYWxjKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDQpOw0KXHRoZWlnaHQ6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDIpOw0KXHRtYXJnaW4tdG9wOiBjYWxjKDBweCAtICh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDQpKSk7DQpcdG1hcmdpbi1sZWZ0OiBjYWxjKDBweCAtICh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDQpKSk7DQpcdGJvcmRlci1jb2xvcjogI2YwNjA0NTsNClx0Ym9yZGVyLXRvcC1sZWZ0LXJhZGl1czogY2FsYygodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogNCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtcmFkaXVzKSk7DQpcdGJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiBjYWxjKCh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikgKiA0KSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1yYWRpdXMpKTsNCn0NCi5zZ24tcHJlbG9hZGVyID4gLnByZWxvYWRlciA+IC5zcGlubmVyID4gaTpudGgtY2hpbGQoNikgew0KXHQtbW96LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAxLjgsIDAuNzIsIDAuMDMpOw0KXHQtd2Via2l0LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAxLjgsIDAuNzIsIDAuMDMpOw0KXHRhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4wOSwgMS44LCAwLjcyLCAwLjAzKTsNClx0d2lkdGg6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogNSk7DQpcdGhlaWdodDogY2FsYyh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogMi41KTsNClx0bWFyZ2luLXRvcDogY2FsYygwcHggLSAodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiA1KSkpOw0KXHRtYXJnaW4tbGVmdDogY2FsYygwcHggLSAodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiA1KSkpOw0KXHRib3JkZXItY29sb3I6ICNlZDI4NjE7DQpcdGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IGNhbGMoKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDUpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXJhZGl1cykpOw0KXHRib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogY2FsYygodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogNSkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtcmFkaXVzKSk7DQp9DQouc2duLXByZWxvYWRlciA+IC5wcmVsb2FkZXIgPiAuc3Bpbm5lciA+IGk6bnRoLWNoaWxkKDcpIHsNClx0LW1vei1hbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4wOSwgMi4xLCAwLjg0LCAwLjAzKTsNClx0LXdlYmtpdC1hbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4wOSwgMi4xLCAwLjg0LCAwLjAzKTsNClx0YW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMDksIDIuMSwgMC44NCwgMC4wMyk7DQpcdHdpZHRoOiBjYWxjKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDYpOw0KXHRoZWlnaHQ6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDMpOw0KXHRtYXJnaW4tdG9wOiBjYWxjKDBweCAtICh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDYpKSk7DQpcdG1hcmdpbi1sZWZ0OiBjYWxjKDBweCAtICh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDYpKSk7DQpcdGJvcmRlci1jb2xvcjogI2MxMjY4MDsNClx0Ym9yZGVyLXRvcC1sZWZ0LXJhZGl1czogY2FsYygodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogNikgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtcmFkaXVzKSk7DQpcdGJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiBjYWxjKCh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikgKiA2KSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1yYWRpdXMpKTsNCn0NCi5zZ24tcHJlbG9hZGVyID4gLnByZWxvYWRlciA+IC5zcGlubmVyID4gaTpudGgtY2hpbGQoOCkgew0KXHQtbW96LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAyLjQsIDAuOTYsIDAuMDMpOw0KXHQtd2Via2l0LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAyLjQsIDAuOTYsIDAuMDMpOw0KXHRhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4wOSwgMi40LCAwLjk2LCAwLjAzKTsNClx0d2lkdGg6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogNyk7DQpcdGhlaWdodDogY2FsYyh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogMy41KTsNClx0bWFyZ2luLXRvcDogY2FsYygwcHggLSAodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiA3KSkpOw0KXHRtYXJnaW4tbGVmdDogY2FsYygwcHggLSAodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiA3KSkpOw0KXHRib3JkZXItY29sb3I6ICM1ZDMxOTE7DQpcdGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IGNhbGMoKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDcpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXJhZGl1cykpOw0KXHRib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogY2FsYygodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogNykgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtcmFkaXVzKSk7DQp9DQoNCkAtbW96LWtleWZyYW1lcyByb3RhdGUgew0KXHR0byB7DQpcdFx0dHJhbnNmb3JtOiByb3RhdGUoMzYwZGVnKTsNClx0fQ0KfQ0KQC13ZWJraXQta2V5ZnJhbWVzIHJvdGF0ZSB7DQpcdHRvIHsNClx0XHR0cmFuc2Zvcm06IHJvdGF0ZSgzNjBkZWcpOw0KXHR9DQp9DQpAa2V5ZnJhbWVzIHJvdGF0ZSB7DQpcdHRvIHsNClx0XHR0cmFuc2Zvcm06IHJvdGF0ZSgzNjBkZWcpOw0KXHR9DQp9DQoNCkBrZXlmcmFtZXMgcHVsc2Ugew0KXHRmcm9tIHsNClx0XHR0cmFuc2Zvcm06IHNjYWxlKC44KTsNClx0fQ0KXHR0byB7DQpcdFx0dHJhbnNmb3JtOiBzY2FsZSgxKTsNClx0fQ0KfQ0KDQpAa2V5ZnJhbWVzIHNwaW4gew0KXHQwJSB7DQpcdFx0dHJhbnNmb3JtOiByb3RhdGVZKDBkZWcpOw0KXHR9DQpcdDUwJSB7DQpcdFx0dHJhbnNmb3JtOiByb3RhdGVZKDE4MGRlZyk7DQpcdH0NClx0MTAwJSB7DQpcdFx0dHJhbnNmb3JtOiByb3RhdGVZKDM2MGRlZyk7DQpcdH0NCn0NCg0KYDsNCgljb25zdCBoZWFkICA9IGRvY3VtZW50LmhlYWQgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXSwNCgkgICAgICBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7DQoJY29uc3QgY3VycmVudFNjcmlwdCA9IGRvY3VtZW50LmN1cnJlbnRTY3JpcHQgfHwgZG9jdW1lbnQucXVlcnlTZWxlY3Rvcigic2NyaXB0W3NyYyo9XCJTR05VSUtpdC5sb2FkZXIuanNcIl0iKTsNCg0KCWhlYWQuYXBwZW5kQ2hpbGQoc3R5bGUpOw0KCXN0eWxlLnR5cGUgPSAidGV4dC9jc3MiOw0KCXN0eWxlLmlkID0gInNnbi11aWtpdC1zdHlsZXMiOw0KCWlmKHN0eWxlLnN0eWxlU2hlZXQpIHsNCgkJLy8gVGhpcyBpcyByZXF1aXJlZCBmb3IgSUU4IGFuZCBiZWxvdy4NCgkJc3R5bGUuc3R5bGVTaGVldC5jc3NUZXh0ID0gY3NzOw0KCX0gZWxzZSB7DQoJCXN0eWxlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNzcykpOw0KCX0NCglsZXQgcHJlbG9hZGVyRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KCXByZWxvYWRlckVsZW0uY2xhc3NOYW1lID0gInNnbi1wcmVsb2FkZXIiOw0KCWxldCBwcmVsb2FkZXIgPSBgXHRcdFx0PGRpdiBjbGFzcz0icHJlbG9hZGVyIj5cbmA7DQoJY29uc3QgaWNvbiA9IGN1cnJlbnRTY3JpcHQuZ2V0QXR0cmlidXRlKCdzZ24tdWkta2l0LWxvYWRlci1pY29uJyk7DQoJaWYoaWNvbiAhPT0gdW5kZWZpbmVkKQ0KCQlwcmVsb2FkZXIgKz0gYFx0XHRcdFx0PGltZyBzcmM9IiR7aWNvbn0iIGFsdD0iSUNPTiI+XG5gOw0KCXByZWxvYWRlciArPSBgXHRcdFx0XHQ8ZGl2IGNsYXNzPSJzcGlubmVyIj5cbmA7DQoJcHJlbG9hZGVyICs9IGBcdFx0XHRcdFx0PGk+PC9pPlxuYDsNCglwcmVsb2FkZXIgKz0gYFx0XHRcdFx0XHQ8aT48L2k+XG5gOw0KCXByZWxvYWRlciArPSBgXHRcdFx0XHRcdDxpPjwvaT5cbmA7DQoJcHJlbG9hZGVyICs9IGBcdFx0XHRcdFx0PGk+PC9pPlxuYDsNCglwcmVsb2FkZXIgKz0gYFx0XHRcdFx0XHQ8aT48L2k+XG5gOw0KCXByZWxvYWRlciArPSBgXHRcdFx0XHRcdDxpPjwvaT5cbmA7DQoJcHJlbG9hZGVyICs9IGBcdFx0XHRcdFx0PGk+PC9pPlxuYDsNCglwcmVsb2FkZXIgKz0gYFx0XHRcdFx0XHQ8aT48L2k+XG5gOw0KCXByZWxvYWRlciArPSBgXHRcdFx0XHQ8L2Rpdj5cbmA7DQoJcHJlbG9hZGVyICs9IGBcdFx0XHQ8L2Rpdj5cbmA7DQoJcHJlbG9hZGVyICs9IGBcdFx0PC9kaXY+XG5gOw0KDQoJcHJlbG9hZGVyRWxlbS5pbm5lckhUTUwgPSBwcmVsb2FkZXI7DQoNCgl3aW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7DQoJCWRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgiaGFzLXByZWxvYWRlciIpOw0KCQlkb2N1bWVudC5ib2R5Lmluc2VydEJlZm9yZShwcmVsb2FkZXJFbGVtLCBkb2N1bWVudC5ib2R5LmZpcnN0Q2hpbGQpOw0KDQoJCWlmKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykNCgkJCWNhbGxiYWNrKCk7DQoJfTsNCn0pKCgpID0+IHsNCglmdW5jdGlvbiBnZXRGaWxlbmFtZUFuZEV4dGVuc2lvbihwYXRoKSB7DQoJCWlmKHBhdGggIT09IHVuZGVmaW5lZCkgew0KCQkJY29uc3QgZmlsZW5hbWVleHRlbnNpb24gPSBwYXRoLnJlcGxhY2UoL14uKltcXFwvXS8sICcnKSwNCgkJCSAgICAgIGZpbGVuYW1lICAgICAgICAgID0gZmlsZW5hbWVleHRlbnNpb24uc3Vic3RyaW5nKDAsIGZpbGVuYW1lZXh0ZW5zaW9uLmxhc3RJbmRleE9mKCcuJykpLA0KCQkJICAgICAgZXh0ICAgICAgICAgICAgICAgPSBmaWxlbmFtZWV4dGVuc2lvbi5zcGxpdCgnLicpLnBvcCgpOw0KDQoJCQlyZXR1cm4gew0KCQkJCSduYW1lJzogZmlsZW5hbWUsDQoJCQkJJ2V4dCc6IGV4dA0KCQkJfTsNCgkJfQ0KCQlyZXR1cm4gew0KCQkJJ25hbWUnOiAnJywNCgkJCSdleHQnOiAnJw0KCQl9Ow0KCX0NCg0KCWlmKHR5cGVvZiBIVE1MRWxlbWVudC5wcm90b3R5cGUuYXR0ciAhPT0gImZ1bmN0aW9uIikgew0KCQlIVE1MRWxlbWVudC5wcm90b3R5cGUuYXR0ciA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7DQoJCQlpZih2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7DQoJCQkJcmV0dXJuIHRoaXMuZ2V0QXR0cmlidXRlKG5hbWUpOw0KCQkJfSBlbHNlDQoJCQkJdGhpcy5zZXRBdHRyaWJ1dGUobmFtZSwgdmFsdWUpOw0KCQl9Ow0KCX0NCg0KCWlmKHR5cGVvZiBIVE1MRWxlbWVudC5wcm90b3R5cGUuZmFkZUluICE9PSAiZnVuY3Rpb24iKSB7DQoJCUhUTUxFbGVtZW50LnByb3RvdHlwZS5mYWRlSW4gPSBmdW5jdGlvbihzcGVlZCwgY2FsbGJhY2spIHsNCgkJCWxldCBfdGhpcyA9IHRoaXM7DQoJCQlzcGVlZCA9ICh0eXBlb2Ygc3BlZWQgIT09ICJudW1iZXIiKSA/IDIwMDAgOiBzcGVlZDsNCg0KCQkJaWYoIV90aGlzLnN0eWxlLm9wYWNpdHkpIHsNCgkJCQlfdGhpcy5zdHlsZS5vcGFjaXR5ID0gKHNwZWVkID4gMCkgPyAwIDogMTsNCgkJCX0NCg0KCQkJaWYoc3BlZWQgPiAwKSB7DQoJCQkJY29uc3QgaW5JbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkgew0KCQkJCQlfdGhpcy5zdHlsZS5vcGFjaXR5ID0gTnVtYmVyKF90aGlzLnN0eWxlLm9wYWNpdHkpICsgMC4wMjsNCgkJCQkJaWYoX3RoaXMuc3R5bGUub3BhY2l0eSA+PSAxKSB7DQoJCQkJCQljbGVhckludGVydmFsKGluSW50ZXJ2YWwpOw0KDQoJCQkJCQlpZih0eXBlb2YgY2FsbGJhY2sgPT09ICJmdW5jdGlvbiIpDQoJCQkJCQkJY2FsbGJhY2soX3RoaXMpOw0KCQkJCQl9DQoJCQkJfSwgc3BlZWQgLyA1MCk7DQoJCQl9IGVsc2Ugew0KCQkJCWlmKHR5cGVvZiBjYWxsYmFjayA9PT0gImZ1bmN0aW9uIikNCgkJCQkJY2FsbGJhY2soX3RoaXMpOw0KCQkJfQ0KCQl9Ow0KCX0NCg0KCWlmKHR5cGVvZiBIVE1MRWxlbWVudC5wcm90b3R5cGUuZmFkZU91dCAhPT0gImZ1bmN0aW9uIikgew0KCQlIVE1MRWxlbWVudC5wcm90b3R5cGUuZmFkZU91dCA9IGZ1bmN0aW9uKHNwZWVkLCBjYWxsYmFjaykgew0KCQkJbGV0IF90aGlzID0gdGhpczsNCgkJCXNwZWVkID0gKHR5cGVvZiBzcGVlZCAhPT0gIm51bWJlciIpID8gMjAwMCA6IHNwZWVkOw0KDQoJCQlpZighX3RoaXMuc3R5bGUub3BhY2l0eSkgew0KCQkJCV90aGlzLnN0eWxlLm9wYWNpdHkgPSAoc3BlZWQgPiAwKSA/IDEgOiAwOw0KCQkJfQ0KDQoJCQlpZihzcGVlZCA+IDApIHsNCgkJCQljb25zdCBvdXRJbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkgew0KCQkJCQlfdGhpcy5zdHlsZS5vcGFjaXR5IC09IDAuMDI7DQoJCQkJCWlmKF90aGlzLnN0eWxlLm9wYWNpdHkgPD0gMCkgew0KCQkJCQkJY2xlYXJJbnRlcnZhbChvdXRJbnRlcnZhbCk7DQoNCgkJCQkJCWlmKHR5cGVvZiBjYWxsYmFjayA9PT0gImZ1bmN0aW9uIikNCgkJCQkJCQljYWxsYmFjayhfdGhpcyk7DQoJCQkJCX0NCgkJCQl9LCBzcGVlZCAvIDUwKTsNCgkJCX0gZWxzZSB7DQoJCQkJaWYodHlwZW9mIGNhbGxiYWNrID09PSAiZnVuY3Rpb24iKQ0KCQkJCQljYWxsYmFjayhfdGhpcyk7DQoJCQl9DQoJCX07DQoJfQ0KDQoJKGFzeW5jIHByZWNhbGxiYWNrID0+IHsNCgkJY29uc3QgdGl0bGUgPSBkb2N1bWVudC50aXRsZTsNCgkJaWYodGl0bGUgIT09IHVuZGVmaW5lZCkNCgkJCWRvY3VtZW50LnRpdGxlID0gIkxvYWRpbmcuLi4iOw0KDQoJCWlmKHdpbmRvdy5qUXVlcnkpDQoJCQkkLmhvbGRSZWFkeSh0cnVlKTsNCg0KCQljb25zdCBjdXJyZW50U2NyaXB0ID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdCB8fCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJzY3JpcHRbc3JjKj1cIlNHTlVJS2l0LmxvYWRlci5qc1wiXSIpOw0KCQljb25zdCB1cmwgPSBjdXJyZW50U2NyaXB0LnNyYy5zcGxpdCgiLyIpLnNsaWNlKDAsIC0yKS5qb2luKCIvIikgKyAiLyI7DQoJCWNvbnN0IHByZWxvYWQgPSBbDQoJCQkvLyJqcy9pMThuL1NHTmkxOG4uanMiLA0KCQldOw0KDQoJCWNvbnN0IGZpbGVzdG9sb2FkID0gcHJlbG9hZC5sZW5ndGg7DQoJCWxldCBmaWxlc2xvYWRlZCA9IDAsIHByb2dyZXNzID0gMDsNCg0KCQlpZihmaWxlc3RvbG9hZCA+IDApIHsNCgkJCXByb2dyZXNzID0gMDsNCgkJCWZvcihsZXQgaSA9IDA7IGkgPCBmaWxlc3RvbG9hZDsgaSsrKSB7DQoJCQkJY29uc3QgY29tcG9uZW50ID0gcHJlbG9hZFtpXSwNCgkJCQkgICAgICBzcmMgICAgICAgPSB1cmwgKyBjb21wb25lbnQsDQoJCQkJICAgICAgbmFtZSAgICAgID0gJ2pzXycgKyBnZXRGaWxlbmFtZUFuZEV4dGVuc2lvbihjb21wb25lbnQpLm5hbWU7DQoJCQkJY29uc3Qgb2JqID0ge307DQoJCQkJb2JqW25hbWVdID0gY29tcG9uZW50Ow0KDQoJCQkJaWYoIVNHTlVJS2l0LmlzQ29tcG9uZW50TG9hZGVkKG5hbWUpKSB7DQoJCQkJCWNvbnN0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOw0KCQkJCQlzY3JpcHQuc3JjID0gc3JjOw0KCQkJCQlzY3JpcHQuYXN5bmMgPSBmYWxzZTsNCgkJCQkJc2NyaXB0LmRlZmVyID0gZmFsc2U7DQoJCQkJCWN1cnJlbnRTY3JpcHQuYWZ0ZXIoc2NyaXB0KTsNCgkJCQkJaWYoaSA9PT0gMCkNCgkJCQkJCXNjcmlwdC5pZCA9ICJzZ24tcHJlbG9hZC1lbmQiOw0KCQkJCQlzY3JpcHQub25sb2FkID0gZnVuY3Rpb24oKSB7DQoJCQkJCQlmaWxlc2xvYWRlZCsrOw0KCQkJCQkJU0dOVUlLaXQuY29tcG9uZW50ID0gb2JqOw0KCQkJCQkJc2NyaXB0Lm9ubG9hZCA9IG51bGw7DQoJCQkJCQlmaW5pc2hMb2FkKCk7DQoJCQkJCX07DQoJCQkJfSBlbHNlIHsNCgkJCQkJZmlsZXNsb2FkZWQrKzsNCgkJCQkJYXdhaXQgZmluaXNoTG9hZCgpOw0KCQkJCX0NCgkJCX0NCgkJfSBlbHNlIHsNCgkJCXByb2dyZXNzID0gMTAwOw0KCQkJZmlsZXNsb2FkZWQrKzsNCgkJCWZpbmlzaExvYWQoKTsNCgkJfQ0KDQoJCWFzeW5jIGZ1bmN0aW9uIGZpbmlzaExvYWQoKSB7DQoJCQlpZihmaWxlc3RvbG9hZCA+IDApIHsNCgkJCQlwcm9ncmVzcyA9IE1hdGgucm91bmQoKGZpbGVzbG9hZGVkICogMTAwKSAvIGZpbGVzdG9sb2FkKTsNCg0KCQkJCWF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gew0KCQkJCQlpZihmaWxlc2xvYWRlZCA+PSBmaWxlc3RvbG9hZCkgew0KCQkJCQkJcmVzb2x2ZSgpOw0KCQkJCQl9DQoJCQkJfSkudGhlbihmdW5jdGlvbigpIHsNCgkJCQkJJCgiaGVhZCA+IHRpdGxlIikudGV4dCh0aXRsZSk7DQoJCQkJCWlmKHR5cGVvZiBwcmVjYWxsYmFjayA9PT0gImZ1bmN0aW9uIiAmJiBwcm9ncmVzcyA9PT0gMTAwKQ0KCQkJCQkJcHJlY2FsbGJhY2soKTsNCgkJCQl9KTsNCgkJCX0gZWxzZSB7DQoJCQkJJCgiaGVhZCA+IHRpdGxlIikudGV4dCh0aXRsZSk7DQoJCQkJaWYodHlwZW9mIHByZWNhbGxiYWNrID09PSAiZnVuY3Rpb24iICYmIHByb2dyZXNzID09PSAxMDApDQoJCQkJCXByZWNhbGxiYWNrKCk7DQoJCQl9DQoJCX0NCg0KCQl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb2ZmbGluZScsIChlKSA9PiB7DQoJCQljb25zdCBnZXRJMThuU3RyaW5nID0gKGssIG0pID0+IG07DQoJCQkvL2lmKHR5cGVvZiBnZXRJMThuU3RyaW5nICE9PSAnZnVuY3Rpb24nKQ0KCQkJY29uc3QgJGJvZHkgPSAkKCdib2R5Jyk7DQoJCQlsZXQgb2ZmbGluZUVycm9yTXNnID0gKFNHTlVJS2l0LnJlYWR5KSA/IGdldEkxOG5TdHJpbmcoJ3Nnbl91aWtpdF9lcnJvcl91c2VyX29mZmxpbmVfbXNnJywgYFNvcnJ5ISBZb3UgYXJlIGN1cnJlbnRseSBvZmZsaW5lLiBZb3UnbGwgYmUgYWJsZSB0byBhY2Nlc3MgdGhlIGFwcGxpY2F0aW9uIG9uY2UgeW91ciBpbnRlcm5ldCBjb25uZWN0aW9uIGlzIHJlc3RvcmVkLmApIDogZ2V0STE4blN0cmluZygnc2duX3Vpa2l0X3VzZXJfb2ZmbGluZV9sb2FkaW5nX2ludGVycnVwdGVkX21zZycsIGBTb3JyeSEgSW5pdGlhbCBsb2FkaW5nIGlzIGludGVycnVwdGVkLiBUaGUgYXBwbGljYXRpb24gd2lsbCBjb250aW51ZSB0byBsb2FkIG9uY2UgeW91ciBpbnRlcm5ldCBjb25uZWN0aW9uIGlzIHJlc3RvcmVkLmApOw0KCQkJaWYocHJvZ3Jlc3MgPCAxMDApDQoJCQkJb2ZmbGluZUVycm9yTXNnID0gZ2V0STE4blN0cmluZygnc2duX3Vpa2l0X3VzZXJfb2ZmbGluZV9wcmVsb2FkX2ZhaWxlZF9tc2cnLCBgSG9vcmF5ISBZb3VyIGludGVybmV0IGNvbm5lY3Rpb24gaXMgcmVzdG9yZWQsIGJ1dCBpdCBoYXMgYnJva2VuIHRoZSBhcHBsaWNhdGlvbidzIHByZWxvYWQgcHJvY2VzcywgcGxlYXNlIHJlbG9hZCB0aGUgcGFnZSB0byBmaXggaXQuYCk7DQoJCQljb25zdCBvZmZsaW5lRXJyb3JIZWFkaW5nID0gZ2V0STE4blN0cmluZygndHh0X25vX2ludGVybmV0JywgYE5vIEludGVybmV0IWApOw0KDQoJCQlsZXQgb3ZlcmxheUVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCgkJCW92ZXJsYXlFbGVtLmNsYXNzTmFtZSA9ICJvdmVybGF5IGJsYWNrb3V0IjsNCgkJCWxldCBwcmVsb2FkZXIgPSBgXHRcdDxkaXYgY2xhc3M9Im9mZmxpbmUtbXNnIj5cbmA7DQoJCQlwcmVsb2FkZXIgKz0gYFx0XHRcdDxoMiBjbGFzcz0idGl0bGUgZXJyb3IiPiR7b2ZmbGluZUVycm9ySGVhZGluZ308L2gyPlxuYDsNCgkJCXByZWxvYWRlciArPSBgXHRcdFx0PGRpdiBjbGFzcz0ibXNnIj4ke29mZmxpbmVFcnJvck1zZ308L2Rpdj5cbmA7DQoJCQlwcmVsb2FkZXIgKz0gYFx0XHQ8L2Rpdj5cbmA7DQoNCgkJCW92ZXJsYXlFbGVtLmlubmVySFRNTCA9IHByZWxvYWRlcjsNCgkJCSQoJy5zZ24tcHJlbG9hZGVyJykuZmFkZU91dCgxMDAwKTsNCgkJCSRib2R5LnJlbW92ZUNsYXNzKCdoYXMtcHJlbG9hZGVyJykuYWRkQ2xhc3MoJ3VzZXItb2ZmbGluZScpOw0KCQkJZG9jdW1lbnQuYm9keS5pbnNlcnRCZWZvcmUob3ZlcmxheUVsZW0sIGRvY3VtZW50LmJvZHkuZmlyc3RDaGlsZCk7DQoNCgkJCS8vb3ZlcmxheUVsZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuc2duLXByZWxvYWRlciIpOw0KCQkJb3ZlcmxheUVsZW0gPSAkKCIudXNlci1vZmZsaW5lID4gLm92ZXJsYXkiKTsNCg0KCQkJaWYob3ZlcmxheUVsZW0ubGVuZ3RoID4gMCkgew0KCQkJCW92ZXJsYXlFbGVtLmZhZGVJbigxMDAwKTsNCgkJCX0NCgkJfSk7DQoJCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvbmxpbmUnLCAoZSkgPT4gew0KCQkJY29uc3QgZ2V0STE4blN0cmluZyA9IChrLCBtKSA9PiBtOw0KCQkJLy9pZih0eXBlb2YgZ2V0STE4blN0cmluZyAhPT0gJ2Z1bmN0aW9uJykNCgkJCWxldCBvbmxpbmVNc2cgPSAoU0dOVUlLaXQucmVhZHkpID8gZ2V0STE4blN0cmluZygnc2duX3Vpa2l0X3VzZXJfb25saW5lX21zZycsIGBIb29yYXkhIFlvdXIgaW50ZXJuZXQgY29ubmVjdGlvbiBpcyByZXN0b3JlZCwgeW91J2xsIG5vdyBiZSBhYmxlIHRvIGFjY2VzcyB0aGUgYXBwbGljYXRpb24gc2hvcnRseS5gKSA6IGdldEkxOG5TdHJpbmcoJ3Nnbl91aWtpdF91c2VyX29ubGluZV9sb2FkaW5nX2ludGVycnVwdGVkX21zZycsIGBIb29yYXkhIFlvdXIgaW50ZXJuZXQgY29ubmVjdGlvbiBpcyByZXN0b3JlZCwgdGhlIGFwcGxpY2F0aW9uIHdpbGwgcmVzdW1lIHRvIGxvYWQgc2hvcnRseS5gKTsNCgkJCWlmKHByb2dyZXNzIDwgMTAwKQ0KCQkJCW9ubGluZU1zZyA9IGdldEkxOG5TdHJpbmcoJ3Nnbl91aWtpdF91c2VyX29ubGluZV9wcmVsb2FkX2ZhaWxlZF9tc2cnLCBgSG9vcmF5ISBZb3VyIGludGVybmV0IGNvbm5lY3Rpb24gaXMgcmVzdG9yZWQsIGJ1dCBpdCBoYXMgYnJva2VuIHRoZSBhcHBsaWNhdGlvbidzIHByZWxvYWQgcHJvY2VzcywgcGxlYXNlIHJlbG9hZCB0aGUgcGFnZSB0byBmaXggaXQuYCk7DQoJCQljb25zdCBvbmxpbmVIZWFkaW5nID0gZ2V0STE4blN0cmluZygndHh0X2ludGVybmV0X2Nvbm5lY3Rpb25fcmVzdG9yZWQnLCBgSW50ZXJuZXQgQ29ubmVjdGlvbiBSZXN0b3JlZCFgKTsNCg0KCQkJLy9jb25zdCBvdmVybGF5RWxlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5vdmVybGF5Iik7DQoJCQljb25zdCAkb3ZlcmxheUVsZW0gPSAkKCIudXNlci1vZmZsaW5lID4gLm92ZXJsYXkiKTsNCgkJCWNvbnN0ICRoZWFkaW5nID0gJG92ZXJsYXlFbGVtLmZpbmQoJy50aXRsZScpLA0KCQkJICAgICAgJG1zZyAgICAgPSAkb3ZlcmxheUVsZW0uZmluZCgnLm1zZycpOw0KCQkJbGV0IE1TR19USU1FT1VUID0gMTAwMDA7DQoJCQlpZih0eXBlb2YgJC5TR05TbmFja2JhciA9PT0gJ2Z1bmN0aW9uJykgew0KCQkJCU1TR19USU1FT1VUID0gNTA7DQoJCQkJJC5TR05TbmFja2JhcihvbmxpbmVNc2cpLnNob3coKTsNCgkJCX0gZWxzZSB7DQoJCQkJJGhlYWRpbmcuaHRtbChvbmxpbmVIZWFkaW5nKS5yZW1vdmVDbGFzcygnZXJyb3InKS5hZGRDbGFzcygnc3VjY2VzcycpOw0KCQkJCSRtc2cuaHRtbChvbmxpbmVNc2cpOw0KCQkJfQ0KDQoJCQlpZigkb3ZlcmxheUVsZW0ubGVuZ3RoID4gMCkgew0KCQkJCXNldFRpbWVvdXQoKCkgPT4gew0KCQkJCQkkKCcuc2duLXByZWxvYWRlcicpLmZhZGVJbigxMDAwKTsNCgkJCQkJJG92ZXJsYXlFbGVtLmZhZGVPdXQoMTAwMCwgKCkgPT4gew0KCQkJCQkJJG92ZXJsYXlFbGVtLnJlbW92ZSgpOw0KCQkJCQkJZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCJ1c2VyLW9mZmxpbmUiKTsNCgkJCQkJCSQoJ2JvZHknKS5hZGRDbGFzcygnaGFzLXByZWxvYWRlcicpOw0KCQkJCQl9KTsNCgkJCQl9LCBNU0dfVElNRU9VVCk7DQoJCQl9DQoNCgkJCWlmKHR5cGVvZiBwcmVjYWxsYmFjayA9PT0gImZ1bmN0aW9uIiAmJiBwcm9ncmVzcyA9PT0gMTAwKQ0KCQkJCXByZWNhbGxiYWNrKCk7DQoJCX0pOw0KCX0pKGZ1bmN0aW9uKCkgew0KCQkoYXN5bmMgY2FsbGJhY2sgPT4gew0KCQkJY29uc3Qgc2dudWlraXRTY3JpcHQgPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0IHx8IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInNjcmlwdFtzcmMqPVwiU0dOVUlLaXQubG9hZGVyLmpzXCJdIik7DQoJCQljb25zdCBjdXJyZW50U2NyaXB0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNnbi1wcmVsb2FkLWVuZCIpIHx8IHNnbnVpa2l0U2NyaXB0Ow0KDQoJCQlmdW5jdGlvbiBnZXRTY3JpcHRVUkwoKSB7DQoJCQkJcmV0dXJuIHNnbnVpa2l0U2NyaXB0LnNyYzsNCgkJCX0NCg0KCQkJY29uc3QgdXJsID0gZ2V0U2NyaXB0VVJMKCkuc3BsaXQoIi8iKS5zbGljZSgwLCAtMikuam9pbigiLyIpICsgIi8iOw0KDQoJCQljb25zdCBzY3JpcHRzID0gWw0KCQkJCSJqcy9TR05VSUtpdC5idW5kbGUuanMiLA0KCQkJXTsNCgkJCWNvbnN0IHN0eWxlcyA9IFsNCgkJCQkiY3NzL1NHTlVJS2l0LmJ1bmRsZS5jc3MiLA0KCQkJXTsNCg0KCQkJbGV0IHNjcmlwdHNMb2FkZWQgPSAwLCBzdHlsZXNMb2FkZWQgPSAwLCBsb2FkZWQgPSAwLA0KCQkJICAgIGxhc3RTY3JpcHQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPSBjdXJyZW50U2NyaXB0Ow0KCQkJY29uc3QgdG90YWxTY3JpcHRzID0gc2NyaXB0cy5sZW5ndGgsIHRvdGFsU3R5bGVzID0gc3R5bGVzLmxlbmd0aCwgdG90YWwgPSB0b3RhbFNjcmlwdHMgKyB0b3RhbFN0eWxlczsNCg0KCQkJY29uc3QgbG9hZFNjcmlwdCA9IGkgPT4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KCQkJCWlmKGkgPT09IHNjcmlwdHMubGVuZ3RoKSByZXR1cm47DQoNCgkJCQljb25zdCBjb21wb25lbnQgPSBzY3JpcHRzW2ldLA0KCQkJCSAgICAgIHNyYyAgICAgICA9IHVybCArIGNvbXBvbmVudCwNCgkJCQkgICAgICBuYW1lICAgICAgPSAnanNfJyArIGdldEZpbGVuYW1lQW5kRXh0ZW5zaW9uKGNvbXBvbmVudCkubmFtZTsNCgkJCQljb25zdCBvYmogPSB7fTsNCgkJCQlvYmpbbmFtZV0gPSBjb21wb25lbnQ7DQoNCgkJCQlpZighU0dOVUlLaXQuaXNDb21wb25lbnRMb2FkZWQobmFtZSkpIHsNCgkJCQkJY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7DQoJCQkJCS8vc2NyaXB0LnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JzsNCgkJCQkJc2NyaXB0LnNyYyA9IHNyYzsNCgkJCQkJbGFzdFNjcmlwdC5hZnRlcihzY3JpcHQpOw0KCQkJCQlsYXN0U2NyaXB0ID0gbGFzdFNjcmlwdC5uZXh0RWxlbWVudFNpYmxpbmcgfHwgY3VycmVudFNjcmlwdDsNCg0KCQkJCQlzY3JpcHQub25sb2FkID0gYXN5bmMgZnVuY3Rpb24oKSB7DQoJCQkJCQlTR05VSUtpdC5jb21wb25lbnQgPSBvYmo7DQoJCQkJCQlzY3JpcHQub25sb2FkID0gbnVsbDsNCgkJCQkJCXNjcmlwdHNMb2FkZWQrKzsNCgkJCQkJCWxvYWRlZCsrOw0KDQoJCQkJCQlpZihzY3JpcHRzTG9hZGVkID09PSB0b3RhbFNjcmlwdHMpDQoJCQkJCQkJcmVzb2x2ZShpKTsNCgkJCQkJCWVsc2UNCgkJCQkJCQlyZXNvbHZlKGxvYWRTY3JpcHQoKytpKSk7DQoJCQkJCX07DQoJCQkJfSBlbHNlIHsNCgkJCQkJc2NyaXB0c0xvYWRlZCsrOw0KCQkJCQlsb2FkZWQrKzsNCg0KCQkJCQlpZihzY3JpcHRzTG9hZGVkID09PSB0b3RhbFNjcmlwdHMpDQoJCQkJCQlyZXNvbHZlKGkpOw0KCQkJCQllbHNlDQoJCQkJCQlyZXNvbHZlKGxvYWRTY3JpcHQoKytpKSk7DQoJCQkJfQ0KCQkJfSk7DQoNCgkJCWNvbnN0IGxvYWRTdHlsZSA9IGkgPT4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KCQkJCWlmKGkgPT09IHN0eWxlcy5sZW5ndGgpIHJldHVybjsNCg0KCQkJCWNvbnN0IGNvbXBvbmVudCA9IHN0eWxlc1tpXSwNCgkJCQkgICAgICBzcmMgICAgICAgPSB1cmwgKyBjb21wb25lbnQsDQoJCQkJICAgICAgbmFtZSAgICAgID0gJ2Nzc18nICsgZ2V0RmlsZW5hbWVBbmRFeHRlbnNpb24oY29tcG9uZW50KS5uYW1lOw0KCQkJCWNvbnN0IG9iaiA9IHt9Ow0KCQkJCW9ialtuYW1lXSA9IGNvbXBvbmVudDsNCg0KCQkJCWlmKCFTR05VSUtpdC5pc0NvbXBvbmVudExvYWRlZChuYW1lKSkgew0KCQkJCQljb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxpbmsiKTsNCgkJCQkJc3R5bGUucmVsID0gInN0eWxlc2hlZXQiOw0KCQkJCQlzdHlsZS5ocmVmID0gc3JjOw0KCQkJCQkvL3N0eWxlLnR5cGUgPSAndGV4dC9jc3MnOw0KCQkJCQljdXJyZW50U2NyaXB0LmFmdGVyKHN0eWxlKTsNCgkJCQkJc3R5bGUub25sb2FkID0gYXN5bmMgZnVuY3Rpb24oKSB7DQoJCQkJCQlTR05VSUtpdC5jb21wb25lbnQgPSBvYmo7DQoJCQkJCQlzdHlsZS5vbmxvYWQgPSBudWxsOw0KCQkJCQkJc3R5bGVzTG9hZGVkKys7DQoJCQkJCQlsb2FkZWQrKzsNCg0KCQkJCQkJaWYoc3R5bGVzTG9hZGVkID09PSB0b3RhbFN0eWxlcykNCgkJCQkJCQlyZXNvbHZlKGkpOw0KCQkJCQkJZWxzZQ0KCQkJCQkJCXJlc29sdmUobG9hZFN0eWxlKCsraSkpOw0KCQkJCQl9Ow0KCQkJCX0gZWxzZSB7DQoJCQkJCXN0eWxlc0xvYWRlZCsrOw0KCQkJCQlsb2FkZWQrKzsNCg0KCQkJCQlpZihzdHlsZXNMb2FkZWQgPT09IHRvdGFsU3R5bGVzKQ0KCQkJCQkJcmVzb2x2ZShpKTsNCgkJCQkJZWxzZQ0KCQkJCQkJcmVzb2x2ZShsb2FkU3R5bGUoKytpKSk7DQoJCQkJfQ0KCQkJfSk7DQoNCgkJCSgoKSA9PiB7DQoJCQkJY29uc3Qgc3RhcnRMb2FkID0gbmV3IFByb21pc2UoYXN5bmMgZnVuY3Rpb24ocmVzb2x2ZSkgew0KCQkJCQlhd2FpdCBsb2FkU3R5bGUoMCk7DQoJCQkJCWF3YWl0IGxvYWRTY3JpcHQoMCk7DQoJCQkJCWlmKGxvYWRlZCA9PT0gdG90YWwpDQoJCQkJCQlyZXNvbHZlKCk7DQoJCQkJfSk7DQoNCgkJCQlzdGFydExvYWQudGhlbigoKSA9PiB7DQoJCQkJCWZpbmlzaExvYWQoKTsNCgkJCQl9KTsNCgkJCX0pKCk7DQoNCgkJCWFzeW5jIGZ1bmN0aW9uIGZpbmlzaExvYWQoKSB7DQoJCQkJY29uc3QgcHJvZ3Jlc3MgPSBNYXRoLnJvdW5kKChsb2FkZWQgKiAxMDApIC8gdG90YWwpOw0KDQoJCQkJYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7DQoJCQkJCWlmKGxvYWRlZCA9PT0gdG90YWwpIHsNCgkJCQkJCXJlc29sdmUoKTsNCgkJCQkJfQ0KCQkJCX0pLnRoZW4oZnVuY3Rpb24oKSB7DQoJCQkJCWlmKHR5cGVvZiBjYWxsYmFjayA9PT0gImZ1bmN0aW9uIikNCgkJCQkJCWNhbGxiYWNrKGxvYWRlZCwgdG90YWwsIHByb2dyZXNzKTsNCgkJCQl9KTsNCgkJCX0NCgkJfSkoKGxvYWRlZCwgdG90YWwsIHByb2dyZXNzKSA9PiB7DQoJCQlpZihwcm9ncmVzcyA9PT0gMTAwKSB7DQoJCQkJU0dOVUlLaXQuaW5pdCA9IHRydWU7DQoNCgkJCQljb25zdCBzdHlsZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJzdHlsZSNzZ24tdWlraXQtc3R5bGVzIik7DQoJCQkJY29uc3QgbGVmdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInN0eWxlW2RhdGEtY2tlPVwidHJ1ZVwiXSIpOw0KCQkJCWlmKGxlZnQgIT09IG51bGwpDQoJCQkJCWxlZnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChsZWZ0KTsNCgkJCQlpZihzdHlsZXMgIT09IG51bGwpDQoJCQkJCXN0eWxlcy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHN0eWxlcyk7DQoNCgkJCQkkLmhvbGRSZWFkeShmYWxzZSk7DQoJCQkJalF1ZXJ5LnJlYWR5KCk7DQoJCQl9DQoJCX0pOw0KCX0pOw0KDQoJKCgpID0+IHsNCgkJY29uc3QgZmluYWxpemUgPSAoaG9sZFByZWxvYWRlciA9IGZhbHNlKSA9PiB7DQoJCQljb25zdCAkYm9keSA9ICQoImJvZHkiKTsNCg0KCQkJLyoqKg0KCQkJICoNCgkJCSAqIEB0eXBlIHtPYmplY3Q8U0dOQXRvbT59DQoJCQkgKi8NCgkJCWNvbnN0IHNnbmF0b21zID0gU0dOQXRvbS5nZXRJbnN0YW5jZSgpOw0KDQoJCQlzZ25hdG9tcy5zZXRPbkNyZWF0ZUxpc3RlbmVyKChzZ25hdG9tcykgPT4gew0KCQkJCWlmKHNnbmF0b21zLmxlbmd0aCA+IDApIHsNCgkJCQkJZm9yKGNvbnN0IGd1aWQgaW4gc2duYXRvbXMpIHsNCgkJCQkJCWNvbnN0IHNnbmF0b20gPSBzZ25hdG9tc1tndWlkXTsNCg0KCQkJCQkJaWYoc2duYXRvbSBpbnN0YW5jZW9mIFNHTkF0b20pIHsNCgkJCQkJCQlzZ25hdG9tLlNHTkF0b21TdGF0ZXMuc2V0T25SZWFkeUxpc3RlbmVyKChpc1JlYWR5KSA9PiB7DQoJCQkJCQkJCWlmKGlzUmVhZHkpIHsNCgkJCQkJCQkJCWNvbnN0IG5hdmlnYXRvciA9IHNnbmF0b20uY29yZS5uYXZpZ2F0b3I7DQoJCQkJCQkJCQluYXZpZ2F0b3Iuc2V0T25QYWdlTG9hZExpc3RlbmVyKCh1cmwsIGNvZGUpID0+IHsNCgkJCQkJCQkJCQlpZihjb2RlID09PSAyMDAgfHwgY29kZSA9PT0gMjAxIHx8IGNvZGUgPT09IDIwMikgew0KCQkJCQkJCQkJCQlTR05VSUtpdC5yZWFkeSA9IHRydWU7DQoJCQkJCQkJCQkJCVNVS1JJbnN0YW5jZXMuc2V0T25DcmVhdGVMaXN0ZW5lcigoaW5zdGFuY2VzKSA9PiB7DQoJCQkJCQkJCQkJCQlmb3JFYWNoKGluc3RhbmNlcywgaW5zdCA9PiBpbnN0LnRyaWdnZXIoKSk7DQoJCQkJCQkJCQkJCX0pOw0KDQoJCQkJCQkJCQkJCWlmKCFob2xkUHJlbG9hZGVyKSB7DQoJCQkJCQkJCQkJCQkkYm9keS5jaGlsZHJlbigiLnNnbi1wcmVsb2FkZXIiKS5mYWRlT3V0KDIwMDAsIGZ1bmN0aW9uKCkgew0KCQkJCQkJCQkJCQkJCSRib2R5LmNoaWxkcmVuKCIuc2duLXByZWxvYWRlciIpLnJlbW92ZSgpOw0KCQkJCQkJCQkJCQkJCSRib2R5LnJlbW92ZUNsYXNzKCJoYXMtcHJlbG9hZGVyIik7DQoJCQkJCQkJCQkJCQl9KTsNCgkJCQkJCQkJCQkJfQ0KCQkJCQkJCQkJCX0NCgkJCQkJCQkJCX0pOw0KCQkJCQkJCQl9DQoJCQkJCQkJfSk7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9IGVsc2Ugew0KCQkJCQlTVUtSSW5zdGFuY2VzLnNldE9uQ2hhbmdlTGlzdGVuZXIoKGluc3RhbmNlLCBpbnN0YW5jZXMpID0+IHsNCgkJCQkJCS8vY29uc29sZS5sb2coaW5zdGFuY2VzKTsNCgkJCQkJCWZvckVhY2goaW5zdGFuY2VzLCBpbnN0ID0+IHsNCgkJCQkJCQlpbnN0LnRyaWdnZXIoKTsNCgkJCQkJCX0pOw0KCQkJCQl9KTsNCgkJCQkJd2luZG93LlNHTlVJS2l0UmVhZHkgPSB0cnVlOw0KCQkJCQlTR05VSUtpdC5yZWFkeSA9IHRydWU7DQoJCQkJCWlmKFNHTlVJS2l0LnJlYWR5KSB7DQoJCQkJCQlpZighaG9sZFByZWxvYWRlcikgew0KCQkJCQkJCSRib2R5LmNoaWxkcmVuKCIuc2duLXByZWxvYWRlciIpLmZhZGVPdXQoMjAwMCwgZnVuY3Rpb24oKSB7DQoJCQkJCQkJCSRib2R5LmNoaWxkcmVuKCIuc2duLXByZWxvYWRlciIpLnJlbW92ZSgpOw0KCQkJCQkJCQkkYm9keS5yZW1vdmVDbGFzcygiaGFzLXByZWxvYWRlciIpOw0KCQkJCQkJCX0pOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfQ0KCQkJfSk7DQoJCX0NCg0KCQlTR05VSUtpdC5zZXRPbkNoYW5nZUxpc3RlbmVyKChwcm9wLCB2YWx1ZSkgPT4gew0KCQkJaWYocHJvcCA9PT0gJ2hvbGRQcmVsb2FkZXInKSB7DQoJCQkJaWYoU0dOVUlLaXQuaW5pdCAmJiAhdmFsdWUpIHsNCgkJCQkJZmluYWxpemUodHJ1ZSk7DQoJCQkJfQ0KCQkJfSBlbHNlIHsNCgkJCQlpZihwcm9wID09PSAnaW5pdCcgJiYgdmFsdWUpIHsNCgkJCQkJZmluYWxpemUoZmFsc2UpOw0KCQkJCX0NCgkJCX0NCgkJfSwgJ3Nnbi11ay1wcm9wLWNoYW5nZS1saXN0ZW5lcicpOw0KCX0pKCk7DQp9KTsNCg0KDQphc3luYyBmdW5jdGlvbiBnZXRTR05JMThuSW5zdGFuY2UoY2FsbGJhY2spIHsNCglyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KCQljb25zdCB0aW1lb3V0SGFuZGxlciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQoJCQlpZihjaGVja0ludGVydmFsSGFuZGxlcikNCgkJCQljbGVhckludGVydmFsKGNoZWNrSW50ZXJ2YWxIYW5kbGVyKTsNCgkJfSwgMTAwMDApOw0KDQoJCWNvbnN0IGNoZWNrSW50ZXJ2YWxIYW5kbGVyID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7DQoJCQlpZih3aW5kb3cuU0dOVUlLaXRSZWFkeSkgew0KCQkJCWlmKHRpbWVvdXRIYW5kbGVyKQ0KCQkJCQljbGVhclRpbWVvdXQodGltZW91dEhhbmRsZXIpOw0KCQkJCWNsZWFySW50ZXJ2YWwoY2hlY2tJbnRlcnZhbEhhbmRsZXIpOw0KCQkJCWNvbnN0IGMgPSBuZXcgU0dOaTE4bigpOw0KDQoJCQkJLyppZih0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpDQoJCQkJIGNhbGxiYWNrKGMpOyovDQoJCQkJcmVzb2x2ZShjKTsNCgkJCX0NCgkJfSwgMTAwKTsNCgl9KTsNCn0NCg0K";

module.exports = {
	args, SGNUIKitLoader, version, cdn_dir,
};
