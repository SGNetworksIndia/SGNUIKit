/*
 * Copyright (c) 2022-2023 SGNetworks. All rights reserved.
 *
 * The software is an exclusive copyright of "SGNetworks" and is provided as is exclusively with only "USAGE" access. "Modification",  "Alteration", "Re-distribution" is completely prohibited.
 * VIOLATING THE ABOVE TERMS IS A PUNISHABLE OFFENSE WHICH MAY LEAD TO LEGAL CONSEQUENCES.
 */

const SGNUIKitLoader = "LyoNCiAqIENvcHlyaWdodCAoYykgMjAyMi0yMDIzIFNHTmV0d29ya3MuIEFsbCByaWdodHMgcmVzZXJ2ZWQuDQogKg0KICogVGhlIHNvZnR3YXJlIGlzIGFuIGV4Y2x1c2l2ZSBjb3B5cmlnaHQgb2YgIlNHTmV0d29ya3MiIGFuZCBpcyBwcm92aWRlZCBhcyBpcyBleGNsdXNpdmVseSB3aXRoIG9ubHkgIlVTQUdFIiBhY2Nlc3MuICJNb2RpZmljYXRpb24iLCAgIkFsdGVyYXRpb24iLCAiUmUtZGlzdHJpYnV0aW9uIiBpcyBjb21wbGV0ZWx5IHByb2hpYml0ZWQuDQogKiBWSU9MQVRJTkcgVEhFIEFCT1ZFIFRFUk1TIElTIEEgUFVOSVNIQUJMRSBPRkZFTlNFIFdISUNIIE1BWSBMRUFEIFRPIExFR0FMIENPTlNFUVVFTkNFUy4NCiAqLw0KDQovLyBAdHMtbm9jaGVjaw0KY29uc3Qgcm9vdCA9ICh0eXBlb2YgZ2xvYmFsICE9PSAidW5kZWZpbmVkIikgPyBnbG9iYWwgOiB3aW5kb3cgfHwgc2VsZjsNCi8vRkFIRVJFDQoNCi8qKg0KICogUGVyZm9ybXMgdGhlIHNwZWNpZmllZCBhY3Rpb24gZm9yIGVhY2ggZWxlbWVudCBpbiBhbiBvYmplY3QuDQogKg0KICogQHBhcmFtIHtPYmplY3R9IG9iag0KICogQHBhcmFtIHsodmFsdWU6YW55LCBrZXk6c3RyaW5nKT0+dm9pZH0gY2FsbGJhY2sgQSBmdW5jdGlvbiB0aGF0IGFjY2VwdHMgdXAgdG8gdGhyZWUgYXJndW1lbnRzLiBmb3JFYWNoIGNhbGxzIHRoZSA8Yj48aT5jYWxsYmFjazwvaT48L2I+IGZ1bmN0aW9uIG9uZSB0aW1lIGZvciBlYWNoIGVsZW1lbnQgaW4gdGhlIG9iamVjdC4NCiAqLw0KY29uc3QgZm9yRWFjaCA9IChvYmosIGNhbGxiYWNrKSA9PiB7DQoJbGV0IHZhbHVlOw0KCS8vY29udGV4dCA9IGNvbnRleHQgfHwgdGhpczsgIC8vYXBwbHkgdGhlIGZ1bmN0aW9uIHRvICd0aGlzJyBieSBkZWZhdWx0DQoNCglmb3IoY29uc3Qga2V5IGluIG9iaikgew0KCQlpZihrZXkgIT09ICJsZW5ndGgiICYmIG9iai5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7ICAvL3RvIHJ1bGUgb3V0IGluaGVyaXRlZCBwcm9wZXJ0aWVzDQoJCQl2YWx1ZSA9IG9ialtrZXldOw0KCQkJaWYodHlwZW9mIGNhbGxiYWNrID09PSAiZnVuY3Rpb24iKSBjYWxsYmFjayh2YWx1ZSwga2V5KTsNCgkJfQ0KCX0NCn07DQoNCi8qKg0KICogQXBwZW5kcyBuZXcgZWxlbWVudHMgdG8gdGhlIGVuZCBvZiBhbiBvYmplY3QsIGFuZCByZXR1cm5zIHRoZSBuZXcgbGVuZ3RoIG9mIHRoZSBvYmplY3QuDQogKiBAcGFyYW0ge09iamVjdH0gb2JqDQogKiBAcGFyYW0gey4uLmFueX0gaXRlbXMgTmV3IGVsZW1lbnRzIHRvIGFkZCB0byB0aGUgb2JqZWN0Lg0KICovDQpjb25zdCBwdXNoID0gKG9iaiwgLi4uaXRlbXMpID0+IHsNCglsZXQgayA9IG9iai5sZW5ndGggfHwgMDsNCg0KCWl0ZW1zLmZvckVhY2goKHZhbHVlKSA9PiB7DQoJCW9ialtrXSA9IHZhbHVlOw0KCQlrKys7DQoJCW9iai5sZW5ndGggPSBrOw0KCX0pOw0KfTsNCg0KY29uc3QgU0dOVUlLaXQgPSB7DQoJaXNSZWFkeTogZmFsc2UsIGlzSW5pdDogZmFsc2UsIGlzUHJlbG9hZGVySGVsZDogZmFsc2UsIGlzUmVhZHlIZWxkOiBmYWxzZSwgY29uZmlnczogew0KCQkidXJscyI6IHsNCgkJCSJhcGkiOiB7DQoJCQkJImdlb25hbWVzIjogImh0dHBzOi8vc2VjdXJlLmdlb25hbWVzLm9yZy8iLCAib3NtIjogImh0dHBzOi8vbm9taW5hdGltLm9wZW5zdHJlZXRtYXAub3JnLyINCgkJCX0sDQoJCX0sICJhcGkiOiB7DQoJCQkiZ2VvbmFtZXMiOiAiIiAvL3VzZXJuYW1lDQoJCX0sICJnZW9jb2RpbmciOiB7DQoJCQkiZGVmYXVsdEFQSSI6ICJvc20iDQoJCX0sDQoJCSJpMThuIjogbnVsbA0KCX0sIGNvbXBvbmVudHM6IHt9LCBvbkNoYW5nZUxpc3RlbmVyOiB7fSwgb25Jbml0TGlzdGVuZXI6IHt9LCBvblJlYWR5TGlzdGVuZXI6IHt9LA0KCWNhbGxDb3VudHM6IHsNCgkJImluaXQiOiAwLCAicmVhZHkiOiAwLCAiY2hhbmdlIjogMCwgImNvbmZpZyI6IDAsICJjb21wb25lbnQiOiAwLCAiaG9sZFByZWxvYWRlciI6IDAsICJob2xkUmVhZHkiOiAwDQoJfSwNCglwZW5kaW5nRXZlbnRzOiB7DQoJCSJvbkluaXQiOiAwLCAib25SZWFkeSI6IDAsICJvbkNoYW5nZSI6IDANCgl9LA0KDQoJLyoqDQoJICogVGhpcyBjYWxsYmFjayBpcyBjYWxsZWQgd2hlbiBhIGNvbXBvbmVudCBpcyBsb2FkZWQvcmVtb3ZlZCBvciB0aGUgc3RhdHVzIG9mIHJlYWRpbmVzcyBpcyBjaGFuZ2VkLg0KCSAqDQoJICogQGNhbGxiYWNrIFNHTlVJS2l0Q2hhbmdlQ2FsbGJhY2sNCgkgKiBAcGFyYW0ge3N0cmluZ30gc3RhdGUgVGhlIG5hbWUgb2YgdGhlIHN0YXRlIHdoaWNoIGlzIGNoYW5nZWQuDQoJICogQHBhcmFtIHtib29sZWFufEpTT059IHZhbHVlIFRoZSB2YWx1ZSBvZiB0aGUgc3RhdGUgd2hpY2ggaXMgY2hhbmdlZC4NCgkgKiBAcGFyYW0ge0pTT059IGNvbXBvbmVudHMgVGhlIDxiPjxpPkpTT048L2k+PC9iPiBvYmplY3Qgb2YgbG9hZGVkIDxiPlNHTlVJS2l0PC9iPiBjb21wb25lbnRzLCBvciBhbiBlbXB0eSA8Yj48aT5KU09OPC9pPjwvYj4gb2JqZWN0IGlmIG5vIGNvbXBvbmVudHMgbG9hZGVkLg0KCSAqLw0KCS8qKg0KCSAqIFRoaXMgY2FsbGJhY2sgaXMgY2FsbGVkIHdoZW4gPGI+U0dOVUlLaXQ8L2I+IGlzIHJlYWR5Lg0KCSAqDQoJICogQGNhbGxiYWNrIFNHTlVJS2l0UmVhZHlDYWxsYmFjaw0KCSAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNSZWFkeSB0aGUgc3RhdHVzIG9mIHJlYWRpbmVzcyBvZiA8Yj5TR05VSUtpdDwvYj4uDQoJICovDQoNCgkvKioNCgkgKiBBZGQgYSBsb2FkZWQgPGI+U0dOVUlLaXQ8L2I+IGNvbXBvbmVudC4NCgkgKg0KCSAqIEBwYXJhbSB7e319IGNvbmZpZyBUaGUgPGI+PGk+SlNPTjwvaT48L2I+IG9iamVjdCBvZiB0aGUgPGI+U0dOVUlLaXQ8L2I+IGNvbmZpZ3VyYXRpb24gb3B0aW9ucy4NCgkgKi8NCglzZXQgY29uZmlnKGNvbmZpZykgew0KCQlpZihjb25maWcgIT09IHVuZGVmaW5lZCAmJiBjb25maWcgIT09IG51bGwgJiYgY29uZmlnICE9PSAiIikgew0KCQkJdGhpcy5jb25maWdzID0gKG5ldyBTR05VS0NvbmZpZ0luaXQoY29uZmlnKSkuY29uZmlnOw0KCQkJdGhpcy5jYWxsQ291bnRzLmNvbmZpZysrOw0KDQoJCQlmb3JFYWNoKHRoaXMub25DaGFuZ2VMaXN0ZW5lciwgKGxpc3RlbmVyKSA9PiB7DQoJCQkJdGhpcy5wZW5kaW5nRXZlbnRzLm9uQ2hhbmdlLS07DQoJCQkJdGhpcy5ldmVudENvbXBsZXRlID0gdGhpcy5wZW5kaW5nRXZlbnRzOw0KCQkJCWxpc3RlbmVyKCJjb25maWciLCBjb25maWcsIHRoaXMuY29uZmlncyk7DQoJCQl9KTsNCgkJfQ0KCX0sDQoNCgkvKioNCgkgKiBHZXQgdGhlIGxpc3Qgb2YgbG9hZGVkIDxiPlNHTlVJS2l0PC9iPiBjb21wb25lbnRzLg0KCSAqDQoJICogQHJldHVybiB7T2JqZWN0fSBUaGUgPGI+PGk+SlNPTjwvaT48L2I+IG9iamVjdCBvZiBsb2FkZWQgPGI+U0dOVUlLaXQ8L2I+IGNvbXBvbmVudHMsIG9yIGFuIGVtcHR5IDxiPjxpPkpTT048L2k+PC9iPiBvYmplY3QgaWYgbm8gY29tcG9uZW50cyBsb2FkZWQuDQoJICovDQoJZ2V0IGNvbmZpZygpIHsNCgkJcmV0dXJuIHRoaXMuY29uZmlnczsNCgl9LA0KDQoJLyoqDQoJICogQWRkIGEgbG9hZGVkIDxiPlNHTlVJS2l0PC9iPiBjb21wb25lbnQuDQoJICoNCgkgKiBAcGFyYW0ge3t9fSBjb25maWcgVGhlIDxiPjxpPkpTT048L2k+PC9iPiBvYmplY3Qgb2YgdGhlIDxiPlNHTlVJS2l0PC9iPiBjb25maWd1cmF0aW9uIG9wdGlvbnMuDQoJICovDQoJc2V0IGkxOG4oaTE4bikgew0KCQlpZihpMThuIGluc3RhbmNlb2YgU0dOaTE4bikgew0KCQkJdGhpcy5jb25maWdzLmkxOG4gPSBpMThuOw0KCQkJdGhpcy5jb25maWcgPSAobmV3IFNHTlVLQ29uZmlnSW5pdCh0aGlzLmNvbmZpZykpLmNvbmZpZzsNCgkJCXRoaXMuY2FsbENvdW50cy5jb25maWcrKzsNCg0KCQkJZm9yRWFjaCh0aGlzLm9uQ2hhbmdlTGlzdGVuZXIsIChsaXN0ZW5lcikgPT4gew0KCQkJCXRoaXMucGVuZGluZ0V2ZW50cy5vbkNoYW5nZS0tOw0KCQkJCXRoaXMuZXZlbnRDb21wbGV0ZSA9IHRoaXMucGVuZGluZ0V2ZW50czsNCgkJCQlsaXN0ZW5lcigiY29uZmlnIiwgaTE4biwgdGhpcy5jb25maWdzKTsNCgkJCX0pOw0KCQl9DQoJfSwNCg0KCS8qKg0KCSAqIEdldCB0aGUgbGlzdCBvZiBsb2FkZWQgPGI+U0dOVUlLaXQ8L2I+IGNvbXBvbmVudHMuDQoJICoNCgkgKiBAcmV0dXJuIHtPYmplY3R9IFRoZSA8Yj48aT5KU09OPC9pPjwvYj4gb2JqZWN0IG9mIGxvYWRlZCA8Yj5TR05VSUtpdDwvYj4gY29tcG9uZW50cywgb3IgYW4gZW1wdHkgPGI+PGk+SlNPTjwvaT48L2I+IG9iamVjdCBpZiBubyBjb21wb25lbnRzIGxvYWRlZC4NCgkgKi8NCglnZXQgaTE4bigpIHsNCgkJcmV0dXJuIHRoaXMuY29uZmlnLmkxOG47DQoJfSwNCg0KCS8qKg0KCSAqIEFkZCBhIGxvYWRlZCA8Yj5TR05VSUtpdDwvYj4gY29tcG9uZW50Lg0KCSAqDQoJICogQHBhcmFtIHt7fX0gdmFsdWUgVGhlIDxiPjxpPkpTT048L2k+PC9iPiBvYmplY3Qgb2YgdGhlIGxvYWRlZCA8Yj5TR05VSUtpdDwvYj4gY29tcG9uZW50Lg0KCSAqLw0KCXNldCBjb21wb25lbnQodmFsdWUpIHsNCgkJaWYodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gIiIpIHsNCgkJCU9iamVjdC5hc3NpZ24odGhpcy5jb21wb25lbnRzLCB2YWx1ZSk7DQoJCQl0aGlzLmNhbGxDb3VudHMuY29tcG9uZW50Kys7DQoNCgkJCWZvckVhY2godGhpcy5vbkNoYW5nZUxpc3RlbmVyLCAobGlzdGVuZXIpID0+IHsNCgkJCQl0aGlzLnBlbmRpbmdFdmVudHMub25DaGFuZ2UtLTsNCgkJCQkvL3RoaXMuZXZlbnRDb21wbGV0ZSA9IHRoaXMucGVuZGluZ0V2ZW50czsNCgkJCQlsaXN0ZW5lcigiY29tcG9uZW50cyIsIHZhbHVlLCB0aGlzLmNvbXBvbmVudHMpOw0KCQkJfSk7DQoJCX0NCgl9LA0KDQoJLyoqDQoJICogR2V0IHRoZSBsaXN0IG9mIGxvYWRlZCA8Yj5TR05VSUtpdDwvYj4gY29tcG9uZW50cy4NCgkgKg0KCSAqIEByZXR1cm4ge29iamVjdH0gVGhlIDxiPjxpPkpTT048L2k+PC9iPiBvYmplY3Qgb2YgbG9hZGVkIDxiPlNHTlVJS2l0PC9iPiBjb21wb25lbnRzLCBvciBhbiBlbXB0eSA8Yj48aT5KU09OPC9pPjwvYj4gb2JqZWN0IGlmIG5vIGNvbXBvbmVudHMgbG9hZGVkLg0KCSAqLw0KCWdldCBjb21wb25lbnQoKSB7DQoJCXJldHVybiB0aGlzLmNvbXBvbmVudHM7DQoJfSwNCg0KCS8qKg0KCSAqIENoZWNrIGlmIGEgPGI+U0dOVUlLaXQ8L2I+IGNvbXBvbmVudCBpcyBsb2FkZWQuDQoJICoNCgkgKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ9IGlkIFRoZSA8aT5JRDwvaT4gb2YgdGhlIDxiPlNHTlVJS2l0PC9iPiBjb21wb25lbnQgdG8gY2hlY2suDQoJICovDQoJaXNDb21wb25lbnRMb2FkZWQ6IGZ1bmN0aW9uKGlkKSB7DQoJCXJldHVybiB0aGlzLmNvbXBvbmVudHMuaGFzT3duUHJvcGVydHkoaWQpOw0KCX0sDQoNCglzZXQgZXZlbnRDb21wbGV0ZSh2YWx1ZSkgew0KCQlpZih0eXBlb2YgdmFsdWUgPT09ICJvYmplY3QiKSB7DQoJCQlPYmplY3QuYXNzaWduKHRoaXMucGVuZGluZ0V2ZW50cywgdmFsdWUpOw0KDQoJCQlmb3JFYWNoKHRoaXMub25DaGFuZ2VMaXN0ZW5lciwgKGxpc3RlbmVyKSA9PiBsaXN0ZW5lcigiZXZlbnRDb21wbGV0ZSIsIHZhbHVlLCB0aGlzLnBlbmRpbmdFdmVudHMpKTsNCgkJfQ0KCQkvL2NvbnNvbGUubG9nKHRoaXMucGVuZGluZ0V2ZW50cyk7DQoJfSwNCg0KCS8qKg0KCSAqIFNldCB0aGUgc3RhdHVzIG9mIHJlYWRpbmVzcyBvZiA8Yj5TR05VSUtpdDwvYj4uDQoJICoNCgkgKiBAcGFyYW0ge2Jvb2xlYW59IGlzSW5pdCBUaGUgdGhlIHN0YXR1cyBvZiByZWFkaW5lc3Mgb2YgPGI+U0dOVUlLaXQ8L2I+Lg0KCSAqLw0KCXNldCBpbml0KGlzSW5pdCkgew0KCQl0aGlzLmlzSW5pdCA9IGlzSW5pdDsNCgkJdGhpcy5jYWxsQ291bnRzLmluaXQrKzsNCgkJZm9yRWFjaCh0aGlzLm9uQ2hhbmdlTGlzdGVuZXIsIChsaXN0ZW5lcikgPT4gew0KCQkJdGhpcy5wZW5kaW5nRXZlbnRzLm9uQ2hhbmdlLS07DQoJCQl0aGlzLmV2ZW50Q29tcGxldGUgPSB0aGlzLnBlbmRpbmdFdmVudHM7DQoJCQlsaXN0ZW5lcigiaW5pdCIsIHRoaXMuaXNJbml0KTsNCgkJfSk7DQoNCgkJaWYodGhpcy5pc0luaXQpIHsNCgkJCWZvckVhY2godGhpcy5vbkluaXRMaXN0ZW5lciwgKGxpc3RlbmVyKSA9PiB7DQoJCQkJbGlzdGVuZXIodGhpcy5pc0luaXQpOw0KCQkJCXRoaXMucGVuZGluZ0V2ZW50cy5vbkluaXQtLTsNCgkJCQl0aGlzLmV2ZW50Q29tcGxldGUgPSB0aGlzLnBlbmRpbmdFdmVudHM7DQoJCQl9KTsNCgkJfQ0KCX0sDQoNCgkvKioNCgkgKiBHZXQgdGhlIHN0YXR1cyBvZiByZWFkaW5lc3Mgb2YgPGI+U0dOVUlLaXQ8L2I+Lg0KCSAqDQoJICogQHJldHVybiB7Ym9vbGVhbn0gPGI+PGk+VFJVRTwvaT48L2I+IGlmIDxiPlNHTlVJS2l0PC9iPiBpcyByZWFkeSwgPGI+PGk+RkFMU0U8L2k+PC9iPiBvdGhlcndpc2UuDQoJICovDQoJZ2V0IGluaXQoKSB7DQoJCXJldHVybiB0aGlzLmlzSW5pdDsNCgl9LA0KDQoJLyoqDQoJICogU2V0IHRoZSBzdGF0dXMgb2YgcmVhZGluZXNzIG9mIDxiPlNHTlVJS2l0PC9iPi4NCgkgKg0KCSAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNSZWFkeSBUaGUgdGhlIHN0YXR1cyBvZiByZWFkaW5lc3Mgb2YgPGI+U0dOVUlLaXQ8L2I+Lg0KCSAqLw0KCXNldCByZWFkeShpc1JlYWR5KSB7DQoJCXRoaXMuaXNSZWFkeSA9IGlzUmVhZHk7DQoJCXRoaXMuY2FsbENvdW50cy5yZWFkeSsrOw0KCQlmb3JFYWNoKHRoaXMub25DaGFuZ2VMaXN0ZW5lciwgKGxpc3RlbmVyKSA9PiB7DQoJCQl0aGlzLnBlbmRpbmdFdmVudHMub25DaGFuZ2UtLTsNCgkJCXRoaXMuZXZlbnRDb21wbGV0ZSA9IHRoaXMucGVuZGluZ0V2ZW50czsNCgkJCWxpc3RlbmVyKCJyZWFkeSIsIHRoaXMuaXNSZWFkeSk7DQoJCX0pOw0KDQoJCWlmKHRoaXMucmVhZHkpIHsNCgkJCWZvckVhY2godGhpcy5vblJlYWR5TGlzdGVuZXIsIChsaXN0ZW5lcikgPT4gew0KCQkJCXRoaXMucGVuZGluZ0V2ZW50cy5vblJlYWR5LS07DQoJCQkJdGhpcy5ldmVudENvbXBsZXRlID0gdGhpcy5wZW5kaW5nRXZlbnRzOw0KCQkJCWxpc3RlbmVyKHRoaXMuaXNSZWFkeSk7DQoJCQl9KTsNCgkJfQ0KCX0sDQoNCgkvKioNCgkgKiBHZXQgdGhlIHN0YXR1cyBvZiByZWFkaW5lc3Mgb2YgPGI+U0dOVUlLaXQ8L2I+Lg0KCSAqDQoJICogQHJldHVybiB7Ym9vbGVhbn0gPGI+PGk+VFJVRTwvaT48L2I+IGlmIDxiPlNHTlVJS2l0PC9iPiBpcyByZWFkeSwgPGI+PGk+RkFMU0U8L2k+PC9iPiBvdGhlcndpc2UuDQoJICovDQoJZ2V0IHJlYWR5KCkgew0KCQlyZXR1cm4gdGhpcy5pc1JlYWR5Ow0KCX0sDQoNCgkvKioNCgkgKiBIb2xkIHRoZSA8Yj5TR05VSUtpdDwvYj4gcHJlbG9hZGVyIGV2ZW4gYWZ0ZXIgIDxiPlNHTlVJS2l0PC9iPiBoYXMgZmluaXNoZWQgbG9hZGluZyB0aGUgY29tcG9uZW50cy4NCgkgKg0KCSAqIEBwYXJhbSB7Ym9vbGVhbn0gaG9sZCBUaGUgdGhlIHN0YXR1cyBvZiByZWFkaW5lc3Mgb2YgPGI+U0dOVUlLaXQ8L2I+Lg0KCSAqLw0KCXNldCBob2xkUHJlbG9hZGVyKGhvbGQpIHsNCgkJdGhpcy5pc1ByZWxvYWRlckhlbGQgPSBob2xkOw0KCQl0aGlzLmNhbGxDb3VudHMuaG9sZFByZWxvYWRlcisrOw0KCQlmb3JFYWNoKHRoaXMub25DaGFuZ2VMaXN0ZW5lciwgKGxpc3RlbmVyKSA9PiB7DQoJCQl0aGlzLnBlbmRpbmdFdmVudHMub25DaGFuZ2UtLTsNCgkJCXRoaXMuZXZlbnRDb21wbGV0ZSA9IHRoaXMucGVuZGluZ0V2ZW50czsNCgkJCWxpc3RlbmVyKCJob2xkUHJlbG9hZGVyIiwgdGhpcy5pc1ByZWxvYWRlckhlbGQpOw0KCQl9KTsNCgl9LA0KDQoJLyoqDQoJICogR2V0IHRoZSBzdGF0dXMgb2YgcmVhZGluZXNzIG9mIDxiPlNHTlVJS2l0PC9iPi4NCgkgKg0KCSAqIEByZXR1cm4ge2Jvb2xlYW59IDxiPjxpPlRSVUU8L2k+PC9iPiBpZiA8Yj5TR05VSUtpdDwvYj4gaXMgcmVhZHksIDxiPjxpPkZBTFNFPC9pPjwvYj4gb3RoZXJ3aXNlLg0KCSAqLw0KCWdldCBob2xkUHJlbG9hZGVyKCkgew0KCQlyZXR1cm4gdGhpcy5pc1ByZWxvYWRlckhlbGQ7DQoJfSwNCg0KCS8qKg0KCSAqIEhvbGQgdGhlIDxiPlNHTlVJS2l0PC9iPiBldmVuIGFmdGVyIDxiPlNHTlVJS2l0PC9iPiBoYXMgZmluaXNoZWQgbG9hZGluZyB0aGUgY29tcG9uZW50cy4NCgkgKg0KCSAqIEBwYXJhbSB7Ym9vbGVhbn0gaG9sZCBUaGUgdGhlIHN0YXR1cyBvZiByZWFkaW5lc3Mgb2YgPGI+U0dOVUlLaXQ8L2I+Lg0KCSAqLw0KCXNldCBob2xkUmVhZHkoaG9sZCkgew0KCQl0aGlzLmlzUmVhZHlIZWxkID0gaG9sZDsNCgkJdGhpcy5jYWxsQ291bnRzLmhvbGRSZWFkeSsrOw0KCQlmb3JFYWNoKHRoaXMub25DaGFuZ2VMaXN0ZW5lciwgKGxpc3RlbmVyKSA9PiB7DQoJCQl0aGlzLnBlbmRpbmdFdmVudHMub25DaGFuZ2UtLTsNCgkJCXRoaXMuZXZlbnRDb21wbGV0ZSA9IHRoaXMucGVuZGluZ0V2ZW50czsNCgkJCWxpc3RlbmVyKCJob2xkUmVhZHkiLCB0aGlzLmlzUmVhZHlIZWxkKTsNCgkJfSk7DQoJfSwNCg0KCS8qKg0KCSAqIEdldCB0aGUgc3RhdHVzIG9mIHJlYWRpbmVzcyBvZiA8Yj5TR05VSUtpdDwvYj4uDQoJICoNCgkgKiBAcmV0dXJuIHtib29sZWFufSA8Yj48aT5UUlVFPC9pPjwvYj4gaWYgPGI+U0dOVUlLaXQ8L2I+IGlzIHJlYWR5LCA8Yj48aT5GQUxTRTwvaT48L2I+IG90aGVyd2lzZS4NCgkgKi8NCglnZXQgaG9sZFJlYWR5KCkgew0KCQlyZXR1cm4gdGhpcy5pc1JlYWR5SGVsZDsNCgl9LA0KDQoJLyoqDQoJICogU2V0IHRoZSBoYW5kbGVyIGZvciA8Yj5TR05VSUtpdDwvYj4gPGI+PGk+T25DaGFuZ2U8L2k+PC9iPiBldmVudCwgd2hpY2ggd2lsbCBiZSB0cmlnZ2VyZWQgd2hlbiBhIGNvbXBvbmVudCBpcyBsb2FkZWQvcmVtb3ZlZCBvciB0aGUgc3RhdHVzIG9mIHJlYWRpbmVzcyBpcyBjaGFuZ2VkLg0KCSAqDQoJICogQHBhcmFtIHtTR05VSUtpdENoYW5nZUNhbGxiYWNrfWxpc3RlbmVyDQoJICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfVtpZD11bmRlZmluZWRdDQoJICovDQoJc2V0T25DaGFuZ2VMaXN0ZW5lcjogZnVuY3Rpb24obGlzdGVuZXIsIGlkKSB7DQoJCWlmKHR5cGVvZiBpZCA9PT0gInN0cmluZyIgfHwgdHlwZW9mIGlkID09PSAibnVtYmVyIikgew0KCQkJdGhpcy5vbkNoYW5nZUxpc3RlbmVyW2lkXSA9IGxpc3RlbmVyOw0KCQl9IGVsc2Ugew0KCQkJcHVzaCh0aGlzLm9uQ2hhbmdlTGlzdGVuZXIsIGxpc3RlbmVyKTsNCgkJfQ0KDQoJCXRoaXMucGVuZGluZ0V2ZW50cy5vbkNoYW5nZSsrOw0KCX0sDQoNCgkvKioNCgkgKiBTZXQgdGhlIGhhbmRsZXIgZm9yIDxiPlNHTlVJS2l0PC9iPiA8Yj48aT5PblJlYWR5PC9pPjwvYj4gZXZlbnQsIHdoaWNoIHdpbGwgYmUgdHJpZ2dlcmVkIHdoZW4gdGhlIDxiPlNHTlVJS2l0PC9iPiBpcyByZWFkeS4NCgkgKg0KCSAqIEBwYXJhbSB7U0dOVUlLaXRSZWFkeUNhbGxiYWNrfWxpc3RlbmVyDQoJICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfVtpZD11bmRlZmluZWRdDQoJICovDQoJc2V0T25Jbml0TGlzdGVuZXI6IGZ1bmN0aW9uKGxpc3RlbmVyLCBpZCwgZmlyZSA9IGZhbHNlKSB7DQoJCWlmKHR5cGVvZiBpZCA9PT0gInN0cmluZyIgfHwgdHlwZW9mIGlkID09PSAibnVtYmVyIikgew0KCQkJdGhpcy5vbkluaXRMaXN0ZW5lcltpZF0gPSBsaXN0ZW5lcjsNCgkJfSBlbHNlIHsNCgkJCXB1c2godGhpcy5vbkluaXRMaXN0ZW5lciwgbGlzdGVuZXIpOw0KCQl9DQoJCXRoaXMucGVuZGluZ0V2ZW50cy5vbkluaXQrKzsNCg0KCQlpZihmaXJlICYmIHRoaXMuaW5pdCkgew0KCQkJdGhpcy5wZW5kaW5nRXZlbnRzLm9uSW5pdC0tOw0KCQkJbGlzdGVuZXIodGhpcy5pc0luaXQpOw0KCQl9DQoJfSwNCg0KCS8qKg0KCSAqIFNldCB0aGUgaGFuZGxlciBmb3IgPGI+U0dOVUlLaXQ8L2I+IDxiPjxpPk9uUmVhZHk8L2k+PC9iPiBldmVudCwgd2hpY2ggd2lsbCBiZSB0cmlnZ2VyZWQgd2hlbiB0aGUgPGI+U0dOVUlLaXQ8L2I+IGlzIHJlYWR5Lg0KCSAqDQoJICogQHBhcmFtIHtTR05VSUtpdFJlYWR5Q2FsbGJhY2t9bGlzdGVuZXINCgkgKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ9W2lkPXVuZGVmaW5lZF0NCgkgKi8NCglzZXRPblJlYWR5TGlzdGVuZXI6IGZ1bmN0aW9uKGxpc3RlbmVyLCBpZCkgew0KCQlpZih0eXBlb2YgaWQgPT09ICJzdHJpbmciIHx8IHR5cGVvZiBpZCA9PT0gIm51bWJlciIpIHsNCgkJCXRoaXMub25SZWFkeUxpc3RlbmVyW2lkXSA9IGxpc3RlbmVyOw0KCQl9IGVsc2Ugew0KCQkJcHVzaCh0aGlzLm9uUmVhZHlMaXN0ZW5lciwgbGlzdGVuZXIpOw0KCQl9DQoJCXRoaXMucGVuZGluZ0V2ZW50cy5vblJlYWR5Kys7DQoNCgkJaWYodGhpcy5yZWFkeSkgew0KCQkJZm9yRWFjaCh0aGlzLm9uUmVhZHlMaXN0ZW5lciwgKGxpc3RlbmVyKSA9PiB7DQoJCQkJdGhpcy5wZW5kaW5nRXZlbnRzLm9uUmVhZHktLTsNCgkJCQlsaXN0ZW5lcih0aGlzLmlzUmVhZHkpOw0KCQkJfSk7DQoJCX0NCgl9LA0KfTsNCnJvb3QuU0dOVUlLaXQgPSBTR05VSUtpdDsNCg0KaWYodHlwZW9mIGpRdWVyeSA9PT0gInVuZGVmaW5lZCIpIHsNCgkvKiEgalF1ZXJ5IHYzLjYuNCB8IChjKSBPcGVuSlMgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzIHwganF1ZXJ5Lm9yZy9saWNlbnNlICovDQoJIWZ1bmN0aW9uKGUsIHQpIHsNCgkJInVzZSBzdHJpY3QiOw0KCQkib2JqZWN0IiA9PSB0eXBlb2YgbW9kdWxlICYmICJvYmplY3QiID09IHR5cGVvZiBtb2R1bGUuZXhwb3J0cyA/IG1vZHVsZS5leHBvcnRzID0gZS5kb2N1bWVudCA/IHQoZSwgITApIDogZnVuY3Rpb24oZSkgew0KCQkJaWYoIWUuZG9jdW1lbnQpIHRocm93IG5ldyBFcnJvcigialF1ZXJ5IHJlcXVpcmVzIGEgd2luZG93IHdpdGggYSBkb2N1bWVudCIpOw0KCQkJcmV0dXJuIHQoZSk7DQoJCX0gOiB0KGUpOw0KCX0oInVuZGVmaW5lZCIgIT0gdHlwZW9mIHdpbmRvdyA/IHdpbmRvdyA6IHRoaXMsIGZ1bmN0aW9uKEMsIGUpIHsNCgkJInVzZSBzdHJpY3QiOw0KCQl2YXIgdCA9IFtdLA0KCQkgICAgciA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiwNCgkJICAgIHMgPSB0LnNsaWNlLA0KCQkgICAgZyA9IHQuZmxhdCA/IGZ1bmN0aW9uKGUpIHtyZXR1cm4gdC5mbGF0LmNhbGwoZSk7fSA6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gdC5jb25jYXQuYXBwbHkoW10sIGUpO30sDQoJCSAgICB1ID0gdC5wdXNoLA0KCQkgICAgaSA9IHQuaW5kZXhPZiwNCgkJICAgIG4gPSB7fSwNCgkJICAgIG8gPSBuLnRvU3RyaW5nLA0KCQkgICAgeSA9IG4uaGFzT3duUHJvcGVydHksDQoJCSAgICBhID0geS50b1N0cmluZywNCgkJICAgIGwgPSBhLmNhbGwoT2JqZWN0KSwNCgkJICAgIHYgPSB7fSwNCgkJICAgIG0gPSBmdW5jdGlvbihlKSB7cmV0dXJuICJmdW5jdGlvbiIgPT0gdHlwZW9mIGUgJiYgIm51bWJlciIgIT0gdHlwZW9mIGUubm9kZVR5cGUgJiYgImZ1bmN0aW9uIiAhPSB0eXBlb2YgZS5pdGVtO30sDQoJCSAgICB4ID0gZnVuY3Rpb24oZSkge3JldHVybiBudWxsICE9IGUgJiYgZSA9PT0gZS53aW5kb3c7fSwNCgkJICAgIEUgPSBDLmRvY3VtZW50LA0KCQkgICAgYyA9IHt0eXBlOiAhMCwgc3JjOiAhMCwgbm9uY2U6ICEwLCBub01vZHVsZTogITB9Ow0KDQoJCWZ1bmN0aW9uIGIoZSwgdCwgbikgew0KCQkJdmFyIHIsIGksIG8gPSAobiA9IG4gfHwgRSkuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7DQoJCQlpZihvLnRleHQgPSBlLCB0KSBmb3IociBpbiBjKSAoaSA9IHRbcl0gfHwgdC5nZXRBdHRyaWJ1dGUgJiYgdC5nZXRBdHRyaWJ1dGUocikpICYmIG8uc2V0QXR0cmlidXRlKHIsIGkpOw0KCQkJbi5oZWFkLmFwcGVuZENoaWxkKG8pLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobyk7DQoJCX0NCg0KCQlmdW5jdGlvbiB3KGUpIHtyZXR1cm4gbnVsbCA9PSBlID8gZSArICIiIDogIm9iamVjdCIgPT0gdHlwZW9mIGUgfHwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgZSA/IG5bby5jYWxsKGUpXSB8fCAib2JqZWN0IiA6IHR5cGVvZiBlO30NCg0KCQl2YXIgZiA9ICIzLjYuNCIsIFMgPSBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIG5ldyBTLmZuLmluaXQoZSwgdCk7fTsNCg0KCQlmdW5jdGlvbiBwKGUpIHsNCgkJCXZhciB0ID0gISFlICYmICJsZW5ndGgiIGluIGUgJiYgZS5sZW5ndGgsIG4gPSB3KGUpOw0KCQkJcmV0dXJuICFtKGUpICYmICF4KGUpICYmICgiYXJyYXkiID09PSBuIHx8IDAgPT09IHQgfHwgIm51bWJlciIgPT0gdHlwZW9mIHQgJiYgMCA8IHQgJiYgdCAtIDEgaW4gZSk7DQoJCX0NCg0KCQlTLmZuID0gUy5wcm90b3R5cGUgPSB7DQoJCQlqcXVlcnk6IGYsDQoJCQljb25zdHJ1Y3RvcjogUywNCgkJCWxlbmd0aDogMCwNCgkJCXRvQXJyYXk6IGZ1bmN0aW9uKCkge3JldHVybiBzLmNhbGwodGhpcyk7fSwNCgkJCWdldDogZnVuY3Rpb24oZSkge3JldHVybiBudWxsID09IGUgPyBzLmNhbGwodGhpcykgOiBlIDwgMCA/IHRoaXNbZSArIHRoaXMubGVuZ3RoXSA6IHRoaXNbZV07fSwNCgkJCXB1c2hTdGFjazogZnVuY3Rpb24oZSkgew0KCQkJCXZhciB0ID0gUy5tZXJnZSh0aGlzLmNvbnN0cnVjdG9yKCksIGUpOw0KCQkJCXJldHVybiB0LnByZXZPYmplY3QgPSB0aGlzLCB0Ow0KCQkJfSwNCgkJCWVhY2g6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gUy5lYWNoKHRoaXMsIGUpO30sDQoJCQltYXA6IGZ1bmN0aW9uKG4pIHtyZXR1cm4gdGhpcy5wdXNoU3RhY2soUy5tYXAodGhpcywgZnVuY3Rpb24oZSwgdCkge3JldHVybiBuLmNhbGwoZSwgdCwgZSk7fSkpO30sDQoJCQlzbGljZTogZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMucHVzaFN0YWNrKHMuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7fSwNCgkJCWZpcnN0OiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5lcSgwKTt9LA0KCQkJbGFzdDogZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMuZXEoLTEpO30sDQoJCQlldmVuOiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5wdXNoU3RhY2soUy5ncmVwKHRoaXMsIGZ1bmN0aW9uKGUsIHQpIHtyZXR1cm4gKHQgKyAxKSAlIDI7fSkpO30sDQoJCQlvZGQ6IGZ1bmN0aW9uKCkge3JldHVybiB0aGlzLnB1c2hTdGFjayhTLmdyZXAodGhpcywgZnVuY3Rpb24oZSwgdCkge3JldHVybiB0ICUgMjt9KSk7fSwNCgkJCWVxOiBmdW5jdGlvbihlKSB7DQoJCQkJdmFyIHQgPSB0aGlzLmxlbmd0aCwgbiA9ICtlICsgKGUgPCAwID8gdCA6IDApOw0KCQkJCXJldHVybiB0aGlzLnB1c2hTdGFjaygwIDw9IG4gJiYgbiA8IHQgPyBbdGhpc1tuXV0gOiBbXSk7DQoJCQl9LA0KCQkJZW5kOiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5wcmV2T2JqZWN0IHx8IHRoaXMuY29uc3RydWN0b3IoKTt9LA0KCQkJcHVzaDogdSwNCgkJCXNvcnQ6IHQuc29ydCwNCgkJCXNwbGljZTogdC5zcGxpY2UNCgkJfSwgUy5leHRlbmQgPSBTLmZuLmV4dGVuZCA9IGZ1bmN0aW9uKCkgew0KCQkJdmFyIGUsIHQsIG4sIHIsIGksIG8sIGEgPSBhcmd1bWVudHNbMF0gfHwge30sIHMgPSAxLCB1ID0gYXJndW1lbnRzLmxlbmd0aCwgbCA9ICExOw0KCQkJZm9yKCJib29sZWFuIiA9PSB0eXBlb2YgYSAmJiAobCA9IGEsIGEgPSBhcmd1bWVudHNbc10gfHwge30sIHMrKyksICJvYmplY3QiID09IHR5cGVvZiBhIHx8IG0oYSkgfHwgKGEgPSB7fSksIHMgPT09IHUgJiYgKGEgPSB0aGlzLCBzLS0pOyBzIDwgdTsgcysrKSBpZihudWxsICE9IChlID0gYXJndW1lbnRzW3NdKSkgZm9yKHQgaW4gZSkgciA9IGVbdF0sICJfX3Byb3RvX18iICE9PQ0KCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQgJiYNCgkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhICE9PQ0KCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgJiYNCgkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobCAmJiByICYmIChTLmlzUGxhaW5PYmplY3QocikgfHwgKGkgPSBBcnJheS5pc0FycmF5KHIpKSkgPw0KCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobiA9IGFbdF0sIG8gPSBpICYmICFBcnJheS5pc0FycmF5KG4pID8gW10gOiBpIHx8IFMuaXNQbGFpbk9iamVjdChuKSA/IG4gOiB7fSwgaSA9DQoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMSwgYVt0XSA9IFMuZXh0ZW5kKGwsIG8sIHIpKSA6DQoJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAwICE9PSByICYmIChhW3RdID0gcikpOw0KCQkJcmV0dXJuIGE7DQoJCX0sIFMuZXh0ZW5kKHsNCgkJCWV4cGFuZG86ICJqUXVlcnkiICsgKGYgKyBNYXRoLnJhbmRvbSgpKS5yZXBsYWNlKC9cRC9nLCAiIiksIGlzUmVhZHk6ICEwLCBlcnJvcjogZnVuY3Rpb24oZSkge3Rocm93IG5ldyBFcnJvcihlKTt9LCBub29wOiBmdW5jdGlvbigpIHt9LCBpc1BsYWluT2JqZWN0OiBmdW5jdGlvbihlKSB7DQoJCQkJdmFyIHQsIG47DQoJCQkJcmV0dXJuICEoIWUgfHwgIltvYmplY3QgT2JqZWN0XSIgIT09IG8uY2FsbChlKSkgJiYgKCEodCA9IHIoZSkpIHx8ICJmdW5jdGlvbiIgPT0gdHlwZW9mIChuID0geS5jYWxsKHQsICJjb25zdHJ1Y3RvciIpICYmIHQuY29uc3RydWN0b3IpICYmIGEuY2FsbChuKSA9PT0gbCk7DQoJCQl9LCBpc0VtcHR5T2JqZWN0OiBmdW5jdGlvbihlKSB7DQoJCQkJdmFyIHQ7DQoJCQkJZm9yKHQgaW4gZSkgcmV0dXJuICExOw0KCQkJCXJldHVybiAhMDsNCgkJCX0sIGdsb2JhbEV2YWw6IGZ1bmN0aW9uKGUsIHQsIG4pIHtiKGUsIHtub25jZTogdCAmJiB0Lm5vbmNlfSwgbik7fSwgZWFjaDogZnVuY3Rpb24oZSwgdCkgew0KCQkJCXZhciBuLCByID0gMDsNCgkJCQlpZihwKGUpKSB7Zm9yKG4gPSBlLmxlbmd0aDsgciA8IG47IHIrKykgaWYoITEgPT09IHQuY2FsbChlW3JdLCByLCBlW3JdKSkgYnJlYWs7fSBlbHNlIGZvcihyIGluIGUpIGlmKCExID09PSB0LmNhbGwoZVtyXSwgciwgZVtyXSkpIGJyZWFrOw0KCQkJCXJldHVybiBlOw0KCQkJfSwgbWFrZUFycmF5OiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4gPSB0IHx8IFtdOw0KCQkJCXJldHVybiBudWxsICE9IGUgJiYgKHAoT2JqZWN0KGUpKSA/IFMubWVyZ2UobiwgInN0cmluZyIgPT0gdHlwZW9mIGUgPyBbZV0gOiBlKSA6IHUuY2FsbChuLCBlKSksIG47DQoJCQl9LCBpbkFycmF5OiBmdW5jdGlvbihlLCB0LCBuKSB7cmV0dXJuIG51bGwgPT0gdCA/IC0xIDogaS5jYWxsKHQsIGUsIG4pO30sIG1lcmdlOiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJZm9yKHZhciBuID0gK3QubGVuZ3RoLCByID0gMCwgaSA9IGUubGVuZ3RoOyByIDwgbjsgcisrKSBlW2krK10gPSB0W3JdOw0KCQkJCXJldHVybiBlLmxlbmd0aCA9IGksIGU7DQoJCQl9LCBncmVwOiBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJZm9yKHZhciByID0gW10sIGkgPSAwLCBvID0gZS5sZW5ndGgsIGEgPSAhbjsgaSA8IG87IGkrKykgIXQoZVtpXSwgaSkgIT09IGEgJiYgci5wdXNoKGVbaV0pOw0KCQkJCXJldHVybiByOw0KCQkJfSwgbWFwOiBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJdmFyIHIsIGksIG8gPSAwLCBhID0gW107DQoJCQkJaWYocChlKSkgZm9yKHIgPSBlLmxlbmd0aDsgbyA8IHI7IG8rKykgbnVsbCAhPSAoaSA9IHQoZVtvXSwgbywgbikpICYmIGEucHVzaChpKTsgZWxzZSBmb3IobyBpbiBlKSBudWxsICE9IChpID0gdChlW29dLCBvLCBuKSkgJiYgYS5wdXNoKGkpOw0KCQkJCXJldHVybiBnKGEpOw0KCQkJfSwgZ3VpZDogMSwgc3VwcG9ydDogdg0KCQl9KSwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmIChTLmZuW1N5bWJvbC5pdGVyYXRvcl0gPSB0W1N5bWJvbC5pdGVyYXRvcl0pLCBTLmVhY2goIkJvb2xlYW4gTnVtYmVyIFN0cmluZyBGdW5jdGlvbiBBcnJheSBEYXRlIFJlZ0V4cCBPYmplY3QgRXJyb3IgU3ltYm9sIi5zcGxpdCgiICIpLCBmdW5jdGlvbihlLCB0KSB7blsiW29iamVjdCAiICsgdCArICJdIl0gPSB0LnRvTG93ZXJDYXNlKCk7fSk7DQoJCXZhciBkID0gZnVuY3Rpb24obikgew0KCQkJdmFyIGUsDQoJCQkgICAgZCwNCgkJCSAgICBiLA0KCQkJICAgIG8sDQoJCQkgICAgaSwNCgkJCSAgICBoLA0KCQkJICAgIGYsDQoJCQkgICAgZywNCgkJCSAgICB3LA0KCQkJICAgIHUsDQoJCQkgICAgbCwNCgkJCSAgICBULA0KCQkJICAgIEMsDQoJCQkgICAgYSwNCgkJCSAgICBFLA0KCQkJICAgIHksDQoJCQkgICAgcywNCgkJCSAgICBjLA0KCQkJICAgIHYsDQoJCQkgICAgUyAgPSAic2l6emxlIiArIDEgKiBuZXcgRGF0ZSwNCgkJCSAgICBwICA9IG4uZG9jdW1lbnQsDQoJCQkgICAgayAgPSAwLA0KCQkJICAgIHIgID0gMCwNCgkJCSAgICBtICA9IHVlKCksDQoJCQkgICAgeCAgPSB1ZSgpLA0KCQkJICAgIEEgID0gdWUoKSwNCgkJCSAgICBOICA9IHVlKCksDQoJCQkgICAgaiAgPSBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIGUgPT09IHQgJiYgKGwgPSAhMCksIDA7fSwNCgkJCSAgICBEICA9IHt9Lmhhc093blByb3BlcnR5LA0KCQkJICAgIHQgID0gW10sDQoJCQkgICAgcSAgPSB0LnBvcCwNCgkJCSAgICBMICA9IHQucHVzaCwNCgkJCSAgICBIICA9IHQucHVzaCwNCgkJCSAgICBPICA9IHQuc2xpY2UsDQoJCQkgICAgUCAgPSBmdW5jdGlvbihlLCB0KSB7DQoJCQkJICAgIGZvcih2YXIgbiA9IDAsIHIgPSBlLmxlbmd0aDsgbiA8IHI7IG4rKykgaWYoZVtuXSA9PT0gdCkgcmV0dXJuIG47DQoJCQkJICAgIHJldHVybiAtMTsNCgkJCSAgICB9LA0KCQkJICAgIFIgID0gImNoZWNrZWR8c2VsZWN0ZWR8YXN5bmN8YXV0b2ZvY3VzfGF1dG9wbGF5fGNvbnRyb2xzfGRlZmVyfGRpc2FibGVkfGhpZGRlbnxpc21hcHxsb29wfG11bHRpcGxlfG9wZW58cmVhZG9ubHl8cmVxdWlyZWR8c2NvcGVkIiwNCgkJCSAgICBNICA9ICJbXFx4MjBcXHRcXHJcXG5cXGZdIiwNCgkJCSAgICBJICA9ICIoPzpcXFxcW1xcZGEtZkEtRl17MSw2fSIgKyBNICsgIj98XFxcXFteXFxyXFxuXFxmXXxbXFx3LV18W15cMC1cXHg3Zl0pKyIsDQoJCQkgICAgVyAgPSAiXFxbIiArIE0gKyAiKigiICsgSSArICIpKD86IiArIE0gKyAiKihbKl4kfCF+XT89KSIgKyBNICsgIiooPzonKCg/OlxcXFwufFteXFxcXCddKSopJ3xcIigoPzpcXFxcLnxbXlxcXFxcIl0pKilcInwoIiArIEkgKyAiKSl8KSIgKyBNICsgIipcXF0iLA0KCQkJICAgIEYgID0gIjooIiArIEkgKyAiKSg/OlxcKCgoJygoPzpcXFxcLnxbXlxcXFwnXSkqKSd8XCIoKD86XFxcXC58W15cXFxcXCJdKSopXCIpfCgoPzpcXFxcLnxbXlxcXFwoKVtcXF1dfCIgKyBXICsgIikqKXwuKilcXCl8KSIsDQoJCQkgICAgJCAgPSBuZXcgUmVnRXhwKE0gKyAiKyIsICJnIiksDQoJCQkgICAgQiAgPSBuZXcgUmVnRXhwKCJeIiArIE0gKyAiK3woKD86XnxbXlxcXFxdKSg/OlxcXFwuKSopIiArIE0gKyAiKyQiLCAiZyIpLA0KCQkJICAgIF8gID0gbmV3IFJlZ0V4cCgiXiIgKyBNICsgIiosIiArIE0gKyAiKiIpLA0KCQkJICAgIHogID0gbmV3IFJlZ0V4cCgiXiIgKyBNICsgIiooWz4rfl18IiArIE0gKyAiKSIgKyBNICsgIioiKSwNCgkJCSAgICBVICA9IG5ldyBSZWdFeHAoTSArICJ8PiIpLA0KCQkJICAgIFggID0gbmV3IFJlZ0V4cChGKSwNCgkJCSAgICBWICA9IG5ldyBSZWdFeHAoIl4iICsgSSArICIkIiksDQoJCQkgICAgRyAgPSB7DQoJCQkJICAgIElEOiBuZXcgUmVnRXhwKCJeIygiICsgSSArICIpIiksDQoJCQkJICAgIENMQVNTOiBuZXcgUmVnRXhwKCJeXFwuKCIgKyBJICsgIikiKSwNCgkJCQkgICAgVEFHOiBuZXcgUmVnRXhwKCJeKCIgKyBJICsgInxbKl0pIiksDQoJCQkJICAgIEFUVFI6IG5ldyBSZWdFeHAoIl4iICsgVyksDQoJCQkJICAgIFBTRVVETzogbmV3IFJlZ0V4cCgiXiIgKyBGKSwNCgkJCQkgICAgQ0hJTEQ6IG5ldyBSZWdFeHAoIl46KG9ubHl8Zmlyc3R8bGFzdHxudGh8bnRoLWxhc3QpLShjaGlsZHxvZi10eXBlKSg/OlxcKCIgKyBNICsgIiooZXZlbnxvZGR8KChbKy1dfCkoXFxkKilufCkiICsgTSArICIqKD86KFsrLV18KSIgKyBNICsgIiooXFxkKyl8KSkiICsgTSArICIqXFwpfCkiLCAiaSIpLA0KCQkJCSAgICBib29sOiBuZXcgUmVnRXhwKCJeKD86IiArIFIgKyAiKSQiLCAiaSIpLA0KCQkJCSAgICBuZWVkc0NvbnRleHQ6IG5ldyBSZWdFeHAoIl4iICsgTSArICIqWz4rfl18OihldmVufG9kZHxlcXxndHxsdHxudGh8Zmlyc3R8bGFzdCkoPzpcXCgiICsgTSArICIqKCg/Oi1cXGQpP1xcZCopIiArIE0gKyAiKlxcKXwpKD89W14tXXwkKSIsICJpIikNCgkJCSAgICB9LA0KCQkJICAgIFkgID0gL0hUTUwkL2ksDQoJCQkgICAgUSAgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b24pJC9pLA0KCQkJICAgIEogID0gL15oXGQkL2ksDQoJCQkgICAgSyAgPSAvXltee10rXHtccypcW25hdGl2ZSBcdy8sDQoJCQkgICAgWiAgPSAvXig/OiMoW1x3LV0rKXwoXHcrKXxcLihbXHctXSspKSQvLA0KCQkJICAgIGVlID0gL1srfl0vLA0KCQkJICAgIHRlID0gbmV3IFJlZ0V4cCgiXFxcXFtcXGRhLWZBLUZdezEsNn0iICsgTSArICI/fFxcXFwoW15cXHJcXG5cXGZdKSIsICJnIiksDQoJCQkgICAgbmUgPSBmdW5jdGlvbihlLCB0KSB7DQoJCQkJICAgIHZhciBuID0gIjB4IiArIGUuc2xpY2UoMSkgLSA2NTUzNjsNCgkJCQkgICAgcmV0dXJuIHQgfHwgKG4gPCAwID8gU3RyaW5nLmZyb21DaGFyQ29kZShuICsgNjU1MzYpIDogU3RyaW5nLmZyb21DaGFyQ29kZShuID4+IDEwIHwgNTUyOTYsIDEwMjMgJiBuIHwgNTYzMjApKTsNCgkJCSAgICB9LA0KCQkJICAgIHJlID0gLyhbXDAtXHgxZlx4N2ZdfF4tP1xkKXxeLSR8W15cMC1ceDFmXHg3Zi1cdUZGRkZcdy1dL2csDQoJCQkgICAgaWUgPSBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIHQgPyAiXDAiID09PSBlID8gIlx1ZmZmZCIgOiBlLnNsaWNlKDAsIC0xKSArICJcXCIgKyBlLmNoYXJDb2RlQXQoZS5sZW5ndGggLSAxKS50b1N0cmluZygxNikgKyAiICIgOiAiXFwiICsgZTt9LA0KCQkJICAgIG9lID0gZnVuY3Rpb24oKSB7VCgpO30sDQoJCQkgICAgYWUgPSBiZShmdW5jdGlvbihlKSB7cmV0dXJuICEwID09PSBlLmRpc2FibGVkICYmICJmaWVsZHNldCIgPT09IGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKTt9LCB7ZGlyOiAicGFyZW50Tm9kZSIsIG5leHQ6ICJsZWdlbmQifSk7DQoJCQl0cnkge0guYXBwbHkodCA9IE8uY2FsbChwLmNoaWxkTm9kZXMpLCBwLmNoaWxkTm9kZXMpLCB0W3AuY2hpbGROb2Rlcy5sZW5ndGhdLm5vZGVUeXBlO30gY2F0Y2goZSkgew0KCQkJCUggPSB7DQoJCQkJCWFwcGx5OiB0Lmxlbmd0aCA/IGZ1bmN0aW9uKGUsIHQpIHtMLmFwcGx5KGUsIE8uY2FsbCh0KSk7fSA6IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJCXZhciBuID0gZS5sZW5ndGgsDQoJCQkJCQkgICAgciA9IDA7DQoJCQkJCQl3aGlsZShlW24rK10gPSB0W3IrK10pIDsNCgkJCQkJCWUubGVuZ3RoID0gbiAtIDE7DQoJCQkJCX0NCgkJCQl9Ow0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBzZSh0LCBlLCBuLCByKSB7DQoJCQkJdmFyIGksIG8sIGEsIHMsIHUsIGwsIGMsIGYgPSBlICYmIGUub3duZXJEb2N1bWVudCwgcCA9IGUgPyBlLm5vZGVUeXBlIDogOTsNCgkJCQlpZihuID0gbiB8fCBbXSwgInN0cmluZyIgIT0gdHlwZW9mIHQgfHwgIXQgfHwgMSAhPT0gcCAmJiA5ICE9PSBwICYmIDExICE9PSBwKSByZXR1cm4gbjsNCgkJCQlpZighciAmJiAoVChlKSwgZSA9IGUgfHwgQywgRSkpIHsNCgkJCQkJaWYoMTEgIT09IHAgJiYgKHUgPSBaLmV4ZWModCkpKSB7DQoJCQkJCQlpZihpID0gdVsxXSkgew0KCQkJCQkJCWlmKDkgPT09IHApIHsNCgkJCQkJCQkJaWYoIShhID0gZS5nZXRFbGVtZW50QnlJZChpKSkpIHJldHVybiBuOw0KCQkJCQkJCQlpZihhLmlkID09PSBpKSByZXR1cm4gbi5wdXNoKGEpLCBuOw0KCQkJCQkJCX0gZWxzZSBpZihmICYmIChhID0gZi5nZXRFbGVtZW50QnlJZChpKSkgJiYgdihlLCBhKSAmJiBhLmlkID09PSBpKSByZXR1cm4gbi5wdXNoKGEpLCBuOw0KCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQlpZih1WzJdKSByZXR1cm4gSC5hcHBseShuLCBlLmdldEVsZW1lbnRzQnlUYWdOYW1lKHQpKSwgbjsNCgkJCQkJCQlpZigoaSA9IHVbM10pICYmIGQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSAmJiBlLmdldEVsZW1lbnRzQnlDbGFzc05hbWUpIHJldHVybiBILmFwcGx5KG4sIGUuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShpKSksIG47DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQkJaWYoZC5xc2EgJiYgIU5bdCArICIgIl0gJiYgKCF5IHx8ICF5LnRlc3QodCkpICYmICgxICE9PSBwIHx8ICJvYmplY3QiICE9PSBlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkpKSB7DQoJCQkJCQlpZihjID0gdCwgZiA9IGUsIDEgPT09IHAgJiYgKFUudGVzdCh0KSB8fCB6LnRlc3QodCkpKSB7DQoJCQkJCQkJKGYgPSBlZS50ZXN0KHQpICYmIHZlKGUucGFyZW50Tm9kZSkgfHwgZSkgPT09IGUgJiYgZC5zY29wZSB8fCAoKHMgPSBlLmdldEF0dHJpYnV0ZSgiaWQiKSkgPyBzID0gcy5yZXBsYWNlKHJlLCBpZSkgOiBlLnNldEF0dHJpYnV0ZSgiaWQiLCBzID0gUykpLCBvID0gKGwgPSBoKHQpKS5sZW5ndGg7DQoJCQkJCQkJd2hpbGUoby0tKSBsW29dID0gKHMgPyAiIyIgKyBzIDogIjpzY29wZSIpICsgIiAiICsgeGUobFtvXSk7DQoJCQkJCQkJYyA9IGwuam9pbigiLCIpOw0KCQkJCQkJfQ0KCQkJCQkJdHJ5IHtyZXR1cm4gSC5hcHBseShuLCBmLnF1ZXJ5U2VsZWN0b3JBbGwoYykpLCBuO30gY2F0Y2goZSkge04odCwgITApO30gZmluYWxseSB7cyA9PT0gUyAmJiBlLnJlbW92ZUF0dHJpYnV0ZSgiaWQiKTt9DQoJCQkJCX0NCgkJCQl9DQoJCQkJcmV0dXJuIGcodC5yZXBsYWNlKEIsICIkMSIpLCBlLCBuLCByKTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gdWUoKSB7DQoJCQkJdmFyIHIgPSBbXTsNCgkJCQlyZXR1cm4gZnVuY3Rpb24gZSh0LCBuKSB7cmV0dXJuIHIucHVzaCh0ICsgIiAiKSA+IGIuY2FjaGVMZW5ndGggJiYgZGVsZXRlIGVbci5zaGlmdCgpXSwgZVt0ICsgIiAiXSA9IG47fTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gbGUoZSkge3JldHVybiBlW1NdID0gITAsIGU7fQ0KDQoJCQlmdW5jdGlvbiBjZShlKSB7DQoJCQkJdmFyIHQgPSBDLmNyZWF0ZUVsZW1lbnQoImZpZWxkc2V0Iik7DQoJCQkJdHJ5IHtyZXR1cm4gISFlKHQpO30gY2F0Y2goZSkge3JldHVybiAhMTt9IGZpbmFsbHkge3QucGFyZW50Tm9kZSAmJiB0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodCksIHQgPSBudWxsO30NCgkJCX0NCg0KCQkJZnVuY3Rpb24gZmUoZSwgdCkgew0KCQkJCXZhciBuID0gZS5zcGxpdCgifCIpLCByID0gbi5sZW5ndGg7DQoJCQkJd2hpbGUoci0tKSBiLmF0dHJIYW5kbGVbbltyXV0gPSB0Ow0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBwZShlLCB0KSB7DQoJCQkJdmFyIG4gPSB0ICYmIGUsIHIgPSBuICYmIDEgPT09IGUubm9kZVR5cGUgJiYgMSA9PT0gdC5ub2RlVHlwZSAmJiBlLnNvdXJjZUluZGV4IC0gdC5zb3VyY2VJbmRleDsNCgkJCQlpZihyKSByZXR1cm4gcjsNCgkJCQlpZihuKSB3aGlsZShuID0gbi5uZXh0U2libGluZykgaWYobiA9PT0gdCkgcmV0dXJuIC0xOw0KCQkJCXJldHVybiBlID8gMSA6IC0xOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBkZSh0KSB7cmV0dXJuIGZ1bmN0aW9uKGUpIHtyZXR1cm4gImlucHV0IiA9PT0gZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICYmIGUudHlwZSA9PT0gdDt9O30NCg0KCQkJZnVuY3Rpb24gaGUobikgew0KCQkJCXJldHVybiBmdW5jdGlvbihlKSB7DQoJCQkJCXZhciB0ID0gZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOw0KCQkJCQlyZXR1cm4gKCJpbnB1dCIgPT09IHQgfHwgImJ1dHRvbiIgPT09IHQpICYmIGUudHlwZSA9PT0gbjsNCgkJCQl9Ow0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBnZSh0KSB7DQoJCQkJcmV0dXJuIGZ1bmN0aW9uKGUpIHsNCgkJCQkJcmV0dXJuICJmb3JtIiBpbiBlID8NCgkJCQkJICAgICAgIGUucGFyZW50Tm9kZSAmJiAhMSA9PT0gZS5kaXNhYmxlZCA/ICJsYWJlbCIgaW4gZSA/ICJsYWJlbCIgaW4gZS5wYXJlbnROb2RlID8gZS5wYXJlbnROb2RlLmRpc2FibGVkID09PSB0IDogZS5kaXNhYmxlZCA9PT0gdCA6IGUuaXNEaXNhYmxlZCA9PT0gdCB8fCBlLmlzRGlzYWJsZWQgIT09ICF0ICYmIGFlKGUpID09PSB0IDogZS5kaXNhYmxlZCA9PT0gdCA6DQoJCQkJCSAgICAgICAibGFiZWwiIGluIGUgJiYgZS5kaXNhYmxlZCA9PT0gdDsNCgkJCQl9Ow0KCQkJfQ0KDQoJCQlmdW5jdGlvbiB5ZShhKSB7DQoJCQkJcmV0dXJuIGxlKGZ1bmN0aW9uKG8pIHsNCgkJCQkJcmV0dXJuIG8gPSArbywgbGUoZnVuY3Rpb24oZSwgdCkgew0KCQkJCQkJdmFyIG4sIHIgPSBhKFtdLCBlLmxlbmd0aCwgbyksIGkgPSByLmxlbmd0aDsNCgkJCQkJCXdoaWxlKGktLSkgZVtuID0gcltpXV0gJiYgKGVbbl0gPSAhKHRbbl0gPSBlW25dKSk7DQoJCQkJCX0pOw0KCQkJCX0pOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiB2ZShlKSB7cmV0dXJuIGUgJiYgInVuZGVmaW5lZCIgIT0gdHlwZW9mIGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUgJiYgZTt9DQoNCgkJCWZvcihlIGluIGQgPSBzZS5zdXBwb3J0ID0ge30sIGkgPSBzZS5pc1hNTCA9IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCA9IGUgJiYgZS5uYW1lc3BhY2VVUkksIG4gPSBlICYmIChlLm93bmVyRG9jdW1lbnQgfHwgZSkuZG9jdW1lbnRFbGVtZW50Ow0KCQkJCXJldHVybiAhWS50ZXN0KHQgfHwgbiAmJiBuLm5vZGVOYW1lIHx8ICJIVE1MIik7DQoJCQl9LCBUID0gc2Uuc2V0RG9jdW1lbnQgPSBmdW5jdGlvbihlKSB7DQoJCQkJdmFyIHQsIG4sIHIgPSBlID8gZS5vd25lckRvY3VtZW50IHx8IGUgOiBwOw0KCQkJCXJldHVybiByICE9IEMgJiYgOSA9PT0gci5ub2RlVHlwZSAmJiByLmRvY3VtZW50RWxlbWVudCAmJiAoYSA9IChDID0gcikuZG9jdW1lbnRFbGVtZW50LCBFID0gIWkoQyksIHAgIT0gQyAmJiAobiA9IEMuZGVmYXVsdFZpZXcpICYmIG4udG9wICE9PSBuICYmIChuLmFkZEV2ZW50TGlzdGVuZXIgPyBuLmFkZEV2ZW50TGlzdGVuZXIoInVubG9hZCIsIG9lLCAhMSkgOiBuLmF0dGFjaEV2ZW50ICYmIG4uYXR0YWNoRXZlbnQoIm9udW5sb2FkIiwgb2UpKSwgZC5zY29wZSA9IGNlKGZ1bmN0aW9uKGUpIHsNCgkJCQkJcmV0dXJuIGEuYXBwZW5kQ2hpbGQoZSkNCgkJCQkJICAgICAgICAuYXBwZW5kQ2hpbGQoQy5jcmVhdGVFbGVtZW50KCJkaXYiKSksICJ1bmRlZmluZWQiICE9IHR5cGVvZiBlLnF1ZXJ5U2VsZWN0b3JBbGwgJiYgIWUucXVlcnlTZWxlY3RvckFsbCgiOnNjb3BlIGZpZWxkc2V0IGRpdiIpLmxlbmd0aDsNCgkJCQl9KSwgZC5jc3NIYXMgPSBjZShmdW5jdGlvbigpIHt0cnkge3JldHVybiBDLnF1ZXJ5U2VsZWN0b3IoIjpoYXMoKiw6anFmYWtlKSIpLCAhMTt9IGNhdGNoKGUpIHtyZXR1cm4gITA7fX0pLCBkLmF0dHJpYnV0ZXMgPSBjZShmdW5jdGlvbihlKSB7cmV0dXJuIGUuY2xhc3NOYW1lID0gImkiLCAhZS5nZXRBdHRyaWJ1dGUoImNsYXNzTmFtZSIpO30pLCBkLmdldEVsZW1lbnRzQnlUYWdOYW1lID0NCgkJCQkJY2UoZnVuY3Rpb24oZSkge3JldHVybiBlLmFwcGVuZENoaWxkKEMuY3JlYXRlQ29tbWVudCgiIikpLCAhZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLmxlbmd0aDt9KSwgZC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lID0gSy50ZXN0KEMuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSksIGQuZ2V0QnlJZCA9DQoJCQkJCWNlKGZ1bmN0aW9uKGUpIHtyZXR1cm4gYS5hcHBlbmRDaGlsZChlKS5pZCA9IFMsICFDLmdldEVsZW1lbnRzQnlOYW1lIHx8ICFDLmdldEVsZW1lbnRzQnlOYW1lKFMpLmxlbmd0aDt9KSwgZC5nZXRCeUlkID8gKGIuZmlsdGVyLklEID0gZnVuY3Rpb24oZSkgew0KCQkJCQl2YXIgdCA9IGUucmVwbGFjZSh0ZSwgbmUpOw0KCQkJCQlyZXR1cm4gZnVuY3Rpb24oZSkge3JldHVybiBlLmdldEF0dHJpYnV0ZSgiaWQiKSA9PT0gdDt9Ow0KCQkJCX0sIGIuZmluZC5JRCA9IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJaWYoInVuZGVmaW5lZCIgIT0gdHlwZW9mIHQuZ2V0RWxlbWVudEJ5SWQgJiYgRSkgew0KCQkJCQkJdmFyIG4gPSB0LmdldEVsZW1lbnRCeUlkKGUpOw0KCQkJCQkJcmV0dXJuIG4gPyBbbl0gOiBbXTsNCgkJCQkJfQ0KCQkJCX0pIDogKGIuZmlsdGVyLklEID0gZnVuY3Rpb24oZSkgew0KCQkJCQl2YXIgbiA9IGUucmVwbGFjZSh0ZSwgbmUpOw0KCQkJCQlyZXR1cm4gZnVuY3Rpb24oZSkgew0KCQkJCQkJdmFyIHQgPSAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZS5nZXRBdHRyaWJ1dGVOb2RlICYmIGUuZ2V0QXR0cmlidXRlTm9kZSgiaWQiKTsNCgkJCQkJCXJldHVybiB0ICYmIHQudmFsdWUgPT09IG47DQoJCQkJCX07DQoJCQkJfSwgYi5maW5kLklEID0gZnVuY3Rpb24oZSwgdCkgew0KCQkJCQlpZigidW5kZWZpbmVkIiAhPSB0eXBlb2YgdC5nZXRFbGVtZW50QnlJZCAmJiBFKSB7DQoJCQkJCQl2YXIgbiwgciwgaSwgbyA9IHQuZ2V0RWxlbWVudEJ5SWQoZSk7DQoJCQkJCQlpZihvKSB7DQoJCQkJCQkJaWYoKG4gPSBvLmdldEF0dHJpYnV0ZU5vZGUoImlkIikpICYmIG4udmFsdWUgPT09IGUpIHJldHVybiBbb107DQoJCQkJCQkJaSA9IHQuZ2V0RWxlbWVudHNCeU5hbWUoZSksIHIgPSAwOw0KCQkJCQkJCXdoaWxlKG8gPSBpW3IrK10pIGlmKChuID0gby5nZXRBdHRyaWJ1dGVOb2RlKCJpZCIpKSAmJiBuLnZhbHVlID09PSBlKSByZXR1cm4gW29dOw0KCQkJCQkJfQ0KCQkJCQkJcmV0dXJuIFtdOw0KCQkJCQl9DQoJCQkJfSksIGIuZmluZC5UQUcgPSBkLmdldEVsZW1lbnRzQnlUYWdOYW1lID8gZnVuY3Rpb24oZSwgdCkge3JldHVybiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgdC5nZXRFbGVtZW50c0J5VGFnTmFtZSA/IHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoZSkgOiBkLnFzYSA/IHQucXVlcnlTZWxlY3RvckFsbChlKSA6IHZvaWQgMDt9IDogZnVuY3Rpb24oZSwgdCkgew0KCQkJCQl2YXIgbiwNCgkJCQkJICAgIHIgPSBbXSwNCgkJCQkJICAgIGkgPSAwLA0KCQkJCQkgICAgbyA9IHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoZSk7DQoJCQkJCWlmKCIqIiA9PT0gZSkgew0KCQkJCQkJd2hpbGUobiA9IG9baSsrXSkgMSA9PT0gbi5ub2RlVHlwZSAmJiByLnB1c2gobik7DQoJCQkJCQlyZXR1cm4gcjsNCgkJCQkJfQ0KCQkJCQlyZXR1cm4gbzsNCgkJCQl9LCBiLmZpbmQuQ0xBU1MgPSBkLmdldEVsZW1lbnRzQnlDbGFzc05hbWUgJiYgZnVuY3Rpb24oZSwgdCkge2lmKCJ1bmRlZmluZWQiICE9IHR5cGVvZiB0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgJiYgRSkgcmV0dXJuIHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShlKTt9LCBzID0gW10sIHkgPSBbXSwgKGQucXNhID0gSy50ZXN0KEMucXVlcnlTZWxlY3RvckFsbCkpICYmIChjZShmdW5jdGlvbihlKSB7DQoJCQkJCXZhciB0Ow0KCQkJCQlhLmFwcGVuZENoaWxkKGUpLmlubmVySFRNTCA9ICI8YSBpZD0nIiArIFMgKyAiJz48L2E+PHNlbGVjdCBpZD0nIiArIFMgKyAiLVxyXFwnIG1zYWxsb3djYXB0dXJlPScnPjxvcHRpb24gc2VsZWN0ZWQ9Jyc+PC9vcHRpb24+PC9zZWxlY3Q+IiwgZS5xdWVyeVNlbGVjdG9yQWxsKCJbbXNhbGxvd2NhcHR1cmVePScnXSIpLmxlbmd0aCAmJiB5LnB1c2goIlsqXiRdPSIgKyBNICsgIiooPzonJ3xcIlwiKSIpLCBlLnF1ZXJ5U2VsZWN0b3JBbGwoIltzZWxlY3RlZF0iKS5sZW5ndGggfHwNCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeS5wdXNoKCJcXFsiICsNCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE0gKw0KCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiooPzp2YWx1ZXwiICsNCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFIgKw0KCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIikiKSwgZS5xdWVyeVNlbGVjdG9yQWxsKCJbaWR+PSIgKw0KCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFMgKw0KCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItXSIpLmxlbmd0aCB8fA0KCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeS5wdXNoKCJ+PSIpLCAodCA9DQoJCQkJCQlDLmNyZWF0ZUVsZW1lbnQoImlucHV0IikpLnNldEF0dHJpYnV0ZSgibmFtZSIsICIiKSwgZS5hcHBlbmRDaGlsZCh0KSwgZS5xdWVyeVNlbGVjdG9yQWxsKCJbbmFtZT0nJ10iKS5sZW5ndGggfHwgeS5wdXNoKCJcXFsiICsgTSArICIqbmFtZSIgKyBNICsgIio9IiArIE0gKyAiKig/OicnfFwiXCIpIiksIGUucXVlcnlTZWxlY3RvckFsbCgiOmNoZWNrZWQiKS5sZW5ndGggfHwgeS5wdXNoKCI6Y2hlY2tlZCIpLCBlLnF1ZXJ5U2VsZWN0b3JBbGwoImEjIiArDQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUyArDQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIisqIikubGVuZ3RoIHx8DQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5LnB1c2goIi4jLitbK35dIiksIGUucXVlcnlTZWxlY3RvckFsbCgiXFxcZiIpLCB5LnB1c2goIltcXHJcXG5cXGZdIik7DQoJCQkJfSksIGNlKGZ1bmN0aW9uKGUpIHsNCgkJCQkJZS5pbm5lckhUTUwgPSAiPGEgaHJlZj0nJyBkaXNhYmxlZD0nZGlzYWJsZWQnPjwvYT48c2VsZWN0IGRpc2FibGVkPSdkaXNhYmxlZCc+PG9wdGlvbi8+PC9zZWxlY3Q+IjsNCgkJCQkJdmFyIHQgPSBDLmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7DQoJCQkJCXQuc2V0QXR0cmlidXRlKCJ0eXBlIiwgImhpZGRlbiIpLCBlLmFwcGVuZENoaWxkKHQpDQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNldEF0dHJpYnV0ZSgibmFtZSIsICJEIiksIGUucXVlcnlTZWxlY3RvckFsbCgiW25hbWU9ZF0iKS5sZW5ndGggJiYgeS5wdXNoKCJuYW1lIiArIE0gKyAiKlsqXiR8IX5dPz0iKSwgMiAhPT0gZS5xdWVyeVNlbGVjdG9yQWxsKCI6ZW5hYmxlZCIpLmxlbmd0aCAmJiB5LnB1c2goIjplbmFibGVkIiwgIjpkaXNhYmxlZCIpLCBhLmFwcGVuZENoaWxkKGUpLmRpc2FibGVkID0gITAsIDIgIT09DQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucXVlcnlTZWxlY3RvckFsbCgiOmRpc2FibGVkIikubGVuZ3RoICYmDQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkucHVzaCgiOmVuYWJsZWQiLCAiOmRpc2FibGVkIiksIGUucXVlcnlTZWxlY3RvckFsbCgiKiw6eCIpLCB5LnB1c2goIiwuKjoiKTsNCgkJCQl9KSksIChkLm1hdGNoZXNTZWxlY3RvciA9IEsudGVzdChjID0gYS5tYXRjaGVzIHx8IGEud2Via2l0TWF0Y2hlc1NlbGVjdG9yIHx8IGEubW96TWF0Y2hlc1NlbGVjdG9yIHx8IGEub01hdGNoZXNTZWxlY3RvciB8fCBhLm1zTWF0Y2hlc1NlbGVjdG9yKSkgJiYgY2UoZnVuY3Rpb24oZSkge2QuZGlzY29ubmVjdGVkTWF0Y2ggPSBjLmNhbGwoZSwgIioiKSwgYy5jYWxsKGUsICJbcyE9JyddOngiKSwgcy5wdXNoKCIhPSIsIEYpO30pLCBkLmNzc0hhcyB8fCB5LnB1c2goIjpoYXMiKSwgeSA9DQoJCQkJICAgICAgIHkubGVuZ3RoICYmIG5ldyBSZWdFeHAoeS5qb2luKCJ8IikpLCBzID0gcy5sZW5ndGggJiYgbmV3IFJlZ0V4cChzLmpvaW4oInwiKSksIHQgPSBLLnRlc3QoYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiksIHYgPSB0IHx8IEsudGVzdChhLmNvbnRhaW5zKSA/IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJdmFyIG4gPSA5ID09PSBlLm5vZGVUeXBlICYmIGUuZG9jdW1lbnRFbGVtZW50IHx8IGUsDQoJCQkJCSAgICByID0gdCAmJiB0LnBhcmVudE5vZGU7DQoJCQkJCXJldHVybiBlID09PSByIHx8ICEoIXIgfHwgMSAhPT0gci5ub2RlVHlwZSB8fCAhKG4uY29udGFpbnMgPyBuLmNvbnRhaW5zKHIpIDogZS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAmJiAxNiAmIGUuY29tcGFyZURvY3VtZW50UG9zaXRpb24ocikpKTsNCgkJCQl9IDogZnVuY3Rpb24oZSwgdCkgew0KCQkJCQlpZih0KSB3aGlsZSh0ID0gdC5wYXJlbnROb2RlKSBpZih0ID09PSBlKSByZXR1cm4gITA7DQoJCQkJCXJldHVybiAhMTsNCgkJCQl9LCBqID0gdCA/IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJaWYoZSA9PT0gdCkgcmV0dXJuIGwgPSAhMCwgMDsNCgkJCQkJdmFyIG4gPSAhZS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAtICF0LmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uOw0KCQkJCQlyZXR1cm4gbiB8fA0KCQkJCQkgICAgICAgKDEgJiAobiA9IChlLm93bmVyRG9jdW1lbnQgfHwgZSkgPT0gKHQub3duZXJEb2N1bWVudCB8fCB0KSA/IGUuY29tcGFyZURvY3VtZW50UG9zaXRpb24odCkgOiAxKSB8fCAhZC5zb3J0RGV0YWNoZWQgJiYgdC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihlKSA9PT0gbiA/DQoJCQkJCSAgICAgICBlID09IEMgfHwgZS5vd25lckRvY3VtZW50ID09IHAgJiYgdihwLCBlKSA/IC0xIDogdCA9PSBDIHx8IHQub3duZXJEb2N1bWVudCA9PSBwICYmIHYocCwgdCkgPyAxIDogdSA/IFAodSwgZSkgLSBQKHUsIHQpIDogMCA6DQoJCQkJCSAgICAgICAgNCAmIG4gPyAtMSA6IDEpOw0KCQkJCX0gOiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJCWlmKGUgPT09IHQpIHJldHVybiBsID0gITAsIDA7DQoJCQkJCXZhciBuLCByID0gMCwgaSA9IGUucGFyZW50Tm9kZSwgbyA9IHQucGFyZW50Tm9kZSwgYSA9IFtlXSwgcyA9IFt0XTsNCgkJCQkJaWYoIWkgfHwgIW8pIHJldHVybiBlID09IEMgPyAtMSA6IHQgPT0gQyA/IDEgOiBpID8gLTEgOiBvID8gMSA6IHUgPyBQKHUsIGUpIC0gUCh1LCB0KSA6IDA7DQoJCQkJCWlmKGkgPT09IG8pIHJldHVybiBwZShlLCB0KTsNCgkJCQkJbiA9IGU7DQoJCQkJCXdoaWxlKG4gPSBuLnBhcmVudE5vZGUpIGEudW5zaGlmdChuKTsNCgkJCQkJbiA9IHQ7DQoJCQkJCXdoaWxlKG4gPSBuLnBhcmVudE5vZGUpIHMudW5zaGlmdChuKTsNCgkJCQkJd2hpbGUoYVtyXSA9PT0gc1tyXSkgcisrOw0KCQkJCQlyZXR1cm4gciA/IHBlKGFbcl0sIHNbcl0pIDogYVtyXSA9PSBwID8gLTEgOiBzW3JdID09IHAgPyAxIDogMDsNCgkJCQl9KSwgQzsNCgkJCX0sIHNlLm1hdGNoZXMgPSBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIHNlKGUsIG51bGwsIG51bGwsIHQpO30sIHNlLm1hdGNoZXNTZWxlY3RvciA9IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQlpZihUKGUpLCBkLm1hdGNoZXNTZWxlY3RvciAmJiBFICYmICFOW3QgKyAiICJdICYmICghcyB8fCAhcy50ZXN0KHQpKSAmJiAoIXkgfHwgIXkudGVzdCh0KSkpIHsNCgkJCQkJdHJ5IHsNCgkJCQkJCXZhciBuID0gYy5jYWxsKGUsIHQpOw0KCQkJCQkJaWYobiB8fCBkLmRpc2Nvbm5lY3RlZE1hdGNoIHx8IGUuZG9jdW1lbnQgJiYgMTEgIT09IGUuZG9jdW1lbnQubm9kZVR5cGUpIHJldHVybiBuOw0KCQkJCQl9IGNhdGNoKGUpIHtOKHQsICEwKTt9DQoJCQkJfQ0KCQkJCXJldHVybiAwIDwgc2UodCwgQywgbnVsbCwgW2VdKS5sZW5ndGg7DQoJCQl9LCBzZS5jb250YWlucyA9IGZ1bmN0aW9uKGUsIHQpIHtyZXR1cm4gKGUub3duZXJEb2N1bWVudCB8fCBlKSAhPSBDICYmIFQoZSksIHYoZSwgdCk7fSwgc2UuYXR0ciA9IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkoZS5vd25lckRvY3VtZW50IHx8IGUpICE9IEMgJiYgVChlKTsNCgkJCQl2YXIgbiA9IGIuYXR0ckhhbmRsZVt0LnRvTG93ZXJDYXNlKCldLCByID0gbiAmJiBELmNhbGwoYi5hdHRySGFuZGxlLCB0LnRvTG93ZXJDYXNlKCkpID8gbihlLCB0LCAhRSkgOiB2b2lkIDA7DQoJCQkJcmV0dXJuIHZvaWQgMCAhPT0gciA/IHIgOiBkLmF0dHJpYnV0ZXMgfHwgIUUgPyBlLmdldEF0dHJpYnV0ZSh0KSA6IChyID0gZS5nZXRBdHRyaWJ1dGVOb2RlKHQpKSAmJiByLnNwZWNpZmllZCA/IHIudmFsdWUgOiBudWxsOw0KCQkJfSwgc2UuZXNjYXBlID0gZnVuY3Rpb24oZSkge3JldHVybiAoZSArICIiKS5yZXBsYWNlKHJlLCBpZSk7fSwgc2UuZXJyb3IgPSBmdW5jdGlvbihlKSB7dGhyb3cgbmV3IEVycm9yKCJTeW50YXggZXJyb3IsIHVucmVjb2duaXplZCBleHByZXNzaW9uOiAiICsgZSk7fSwgc2UudW5pcXVlU29ydCA9IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCwNCgkJCQkgICAgbiA9IFtdLA0KCQkJCSAgICByID0gMCwNCgkJCQkgICAgaSA9IDA7DQoJCQkJaWYobCA9ICFkLmRldGVjdER1cGxpY2F0ZXMsIHUgPSAhZC5zb3J0U3RhYmxlICYmIGUuc2xpY2UoMCksIGUuc29ydChqKSwgbCkgew0KCQkJCQl3aGlsZSh0ID0gZVtpKytdKSB0ID09PSBlW2ldICYmIChyID0gbi5wdXNoKGkpKTsNCgkJCQkJd2hpbGUoci0tKSBlLnNwbGljZShuW3JdLCAxKTsNCgkJCQl9DQoJCQkJcmV0dXJuIHUgPSBudWxsLCBlOw0KCQkJfSwgbyA9IHNlLmdldFRleHQgPSBmdW5jdGlvbihlKSB7DQoJCQkJdmFyIHQsIG4gPSAiIiwgciA9IDAsIGkgPSBlLm5vZGVUeXBlOw0KCQkJCWlmKGkpIHsNCgkJCQkJaWYoMSA9PT0gaSB8fCA5ID09PSBpIHx8IDExID09PSBpKSB7DQoJCQkJCQlpZigic3RyaW5nIiA9PSB0eXBlb2YgZS50ZXh0Q29udGVudCkgcmV0dXJuIGUudGV4dENvbnRlbnQ7DQoJCQkJCQlmb3IoZSA9IGUuZmlyc3RDaGlsZDsgZTsgZSA9IGUubmV4dFNpYmxpbmcpIG4gKz0gbyhlKTsNCgkJCQkJfSBlbHNlIGlmKDMgPT09IGkgfHwgNCA9PT0gaSkgcmV0dXJuIGUubm9kZVZhbHVlOw0KCQkJCX0gZWxzZSB7DQoJCQkJCXdoaWxlKHQgPSBlW3IrK10pIG4gKz0gbyh0KTsNCgkJCQl9DQoJCQkJcmV0dXJuIG47DQoJCQl9LCAoYiA9IHNlLnNlbGVjdG9ycyA9IHsNCgkJCQljYWNoZUxlbmd0aDogNTAsDQoJCQkJY3JlYXRlUHNldWRvOiBsZSwNCgkJCQltYXRjaDogRywNCgkJCQlhdHRySGFuZGxlOiB7fSwNCgkJCQlmaW5kOiB7fSwNCgkJCQlyZWxhdGl2ZTogeyI+Ijoge2RpcjogInBhcmVudE5vZGUiLCBmaXJzdDogITB9LCAiICI6IHtkaXI6ICJwYXJlbnROb2RlIn0sICIrIjoge2RpcjogInByZXZpb3VzU2libGluZyIsIGZpcnN0OiAhMH0sICJ+Ijoge2RpcjogInByZXZpb3VzU2libGluZyJ9fSwNCgkJCQlwcmVGaWx0ZXI6IHsNCgkJCQkJQVRUUjogZnVuY3Rpb24oZSkge3JldHVybiBlWzFdID0gZVsxXS5yZXBsYWNlKHRlLCBuZSksIGVbM10gPSAoZVszXSB8fCBlWzRdIHx8IGVbNV0gfHwgIiIpLnJlcGxhY2UodGUsIG5lKSwgIn49IiA9PT0gZVsyXSAmJiAoZVszXSA9ICIgIiArIGVbM10gKyAiICIpLCBlLnNsaWNlKDAsIDQpO30sDQoJCQkJCUNISUxEOiBmdW5jdGlvbihlKSB7cmV0dXJuIGVbMV0gPSBlWzFdLnRvTG93ZXJDYXNlKCksICJudGgiID09PSBlWzFdLnNsaWNlKDAsIDMpID8gKGVbM10gfHwgc2UuZXJyb3IoZVswXSksIGVbNF0gPSArKGVbNF0gPyBlWzVdICsgKGVbNl0gfHwgMSkgOiAyICogKCJldmVuIiA9PT0gZVszXSB8fCAib2RkIiA9PT0gZVszXSkpLCBlWzVdID0gKyhlWzddICsgZVs4XSB8fCAib2RkIiA9PT0gZVszXSkpIDogZVszXSAmJiBzZS5lcnJvcihlWzBdKSwgZTt9LA0KCQkJCQlQU0VVRE86IGZ1bmN0aW9uKGUpIHsNCgkJCQkJCXZhciB0LCBuID0gIWVbNl0gJiYgZVsyXTsNCgkJCQkJCXJldHVybiBHLkNISUxELnRlc3QoZVswXSkgPyBudWxsIDogKGVbM10gPyBlWzJdID0gZVs0XSB8fCBlWzVdIHx8ICIiIDogbiAmJiBYLnRlc3QobikgJiYgKHQgPSBoKG4sICEwKSkgJiYgKHQgPSBuLmluZGV4T2YoIikiLCBuLmxlbmd0aCAtIHQpIC0gbi5sZW5ndGgpICYmIChlWzBdID0gZVswXS5zbGljZSgwLCB0KSwgZVsyXSA9IG4uc2xpY2UoMCwgdCkpLCBlLnNsaWNlKDAsIDMpKTsNCgkJCQkJfQ0KCQkJCX0sDQoJCQkJZmlsdGVyOiB7DQoJCQkJCVRBRzogZnVuY3Rpb24oZSkgew0KCQkJCQkJdmFyIHQgPSBlLnJlcGxhY2UodGUsIG5lKS50b0xvd2VyQ2FzZSgpOw0KCQkJCQkJcmV0dXJuICIqIiA9PT0gZSA/IGZ1bmN0aW9uKCkge3JldHVybiAhMDt9IDogZnVuY3Rpb24oZSkge3JldHVybiBlLm5vZGVOYW1lICYmIGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gdDt9Ow0KCQkJCQl9LCBDTEFTUzogZnVuY3Rpb24oZSkgew0KCQkJCQkJdmFyIHQgPSBtW2UgKyAiICJdOw0KCQkJCQkJcmV0dXJuIHQgfHwgKHQgPSBuZXcgUmVnRXhwKCIoXnwiICsgTSArICIpIiArIGUgKyAiKCIgKyBNICsgInwkKSIpKSAmJiBtKGUsIGZ1bmN0aW9uKGUpIHtyZXR1cm4gdC50ZXN0KCJzdHJpbmciID09IHR5cGVvZiBlLmNsYXNzTmFtZSAmJiBlLmNsYXNzTmFtZSB8fCAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZS5nZXRBdHRyaWJ1dGUgJiYgZS5nZXRBdHRyaWJ1dGUoImNsYXNzIikgfHwgIiIpO30pOw0KCQkJCQl9LCBBVFRSOiBmdW5jdGlvbihuLCByLCBpKSB7DQoJCQkJCQlyZXR1cm4gZnVuY3Rpb24oZSkgew0KCQkJCQkJCXZhciB0ID0gc2UuYXR0cihlLCBuKTsNCgkJCQkJCQlyZXR1cm4gbnVsbCA9PSB0ID8NCgkJCQkJCQkgICAgICAgIiE9IiA9PT0gciA6DQoJCQkJCQkJICAgICAgICFyIHx8DQoJCQkJCQkJICAgICAgICh0ICs9ICIiLCAiPSIgPT09IHIgPw0KCQkJCQkJCSAgICAgICAgICAgICAgICAgdCA9PT0gaSA6DQoJCQkJCQkJICAgICAgICAgICAgICAgICAiIT0iID09PSByID8NCgkJCQkJCQkgICAgICAgICAgICAgICAgIHQgIT09IGkgOg0KCQkJCQkJCSAgICAgICAgICAgICAgICAgIl49IiA9PT0gciA/IGkgJiYgMCA9PT0gdC5pbmRleE9mKGkpIDogIio9IiA9PT0gciA/IGkgJiYgLTEgPCB0LmluZGV4T2YoaSkgOiAiJD0iID09PSByID8gaSAmJiB0LnNsaWNlKC1pLmxlbmd0aCkgPT09IGkgOiAifj0iID09PSByID8gLTEgPCAoIiAiICsgdC5yZXBsYWNlKCQsICIgIikgKyAiICIpLmluZGV4T2YoaSkgOiAifD0iID09PSByICYmICh0ID09PSBpIHx8IHQuc2xpY2UoMCwgaS5sZW5ndGggKyAxKSA9PT0gaSArICItIikpOw0KCQkJCQkJfTsNCgkJCQkJfSwgQ0hJTEQ6IGZ1bmN0aW9uKGgsIGUsIHQsIGcsIHkpIHsNCgkJCQkJCXZhciB2ID0gIm50aCIgIT09IGguc2xpY2UoMCwgMyksIG0gPSAibGFzdCIgIT09IGguc2xpY2UoLTQpLCB4ID0gIm9mLXR5cGUiID09PSBlOw0KCQkJCQkJcmV0dXJuIDEgPT09IGcgJiYgMCA9PT0geSA/IGZ1bmN0aW9uKGUpIHtyZXR1cm4gISFlLnBhcmVudE5vZGU7fSA6IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQkJCQl2YXIgciwNCgkJCQkJCQkgICAgaSwNCgkJCQkJCQkgICAgbywNCgkJCQkJCQkgICAgYSwNCgkJCQkJCQkgICAgcywNCgkJCQkJCQkgICAgdSwNCgkJCQkJCQkgICAgbCA9IHYgIT09IG0gPyAibmV4dFNpYmxpbmciIDogInByZXZpb3VzU2libGluZyIsDQoJCQkJCQkJICAgIGMgPSBlLnBhcmVudE5vZGUsDQoJCQkJCQkJICAgIGYgPSB4ICYmIGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSwNCgkJCQkJCQkgICAgcCA9ICFuICYmICF4LA0KCQkJCQkJCSAgICBkID0gITE7DQoJCQkJCQkJaWYoYykgew0KCQkJCQkJCQlpZih2KSB7DQoJCQkJCQkJCQl3aGlsZShsKSB7DQoJCQkJCQkJCQkJYSA9IGU7DQoJCQkJCQkJCQkJd2hpbGUoYSA9IGFbbF0pIGlmKHggPyBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IGYgOiAxID09PSBhLm5vZGVUeXBlKSByZXR1cm4gITE7DQoJCQkJCQkJCQkJdSA9IGwgPSAib25seSIgPT09IGggJiYgIXUgJiYgIm5leHRTaWJsaW5nIjsNCgkJCQkJCQkJCX0NCgkJCQkJCQkJCXJldHVybiAhMDsNCgkJCQkJCQkJfQ0KCQkJCQkJCQlpZih1ID0gW20gPyBjLmZpcnN0Q2hpbGQgOiBjLmxhc3RDaGlsZF0sIG0gJiYgcCkgew0KCQkJCQkJCQkJZCA9IChzID0gKHIgPSAoaSA9IChvID0gKGEgPSBjKVtTXSB8fCAoYVtTXSA9IHt9KSlbYS51bmlxdWVJRF0gfHwgKG9bYS51bmlxdWVJRF0gPSB7fSkpW2hdIHx8IFtdKVswXSA9PT0gayAmJiByWzFdKSAmJiByWzJdLCBhID0gcyAmJiBjLmNoaWxkTm9kZXNbc107DQoJCQkJCQkJCQl3aGlsZShhID0gKytzICYmIGEgJiYgYVtsXSB8fCAoZCA9IHMgPSAwKSB8fCB1LnBvcCgpKSB7DQoJCQkJCQkJCQkJaWYoMSA9PT0gYS5ub2RlVHlwZSAmJiArK2QgJiYgYSA9PT0gZSkgew0KCQkJCQkJCQkJCQlpW2hdID0gW2ssIHMsIGRdOw0KCQkJCQkJCQkJCQlicmVhazsNCgkJCQkJCQkJCQl9DQoJCQkJCQkJCQl9DQoJCQkJCQkJCX0gZWxzZSBpZihwICYmIChkID0gcyA9IChyID0gKGkgPSAobyA9IChhID0gZSlbU10gfHwgKGFbU10gPSB7fSkpW2EudW5pcXVlSURdIHx8IChvW2EudW5pcXVlSURdID0ge30pKVtoXSB8fCBbXSlbMF0gPT09IGsgJiYgclsxXSksICExID09PSBkKSB7DQoJCQkJCQkJCQl3aGlsZShhID0gKytzICYmIGEgJiYgYVtsXSB8fCAoZCA9IHMgPSAwKSB8fCB1LnBvcCgpKSB7DQoJCQkJCQkJCQkJaWYoKHggPyBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IGYgOiAxID09PSBhLm5vZGVUeXBlKSAmJiArK2QgJiYgKHAgJiYgKChpID0gKG8gPSBhW1NdIHx8IChhW1NdID0ge30pKVthLnVuaXF1ZUlEXSB8fCAob1thLnVuaXF1ZUlEXSA9IHt9KSlbaF0gPSBbaywNCgkJCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkXSksIGEgPT09IGUpKSB7DQoJCQkJCQkJCQkJCWJyZWFrOw0KCQkJCQkJCQkJCX0NCgkJCQkJCQkJCX0NCgkJCQkJCQkJfQ0KCQkJCQkJCQlyZXR1cm4gKGQgLT0geSkgPT09IGcgfHwgZCAlIGcgPT0gMCAmJiAwIDw9IGQgLyBnOw0KCQkJCQkJCX0NCgkJCQkJCX07DQoJCQkJCX0sIFBTRVVETzogZnVuY3Rpb24oZSwgbykgew0KCQkJCQkJdmFyIHQsIGEgPSBiLnBzZXVkb3NbZV0gfHwgYi5zZXRGaWx0ZXJzW2UudG9Mb3dlckNhc2UoKV0gfHwgc2UuZXJyb3IoInVuc3VwcG9ydGVkIHBzZXVkbzogIiArIGUpOw0KCQkJCQkJcmV0dXJuIGFbU10gPyBhKG8pIDogMSA8IGEubGVuZ3RoID8gKHQgPSBbZSwgZSwgIiIsIG9dLCBiLnNldEZpbHRlcnMuaGFzT3duUHJvcGVydHkoZS50b0xvd2VyQ2FzZSgpKSA/IGxlKGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJCQl2YXIgbiwgciA9IGEoZSwgbyksIGkgPSByLmxlbmd0aDsNCgkJCQkJCQl3aGlsZShpLS0pIGVbbiA9IFAoZSwgcltpXSldID0gISh0W25dID0gcltpXSk7DQoJCQkJCQl9KSA6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gYShlLCAwLCB0KTt9KSA6IGE7DQoJCQkJCX0NCgkJCQl9LA0KCQkJCXBzZXVkb3M6IHsNCgkJCQkJbm90OiBsZShmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgciA9IFtdLCBpID0gW10sIHMgPSBmKGUucmVwbGFjZShCLCAiJDEiKSk7DQoJCQkJCQlyZXR1cm4gc1tTXSA/IGxlKGZ1bmN0aW9uKGUsIHQsIG4sIHIpIHsNCgkJCQkJCQl2YXIgaSwgbyA9IHMoZSwgbnVsbCwgciwgW10pLCBhID0gZS5sZW5ndGg7DQoJCQkJCQkJd2hpbGUoYS0tKSAoaSA9IG9bYV0pICYmIChlW2FdID0gISh0W2FdID0gaSkpOw0KCQkJCQkJfSkgOiBmdW5jdGlvbihlLCB0LCBuKSB7cmV0dXJuIHJbMF0gPSBlLCBzKHIsIG51bGwsIG4sIGkpLCByWzBdID0gbnVsbCwgIWkucG9wKCk7fTsNCgkJCQkJfSksDQoJCQkJCWhhczogbGUoZnVuY3Rpb24odCkge3JldHVybiBmdW5jdGlvbihlKSB7cmV0dXJuIDAgPCBzZSh0LCBlKS5sZW5ndGg7fTt9KSwNCgkJCQkJY29udGFpbnM6IGxlKGZ1bmN0aW9uKHQpIHtyZXR1cm4gdCA9IHQucmVwbGFjZSh0ZSwgbmUpLCBmdW5jdGlvbihlKSB7cmV0dXJuIC0xIDwgKGUudGV4dENvbnRlbnQgfHwgbyhlKSkuaW5kZXhPZih0KTt9O30pLA0KCQkJCQlsYW5nOiBsZShmdW5jdGlvbihuKSB7DQoJCQkJCQlyZXR1cm4gVi50ZXN0KG4gfHwgIiIpIHx8IHNlLmVycm9yKCJ1bnN1cHBvcnRlZCBsYW5nOiAiICsgbiksIG4gPSBuLnJlcGxhY2UodGUsIG5lKS50b0xvd2VyQ2FzZSgpLCBmdW5jdGlvbihlKSB7DQoJCQkJCQkJdmFyIHQ7DQoJCQkJCQkJZG8ge2lmKHQgPSBFID8gZS5sYW5nIDogZS5nZXRBdHRyaWJ1dGUoInhtbDpsYW5nIikgfHwgZS5nZXRBdHRyaWJ1dGUoImxhbmciKSkgcmV0dXJuICh0ID0gdC50b0xvd2VyQ2FzZSgpKSA9PT0gbiB8fCAwID09PSB0LmluZGV4T2YobiArICItIik7fSB3aGlsZSgoZSA9IGUucGFyZW50Tm9kZSkgJiYgMSA9PT0gZS5ub2RlVHlwZSk7DQoJCQkJCQkJcmV0dXJuICExOw0KCQkJCQkJfTsNCgkJCQkJfSksDQoJCQkJCXRhcmdldDogZnVuY3Rpb24oZSkgew0KCQkJCQkJdmFyIHQgPSBuLmxvY2F0aW9uICYmIG4ubG9jYXRpb24uaGFzaDsNCgkJCQkJCXJldHVybiB0ICYmIHQuc2xpY2UoMSkgPT09IGUuaWQ7DQoJCQkJCX0sDQoJCQkJCXJvb3Q6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gZSA9PT0gYTt9LA0KCQkJCQlmb2N1czogZnVuY3Rpb24oZSkge3JldHVybiBlID09PSBDLmFjdGl2ZUVsZW1lbnQgJiYgKCFDLmhhc0ZvY3VzIHx8IEMuaGFzRm9jdXMoKSkgJiYgISEoZS50eXBlIHx8IGUuaHJlZiB8fCB+ZS50YWJJbmRleCk7fSwNCgkJCQkJZW5hYmxlZDogZ2UoITEpLA0KCQkJCQlkaXNhYmxlZDogZ2UoITApLA0KCQkJCQljaGVja2VkOiBmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgdCA9IGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsNCgkJCQkJCXJldHVybiAiaW5wdXQiID09PSB0ICYmICEhZS5jaGVja2VkIHx8ICJvcHRpb24iID09PSB0ICYmICEhZS5zZWxlY3RlZDsNCgkJCQkJfSwNCgkJCQkJc2VsZWN0ZWQ6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gZS5wYXJlbnROb2RlICYmIGUucGFyZW50Tm9kZS5zZWxlY3RlZEluZGV4LCAhMCA9PT0gZS5zZWxlY3RlZDt9LA0KCQkJCQllbXB0eTogZnVuY3Rpb24oZSkgew0KCQkJCQkJZm9yKGUgPSBlLmZpcnN0Q2hpbGQ7IGU7IGUgPSBlLm5leHRTaWJsaW5nKSBpZihlLm5vZGVUeXBlIDwgNikgcmV0dXJuICExOw0KCQkJCQkJcmV0dXJuICEwOw0KCQkJCQl9LA0KCQkJCQlwYXJlbnQ6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gIWIucHNldWRvcy5lbXB0eShlKTt9LA0KCQkJCQloZWFkZXI6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gSi50ZXN0KGUubm9kZU5hbWUpO30sDQoJCQkJCWlucHV0OiBmdW5jdGlvbihlKSB7cmV0dXJuIFEudGVzdChlLm5vZGVOYW1lKTt9LA0KCQkJCQlidXR0b246IGZ1bmN0aW9uKGUpIHsNCgkJCQkJCXZhciB0ID0gZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOw0KCQkJCQkJcmV0dXJuICJpbnB1dCIgPT09IHQgJiYgImJ1dHRvbiIgPT09IGUudHlwZSB8fCAiYnV0dG9uIiA9PT0gdDsNCgkJCQkJfSwNCgkJCQkJdGV4dDogZnVuY3Rpb24oZSkgew0KCQkJCQkJdmFyIHQ7DQoJCQkJCQlyZXR1cm4gImlucHV0IiA9PT0gZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICYmICJ0ZXh0IiA9PT0gZS50eXBlICYmIChudWxsID09ICh0ID0gZS5nZXRBdHRyaWJ1dGUoInR5cGUiKSkgfHwgInRleHQiID09PSB0LnRvTG93ZXJDYXNlKCkpOw0KCQkJCQl9LA0KCQkJCQlmaXJzdDogeWUoZnVuY3Rpb24oKSB7cmV0dXJuIFswXTt9KSwNCgkJCQkJbGFzdDogeWUoZnVuY3Rpb24oZSwgdCkge3JldHVybiBbdCAtIDFdO30pLA0KCQkJCQllcTogeWUoZnVuY3Rpb24oZSwgdCwgbikge3JldHVybiBbbiA8IDAgPyBuICsgdCA6IG5dO30pLA0KCQkJCQlldmVuOiB5ZShmdW5jdGlvbihlLCB0KSB7DQoJCQkJCQlmb3IodmFyIG4gPSAwOyBuIDwgdDsgbiArPSAyKSBlLnB1c2gobik7DQoJCQkJCQlyZXR1cm4gZTsNCgkJCQkJfSksDQoJCQkJCW9kZDogeWUoZnVuY3Rpb24oZSwgdCkgew0KCQkJCQkJZm9yKHZhciBuID0gMTsgbiA8IHQ7IG4gKz0gMikgZS5wdXNoKG4pOw0KCQkJCQkJcmV0dXJuIGU7DQoJCQkJCX0pLA0KCQkJCQlsdDogeWUoZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCQkJZm9yKHZhciByID0gbiA8IDAgPyBuICsgdCA6IHQgPCBuID8gdCA6IG47IDAgPD0gLS1yOykgZS5wdXNoKHIpOw0KCQkJCQkJcmV0dXJuIGU7DQoJCQkJCX0pLA0KCQkJCQlndDogeWUoZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCQkJZm9yKHZhciByID0gbiA8IDAgPyBuICsgdCA6IG47ICsrciA8IHQ7KSBlLnB1c2gocik7DQoJCQkJCQlyZXR1cm4gZTsNCgkJCQkJfSkNCgkJCQl9DQoJCQl9KS5wc2V1ZG9zLm50aCA9IGIucHNldWRvcy5lcSwge3JhZGlvOiAhMCwgY2hlY2tib3g6ICEwLCBmaWxlOiAhMCwgcGFzc3dvcmQ6ICEwLCBpbWFnZTogITB9KSB7DQoJCQkJYi5wc2V1ZG9zW2VdID0gZGUoZSk7DQoJCQl9DQoJCQlmb3IoZSBpbiB7c3VibWl0OiAhMCwgcmVzZXQ6ICEwfSkgYi5wc2V1ZG9zW2VdID0gaGUoZSk7DQoNCgkJCWZ1bmN0aW9uIG1lKCkge30NCg0KCQkJZnVuY3Rpb24geGUoZSkgew0KCQkJCWZvcih2YXIgdCA9IDAsIG4gPSBlLmxlbmd0aCwgciA9ICIiOyB0IDwgbjsgdCsrKSByICs9IGVbdF0udmFsdWU7DQoJCQkJcmV0dXJuIHI7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGJlKHMsIGUsIHQpIHsNCgkJCQl2YXIgdSA9IGUuZGlyLCBsID0gZS5uZXh0LCBjID0gbCB8fCB1LCBmID0gdCAmJiAicGFyZW50Tm9kZSIgPT09IGMsIHAgPSByKys7DQoJCQkJcmV0dXJuIGUuZmlyc3QgPyBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJCXdoaWxlKGUgPSBlW3VdKSBpZigxID09PSBlLm5vZGVUeXBlIHx8IGYpIHJldHVybiBzKGUsIHQsIG4pOw0KCQkJCQlyZXR1cm4gITE7DQoJCQkJfSA6IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQkJdmFyIHIsIGksIG8sIGEgPSBbaywgcF07DQoJCQkJCWlmKG4pIHt3aGlsZShlID0gZVt1XSkgaWYoKDEgPT09IGUubm9kZVR5cGUgfHwgZikgJiYgcyhlLCB0LCBuKSkgcmV0dXJuICEwO30gZWxzZSB7DQoJCQkJCQl3aGlsZShlID0gZVt1XSkgew0KCQkJCQkJCWlmKDEgPT09IGUubm9kZVR5cGUgfHwgZikgew0KCQkJCQkJCQlpZihpID0gKG8gPSBlW1NdIHx8IChlW1NdID0ge30pKVtlLnVuaXF1ZUlEXSB8fCAob1tlLnVuaXF1ZUlEXSA9IHt9KSwgbCAmJiBsID09PSBlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkpIHsNCgkJCQkJCQkJCWUgPSBlW3VdIHx8IGU7DQoJCQkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJCQlpZigociA9IGlbY10pICYmIHJbMF0gPT09IGsgJiYgclsxXSA9PT0gcCkgcmV0dXJuIGFbMl0gPSByWzJdOw0KCQkJCQkJCQkJaWYoKGlbY10gPSBhKVsyXSA9IHMoZSwgdCwgbikpIHJldHVybiAhMDsNCgkJCQkJCQkJfQ0KCQkJCQkJCX0NCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQlyZXR1cm4gITE7DQoJCQkJfTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gd2UoaSkgew0KCQkJCXJldHVybiAxIDwgaS5sZW5ndGggPyBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJCXZhciByID0gaS5sZW5ndGg7DQoJCQkJCXdoaWxlKHItLSkgaWYoIWlbcl0oZSwgdCwgbikpIHJldHVybiAhMTsNCgkJCQkJcmV0dXJuICEwOw0KCQkJCX0gOiBpWzBdOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBUZShlLCB0LCBuLCByLCBpKSB7DQoJCQkJZm9yKHZhciBvLCBhID0gW10sIHMgPSAwLCB1ID0gZS5sZW5ndGgsIGwgPSBudWxsICE9IHQ7IHMgPCB1OyBzKyspIChvID0gZVtzXSkgJiYgKG4gJiYgIW4obywgciwgaSkgfHwgKGEucHVzaChvKSwgbCAmJiB0LnB1c2gocykpKTsNCgkJCQlyZXR1cm4gYTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gQ2UoZCwgaCwgZywgeSwgdiwgZSkgew0KCQkJCXJldHVybiB5ICYmICF5W1NdICYmICh5ID0gQ2UoeSkpLCB2ICYmICF2W1NdICYmICh2ID0gQ2UodiwgZSkpLCBsZShmdW5jdGlvbihlLCB0LCBuLCByKSB7DQoJCQkJCXZhciBpLA0KCQkJCQkgICAgbywNCgkJCQkJICAgIGEsDQoJCQkJCSAgICBzID0gW10sDQoJCQkJCSAgICB1ID0gW10sDQoJCQkJCSAgICBsID0gdC5sZW5ndGgsDQoJCQkJCSAgICBjID0gZSB8fCBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJCQkgICAgZm9yKHZhciByID0gMCwgaSA9IHQubGVuZ3RoOyByIDwgaTsgcisrKSBzZShlLCB0W3JdLCBuKTsNCgkJCQkJCSAgICByZXR1cm4gbjsNCgkJCQkJICAgIH0oaCB8fCAiKiIsIG4ubm9kZVR5cGUgPyBbbl0gOiBuLCBbXSksDQoJCQkJCSAgICBmID0gIWQgfHwgIWUgJiYgaCA/IGMgOiBUZShjLCBzLCBkLCBuLCByKSwNCgkJCQkJICAgIHAgPSBnID8gdiB8fCAoZSA/IGQgOiBsIHx8IHkpID8gW10gOiB0IDogZjsNCgkJCQkJaWYoZyAmJiBnKGYsIHAsIG4sIHIpLCB5KSB7DQoJCQkJCQlpID0gVGUocCwgdSksIHkoaSwgW10sIG4sIHIpLCBvID0gaS5sZW5ndGg7DQoJCQkJCQl3aGlsZShvLS0pIChhID0gaVtvXSkgJiYgKHBbdVtvXV0gPSAhKGZbdVtvXV0gPSBhKSk7DQoJCQkJCX0NCgkJCQkJaWYoZSkgew0KCQkJCQkJaWYodiB8fCBkKSB7DQoJCQkJCQkJaWYodikgew0KCQkJCQkJCQlpID0gW10sIG8gPSBwLmxlbmd0aDsNCgkJCQkJCQkJd2hpbGUoby0tKSAoYSA9IHBbb10pICYmIGkucHVzaChmW29dID0gYSk7DQoJCQkJCQkJCXYobnVsbCwgcCA9IFtdLCBpLCByKTsNCgkJCQkJCQl9DQoJCQkJCQkJbyA9IHAubGVuZ3RoOw0KCQkJCQkJCXdoaWxlKG8tLSkgKGEgPSBwW29dKSAmJiAtMSA8IChpID0gdiA/IFAoZSwgYSkgOiBzW29dKSAmJiAoZVtpXSA9ICEodFtpXSA9IGEpKTsNCgkJCQkJCX0NCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXAgPSBUZShwID09PSB0ID8gcC5zcGxpY2UobCwgcC5sZW5ndGgpIDogcCksIHYgPyB2KG51bGwsIHQsIHAsIHIpIDogSC5hcHBseSh0LCBwKTsNCgkJCQkJfQ0KCQkJCX0pOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBFZShlKSB7DQoJCQkJZm9yKHZhciBpLCB0LCBuLCByID0gZS5sZW5ndGgsIG8gPSBiLnJlbGF0aXZlW2VbMF0udHlwZV0sIGEgPSBvIHx8IGIucmVsYXRpdmVbIiAiXSwgcyA9IG8gPyAxIDogMCwgdSA9IGJlKGZ1bmN0aW9uKGUpIHtyZXR1cm4gZSA9PT0gaTt9LCBhLCAhMCksIGwgPSBiZShmdW5jdGlvbihlKSB7cmV0dXJuIC0xIDwgUChpLCBlKTt9LCBhLCAhMCksIGMgPSBbZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCQl2YXIgciA9ICFvICYmIChuIHx8IHQgIT09IHcpIHx8ICgoaSA9IHQpLm5vZGVUeXBlID8gdShlLCB0LCBuKSA6IGwoZSwgdCwgbikpOw0KCQkJCQlyZXR1cm4gaSA9IG51bGwsIHI7DQoJCQkJfV07IHMgPCByOyBzKyspIHsNCgkJCQkJaWYodCA9IGIucmVsYXRpdmVbZVtzXS50eXBlXSkgew0KCQkJCQkJYyA9IFtiZSh3ZShjKSwgdCldOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJaWYoKHQgPSBiLmZpbHRlcltlW3NdLnR5cGVdLmFwcGx5KG51bGwsIGVbc10ubWF0Y2hlcykpW1NdKSB7DQoJCQkJCQkJZm9yKG4gPSArK3M7IG4gPCByOyBuKyspIGlmKGIucmVsYXRpdmVbZVtuXS50eXBlXSkgYnJlYWs7DQoJCQkJCQkJcmV0dXJuIENlKDEgPCBzICYmIHdlKGMpLCAxIDwgcyAmJiB4ZShlLnNsaWNlKDAsIHMgLSAxKS5jb25jYXQoe3ZhbHVlOiAiICIgPT09IGVbcyAtIDJdLnR5cGUgPyAiKiIgOiAiIn0pKQ0KCQkJCQkJCQkucmVwbGFjZShCLCAiJDEiKSwgdCwgcyA8IG4gJiYgRWUoZS5zbGljZShzLCBuKSksIG4gPCByICYmIEVlKGUgPSBlLnNsaWNlKG4pKSwgbiA8IHIgJiYgeGUoZSkpOw0KCQkJCQkJfQ0KCQkJCQkJYy5wdXNoKHQpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJCXJldHVybiB3ZShjKTsNCgkJCX0NCg0KCQkJcmV0dXJuIG1lLnByb3RvdHlwZSA9IGIuZmlsdGVycyA9IGIucHNldWRvcywgYi5zZXRGaWx0ZXJzID0gbmV3IG1lLCBoID0gc2UudG9rZW5pemUgPSBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4sIHIsIGksIG8sIGEsIHMsIHUsIGwgPSB4W2UgKyAiICJdOw0KCQkJCWlmKGwpIHJldHVybiB0ID8gMCA6IGwuc2xpY2UoMCk7DQoJCQkJYSA9IGUsIHMgPSBbXSwgdSA9IGIucHJlRmlsdGVyOw0KCQkJCXdoaWxlKGEpIHsNCgkJCQkJZm9yKG8gaW4gbiAmJiAhKHIgPSBfLmV4ZWMoYSkpIHx8IChyICYmIChhID0gYS5zbGljZShyWzBdLmxlbmd0aCkgfHwgYSksIHMucHVzaChpID0gW10pKSwgbiA9ICExLCAociA9IHouZXhlYyhhKSkgJiYgKG4gPSByLnNoaWZ0KCksIGkucHVzaCh7DQoJCQkJCQl2YWx1ZTogbiwNCgkJCQkJCXR5cGU6IHJbMF0ucmVwbGFjZShCLCAiICIpDQoJCQkJCX0pLCBhID0gYS5zbGljZShuLmxlbmd0aCkpLCBiLmZpbHRlcikgew0KCQkJCQkJIShyID0gR1tvXS5leGVjKGEpKSB8fCB1W29dICYmICEociA9IHVbb10ocikpIHx8IChuID0gci5zaGlmdCgpLCBpLnB1c2goe3ZhbHVlOiBuLCB0eXBlOiBvLCBtYXRjaGVzOiByfSksIGEgPSBhLnNsaWNlKG4ubGVuZ3RoKSk7DQoJCQkJCX0NCgkJCQkJaWYoIW4pIGJyZWFrOw0KCQkJCX0NCgkJCQlyZXR1cm4gdCA/IGEubGVuZ3RoIDogYSA/IHNlLmVycm9yKGUpIDogeChlLCBzKS5zbGljZSgwKTsNCgkJCX0sIGYgPSBzZS5jb21waWxlID0gZnVuY3Rpb24oZSwgdCkgew0KCQkJCXZhciBuLCB5LCB2LCBtLCB4LCByLCBpID0gW10sIG8gPSBbXSwgYSA9IEFbZSArICIgIl07DQoJCQkJaWYoIWEpIHsNCgkJCQkJdCB8fCAodCA9IGgoZSkpLCBuID0gdC5sZW5ndGg7DQoJCQkJCXdoaWxlKG4tLSkgKGEgPSBFZSh0W25dKSlbU10gPyBpLnB1c2goYSkgOiBvLnB1c2goYSk7DQoJCQkJCShhID0gQShlLCAoeSA9IG8sIG0gPSAwIDwgKHYgPSBpKS5sZW5ndGgsIHggPSAwIDwgeS5sZW5ndGgsIHIgPSBmdW5jdGlvbihlLCB0LCBuLCByLCBpKSB7DQoJCQkJCQl2YXIgbywNCgkJCQkJCSAgICBhLA0KCQkJCQkJICAgIHMsDQoJCQkJCQkgICAgdSA9IDAsDQoJCQkJCQkgICAgbCA9ICIwIiwNCgkJCQkJCSAgICBjID0gZSAmJiBbXSwNCgkJCQkJCSAgICBmID0gW10sDQoJCQkJCQkgICAgcCA9IHcsDQoJCQkJCQkgICAgZCA9IGUgfHwgeCAmJiBiLmZpbmQuVEFHKCIqIiwgaSksDQoJCQkJCQkgICAgaCA9IGsgKz0gbnVsbCA9PSBwID8gMSA6IE1hdGgucmFuZG9tKCkgfHwgLjEsDQoJCQkJCQkgICAgZyA9IGQubGVuZ3RoOw0KCQkJCQkJZm9yKGkgJiYgKHcgPSB0ID09IEMgfHwgdCB8fCBpKTsgbCAhPT0gZyAmJiBudWxsICE9IChvID0gZFtsXSk7IGwrKykgew0KCQkJCQkJCWlmKHggJiYgbykgew0KCQkJCQkJCQlhID0gMCwgdCB8fCBvLm93bmVyRG9jdW1lbnQgPT0gQyB8fCAoVChvKSwgbiA9ICFFKTsNCgkJCQkJCQkJd2hpbGUocyA9IHlbYSsrXSkgew0KCQkJCQkJCQkJaWYocyhvLCB0IHx8IEMsIG4pKSB7DQoJCQkJCQkJCQkJci5wdXNoKG8pOw0KCQkJCQkJCQkJCWJyZWFrOw0KCQkJCQkJCQkJfQ0KCQkJCQkJCQl9DQoJCQkJCQkJCWkgJiYgKGsgPSBoKTsNCgkJCQkJCQl9DQoJCQkJCQkJbSAmJiAoKG8gPSAhcyAmJiBvKSAmJiB1LS0sIGUgJiYgYy5wdXNoKG8pKTsNCgkJCQkJCX0NCgkJCQkJCWlmKHUgKz0gbCwgbSAmJiBsICE9PSB1KSB7DQoJCQkJCQkJYSA9IDA7DQoJCQkJCQkJd2hpbGUocyA9IHZbYSsrXSkgcyhjLCBmLCB0LCBuKTsNCgkJCQkJCQlpZihlKSB7DQoJCQkJCQkJCWlmKDAgPCB1KSB3aGlsZShsLS0pIGNbbF0gfHwgZltsXSB8fCAoZltsXSA9IHEuY2FsbChyKSk7DQoJCQkJCQkJCWYgPSBUZShmKTsNCgkJCQkJCQl9DQoJCQkJCQkJSC5hcHBseShyLCBmKSwgaSAmJiAhZSAmJiAwIDwgZi5sZW5ndGggJiYgMSA8IHUgKyB2Lmxlbmd0aCAmJiBzZS51bmlxdWVTb3J0KHIpOw0KCQkJCQkJfQ0KCQkJCQkJcmV0dXJuIGkgJiYgKGsgPSBoLCB3ID0gcCksIGM7DQoJCQkJCX0sIG0gPyBsZShyKSA6IHIpKSkuc2VsZWN0b3IgPSBlOw0KCQkJCX0NCgkJCQlyZXR1cm4gYTsNCgkJCX0sIGcgPSBzZS5zZWxlY3QgPSBmdW5jdGlvbihlLCB0LCBuLCByKSB7DQoJCQkJdmFyIGksIG8sIGEsIHMsIHUsIGwgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBlICYmIGUsIGMgPSAhciAmJiBoKGUgPSBsLnNlbGVjdG9yIHx8IGUpOw0KCQkJCWlmKG4gPSBuIHx8IFtdLCAxID09PSBjLmxlbmd0aCkgew0KCQkJCQlpZigyIDwgKG8gPSBjWzBdID0gY1swXS5zbGljZSgwKSkubGVuZ3RoICYmICJJRCIgPT09IChhID0gb1swXSkudHlwZSAmJiA5ID09PSB0Lm5vZGVUeXBlICYmIEUgJiYgYi5yZWxhdGl2ZVtvWzFdLnR5cGVdKSB7DQoJCQkJCQlpZighKHQgPSAoYi5maW5kLklEKGEubWF0Y2hlc1swXS5yZXBsYWNlKHRlLCBuZSksIHQpIHx8IFtdKVswXSkpIHJldHVybiBuOw0KCQkJCQkJbCAmJiAodCA9IHQucGFyZW50Tm9kZSksIGUgPSBlLnNsaWNlKG8uc2hpZnQoKS52YWx1ZS5sZW5ndGgpOw0KCQkJCQl9DQoJCQkJCWkgPSBHLm5lZWRzQ29udGV4dC50ZXN0KGUpID8gMCA6IG8ubGVuZ3RoOw0KCQkJCQl3aGlsZShpLS0pIHsNCgkJCQkJCWlmKGEgPSBvW2ldLCBiLnJlbGF0aXZlW3MgPSBhLnR5cGVdKSBicmVhazsNCgkJCQkJCWlmKCh1ID0gYi5maW5kW3NdKSAmJiAociA9IHUoYS5tYXRjaGVzWzBdLnJlcGxhY2UodGUsIG5lKSwgZWUudGVzdChvWzBdLnR5cGUpICYmIHZlKHQucGFyZW50Tm9kZSkgfHwgdCkpKSB7DQoJCQkJCQkJaWYoby5zcGxpY2UoaSwgMSksICEoZSA9IHIubGVuZ3RoICYmIHhlKG8pKSkgcmV0dXJuIEguYXBwbHkobiwgciksIG47DQoJCQkJCQkJYnJlYWs7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9DQoJCQkJcmV0dXJuIChsIHx8IGYoZSwgYykpKHIsIHQsICFFLCBuLCAhdCB8fCBlZS50ZXN0KGUpICYmIHZlKHQucGFyZW50Tm9kZSkgfHwgdCksIG47DQoJCQl9LCBkLnNvcnRTdGFibGUgPSBTLnNwbGl0KCIiKQ0KCQkJICAgICAgICAgICAgICAgICAgIC5zb3J0KGopDQoJCQkgICAgICAgICAgICAgICAgICAgLmpvaW4oIiIpID09PSBTLCBkLmRldGVjdER1cGxpY2F0ZXMgPSAhIWwsIFQoKSwgZC5zb3J0RGV0YWNoZWQgPSBjZShmdW5jdGlvbihlKSB7cmV0dXJuIDEgJiBlLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKEMuY3JlYXRlRWxlbWVudCgiZmllbGRzZXQiKSk7fSksIGNlKGZ1bmN0aW9uKGUpIHtyZXR1cm4gZS5pbm5lckhUTUwgPSAiPGEgaHJlZj0nIyc+PC9hPiIsICIjIiA9PT0gZS5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSgiaHJlZiIpO30pIHx8DQoJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZlKCJ0eXBlfGhyZWZ8aGVpZ2h0fHdpZHRoIiwgZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIW4pIHJldHVybiBlLmdldEF0dHJpYnV0ZSh0LCAidHlwZSIgPT09IHQudG9Mb3dlckNhc2UoKSA/DQoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEgOg0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAyKTsNCgkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGQuYXR0cmlidXRlcyAmJg0KCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2UoZnVuY3Rpb24oZSkgew0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlLmlubmVySFRNTCA9ICI8aW5wdXQvPiIsIGUuZmlyc3RDaGlsZC5zZXRBdHRyaWJ1dGUoInZhbHVlIiwgIiIpLCAiIiA9PT0NCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSgidmFsdWUiKTsNCgkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pIHx8DQoJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmZSgidmFsdWUiLCBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIW4gJiYNCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaW5wdXQiID09PQ0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSkgcmV0dXJuIGUuZGVmYXVsdFZhbHVlOw0KCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGNlKGZ1bmN0aW9uKGUpIHtyZXR1cm4gbnVsbCA9PSBlLmdldEF0dHJpYnV0ZSgiZGlzYWJsZWQiKTt9KSB8fCBmZShSLCBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJdmFyIHI7DQoJCQkJaWYoIW4pIHJldHVybiAhMCA9PT0gZVt0XSA/IHQudG9Mb3dlckNhc2UoKSA6IChyID0gZS5nZXRBdHRyaWJ1dGVOb2RlKHQpKSAmJiByLnNwZWNpZmllZCA/IHIudmFsdWUgOiBudWxsOw0KCQkJfSksIHNlOw0KCQl9KEMpOw0KCQlTLmZpbmQgPSBkLCBTLmV4cHIgPSBkLnNlbGVjdG9ycywgUy5leHByWyI6Il0gPSBTLmV4cHIucHNldWRvcywgUy51bmlxdWVTb3J0ID0gUy51bmlxdWUgPSBkLnVuaXF1ZVNvcnQsIFMudGV4dCA9IGQuZ2V0VGV4dCwgUy5pc1hNTERvYyA9IGQuaXNYTUwsIFMuY29udGFpbnMgPSBkLmNvbnRhaW5zLCBTLmVzY2FwZVNlbGVjdG9yID0gZC5lc2NhcGU7DQoJCXZhciBoID0gZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJdmFyIHIgPSBbXSwgaSA9IHZvaWQgMCAhPT0gbjsNCgkJCXdoaWxlKChlID0gZVt0XSkgJiYgOSAhPT0gZS5ub2RlVHlwZSkgew0KCQkJCWlmKDEgPT09IGUubm9kZVR5cGUpIHsNCgkJCQkJaWYoaSAmJiBTKGUpLmlzKG4pKSBicmVhazsNCgkJCQkJci5wdXNoKGUpOw0KCQkJCX0NCgkJCX0NCgkJCXJldHVybiByOw0KCQl9LCBUICA9IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCWZvcih2YXIgbiA9IFtdOyBlOyBlID0gZS5uZXh0U2libGluZykgMSA9PT0gZS5ub2RlVHlwZSAmJiBlICE9PSB0ICYmIG4ucHVzaChlKTsNCgkJCXJldHVybiBuOw0KCQl9LCBrICA9IFMuZXhwci5tYXRjaC5uZWVkc0NvbnRleHQ7DQoNCgkJZnVuY3Rpb24gQShlLCB0KSB7cmV0dXJuIGUubm9kZU5hbWUgJiYgZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSB0LnRvTG93ZXJDYXNlKCk7fQ0KDQoJCXZhciBOID0gL148KFthLXpdW15cL1wwPjpceDIwXHRcclxuXGZdKilbXHgyMFx0XHJcblxmXSpcLz8+KD86PFwvXDE+fCkkL2k7DQoNCgkJZnVuY3Rpb24gaihlLCBuLCByKSB7cmV0dXJuIG0obikgPyBTLmdyZXAoZSwgZnVuY3Rpb24oZSwgdCkge3JldHVybiAhIW4uY2FsbChlLCB0LCBlKSAhPT0gcjt9KSA6IG4ubm9kZVR5cGUgPyBTLmdyZXAoZSwgZnVuY3Rpb24oZSkge3JldHVybiBlID09PSBuICE9PSByO30pIDogInN0cmluZyIgIT0gdHlwZW9mIG4gPyBTLmdyZXAoZSwgZnVuY3Rpb24oZSkge3JldHVybiAtMSA8IGkuY2FsbChuLCBlKSAhPT0gcjt9KSA6IFMuZmlsdGVyKG4sIGUsIHIpO30NCg0KCQlTLmZpbHRlciA9IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCXZhciByID0gdFswXTsNCgkJCXJldHVybiBuICYmIChlID0gIjpub3QoIiArIGUgKyAiKSIpLCAxID09PSB0Lmxlbmd0aCAmJiAxID09PSByLm5vZGVUeXBlID8gUy5maW5kLm1hdGNoZXNTZWxlY3RvcihyLCBlKSA/IFtyXSA6IFtdIDogUy5maW5kLm1hdGNoZXMoZSwgUy5ncmVwKHQsIGZ1bmN0aW9uKGUpIHtyZXR1cm4gMSA9PT0gZS5ub2RlVHlwZTt9KSk7DQoJCX0sIFMuZm4uZXh0ZW5kKHsNCgkJCWZpbmQ6IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCwgbiwgciA9IHRoaXMubGVuZ3RoLCBpID0gdGhpczsNCgkJCQlpZigic3RyaW5nIiAhPSB0eXBlb2YgZSkgcmV0dXJuIHRoaXMucHVzaFN0YWNrKFMoZSkuZmlsdGVyKGZ1bmN0aW9uKCkge2Zvcih0ID0gMDsgdCA8IHI7IHQrKykgaWYoUy5jb250YWlucyhpW3RdLCB0aGlzKSkgcmV0dXJuICEwO30pKTsNCgkJCQlmb3IobiA9IHRoaXMucHVzaFN0YWNrKFtdKSwgdCA9IDA7IHQgPCByOyB0KyspIFMuZmluZChlLCBpW3RdLCBuKTsNCgkJCQlyZXR1cm4gMSA8IHIgPyBTLnVuaXF1ZVNvcnQobikgOiBuOw0KCQkJfSwNCgkJCWZpbHRlcjogZnVuY3Rpb24oZSkge3JldHVybiB0aGlzLnB1c2hTdGFjayhqKHRoaXMsIGUgfHwgW10sICExKSk7fSwNCgkJCW5vdDogZnVuY3Rpb24oZSkge3JldHVybiB0aGlzLnB1c2hTdGFjayhqKHRoaXMsIGUgfHwgW10sICEwKSk7fSwNCgkJCWlzOiBmdW5jdGlvbihlKSB7cmV0dXJuICEhaih0aGlzLCAic3RyaW5nIiA9PSB0eXBlb2YgZSAmJiBrLnRlc3QoZSkgPyBTKGUpIDogZSB8fCBbXSwgITEpLmxlbmd0aDt9DQoJCX0pOw0KCQl2YXIgRCwgcSA9IC9eKD86XHMqKDxbXHdcV10rPilbXj5dKnwjKFtcdy1dKykpJC87DQoJCShTLmZuLmluaXQgPSBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQl2YXIgciwgaTsNCgkJCWlmKCFlKSByZXR1cm4gdGhpczsNCgkJCWlmKG4gPSBuIHx8IEQsICJzdHJpbmciID09IHR5cGVvZiBlKSB7DQoJCQkJaWYoIShyID0gIjwiID09PSBlWzBdICYmICI+IiA9PT0gZVtlLmxlbmd0aCAtIDFdICYmIDMgPD0gZS5sZW5ndGggPyBbbnVsbCwNCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLA0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGxdIDogcS5leGVjKGUpKSB8fCAhclsxXSAmJiB0KSB7DQoJCQkJCXJldHVybiAhdCB8fCB0LmpxdWVyeSA/ICh0IHx8IG4pLmZpbmQoZSkgOiB0aGlzLmNvbnN0cnVjdG9yKHQpDQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbmQoZSk7DQoJCQkJfQ0KCQkJCWlmKHJbMV0pIHsNCgkJCQkJaWYodCA9IHQgaW5zdGFuY2VvZiBTID8gdFswXSA6IHQsIFMubWVyZ2UodGhpcywgUy5wYXJzZUhUTUwoclsxXSwgdCAmJiB0Lm5vZGVUeXBlID8gdC5vd25lckRvY3VtZW50IHx8IHQgOiBFLCAhMCkpLCBOLnRlc3QoclsxXSkgJiYgUy5pc1BsYWluT2JqZWN0KHQpKSBmb3IociBpbiB0KSBtKHRoaXNbcl0pID8gdGhpc1tyXSh0W3JdKSA6IHRoaXMuYXR0cihyLCB0W3JdKTsNCgkJCQkJcmV0dXJuIHRoaXM7DQoJCQkJfQ0KCQkJCXJldHVybiAoaSA9IEUuZ2V0RWxlbWVudEJ5SWQoclsyXSkpICYmICh0aGlzWzBdID0gaSwgdGhpcy5sZW5ndGggPSAxKSwgdGhpczsNCgkJCX0NCgkJCXJldHVybiBlLm5vZGVUeXBlID8gKHRoaXNbMF0gPSBlLCB0aGlzLmxlbmd0aCA9IDEsIHRoaXMpIDogbShlKSA/IHZvaWQgMCAhPT0gbi5yZWFkeSA/IG4ucmVhZHkoZSkgOiBlKFMpIDogUy5tYWtlQXJyYXkoZSwgdGhpcyk7DQoJCX0pLnByb3RvdHlwZSA9IFMuZm4sIEQgPSBTKEUpOw0KCQl2YXIgTCA9IC9eKD86cGFyZW50c3xwcmV2KD86VW50aWx8QWxsKSkvLCBIID0ge2NoaWxkcmVuOiAhMCwgY29udGVudHM6ICEwLCBuZXh0OiAhMCwgcHJldjogITB9Ow0KDQoJCWZ1bmN0aW9uIE8oZSwgdCkgew0KCQkJd2hpbGUoKGUgPSBlW3RdKSAmJiAxICE9PSBlLm5vZGVUeXBlKSA7DQoJCQlyZXR1cm4gZTsNCgkJfQ0KDQoJCVMuZm4uZXh0ZW5kKHsNCgkJCWhhczogZnVuY3Rpb24oZSkgew0KCQkJCXZhciB0ID0gUyhlLCB0aGlzKSwgbiA9IHQubGVuZ3RoOw0KCQkJCXJldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbigpIHtmb3IodmFyIGUgPSAwOyBlIDwgbjsgZSsrKSBpZihTLmNvbnRhaW5zKHRoaXMsIHRbZV0pKSByZXR1cm4gITA7fSk7DQoJCQl9LA0KCQkJY2xvc2VzdDogZnVuY3Rpb24oZSwgdCkgew0KCQkJCXZhciBuLCByID0gMCwgaSA9IHRoaXMubGVuZ3RoLCBvID0gW10sIGEgPSAic3RyaW5nIiAhPSB0eXBlb2YgZSAmJiBTKGUpOw0KCQkJCWlmKCFrLnRlc3QoZSkpIHsNCgkJCQkJZm9yKDsgciA8IGk7IHIrKykgew0KCQkJCQkJZm9yKG4gPSB0aGlzW3JdOyBuICYmIG4gIT09IHQ7IG4gPSBuLnBhcmVudE5vZGUpIHsNCgkJCQkJCQlpZihuLm5vZGVUeXBlIDwgMTEgJiYgKGEgPyAtMSA8IGEuaW5kZXgobikgOiAxID09PSBuLm5vZGVUeXBlICYmIFMuZmluZC5tYXRjaGVzU2VsZWN0b3IobiwgZSkpKSB7DQoJCQkJCQkJCW8ucHVzaChuKTsNCgkJCQkJCQkJYnJlYWs7DQoJCQkJCQkJfQ0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfQ0KCQkJCXJldHVybiB0aGlzLnB1c2hTdGFjaygxIDwgby5sZW5ndGggPyBTLnVuaXF1ZVNvcnQobykgOiBvKTsNCgkJCX0sDQoJCQlpbmRleDogZnVuY3Rpb24oZSkge3JldHVybiBlID8gInN0cmluZyIgPT0gdHlwZW9mIGUgPyBpLmNhbGwoUyhlKSwgdGhpc1swXSkgOiBpLmNhbGwodGhpcywgZS5qcXVlcnkgPyBlWzBdIDogZSkgOiB0aGlzWzBdICYmIHRoaXNbMF0ucGFyZW50Tm9kZSA/IHRoaXMuZmlyc3QoKS5wcmV2QWxsKCkubGVuZ3RoIDogLTE7fSwNCgkJCWFkZDogZnVuY3Rpb24oZSwgdCkge3JldHVybiB0aGlzLnB1c2hTdGFjayhTLnVuaXF1ZVNvcnQoUy5tZXJnZSh0aGlzLmdldCgpLCBTKGUsIHQpKSkpO30sDQoJCQlhZGRCYWNrOiBmdW5jdGlvbihlKSB7cmV0dXJuIHRoaXMuYWRkKG51bGwgPT0gZSA/IHRoaXMucHJldk9iamVjdCA6IHRoaXMucHJldk9iamVjdC5maWx0ZXIoZSkpO30NCgkJfSksIFMuZWFjaCh7DQoJCQlwYXJlbnQ6IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCA9IGUucGFyZW50Tm9kZTsNCgkJCQlyZXR1cm4gdCAmJiAxMSAhPT0gdC5ub2RlVHlwZSA/IHQgOiBudWxsOw0KCQkJfSwNCgkJCXBhcmVudHM6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gaChlLCAicGFyZW50Tm9kZSIpO30sDQoJCQlwYXJlbnRzVW50aWw6IGZ1bmN0aW9uKGUsIHQsIG4pIHtyZXR1cm4gaChlLCAicGFyZW50Tm9kZSIsIG4pO30sDQoJCQluZXh0OiBmdW5jdGlvbihlKSB7cmV0dXJuIE8oZSwgIm5leHRTaWJsaW5nIik7fSwNCgkJCXByZXY6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gTyhlLCAicHJldmlvdXNTaWJsaW5nIik7fSwNCgkJCW5leHRBbGw6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gaChlLCAibmV4dFNpYmxpbmciKTt9LA0KCQkJcHJldkFsbDogZnVuY3Rpb24oZSkge3JldHVybiBoKGUsICJwcmV2aW91c1NpYmxpbmciKTt9LA0KCQkJbmV4dFVudGlsOiBmdW5jdGlvbihlLCB0LCBuKSB7cmV0dXJuIGgoZSwgIm5leHRTaWJsaW5nIiwgbik7fSwNCgkJCXByZXZVbnRpbDogZnVuY3Rpb24oZSwgdCwgbikge3JldHVybiBoKGUsICJwcmV2aW91c1NpYmxpbmciLCBuKTt9LA0KCQkJc2libGluZ3M6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gVCgoZS5wYXJlbnROb2RlIHx8IHt9KS5maXJzdENoaWxkLCBlKTt9LA0KCQkJY2hpbGRyZW46IGZ1bmN0aW9uKGUpIHtyZXR1cm4gVChlLmZpcnN0Q2hpbGQpO30sDQoJCQljb250ZW50czogZnVuY3Rpb24oZSkge3JldHVybiBudWxsICE9IGUuY29udGVudERvY3VtZW50ICYmIHIoZS5jb250ZW50RG9jdW1lbnQpID8gZS5jb250ZW50RG9jdW1lbnQgOiAoQShlLCAidGVtcGxhdGUiKSAmJiAoZSA9IGUuY29udGVudCB8fCBlKSwgUy5tZXJnZShbXSwgZS5jaGlsZE5vZGVzKSk7fQ0KCQl9LCBmdW5jdGlvbihyLCBpKSB7DQoJCQlTLmZuW3JdID0gZnVuY3Rpb24oZSwgdCkgew0KCQkJCXZhciBuID0gUy5tYXAodGhpcywgaSwgZSk7DQoJCQkJcmV0dXJuICJVbnRpbCIgIT09IHIuc2xpY2UoLTUpICYmICh0ID0gZSksIHQgJiYgInN0cmluZyIgPT0gdHlwZW9mIHQgJiYgKG4gPSBTLmZpbHRlcih0LCBuKSksIDEgPCB0aGlzLmxlbmd0aCAmJiAoSFtyXSB8fCBTLnVuaXF1ZVNvcnQobiksIEwudGVzdChyKSAmJiBuLnJldmVyc2UoKSksIHRoaXMucHVzaFN0YWNrKG4pOw0KCQkJfTsNCgkJfSk7DQoJCXZhciBQID0gL1teXHgyMFx0XHJcblxmXSsvZzsNCg0KCQlmdW5jdGlvbiBSKGUpIHtyZXR1cm4gZTt9DQoNCgkJZnVuY3Rpb24gTShlKSB7dGhyb3cgZTt9DQoNCgkJZnVuY3Rpb24gSShlLCB0LCBuLCByKSB7DQoJCQl2YXIgaTsNCgkJCXRyeSB7ZSAmJiBtKGkgPSBlLnByb21pc2UpID8gaS5jYWxsKGUpLmRvbmUodCkuZmFpbChuKSA6IGUgJiYgbShpID0gZS50aGVuKSA/IGkuY2FsbChlLCB0LCBuKSA6IHQuYXBwbHkodm9pZCAwLCBbZV0uc2xpY2UocikpO30gY2F0Y2goZSkge24uYXBwbHkodm9pZCAwLCBbZV0pO30NCgkJfQ0KDQoJCVMuQ2FsbGJhY2tzID0gZnVuY3Rpb24ocikgew0KCQkJdmFyIGUsIG47DQoJCQlyID0gInN0cmluZyIgPT0gdHlwZW9mIHIgPyAoZSA9IHIsIG4gPSB7fSwgUy5lYWNoKGUubWF0Y2goUCkgfHwgW10sIGZ1bmN0aW9uKGUsIHQpIHtuW3RdID0gITA7fSksIG4pIDogUy5leHRlbmQoe30sIHIpOw0KCQkJdmFyIGksDQoJCQkgICAgdCwNCgkJCSAgICBvLA0KCQkJICAgIGEsDQoJCQkgICAgcyA9IFtdLA0KCQkJICAgIHUgPSBbXSwNCgkJCSAgICBsID0gLTEsDQoJCQkgICAgYyA9IGZ1bmN0aW9uKCkgew0KCQkJCSAgICBmb3IoYSA9IGEgfHwgci5vbmNlLCBvID0gaSA9ICEwOyB1Lmxlbmd0aDsgbCA9IC0xKSB7DQoJCQkJCSAgICB0ID0gdS5zaGlmdCgpOw0KCQkJCQkgICAgd2hpbGUoKytsIDwgcy5sZW5ndGgpICExID09PSBzW2xdLmFwcGx5KHRbMF0sIHRbMV0pICYmIHIuc3RvcE9uRmFsc2UgJiYgKGwgPSBzLmxlbmd0aCwgdCA9ICExKTsNCgkJCQkgICAgfQ0KCQkJCSAgICByLm1lbW9yeSB8fCAodCA9ICExKSwgaSA9ICExLCBhICYmIChzID0gdCA/IFtdIDogIiIpOw0KCQkJICAgIH0sDQoJCQkgICAgZiA9IHsNCgkJCQkgICAgYWRkOiBmdW5jdGlvbigpIHtyZXR1cm4gcyAmJiAodCAmJiAhaSAmJiAobCA9IHMubGVuZ3RoIC0gMSwgdS5wdXNoKHQpKSwgZnVuY3Rpb24gbihlKSB7Uy5lYWNoKGUsIGZ1bmN0aW9uKGUsIHQpIHttKHQpID8gci51bmlxdWUgJiYgZi5oYXModCkgfHwgcy5wdXNoKHQpIDogdCAmJiB0Lmxlbmd0aCAmJiAic3RyaW5nIiAhPT0gdyh0KSAmJiBuKHQpO30pO30oYXJndW1lbnRzKSwgdCAmJiAhaSAmJiBjKCkpLCB0aGlzO30sDQoJCQkJICAgIHJlbW92ZTogZnVuY3Rpb24oKSB7DQoJCQkJCSAgICByZXR1cm4gUy5lYWNoKGFyZ3VtZW50cywgZnVuY3Rpb24oZSwgdCkgew0KCQkJCQkJICAgIHZhciBuOw0KCQkJCQkJICAgIHdoaWxlKC0xIDwgKG4gPSBTLmluQXJyYXkodCwgcywgbikpKSBzLnNwbGljZShuLCAxKSwgbiA8PSBsICYmIGwtLTsNCgkJCQkJICAgIH0pLCB0aGlzOw0KCQkJCSAgICB9LA0KCQkJCSAgICBoYXM6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gZSA/IC0xIDwgUy5pbkFycmF5KGUsIHMpIDogMCA8IHMubGVuZ3RoO30sDQoJCQkJICAgIGVtcHR5OiBmdW5jdGlvbigpIHtyZXR1cm4gcyAmJiAocyA9IFtdKSwgdGhpczt9LA0KCQkJCSAgICBkaXNhYmxlOiBmdW5jdGlvbigpIHtyZXR1cm4gYSA9IHUgPSBbXSwgcyA9IHQgPSAiIiwgdGhpczt9LA0KCQkJCSAgICBkaXNhYmxlZDogZnVuY3Rpb24oKSB7cmV0dXJuICFzO30sDQoJCQkJICAgIGxvY2s6IGZ1bmN0aW9uKCkge3JldHVybiBhID0gdSA9IFtdLCB0IHx8IGkgfHwgKHMgPSB0ID0gIiIpLCB0aGlzO30sDQoJCQkJICAgIGxvY2tlZDogZnVuY3Rpb24oKSB7cmV0dXJuICEhYTt9LA0KCQkJCSAgICBmaXJlV2l0aDogZnVuY3Rpb24oZSwgdCkge3JldHVybiBhIHx8ICh0ID0gW2UsICh0ID0gdCB8fCBbXSkuc2xpY2UgPyB0LnNsaWNlKCkgOiB0XSwgdS5wdXNoKHQpLCBpIHx8IGMoKSksIHRoaXM7fSwNCgkJCQkgICAgZmlyZTogZnVuY3Rpb24oKSB7cmV0dXJuIGYuZmlyZVdpdGgodGhpcywgYXJndW1lbnRzKSwgdGhpczt9LA0KCQkJCSAgICBmaXJlZDogZnVuY3Rpb24oKSB7cmV0dXJuICEhbzt9DQoJCQkgICAgfTsNCgkJCXJldHVybiBmOw0KCQl9LCBTLmV4dGVuZCh7DQoJCQlEZWZlcnJlZDogZnVuY3Rpb24oZSkgew0KCQkJCXZhciBvICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPSBbWyJub3RpZnkiLCAicHJvZ3Jlc3MiLCBTLkNhbGxiYWNrcygibWVtb3J5IiksIFMuQ2FsbGJhY2tzKCJtZW1vcnkiKSwgMl0sDQoJCQkJCVsicmVzb2x2ZSIsICJkb25lIiwgUy5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksIFMuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLCAwLCAicmVzb2x2ZWQiXSwNCgkJCQkJWyJyZWplY3QiLCAiZmFpbCIsIFMuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLCBTLkNhbGxiYWNrcygib25jZSBtZW1vcnkiKSwgMSwgInJlamVjdGVkIl1dLCBpID0gInBlbmRpbmciLCBhID0gew0KCQkJCQlzdGF0ZTogZnVuY3Rpb24oKSB7cmV0dXJuIGk7fSwNCgkJCQkJYWx3YXlzOiBmdW5jdGlvbigpIHtyZXR1cm4gcy5kb25lKGFyZ3VtZW50cykuZmFpbChhcmd1bWVudHMpLCB0aGlzO30sDQoJCQkJCSJjYXRjaCI6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gYS50aGVuKG51bGwsIGUpO30sDQoJCQkJCXBpcGU6IGZ1bmN0aW9uKCkgew0KCQkJCQkJdmFyIGkgPSBhcmd1bWVudHM7DQoJCQkJCQlyZXR1cm4gUy5EZWZlcnJlZChmdW5jdGlvbihyKSB7DQoJCQkJCQkJUy5lYWNoKG8sIGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJCQkJdmFyIG4gPSBtKGlbdFs0XV0pICYmIGlbdFs0XV07DQoJCQkJCQkJCXNbdFsxXV0oZnVuY3Rpb24oKSB7DQoJCQkJCQkJCQl2YXIgZSA9IG4gJiYgbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOw0KCQkJCQkJCQkJZSAmJiBtKGUucHJvbWlzZSkgPyBlLnByb21pc2UoKS5wcm9ncmVzcyhyLm5vdGlmeSkuZG9uZShyLnJlc29sdmUpLmZhaWwoci5yZWplY3QpIDogclt0WzBdICsgIldpdGgiXSh0aGlzLCBuID8gW2VdIDogYXJndW1lbnRzKTsNCgkJCQkJCQkJfSk7DQoJCQkJCQkJfSksIGkgPSBudWxsOw0KCQkJCQkJfSkucHJvbWlzZSgpOw0KCQkJCQl9LA0KCQkJCQl0aGVuOiBmdW5jdGlvbih0LCBuLCByKSB7DQoJCQkJCQl2YXIgdSA9IDA7DQoNCgkJCQkJCWZ1bmN0aW9uIGwoaSwgbywgYSwgcykgew0KCQkJCQkJCXJldHVybiBmdW5jdGlvbigpIHsNCgkJCQkJCQkJdmFyIG4gPSB0aGlzLA0KCQkJCQkJCQkgICAgciA9IGFyZ3VtZW50cywNCgkJCQkJCQkJICAgIGUgPSBmdW5jdGlvbigpIHsNCgkJCQkJCQkJCSAgICB2YXIgZSwgdDsNCgkJCQkJCQkJCSAgICBpZighKGkgPCB1KSkgew0KCQkJCQkJCQkJCSAgICBpZigoZSA9IGEuYXBwbHkobiwgcikpID09PSBvLnByb21pc2UoKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiVGhlbmFibGUgc2VsZi1yZXNvbHV0aW9uIik7DQoJCQkJCQkJCQkJICAgIHQgPSBlICYmICgib2JqZWN0IiA9PSB0eXBlb2YgZSB8fCAiZnVuY3Rpb24iID09IHR5cGVvZiBlKSAmJiBlLnRoZW4sIG0odCkgPw0KCQkJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID8gdC5jYWxsKGUsIGwodSwgbywgUiwgcyksIGwodSwgbywgTSwgcykpIDogKHUrKywgdC5jYWxsKGUsIGwodSwgbywgUiwgcyksIGwodSwgbywgTSwgcyksIGwodSwgbywgUiwgby5ub3RpZnlXaXRoKSkpIDoNCgkJCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGEgIT09IFIgJiYgKG4gPSB2b2lkIDAsIHIgPSBbZV0pLCAocyB8fCBvLnJlc29sdmVXaXRoKShuLCByKSk7DQoJCQkJCQkJCQkgICAgfQ0KCQkJCQkJCQkgICAgfSwNCgkJCQkJCQkJICAgIHQgPSBzID8gZSA6IGZ1bmN0aW9uKCkge3RyeSB7ZSgpO30gY2F0Y2goZSkge1MuRGVmZXJyZWQuZXhjZXB0aW9uSG9vayAmJiBTLkRlZmVycmVkLmV4Y2VwdGlvbkhvb2soZSwgdC5zdGFja1RyYWNlKSwgdSA8PSBpICsgMSAmJiAoYSAhPT0gTSAmJiAobiA9IHZvaWQgMCwgciA9IFtlXSksIG8ucmVqZWN0V2l0aChuLCByKSk7fX07DQoJCQkJCQkJCWkgPyB0KCkgOiAoUy5EZWZlcnJlZC5nZXRTdGFja0hvb2sgJiYgKHQuc3RhY2tUcmFjZSA9IFMuRGVmZXJyZWQuZ2V0U3RhY2tIb29rKCkpLCBDLnNldFRpbWVvdXQodCkpOw0KCQkJCQkJCX07DQoJCQkJCQl9DQoNCgkJCQkJCXJldHVybiBTLkRlZmVycmVkKGZ1bmN0aW9uKGUpIHtvWzBdWzNdLmFkZChsKDAsIGUsIG0ocikgPyByIDogUiwgZS5ub3RpZnlXaXRoKSksIG9bMV1bM10uYWRkKGwoMCwgZSwgbSh0KSA/IHQgOiBSKSksIG9bMl1bM10uYWRkKGwoMCwgZSwgbShuKSA/IG4gOiBNKSk7fSkucHJvbWlzZSgpOw0KCQkJCQl9LA0KCQkJCQlwcm9taXNlOiBmdW5jdGlvbihlKSB7cmV0dXJuIG51bGwgIT0gZSA/IFMuZXh0ZW5kKGUsIGEpIDogYTt9DQoJCQkJfSwgcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA9IHt9Ow0KCQkJCXJldHVybiBTLmVhY2gobywgZnVuY3Rpb24oZSwgdCkgew0KCQkJCQl2YXIgbiA9IHRbMl0sIHIgPSB0WzVdOw0KCQkJCQlhW3RbMV1dID0gbi5hZGQsIHIgJiYgbi5hZGQoZnVuY3Rpb24oKSB7aSA9IHI7fSwgb1szIC0gZV1bMl0uZGlzYWJsZSwgb1szIC0gZV1bM10uZGlzYWJsZSwgb1swXVsyXS5sb2NrLCBvWzBdWzNdLmxvY2spLCBuLmFkZCh0WzNdLmZpcmUpLCBzW3RbMF1dID0gZnVuY3Rpb24oKSB7cmV0dXJuIHNbdFswXSArICJXaXRoIl0odGhpcyA9PT0gcyA/IHZvaWQgMCA6IHRoaXMsIGFyZ3VtZW50cyksIHRoaXM7fSwgc1t0WzBdICsgIldpdGgiXSA9IG4uZmlyZVdpdGg7DQoJCQkJfSksIGEucHJvbWlzZShzKSwgZSAmJiBlLmNhbGwocywgcyksIHM7DQoJCQl9LA0KCQkJd2hlbjogZnVuY3Rpb24oZSkgew0KCQkJCXZhciBuID0gYXJndW1lbnRzLmxlbmd0aCwNCgkJCQkgICAgdCA9IG4sDQoJCQkJICAgIHIgPSBBcnJheSh0KSwNCgkJCQkgICAgaSA9IHMuY2FsbChhcmd1bWVudHMpLA0KCQkJCSAgICBvID0gUy5EZWZlcnJlZCgpLA0KCQkJCSAgICBhID0gZnVuY3Rpb24odCkge3JldHVybiBmdW5jdGlvbihlKSB7clt0XSA9IHRoaXMsIGlbdF0gPSAxIDwgYXJndW1lbnRzLmxlbmd0aCA/IHMuY2FsbChhcmd1bWVudHMpIDogZSwgLS1uIHx8IG8ucmVzb2x2ZVdpdGgociwgaSk7fTt9Ow0KCQkJCWlmKG4gPD0gMSAmJiAoSShlLCBvLmRvbmUoYSh0KSkucmVzb2x2ZSwgby5yZWplY3QsICFuKSwgInBlbmRpbmciID09PSBvLnN0YXRlKCkgfHwgbShpW3RdICYmIGlbdF0udGhlbikpKSByZXR1cm4gby50aGVuKCk7DQoJCQkJd2hpbGUodC0tKSBJKGlbdF0sIGEodCksIG8ucmVqZWN0KTsNCgkJCQlyZXR1cm4gby5wcm9taXNlKCk7DQoJCQl9DQoJCX0pOw0KCQl2YXIgVyA9IC9eKEV2YWx8SW50ZXJuYWx8UmFuZ2V8UmVmZXJlbmNlfFN5bnRheHxUeXBlfFVSSSlFcnJvciQvOw0KCQlTLkRlZmVycmVkLmV4Y2VwdGlvbkhvb2sgPSBmdW5jdGlvbihlLCB0KSB7Qy5jb25zb2xlICYmIEMuY29uc29sZS53YXJuICYmIGUgJiYgVy50ZXN0KGUubmFtZSkgJiYgQy5jb25zb2xlLndhcm4oImpRdWVyeS5EZWZlcnJlZCBleGNlcHRpb246ICIgKyBlLm1lc3NhZ2UsIGUuc3RhY2ssIHQpO30sIFMucmVhZHlFeGNlcHRpb24gPSBmdW5jdGlvbihlKSB7Qy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkge3Rocm93IGU7fSk7fTsNCgkJdmFyIEYgPSBTLkRlZmVycmVkKCk7DQoNCgkJZnVuY3Rpb24gJCgpIHtFLnJlbW92ZUV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCAkKSwgQy5yZW1vdmVFdmVudExpc3RlbmVyKCJsb2FkIiwgJCksIFMucmVhZHkoKTt9DQoNCgkJUy5mbi5yZWFkeSA9IGZ1bmN0aW9uKGUpIHtyZXR1cm4gRi50aGVuKGUpWyJjYXRjaCJdKGZ1bmN0aW9uKGUpIHtTLnJlYWR5RXhjZXB0aW9uKGUpO30pLCB0aGlzO30sIFMuZXh0ZW5kKHsNCgkJCWlzUmVhZHk6ICExLA0KCQkJcmVhZHlXYWl0OiAxLA0KCQkJcmVhZHk6IGZ1bmN0aW9uKGUpIHsoITAgPT09IGUgPyAtLVMucmVhZHlXYWl0IDogUy5pc1JlYWR5KSB8fCAoUy5pc1JlYWR5ID0gITApICE9PSBlICYmIDAgPCAtLVMucmVhZHlXYWl0IHx8IEYucmVzb2x2ZVdpdGgoRSwgW1NdKTt9DQoJCX0pLCBTLnJlYWR5LnRoZW4gPSBGLnRoZW4sICJjb21wbGV0ZSIgPT09IEUucmVhZHlTdGF0ZSB8fCAibG9hZGluZyIgIT09IEUucmVhZHlTdGF0ZSAmJiAhRS5kb2N1bWVudEVsZW1lbnQuZG9TY3JvbGwgPyBDLnNldFRpbWVvdXQoUy5yZWFkeSkgOiAoRS5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgJCksIEMuYWRkRXZlbnRMaXN0ZW5lcigibG9hZCIsICQpKTsNCgkJdmFyIEIgPSBmdW5jdGlvbihlLCB0LCBuLCByLCBpLCBvLCBhKSB7DQoJCQl2YXIgcyA9IDAsIHUgPSBlLmxlbmd0aCwgbCA9IG51bGwgPT0gbjsNCgkJCWlmKCJvYmplY3QiID09PSB3KG4pKSBmb3IocyBpbiBpID0gITAsIG4pIEIoZSwgdCwgcywgbltzXSwgITAsIG8sIGEpOyBlbHNlIGlmKHZvaWQgMCAhPT0gciAmJiAoaSA9ICEwLCBtKHIpIHx8IChhID0gITApLCBsICYmIChhID8gKHQuY2FsbChlLCByKSwgdCA9IG51bGwpIDogKGwgPSB0LCB0ID0gZnVuY3Rpb24oZSwgdCwgbikge3JldHVybiBsLmNhbGwoUyhlKSwgbik7fSkpLCB0KSkgZm9yKDsgcyA8IHU7IHMrKykgdChlW3NdLCBuLCBhID8gciA6IHIuY2FsbChlW3NdLCBzLCB0KGVbc10sIG4pKSk7DQoJCQlyZXR1cm4gaSA/IGUgOiBsID8gdC5jYWxsKGUpIDogdSA/IHQoZVswXSwgbikgOiBvOw0KCQl9LCBfICA9IC9eLW1zLS8sIHogPSAvLShbYS16XSkvZzsNCg0KCQlmdW5jdGlvbiBVKGUsIHQpIHtyZXR1cm4gdC50b1VwcGVyQ2FzZSgpO30NCg0KCQlmdW5jdGlvbiBYKGUpIHtyZXR1cm4gZS5yZXBsYWNlKF8sICJtcy0iKS5yZXBsYWNlKHosIFUpO30NCg0KCQl2YXIgViA9IGZ1bmN0aW9uKGUpIHtyZXR1cm4gMSA9PT0gZS5ub2RlVHlwZSB8fCA5ID09PSBlLm5vZGVUeXBlIHx8ICErZS5ub2RlVHlwZTt9Ow0KDQoJCWZ1bmN0aW9uIEcoKSB7dGhpcy5leHBhbmRvID0gUy5leHBhbmRvICsgRy51aWQrKzt9DQoNCgkJRy51aWQgPSAxLCBHLnByb3RvdHlwZSA9IHsNCgkJCWNhY2hlOiBmdW5jdGlvbihlKSB7DQoJCQkJdmFyIHQgPSBlW3RoaXMuZXhwYW5kb107DQoJCQkJcmV0dXJuIHQgfHwgKHQgPSB7fSwgVihlKSAmJiAoZS5ub2RlVHlwZSA/IGVbdGhpcy5leHBhbmRvXSA9IHQgOiBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgdGhpcy5leHBhbmRvLCB7dmFsdWU6IHQsIGNvbmZpZ3VyYWJsZTogITB9KSkpLCB0Ow0KCQkJfSwNCgkJCXNldDogZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCXZhciByLCBpID0gdGhpcy5jYWNoZShlKTsNCgkJCQlpZigic3RyaW5nIiA9PSB0eXBlb2YgdCkgaVtYKHQpXSA9IG47IGVsc2UgZm9yKHIgaW4gdCkgaVtYKHIpXSA9IHRbcl07DQoJCQkJcmV0dXJuIGk7DQoJCQl9LA0KCQkJZ2V0OiBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIHZvaWQgMCA9PT0gdCA/IHRoaXMuY2FjaGUoZSkgOiBlW3RoaXMuZXhwYW5kb10gJiYgZVt0aGlzLmV4cGFuZG9dW1godCldO30sDQoJCQlhY2Nlc3M6IGZ1bmN0aW9uKGUsIHQsIG4pIHtyZXR1cm4gdm9pZCAwID09PSB0IHx8IHQgJiYgInN0cmluZyIgPT0gdHlwZW9mIHQgJiYgdm9pZCAwID09PSBuID8gdGhpcy5nZXQoZSwgdCkgOiAodGhpcy5zZXQoZSwgdCwgbiksIHZvaWQgMCAhPT0gbiA/IG4gOiB0KTt9LA0KCQkJcmVtb3ZlOiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4sIHIgPSBlW3RoaXMuZXhwYW5kb107DQoJCQkJaWYodm9pZCAwICE9PSByKSB7DQoJCQkJCWlmKHZvaWQgMCAhPT0gdCkgew0KCQkJCQkJbiA9ICh0ID0gQXJyYXkuaXNBcnJheSh0KSA/IHQubWFwKFgpIDogKHQgPSBYKHQpKSBpbiByID8gW3RdIDogdC5tYXRjaChQKSB8fCBbXSkubGVuZ3RoOw0KCQkJCQkJd2hpbGUobi0tKSBkZWxldGUgclt0W25dXTsNCgkJCQkJfQ0KCQkJCQkodm9pZCAwID09PSB0IHx8IFMuaXNFbXB0eU9iamVjdChyKSkgJiYgKGUubm9kZVR5cGUgPyBlW3RoaXMuZXhwYW5kb10gPSB2b2lkIDAgOiBkZWxldGUgZVt0aGlzLmV4cGFuZG9dKTsNCgkJCQl9DQoJCQl9LA0KCQkJaGFzRGF0YTogZnVuY3Rpb24oZSkgew0KCQkJCXZhciB0ID0gZVt0aGlzLmV4cGFuZG9dOw0KCQkJCXJldHVybiB2b2lkIDAgIT09IHQgJiYgIVMuaXNFbXB0eU9iamVjdCh0KTsNCgkJCX0NCgkJfTsNCgkJdmFyIFkgPSBuZXcgRywgUSA9IG5ldyBHLCBKID0gL14oPzpce1tcd1xXXSpcfXxcW1tcd1xXXSpcXSkkLywgSyA9IC9bQS1aXS9nOw0KDQoJCWZ1bmN0aW9uIFooZSwgdCwgbikgew0KCQkJdmFyIHIsIGk7DQoJCQlpZih2b2lkIDAgPT09IG4gJiYgMSA9PT0gZS5ub2RlVHlwZSkgew0KCQkJCWlmKHIgPSAiZGF0YS0iICsgdC5yZXBsYWNlKEssICItJCYiKQ0KCQkJCSAgICAgICAgICAgICAgICAgIC50b0xvd2VyQ2FzZSgpLCAic3RyaW5nIiA9PSB0eXBlb2YgKG4gPSBlLmdldEF0dHJpYnV0ZShyKSkpIHsNCgkJCQkJdHJ5IHtuID0gInRydWUiID09PSAoaSA9IG4pIHx8ICJmYWxzZSIgIT09IGkgJiYgKCJudWxsIiA9PT0gaSA/IG51bGwgOiBpID09PSAraSArICIiID8gK2kgOiBKLnRlc3QoaSkgPyBKU09OLnBhcnNlKGkpIDogaSk7fSBjYXRjaChlKSB7fQ0KCQkJCQlRLnNldChlLCB0LCBuKTsNCgkJCQl9IGVsc2Ugew0KCQkJCQluID0gdm9pZCAwOw0KCQkJCX0NCgkJCX0NCgkJCXJldHVybiBuOw0KCQl9DQoNCgkJUy5leHRlbmQoew0KCQkJaGFzRGF0YTogZnVuY3Rpb24oZSkge3JldHVybiBRLmhhc0RhdGEoZSkgfHwgWS5oYXNEYXRhKGUpO30sDQoJCQlkYXRhOiBmdW5jdGlvbihlLCB0LCBuKSB7cmV0dXJuIFEuYWNjZXNzKGUsIHQsIG4pO30sDQoJCQlyZW1vdmVEYXRhOiBmdW5jdGlvbihlLCB0KSB7US5yZW1vdmUoZSwgdCk7fSwNCgkJCV9kYXRhOiBmdW5jdGlvbihlLCB0LCBuKSB7cmV0dXJuIFkuYWNjZXNzKGUsIHQsIG4pO30sDQoJCQlfcmVtb3ZlRGF0YTogZnVuY3Rpb24oZSwgdCkge1kucmVtb3ZlKGUsIHQpO30NCgkJfSksIFMuZm4uZXh0ZW5kKHsNCgkJCWRhdGE6IGZ1bmN0aW9uKG4sIGUpIHsNCgkJCQl2YXIgdCwgciwgaSwgbyA9IHRoaXNbMF0sIGEgPSBvICYmIG8uYXR0cmlidXRlczsNCgkJCQlpZih2b2lkIDAgPT09IG4pIHsNCgkJCQkJaWYodGhpcy5sZW5ndGggJiYgKGkgPSBRLmdldChvKSwgMSA9PT0gby5ub2RlVHlwZSAmJiAhWS5nZXQobywgImhhc0RhdGFBdHRycyIpKSkgew0KCQkJCQkJdCA9IGEubGVuZ3RoOw0KCQkJCQkJd2hpbGUodC0tKSBhW3RdICYmIDAgPT09IChyID0gYVt0XS5uYW1lKS5pbmRleE9mKCJkYXRhLSIpICYmIChyID0gWChyLnNsaWNlKDUpKSwgWihvLCByLCBpW3JdKSk7DQoJCQkJCQlZLnNldChvLCAiaGFzRGF0YUF0dHJzIiwgITApOw0KCQkJCQl9DQoJCQkJCXJldHVybiBpOw0KCQkJCX0NCgkJCQlyZXR1cm4gIm9iamVjdCIgPT0gdHlwZW9mIG4gPyB0aGlzLmVhY2goZnVuY3Rpb24oKSB7US5zZXQodGhpcywgbik7fSkgOiBCKHRoaXMsIGZ1bmN0aW9uKGUpIHsNCgkJCQkJdmFyIHQ7DQoJCQkJCWlmKG8gJiYgdm9pZCAwID09PSBlKSByZXR1cm4gdm9pZCAwICE9PSAodCA9IFEuZ2V0KG8sIG4pKSA/IHQgOiB2b2lkIDAgIT09ICh0ID0gWihvLCBuKSkgPyB0IDogdm9pZCAwOw0KCQkJCQl0aGlzLmVhY2goZnVuY3Rpb24oKSB7US5zZXQodGhpcywgbiwgZSk7fSk7DQoJCQkJfSwgbnVsbCwgZSwgMSA8IGFyZ3VtZW50cy5sZW5ndGgsIG51bGwsICEwKTsNCgkJCX0sIHJlbW92ZURhdGE6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1EucmVtb3ZlKHRoaXMsIGUpO30pO30NCgkJfSksIFMuZXh0ZW5kKHsNCgkJCXF1ZXVlOiBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJdmFyIHI7DQoJCQkJaWYoZSkgcmV0dXJuIHQgPSAodCB8fCAiZngiKSArICJxdWV1ZSIsIHIgPSBZLmdldChlLCB0KSwgbiAmJiAoIXIgfHwgQXJyYXkuaXNBcnJheShuKSA/IHIgPSBZLmFjY2VzcyhlLCB0LCBTLm1ha2VBcnJheShuKSkgOiByLnB1c2gobikpLCByIHx8IFtdOw0KCQkJfSwgZGVxdWV1ZTogZnVuY3Rpb24oZSwgdCkgew0KCQkJCXQgPSB0IHx8ICJmeCI7DQoJCQkJdmFyIG4gPSBTLnF1ZXVlKGUsIHQpLCByID0gbi5sZW5ndGgsIGkgPSBuLnNoaWZ0KCksIG8gPSBTLl9xdWV1ZUhvb2tzKGUsIHQpOw0KCQkJCSJpbnByb2dyZXNzIiA9PT0gaSAmJiAoaSA9IG4uc2hpZnQoKSwgci0tKSwgaSAmJiAoImZ4IiA9PT0gdCAmJiBuLnVuc2hpZnQoImlucHJvZ3Jlc3MiKSwgZGVsZXRlIG8uc3RvcCwgaS5jYWxsKGUsIGZ1bmN0aW9uKCkge1MuZGVxdWV1ZShlLCB0KTt9LCBvKSksICFyICYmIG8gJiYgby5lbXB0eS5maXJlKCk7DQoJCQl9LCBfcXVldWVIb29rczogZnVuY3Rpb24oZSwgdCkgew0KCQkJCXZhciBuID0gdCArICJxdWV1ZUhvb2tzIjsNCgkJCQlyZXR1cm4gWS5nZXQoZSwgbikgfHwgWS5hY2Nlc3MoZSwgbiwge2VtcHR5OiBTLkNhbGxiYWNrcygib25jZSBtZW1vcnkiKS5hZGQoZnVuY3Rpb24oKSB7WS5yZW1vdmUoZSwgW3QgKyAicXVldWUiLCBuXSk7fSl9KTsNCgkJCX0NCgkJfSksIFMuZm4uZXh0ZW5kKHsNCgkJCXF1ZXVlOiBmdW5jdGlvbih0LCBuKSB7DQoJCQkJdmFyIGUgPSAyOw0KCQkJCXJldHVybiAic3RyaW5nIiAhPSB0eXBlb2YgdCAmJiAobiA9IHQsIHQgPSAiZngiLCBlLS0pLCBhcmd1bWVudHMubGVuZ3RoIDwgZSA/IFMucXVldWUodGhpc1swXSwgdCkgOiB2b2lkIDAgPT09IG4gPyB0aGlzIDogdGhpcy5lYWNoKGZ1bmN0aW9uKCkgew0KCQkJCQl2YXIgZSA9IFMucXVldWUodGhpcywgdCwgbik7DQoJCQkJCVMuX3F1ZXVlSG9va3ModGhpcywgdCksICJmeCIgPT09IHQgJiYgImlucHJvZ3Jlc3MiICE9PSBlWzBdICYmIFMuZGVxdWV1ZSh0aGlzLCB0KTsNCgkJCQl9KTsNCgkJCX0sDQoJCQlkZXF1ZXVlOiBmdW5jdGlvbihlKSB7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtTLmRlcXVldWUodGhpcywgZSk7fSk7fSwNCgkJCWNsZWFyUXVldWU6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gdGhpcy5xdWV1ZShlIHx8ICJmeCIsIFtdKTt9LA0KCQkJcHJvbWlzZTogZnVuY3Rpb24oZSwgdCkgew0KCQkJCXZhciBuLCByID0gMSwgaSA9IFMuRGVmZXJyZWQoKSwgbyA9IHRoaXMsIGEgPSB0aGlzLmxlbmd0aCwgcyA9IGZ1bmN0aW9uKCkgey0tciB8fCBpLnJlc29sdmVXaXRoKG8sIFtvXSk7fTsNCgkJCQkic3RyaW5nIiAhPSB0eXBlb2YgZSAmJiAodCA9IGUsIGUgPSB2b2lkIDApLCBlID0gZSB8fCAiZngiOw0KCQkJCXdoaWxlKGEtLSkgKG4gPSBZLmdldChvW2FdLCBlICsgInF1ZXVlSG9va3MiKSkgJiYgbi5lbXB0eSAmJiAocisrLCBuLmVtcHR5LmFkZChzKSk7DQoJCQkJcmV0dXJuIHMoKSwgaS5wcm9taXNlKHQpOw0KCQkJfQ0KCQl9KTsNCgkJdmFyIGVlID0gL1srLV0/KD86XGQqXC58KVxkKyg/OltlRV1bKy1dP1xkK3wpLy5zb3VyY2UsDQoJCSAgICB0ZSA9IG5ldyBSZWdFeHAoIl4oPzooWystXSk9fCkoIiArIGVlICsgIikoW2EteiVdKikkIiwgImkiKSwNCgkJICAgIG5lID0gWyJUb3AiLCAiUmlnaHQiLCAiQm90dG9tIiwgIkxlZnQiXSwNCgkJICAgIHJlID0gRS5kb2N1bWVudEVsZW1lbnQsDQoJCSAgICBpZSA9IGZ1bmN0aW9uKGUpIHtyZXR1cm4gUy5jb250YWlucyhlLm93bmVyRG9jdW1lbnQsIGUpO30sDQoJCSAgICBvZSA9IHtjb21wb3NlZDogITB9Ow0KCQlyZS5nZXRSb290Tm9kZSAmJiAoaWUgPSBmdW5jdGlvbihlKSB7cmV0dXJuIFMuY29udGFpbnMoZS5vd25lckRvY3VtZW50LCBlKSB8fCBlLmdldFJvb3ROb2RlKG9lKSA9PT0gZS5vd25lckRvY3VtZW50O30pOw0KCQl2YXIgYWUgPSBmdW5jdGlvbihlLCB0KSB7cmV0dXJuICJub25lIiA9PT0gKGUgPSB0IHx8IGUpLnN0eWxlLmRpc3BsYXkgfHwgIiIgPT09IGUuc3R5bGUuZGlzcGxheSAmJiBpZShlKSAmJiAibm9uZSIgPT09IFMuY3NzKGUsICJkaXNwbGF5Iik7fTsNCg0KCQlmdW5jdGlvbiBzZShlLCB0LCBuLCByKSB7DQoJCQl2YXIgaSwNCgkJCSAgICBvLA0KCQkJICAgIGEgPSAyMCwNCgkJCSAgICBzID0gciA/IGZ1bmN0aW9uKCkge3JldHVybiByLmN1cigpO30gOiBmdW5jdGlvbigpIHtyZXR1cm4gUy5jc3MoZSwgdCwgIiIpO30sDQoJCQkgICAgdSA9IHMoKSwNCgkJCSAgICBsID0gbiAmJiBuWzNdIHx8IChTLmNzc051bWJlclt0XSA/ICIiIDogInB4IiksDQoJCQkgICAgYyA9IGUubm9kZVR5cGUgJiYgKFMuY3NzTnVtYmVyW3RdIHx8ICJweCIgIT09IGwgJiYgK3UpICYmIHRlLmV4ZWMoUy5jc3MoZSwgdCkpOw0KCQkJaWYoYyAmJiBjWzNdICE9PSBsKSB7DQoJCQkJdSAvPSAyLCBsID0gbCB8fCBjWzNdLCBjID0gK3UgfHwgMTsNCgkJCQl3aGlsZShhLS0pIFMuc3R5bGUoZSwgdCwgYyArIGwpLCAoMSAtIG8pICogKDEgLSAobyA9IHMoKSAvIHUgfHwgLjUpKSA8PSAwICYmIChhID0gMCksIGMgLz0gbzsNCgkJCQljICo9IDIsIFMuc3R5bGUoZSwgdCwgYyArIGwpLCBuID0gbiB8fCBbXTsNCgkJCX0NCgkJCXJldHVybiBuICYmIChjID0gK2MgfHwgK3UgfHwgMCwgaSA9IG5bMV0gPyBjICsgKG5bMV0gKyAxKSAqIG5bMl0gOiArblsyXSwgciAmJiAoci51bml0ID0gbCwgci5zdGFydCA9IGMsIHIuZW5kID0gaSkpLCBpOw0KCQl9DQoNCgkJdmFyIHVlID0ge307DQoNCgkJZnVuY3Rpb24gbGUoZSwgdCkgew0KCQkJZm9yKHZhciBuLCByLCBpLCBvLCBhLCBzLCB1LCBsID0gW10sIGMgPSAwLCBmID0gZS5sZW5ndGg7IGMgPCBmOyBjKyspIChyID0gZVtjXSkuc3R5bGUgJiYNCgkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobiA9IHIuc3R5bGUuZGlzcGxheSwgdCA/DQoJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgibm9uZSIgPT09IG4gJiYgKGxbY10gPSBZLmdldChyLCAiZGlzcGxheSIpIHx8IG51bGwsIGxbY10gfHwgKHIuc3R5bGUuZGlzcGxheSA9ICIiKSksICIiID09PQ0KCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIuc3R5bGUuZGlzcGxheSAmJg0KCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFlKHIpICYmDQoJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGxbY10gPQ0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodSA9IGEgPSBvID0gdm9pZCAwLCBhID0gKGkgPSByKS5vd25lckRvY3VtZW50LCBzID0gaS5ub2RlTmFtZSwgKHUgPSB1ZVtzXSkgfHwNCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChvID0gYS5ib2R5LmFwcGVuZENoaWxkKGEuY3JlYXRlRWxlbWVudChzKSksIHUgPSBTLmNzcyhvLCAiZGlzcGxheSIpLCBvLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobyksICJub25lIiA9PT0gdSAmJiAodSA9ICJibG9jayIpLCB1ZVtzXSA9IHUpKSkpIDoNCgkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibm9uZSIgIT09IG4gJiYgKGxbY10gPSAibm9uZSIsIFkuc2V0KHIsICJkaXNwbGF5IiwgbikpKTsNCgkJCWZvcihjID0gMDsgYyA8IGY7IGMrKykgbnVsbCAhPSBsW2NdICYmIChlW2NdLnN0eWxlLmRpc3BsYXkgPSBsW2NdKTsNCgkJCXJldHVybiBlOw0KCQl9DQoNCgkJUy5mbi5leHRlbmQoew0KCQkJc2hvdzogZnVuY3Rpb24oKSB7cmV0dXJuIGxlKHRoaXMsICEwKTt9LA0KCQkJaGlkZTogZnVuY3Rpb24oKSB7cmV0dXJuIGxlKHRoaXMpO30sDQoJCQl0b2dnbGU6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gImJvb2xlYW4iID09IHR5cGVvZiBlID8gZSA/IHRoaXMuc2hvdygpIDogdGhpcy5oaWRlKCkgOiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7YWUodGhpcykgPyBTKHRoaXMpLnNob3coKSA6IFModGhpcykuaGlkZSgpO30pO30NCgkJfSk7DQoJCXZhciBjZSwgZmUsIHBlID0gL14oPzpjaGVja2JveHxyYWRpbykkL2ksIGRlID0gLzwoW2Etel1bXlwvXDA+XHgyMFx0XHJcblxmXSopL2ksIGhlID0gL14kfF5tb2R1bGUkfFwvKD86amF2YXxlY21hKXNjcmlwdC9pOw0KCQljZSA9IEUuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpDQoJCSAgICAgIC5hcHBlbmRDaGlsZChFLmNyZWF0ZUVsZW1lbnQoImRpdiIpKSwgKGZlID0gRS5jcmVhdGVFbGVtZW50KCJpbnB1dCIpKS5zZXRBdHRyaWJ1dGUoInR5cGUiLCAicmFkaW8iKSwgZmUuc2V0QXR0cmlidXRlKCJjaGVja2VkIiwgImNoZWNrZWQiKSwgZmUuc2V0QXR0cmlidXRlKCJuYW1lIiwgInQiKSwgY2UuYXBwZW5kQ2hpbGQoZmUpLCB2LmNoZWNrQ2xvbmUgPSBjZS5jbG9uZU5vZGUoITApDQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jbG9uZU5vZGUoITApLmxhc3RDaGlsZC5jaGVja2VkLCBjZS5pbm5lckhUTUwgPQ0KCQkJIjx0ZXh0YXJlYT54PC90ZXh0YXJlYT4iLCB2Lm5vQ2xvbmVDaGVja2VkID0gISFjZS5jbG9uZU5vZGUoITApLmxhc3RDaGlsZC5kZWZhdWx0VmFsdWUsIGNlLmlubmVySFRNTCA9ICI8b3B0aW9uPjwvb3B0aW9uPiIsIHYub3B0aW9uID0gISFjZS5sYXN0Q2hpbGQ7DQoJCXZhciBnZSA9IHsNCgkJCXRoZWFkOiBbMSwgIjx0YWJsZT4iLCAiPC90YWJsZT4iXSwNCgkJCWNvbDogWzIsICI8dGFibGU+PGNvbGdyb3VwPiIsICI8L2NvbGdyb3VwPjwvdGFibGU+Il0sDQoJCQl0cjogWzIsICI8dGFibGU+PHRib2R5PiIsICI8L3Rib2R5PjwvdGFibGU+Il0sDQoJCQl0ZDogWzMsICI8dGFibGU+PHRib2R5Pjx0cj4iLCAiPC90cj48L3Rib2R5PjwvdGFibGU+Il0sDQoJCQlfZGVmYXVsdDogWzAsICIiLCAiIl0NCgkJfTsNCg0KCQlmdW5jdGlvbiB5ZShlLCB0KSB7DQoJCQl2YXIgbjsNCgkJCXJldHVybiBuID0gInVuZGVmaW5lZCIgIT0gdHlwZW9mIGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUgPyBlLmdldEVsZW1lbnRzQnlUYWdOYW1lKHQgfHwgIioiKSA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBlLnF1ZXJ5U2VsZWN0b3JBbGwgPyBlLnF1ZXJ5U2VsZWN0b3JBbGwodCB8fCAiKiIpIDogW10sIHZvaWQgMCA9PT0gdCB8fCB0ICYmIEEoZSwgdCkgPyBTLm1lcmdlKFtlXSwgbikgOiBuOw0KCQl9DQoNCgkJZnVuY3Rpb24gdmUoZSwgdCkge2Zvcih2YXIgbiA9IDAsIHIgPSBlLmxlbmd0aDsgbiA8IHI7IG4rKykgWS5zZXQoZVtuXSwgImdsb2JhbEV2YWwiLCAhdCB8fCBZLmdldCh0W25dLCAiZ2xvYmFsRXZhbCIpKTt9DQoNCgkJZ2UudGJvZHkgPSBnZS50Zm9vdCA9IGdlLmNvbGdyb3VwID0gZ2UuY2FwdGlvbiA9IGdlLnRoZWFkLCBnZS50aCA9IGdlLnRkLCB2Lm9wdGlvbiB8fCAoZ2Uub3B0Z3JvdXAgPSBnZS5vcHRpb24gPSBbMSwgIjxzZWxlY3QgbXVsdGlwbGU9J211bHRpcGxlJz4iLCAiPC9zZWxlY3Q+Il0pOw0KCQl2YXIgbWUgPSAvPHwmIz9cdys7LzsNCg0KCQlmdW5jdGlvbiB4ZShlLCB0LCBuLCByLCBpKSB7DQoJCQlmb3IodmFyIG8sIGEsIHMsIHUsIGwsIGMsIGYgPSB0LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSwgcCA9IFtdLCBkID0gMCwgaCA9IGUubGVuZ3RoOyBkIDwgaDsgZCsrKSB7DQoJCQkJaWYoKG8gPSBlW2RdKSB8fCAwID09PSBvKSB7DQoJCQkJCWlmKCJvYmplY3QiID09PSB3KG8pKSB7DQoJCQkJCQlTLm1lcmdlKHAsIG8ubm9kZVR5cGUgPyBbb10gOiBvKTsNCgkJCQkJfSBlbHNlIGlmKG1lLnRlc3QobykpIHsNCgkJCQkJCWEgPSBhIHx8IGYuYXBwZW5kQ2hpbGQodC5jcmVhdGVFbGVtZW50KCJkaXYiKSksIHMgPSAoZGUuZXhlYyhvKSB8fCBbIiIsDQoJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIiXSlbMV0udG9Mb3dlckNhc2UoKSwgdSA9IGdlW3NdIHx8IGdlLl9kZWZhdWx0LCBhLmlubmVySFRNTCA9IHVbMV0gKyBTLmh0bWxQcmVmaWx0ZXIobykgKyB1WzJdLCBjID0gdVswXTsNCgkJCQkJCXdoaWxlKGMtLSkgYSA9IGEubGFzdENoaWxkOw0KCQkJCQkJUy5tZXJnZShwLCBhLmNoaWxkTm9kZXMpLCAoYSA9IGYuZmlyc3RDaGlsZCkudGV4dENvbnRlbnQgPSAiIjsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXAucHVzaCh0LmNyZWF0ZVRleHROb2RlKG8pKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCgkJCWYudGV4dENvbnRlbnQgPSAiIiwgZCA9IDA7DQoJCQl3aGlsZShvID0gcFtkKytdKSB7DQoJCQkJaWYociAmJiAtMSA8IFMuaW5BcnJheShvLCByKSkgew0KCQkJCQlpICYmIGkucHVzaChvKTsNCgkJCQl9IGVsc2UgaWYobCA9IGllKG8pLCBhID0geWUoZi5hcHBlbmRDaGlsZChvKSwgInNjcmlwdCIpLCBsICYmIHZlKGEpLCBuKSB7DQoJCQkJCWMgPSAwOw0KCQkJCQl3aGlsZShvID0gYVtjKytdKSBoZS50ZXN0KG8udHlwZSB8fCAiIikgJiYgbi5wdXNoKG8pOw0KCQkJCX0NCgkJCX0NCgkJCXJldHVybiBmOw0KCQl9DQoNCgkJdmFyIGJlID0gL14oW14uXSopKD86XC4oLispfCkvOw0KDQoJCWZ1bmN0aW9uIHdlKCkge3JldHVybiAhMDt9DQoNCgkJZnVuY3Rpb24gVGUoKSB7cmV0dXJuICExO30NCg0KCQlmdW5jdGlvbiBDZShlLCB0KSB7cmV0dXJuIGUgPT09IGZ1bmN0aW9uKCkge3RyeSB7cmV0dXJuIEUuYWN0aXZlRWxlbWVudDt9IGNhdGNoKGUpIHt9fSgpID09ICgiZm9jdXMiID09PSB0KTt9DQoNCgkJZnVuY3Rpb24gRWUoZSwgdCwgbiwgciwgaSwgbykgew0KCQkJdmFyIGEsIHM7DQoJCQlpZigib2JqZWN0IiA9PSB0eXBlb2YgdCkgew0KCQkJCWZvcihzIGluICJzdHJpbmciICE9IHR5cGVvZiBuICYmIChyID0gciB8fCBuLCBuID0gdm9pZCAwKSwgdCkgRWUoZSwgcywgbiwgciwgdFtzXSwgbyk7DQoJCQkJcmV0dXJuIGU7DQoJCQl9DQoJCQlpZihudWxsID09IHIgJiYgbnVsbCA9PSBpID8gKGkgPSBuLCByID0gbiA9IHZvaWQgMCkgOiBudWxsID09IGkgJiYgKCJzdHJpbmciID09IHR5cGVvZiBuID8gKGkgPSByLCByID0gdm9pZCAwKSA6IChpID0gciwgciA9IG4sIG4gPSB2b2lkIDApKSwgITEgPT09IGkpIGkgPSBUZTsgZWxzZSBpZighaSkgcmV0dXJuIGU7DQoJCQlyZXR1cm4gMSA9PT0gbyAmJiAoYSA9IGksIChpID0gZnVuY3Rpb24oZSkge3JldHVybiBTKCkub2ZmKGUpLCBhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fSkuZ3VpZCA9IGEuZ3VpZCB8fCAoYS5ndWlkID0gUy5ndWlkKyspKSwgZS5lYWNoKGZ1bmN0aW9uKCkge1MuZXZlbnQuYWRkKHRoaXMsIHQsIGksIHIsIG4pO30pOw0KCQl9DQoNCgkJZnVuY3Rpb24gU2UoZSwgaSwgbykgew0KCQkJbyA/IChZLnNldChlLCBpLCAhMSksIFMuZXZlbnQuYWRkKGUsIGksIHsNCgkJCQluYW1lc3BhY2U6ICExLCBoYW5kbGVyOiBmdW5jdGlvbihlKSB7DQoJCQkJCXZhciB0LCBuLCByID0gWS5nZXQodGhpcywgaSk7DQoJCQkJCWlmKDEgJiBlLmlzVHJpZ2dlciAmJiB0aGlzW2ldKSB7DQoJCQkJCQlpZihyLmxlbmd0aCkgKFMuZXZlbnQuc3BlY2lhbFtpXSB8fCB7fSkuZGVsZWdhdGVUeXBlICYmIGUuc3RvcFByb3BhZ2F0aW9uKCk7IGVsc2UgaWYociA9IHMuY2FsbChhcmd1bWVudHMpLCBZLnNldCh0aGlzLCBpLCByKSwgdCA9IG8odGhpcywgaSksIHRoaXNbaV0oKSwgciAhPT0gKG4gPSBZLmdldCh0aGlzLCBpKSkgfHwgdCA/IFkuc2V0KHRoaXMsIGksICExKSA6IG4gPSB7fSwgciAhPT0NCgkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuKSByZXR1cm4gZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSwgZS5wcmV2ZW50RGVmYXVsdCgpLCBuICYmDQoJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbi52YWx1ZTsNCgkJCQkJfSBlbHNlIHIubGVuZ3RoICYmIChZLnNldCh0aGlzLCBpLCB7dmFsdWU6IFMuZXZlbnQudHJpZ2dlcihTLmV4dGVuZChyWzBdLCBTLkV2ZW50LnByb3RvdHlwZSksIHIuc2xpY2UoMSksIHRoaXMpfSksIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCkpOw0KCQkJCX0NCgkJCX0pKSA6IHZvaWQgMCA9PT0gWS5nZXQoZSwgaSkgJiYgUy5ldmVudC5hZGQoZSwgaSwgd2UpOw0KCQl9DQoNCgkJUy5ldmVudCA9IHsNCgkJCWdsb2JhbDoge30sDQoJCQlhZGQ6IGZ1bmN0aW9uKHQsIGUsIG4sIHIsIGkpIHsNCgkJCQl2YXIgbywgYSwgcywgdSwgbCwgYywgZiwgcCwgZCwgaCwgZywgeSA9IFkuZ2V0KHQpOw0KCQkJCWlmKFYodCkpIHsNCgkJCQkJbi5oYW5kbGVyICYmIChuID0gKG8gPSBuKS5oYW5kbGVyLCBpID0gby5zZWxlY3RvciksIGkgJiYgUy5maW5kLm1hdGNoZXNTZWxlY3RvcihyZSwgaSksIG4uZ3VpZCB8fCAobi5ndWlkID0gUy5ndWlkKyspLCAodSA9IHkuZXZlbnRzKSB8fCAodSA9IHkuZXZlbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKSksIChhID0geS5oYW5kbGUpIHx8DQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYSA9DQoJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeS5oYW5kbGUgPQ0KCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihlKSB7DQoJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gInVuZGVmaW5lZCIgIT0gdHlwZW9mIFMgJiYgUy5ldmVudC50cmlnZ2VyZWQgIT09IGUudHlwZSA/DQoJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUy5ldmVudC5kaXNwYXRjaC5hcHBseSh0LCBhcmd1bWVudHMpIDoNCgkJCQkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkIDA7DQoJCQkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBsID0gKGUgPSAoZSB8fCAiIikubWF0Y2goUCkgfHwgWyIiXSkubGVuZ3RoOw0KCQkJCQl3aGlsZShsLS0pIHsNCgkJCQkJCWQgPSBnID0gKHMgPSBiZS5leGVjKGVbbF0pIHx8IFtdKVsxXSwgaCA9IChzWzJdIHx8ICIiKS5zcGxpdCgiLiIpDQoJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc29ydCgpLCBkICYmIChmID0gUy5ldmVudC5zcGVjaWFsW2RdIHx8IHt9LCBkID0gKGkgPyBmLmRlbGVnYXRlVHlwZSA6IGYuYmluZFR5cGUpIHx8IGQsIGYgPSBTLmV2ZW50LnNwZWNpYWxbZF0gfHwge30sIGMgPSBTLmV4dGVuZCh7DQoJCQkJCQkJdHlwZTogZCwNCgkJCQkJCQlvcmlnVHlwZTogZywNCgkJCQkJCQlkYXRhOiByLA0KCQkJCQkJCWhhbmRsZXI6IG4sDQoJCQkJCQkJZ3VpZDogbi5ndWlkLA0KCQkJCQkJCXNlbGVjdG9yOiBpLA0KCQkJCQkJCW5lZWRzQ29udGV4dDogaSAmJiBTLmV4cHIubWF0Y2gubmVlZHNDb250ZXh0LnRlc3QoaSksDQoJCQkJCQkJbmFtZXNwYWNlOiBoLmpvaW4oIi4iKQ0KCQkJCQkJfSwgbyksIChwID0gdVtkXSkgfHwgKChwID0gdVtkXSA9IFtdKS5kZWxlZ2F0ZUNvdW50ID0gMCwgZi5zZXR1cCAmJiAhMSAhPT0gZi5zZXR1cC5jYWxsKHQsIHIsIGgsIGEpIHx8IHQuYWRkRXZlbnRMaXN0ZW5lciAmJiB0LmFkZEV2ZW50TGlzdGVuZXIoZCwgYSkpLCBmLmFkZCAmJiAoZi5hZGQuY2FsbCh0LCBjKSwgYy5oYW5kbGVyLmd1aWQgfHwgKGMuaGFuZGxlci5ndWlkID0gbi5ndWlkKSksIGkgPw0KCQkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAuc3BsaWNlKHAuZGVsZWdhdGVDb3VudCsrLCAwLCBjKSA6DQoJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcC5wdXNoKGMpLCBTLmV2ZW50Lmdsb2JhbFtkXSA9ICEwKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0sDQoJCQlyZW1vdmU6IGZ1bmN0aW9uKGUsIHQsIG4sIHIsIGkpIHsNCgkJCQl2YXIgbywgYSwgcywgdSwgbCwgYywgZiwgcCwgZCwgaCwgZywgeSA9IFkuaGFzRGF0YShlKSAmJiBZLmdldChlKTsNCgkJCQlpZih5ICYmICh1ID0geS5ldmVudHMpKSB7DQoJCQkJCWwgPSAodCA9ICh0IHx8ICIiKS5tYXRjaChQKSB8fCBbIiJdKS5sZW5ndGg7DQoJCQkJCXdoaWxlKGwtLSkgew0KCQkJCQkJaWYoZCA9IGcgPSAocyA9IGJlLmV4ZWModFtsXSkgfHwgW10pWzFdLCBoID0gKHNbMl0gfHwgIiIpLnNwbGl0KCIuIikNCgkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zb3J0KCksIGQpIHsNCgkJCQkJCQlmID0gUy5ldmVudC5zcGVjaWFsW2RdIHx8IHt9LCBwID0gdVtkID0gKHIgPyBmLmRlbGVnYXRlVHlwZSA6IGYuYmluZFR5cGUpIHx8IGRdIHx8IFtdLCBzID0gc1syXSAmJiBuZXcgUmVnRXhwKCIoXnxcXC4pIiArIGguam9pbigiXFwuKD86LipcXC58KSIpICsgIihcXC58JCkiKSwgYSA9IG8gPSBwLmxlbmd0aDsNCgkJCQkJCQl3aGlsZShvLS0pIGMgPSBwW29dLCAhaSAmJiBnICE9PSBjLm9yaWdUeXBlIHx8IG4gJiYgbi5ndWlkICE9PSBjLmd1aWQgfHwgcyAmJiAhcy50ZXN0KGMubmFtZXNwYWNlKSB8fCByICYmIHIgIT09IGMuc2VsZWN0b3IgJiYgKCIqKiIgIT09IHIgfHwgIWMuc2VsZWN0b3IpIHx8IChwLnNwbGljZShvLCAxKSwgYy5zZWxlY3RvciAmJiBwLmRlbGVnYXRlQ291bnQtLSwgZi5yZW1vdmUgJiYgZi5yZW1vdmUuY2FsbChlLCBjKSk7DQoJCQkJCQkJYSAmJiAhcC5sZW5ndGggJiYgKGYudGVhcmRvd24gJiYgITEgIT09IGYudGVhcmRvd24uY2FsbChlLCBoLCB5LmhhbmRsZSkgfHwgUy5yZW1vdmVFdmVudChlLCBkLCB5LmhhbmRsZSksIGRlbGV0ZSB1W2RdKTsNCgkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJZm9yKGQgaW4gdSkgUy5ldmVudC5yZW1vdmUoZSwgZCArIHRbbF0sIG4sIHIsICEwKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQlTLmlzRW1wdHlPYmplY3QodSkgJiYgWS5yZW1vdmUoZSwgImhhbmRsZSBldmVudHMiKTsNCgkJCQl9DQoJCQl9LA0KCQkJZGlzcGF0Y2g6IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCwNCgkJCQkgICAgbiwNCgkJCQkgICAgciwNCgkJCQkgICAgaSwNCgkJCQkgICAgbywNCgkJCQkgICAgYSwNCgkJCQkgICAgcyA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoKSwNCgkJCQkgICAgdSA9IFMuZXZlbnQuZml4KGUpLA0KCQkJCSAgICBsID0gKFkuZ2V0KHRoaXMsICJldmVudHMiKSB8fCBPYmplY3QuY3JlYXRlKG51bGwpKVt1LnR5cGVdIHx8IFtdLA0KCQkJCSAgICBjID0gUy5ldmVudC5zcGVjaWFsW3UudHlwZV0gfHwge307DQoJCQkJZm9yKHNbMF0gPSB1LCB0ID0gMTsgdCA8IGFyZ3VtZW50cy5sZW5ndGg7IHQrKykgc1t0XSA9IGFyZ3VtZW50c1t0XTsNCgkJCQlpZih1LmRlbGVnYXRlVGFyZ2V0ID0gdGhpcywgIWMucHJlRGlzcGF0Y2ggfHwgITEgIT09IGMucHJlRGlzcGF0Y2guY2FsbCh0aGlzLCB1KSkgew0KCQkJCQlhID0gUy5ldmVudC5oYW5kbGVycy5jYWxsKHRoaXMsIHUsIGwpLCB0ID0gMDsNCgkJCQkJd2hpbGUoKGkgPSBhW3QrK10pICYmICF1LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkpIHsNCgkJCQkJCXUuY3VycmVudFRhcmdldCA9IGkuZWxlbSwgbiA9IDA7DQoJCQkJCQl3aGlsZSgobyA9IGkuaGFuZGxlcnNbbisrXSkgJiYgIXUuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQoKSkgdS5ybmFtZXNwYWNlICYmDQoJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgITEgIT09DQoJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgby5uYW1lc3BhY2UgJiYNCgkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhdS5ybmFtZXNwYWNlLnRlc3Qoby5uYW1lc3BhY2UpIHx8DQoJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHUuaGFuZGxlT2JqID0gbywgdS5kYXRhID0gby5kYXRhLCB2b2lkIDAgIT09IChyID0gKChTLmV2ZW50LnNwZWNpYWxbby5vcmlnVHlwZV0gfHwge30pLmhhbmRsZSB8fCBvLmhhbmRsZXIpLmFwcGx5KGkuZWxlbSwgcykpICYmICExID09PSAodS5yZXN1bHQgPSByKSAmJiAodS5wcmV2ZW50RGVmYXVsdCgpLCB1LnN0b3BQcm9wYWdhdGlvbigpKSk7DQoJCQkJCX0NCgkJCQkJcmV0dXJuIGMucG9zdERpc3BhdGNoICYmIGMucG9zdERpc3BhdGNoLmNhbGwodGhpcywgdSksIHUucmVzdWx0Ow0KCQkJCX0NCgkJCX0sDQoJCQloYW5kbGVyczogZnVuY3Rpb24oZSwgdCkgew0KCQkJCXZhciBuLCByLCBpLCBvLCBhLCBzID0gW10sIHUgPSB0LmRlbGVnYXRlQ291bnQsIGwgPSBlLnRhcmdldDsNCgkJCQlpZih1ICYmIGwubm9kZVR5cGUgJiYgISgiY2xpY2siID09PSBlLnR5cGUgJiYgMSA8PSBlLmJ1dHRvbikpIHsNCgkJCQkJZm9yKDsgbCAhPT0gdGhpczsgbCA9IGwucGFyZW50Tm9kZSB8fCB0aGlzKSB7DQoJCQkJCQlpZigxID09PSBsLm5vZGVUeXBlICYmICgiY2xpY2siICE9PSBlLnR5cGUgfHwgITAgIT09IGwuZGlzYWJsZWQpKSB7DQoJCQkJCQkJZm9yKG8gPSBbXSwgYSA9IHt9LCBuID0gMDsgbiA8IHU7IG4rKykgew0KCQkJCQkJCQl2b2lkIDAgPT09IGFbaSA9IChyID0gdFtuXSkuc2VsZWN0b3IgKyAiICJdICYmIChhW2ldID0gci5uZWVkc0NvbnRleHQgPyAtMSA8IFMoaSwgdGhpcykNCgkJCQkJCQkJCS5pbmRleChsKSA6IFMuZmluZChpLCB0aGlzLCBudWxsLCBbbF0pLmxlbmd0aCksIGFbaV0gJiYgby5wdXNoKHIpOw0KCQkJCQkJCX0NCgkJCQkJCQlvLmxlbmd0aCAmJiBzLnB1c2goe2VsZW06IGwsIGhhbmRsZXJzOiBvfSk7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9DQoJCQkJcmV0dXJuIGwgPSB0aGlzLCB1IDwgdC5sZW5ndGggJiYgcy5wdXNoKHtlbGVtOiBsLCBoYW5kbGVyczogdC5zbGljZSh1KX0pLCBzOw0KCQkJfSwNCgkJCWFkZFByb3A6IGZ1bmN0aW9uKHQsIGUpIHsNCgkJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoUy5FdmVudC5wcm90b3R5cGUsIHQsIHsNCgkJCQkJZW51bWVyYWJsZTogITAsDQoJCQkJCWNvbmZpZ3VyYWJsZTogITAsDQoJCQkJCWdldDogbShlKSA/IGZ1bmN0aW9uKCkge2lmKHRoaXMub3JpZ2luYWxFdmVudCkgcmV0dXJuIGUodGhpcy5vcmlnaW5hbEV2ZW50KTt9IDogZnVuY3Rpb24oKSB7aWYodGhpcy5vcmlnaW5hbEV2ZW50KSByZXR1cm4gdGhpcy5vcmlnaW5hbEV2ZW50W3RdO30sDQoJCQkJCXNldDogZnVuY3Rpb24oZSkge09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCB0LCB7ZW51bWVyYWJsZTogITAsIGNvbmZpZ3VyYWJsZTogITAsIHdyaXRhYmxlOiAhMCwgdmFsdWU6IGV9KTt9DQoJCQkJfSk7DQoJCQl9LA0KCQkJZml4OiBmdW5jdGlvbihlKSB7cmV0dXJuIGVbUy5leHBhbmRvXSA/IGUgOiBuZXcgUy5FdmVudChlKTt9LA0KCQkJc3BlY2lhbDogew0KCQkJCWxvYWQ6IHtub0J1YmJsZTogITB9LCBjbGljazogew0KCQkJCQlzZXR1cDogZnVuY3Rpb24oZSkgew0KCQkJCQkJdmFyIHQgPSB0aGlzIHx8IGU7DQoJCQkJCQlyZXR1cm4gcGUudGVzdCh0LnR5cGUpICYmIHQuY2xpY2sgJiYgQSh0LCAiaW5wdXQiKSAmJiBTZSh0LCAiY2xpY2siLCB3ZSksICExOw0KCQkJCQl9LCB0cmlnZ2VyOiBmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgdCA9IHRoaXMgfHwgZTsNCgkJCQkJCXJldHVybiBwZS50ZXN0KHQudHlwZSkgJiYgdC5jbGljayAmJiBBKHQsICJpbnB1dCIpICYmIFNlKHQsICJjbGljayIpLCAhMDsNCgkJCQkJfSwgX2RlZmF1bHQ6IGZ1bmN0aW9uKGUpIHsNCgkJCQkJCXZhciB0ID0gZS50YXJnZXQ7DQoJCQkJCQlyZXR1cm4gcGUudGVzdCh0LnR5cGUpICYmIHQuY2xpY2sgJiYgQSh0LCAiaW5wdXQiKSAmJiBZLmdldCh0LCAiY2xpY2siKSB8fCBBKHQsICJhIik7DQoJCQkJCX0NCgkJCQl9LCBiZWZvcmV1bmxvYWQ6IHtwb3N0RGlzcGF0Y2g6IGZ1bmN0aW9uKGUpIHt2b2lkIDAgIT09IGUucmVzdWx0ICYmIGUub3JpZ2luYWxFdmVudCAmJiAoZS5vcmlnaW5hbEV2ZW50LnJldHVyblZhbHVlID0gZS5yZXN1bHQpO319DQoJCQl9DQoJCX0sIFMucmVtb3ZlRXZlbnQgPSBmdW5jdGlvbihlLCB0LCBuKSB7ZS5yZW1vdmVFdmVudExpc3RlbmVyICYmIGUucmVtb3ZlRXZlbnRMaXN0ZW5lcih0LCBuKTt9LCBTLkV2ZW50ID0gZnVuY3Rpb24oZSwgdCkgew0KCQkJaWYoISh0aGlzIGluc3RhbmNlb2YgUy5FdmVudCkpIHJldHVybiBuZXcgUy5FdmVudChlLCB0KTsNCgkJCWUgJiYgZS50eXBlID8NCgkJCSh0aGlzLm9yaWdpbmFsRXZlbnQgPSBlLCB0aGlzLnR5cGUgPSBlLnR5cGUsIHRoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gZS5kZWZhdWx0UHJldmVudGVkIHx8IHZvaWQgMCA9PT0gZS5kZWZhdWx0UHJldmVudGVkICYmICExID09PSBlLnJldHVyblZhbHVlID8gd2UgOiBUZSwgdGhpcy50YXJnZXQgPSBlLnRhcmdldCAmJiAzID09PSBlLnRhcmdldC5ub2RlVHlwZSA/IGUudGFyZ2V0LnBhcmVudE5vZGUgOiBlLnRhcmdldCwgdGhpcy5jdXJyZW50VGFyZ2V0ID0NCgkJCQllLmN1cnJlbnRUYXJnZXQsIHRoaXMucmVsYXRlZFRhcmdldCA9IGUucmVsYXRlZFRhcmdldCkgOg0KCQkJdGhpcy50eXBlID0gZSwgdCAmJiBTLmV4dGVuZCh0aGlzLCB0KSwgdGhpcy50aW1lU3RhbXAgPSBlICYmIGUudGltZVN0YW1wIHx8IERhdGUubm93KCksIHRoaXNbUy5leHBhbmRvXSA9ICEwOw0KCQl9LCBTLkV2ZW50LnByb3RvdHlwZSA9IHsNCgkJCWNvbnN0cnVjdG9yOiBTLkV2ZW50LA0KCQkJaXNEZWZhdWx0UHJldmVudGVkOiBUZSwNCgkJCWlzUHJvcGFnYXRpb25TdG9wcGVkOiBUZSwNCgkJCWlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkOiBUZSwNCgkJCWlzU2ltdWxhdGVkOiAhMSwNCgkJCXByZXZlbnREZWZhdWx0OiBmdW5jdGlvbigpIHsNCgkJCQl2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsNCgkJCQl0aGlzLmlzRGVmYXVsdFByZXZlbnRlZCA9IHdlLCBlICYmICF0aGlzLmlzU2ltdWxhdGVkICYmIGUucHJldmVudERlZmF1bHQoKTsNCgkJCX0sDQoJCQlzdG9wUHJvcGFnYXRpb246IGZ1bmN0aW9uKCkgew0KCQkJCXZhciBlID0gdGhpcy5vcmlnaW5hbEV2ZW50Ow0KCQkJCXRoaXMuaXNQcm9wYWdhdGlvblN0b3BwZWQgPSB3ZSwgZSAmJiAhdGhpcy5pc1NpbXVsYXRlZCAmJiBlLnN0b3BQcm9wYWdhdGlvbigpOw0KCQkJfSwNCgkJCXN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbjogZnVuY3Rpb24oKSB7DQoJCQkJdmFyIGUgPSB0aGlzLm9yaWdpbmFsRXZlbnQ7DQoJCQkJdGhpcy5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCA9IHdlLCBlICYmICF0aGlzLmlzU2ltdWxhdGVkICYmIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksIHRoaXMuc3RvcFByb3BhZ2F0aW9uKCk7DQoJCQl9DQoJCX0sIFMuZWFjaCh7DQoJCQlhbHRLZXk6ICEwLA0KCQkJYnViYmxlczogITAsDQoJCQljYW5jZWxhYmxlOiAhMCwNCgkJCWNoYW5nZWRUb3VjaGVzOiAhMCwNCgkJCWN0cmxLZXk6ICEwLA0KCQkJZGV0YWlsOiAhMCwNCgkJCWV2ZW50UGhhc2U6ICEwLA0KCQkJbWV0YUtleTogITAsDQoJCQlwYWdlWDogITAsDQoJCQlwYWdlWTogITAsDQoJCQlzaGlmdEtleTogITAsDQoJCQl2aWV3OiAhMCwNCgkJCSJjaGFyIjogITAsDQoJCQljb2RlOiAhMCwNCgkJCWNoYXJDb2RlOiAhMCwNCgkJCWtleTogITAsDQoJCQlrZXlDb2RlOiAhMCwNCgkJCWJ1dHRvbjogITAsDQoJCQlidXR0b25zOiAhMCwNCgkJCWNsaWVudFg6ICEwLA0KCQkJY2xpZW50WTogITAsDQoJCQlvZmZzZXRYOiAhMCwNCgkJCW9mZnNldFk6ICEwLA0KCQkJcG9pbnRlcklkOiAhMCwNCgkJCXBvaW50ZXJUeXBlOiAhMCwNCgkJCXNjcmVlblg6ICEwLA0KCQkJc2NyZWVuWTogITAsDQoJCQl0YXJnZXRUb3VjaGVzOiAhMCwNCgkJCXRvRWxlbWVudDogITAsDQoJCQl0b3VjaGVzOiAhMCwNCgkJCXdoaWNoOiAhMA0KCQl9LCBTLmV2ZW50LmFkZFByb3ApLCBTLmVhY2goe2ZvY3VzOiAiZm9jdXNpbiIsIGJsdXI6ICJmb2N1c291dCJ9LCBmdW5jdGlvbih0LCBlKSB7DQoJCQlTLmV2ZW50LnNwZWNpYWxbdF0gPSB7DQoJCQkJc2V0dXA6IGZ1bmN0aW9uKCkge3JldHVybiBTZSh0aGlzLCB0LCBDZSksICExO30sDQoJCQkJdHJpZ2dlcjogZnVuY3Rpb24oKSB7cmV0dXJuIFNlKHRoaXMsIHQpLCAhMDt9LA0KCQkJCV9kZWZhdWx0OiBmdW5jdGlvbihlKSB7cmV0dXJuIFkuZ2V0KGUudGFyZ2V0LCB0KTt9LA0KCQkJCWRlbGVnYXRlVHlwZTogZQ0KCQkJfTsNCgkJfSksIFMuZWFjaCh7bW91c2VlbnRlcjogIm1vdXNlb3ZlciIsIG1vdXNlbGVhdmU6ICJtb3VzZW91dCIsIHBvaW50ZXJlbnRlcjogInBvaW50ZXJvdmVyIiwgcG9pbnRlcmxlYXZlOiAicG9pbnRlcm91dCJ9LCBmdW5jdGlvbihlLCBpKSB7DQoJCQlTLmV2ZW50LnNwZWNpYWxbZV0gPSB7DQoJCQkJZGVsZWdhdGVUeXBlOiBpLA0KCQkJCWJpbmRUeXBlOiBpLA0KCQkJCWhhbmRsZTogZnVuY3Rpb24oZSkgew0KCQkJCQl2YXIgdCwgbiA9IGUucmVsYXRlZFRhcmdldCwgciA9IGUuaGFuZGxlT2JqOw0KCQkJCQlyZXR1cm4gbiAmJiAobiA9PT0gdGhpcyB8fCBTLmNvbnRhaW5zKHRoaXMsIG4pKSB8fCAoZS50eXBlID0gci5vcmlnVHlwZSwgdCA9IHIuaGFuZGxlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCBlLnR5cGUgPSBpKSwgdDsNCgkJCQl9DQoJCQl9Ow0KCQl9KSwgUy5mbi5leHRlbmQoew0KCQkJb246IGZ1bmN0aW9uKGUsIHQsIG4sIHIpIHtyZXR1cm4gRWUodGhpcywgZSwgdCwgbiwgcik7fSwgb25lOiBmdW5jdGlvbihlLCB0LCBuLCByKSB7cmV0dXJuIEVlKHRoaXMsIGUsIHQsIG4sIHIsIDEpO30sIG9mZjogZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCXZhciByLCBpOw0KCQkJCWlmKGUgJiYgZS5wcmV2ZW50RGVmYXVsdCAmJiBlLmhhbmRsZU9iaikgcmV0dXJuIHIgPSBlLmhhbmRsZU9iaiwgUyhlLmRlbGVnYXRlVGFyZ2V0KS5vZmYoci5uYW1lc3BhY2UgPyByLm9yaWdUeXBlICsgIi4iICsgci5uYW1lc3BhY2UgOiByLm9yaWdUeXBlLCByLnNlbGVjdG9yLCByLmhhbmRsZXIpLCB0aGlzOw0KCQkJCWlmKCJvYmplY3QiID09IHR5cGVvZiBlKSB7DQoJCQkJCWZvcihpIGluIGUpIHRoaXMub2ZmKGksIHQsIGVbaV0pOw0KCQkJCQlyZXR1cm4gdGhpczsNCgkJCQl9DQoJCQkJcmV0dXJuICExICE9PSB0ICYmICJmdW5jdGlvbiIgIT0gdHlwZW9mIHQgfHwgKG4gPSB0LCB0ID0gdm9pZCAwKSwgITEgPT09IG4gJiYgKG4gPSBUZSksIHRoaXMuZWFjaChmdW5jdGlvbigpIHtTLmV2ZW50LnJlbW92ZSh0aGlzLCBlLCBuLCB0KTt9KTsNCgkJCX0NCgkJfSk7DQoJCXZhciBrZSA9IC88c2NyaXB0fDxzdHlsZXw8bGluay9pLCBBZSA9IC9jaGVja2VkXHMqKD86W149XXw9XHMqLmNoZWNrZWQuKS9pLCBOZSA9IC9eXHMqPCFcW0NEQVRBXFt8XF1cXT5ccyokL2c7DQoNCgkJZnVuY3Rpb24gamUoZSwgdCkge3JldHVybiBBKGUsICJ0YWJsZSIpICYmIEEoMTEgIT09IHQubm9kZVR5cGUgPyB0IDogdC5maXJzdENoaWxkLCAidHIiKSAmJiBTKGUpLmNoaWxkcmVuKCJ0Ym9keSIpWzBdIHx8IGU7fQ0KDQoJCWZ1bmN0aW9uIERlKGUpIHtyZXR1cm4gZS50eXBlID0gKG51bGwgIT09IGUuZ2V0QXR0cmlidXRlKCJ0eXBlIikpICsgIi8iICsgZS50eXBlLCBlO30NCg0KCQlmdW5jdGlvbiBxZShlKSB7cmV0dXJuICJ0cnVlLyIgPT09IChlLnR5cGUgfHwgIiIpLnNsaWNlKDAsIDUpID8gZS50eXBlID0gZS50eXBlLnNsaWNlKDUpIDogZS5yZW1vdmVBdHRyaWJ1dGUoInR5cGUiKSwgZTt9DQoNCgkJZnVuY3Rpb24gTGUoZSwgdCkgew0KCQkJdmFyIG4sIHIsIGksIG8sIGEsIHM7DQoJCQlpZigxID09PSB0Lm5vZGVUeXBlKSB7DQoJCQkJaWYoWS5oYXNEYXRhKGUpICYmIChzID0gWS5nZXQoZSkuZXZlbnRzKSkgZm9yKGkgaW4gWS5yZW1vdmUodCwgImhhbmRsZSBldmVudHMiKSwgcykgZm9yKG4gPSAwLCByID0gc1tpXS5sZW5ndGg7IG4gPCByOyBuKyspIFMuZXZlbnQuYWRkKHQsIGksIHNbaV1bbl0pOw0KCQkJCVEuaGFzRGF0YShlKSAmJiAobyA9IFEuYWNjZXNzKGUpLCBhID0gUy5leHRlbmQoe30sIG8pLCBRLnNldCh0LCBhKSk7DQoJCQl9DQoJCX0NCg0KCQlmdW5jdGlvbiBIZShuLCByLCBpLCBvKSB7DQoJCQlyID0gZyhyKTsNCgkJCXZhciBlLCB0LCBhLCBzLCB1LCBsLCBjID0gMCwgZiA9IG4ubGVuZ3RoLCBwID0gZiAtIDEsIGQgPSByWzBdLCBoID0gbShkKTsNCgkJCWlmKGggfHwgMSA8IGYgJiYgInN0cmluZyIgPT0gdHlwZW9mIGQgJiYgIXYuY2hlY2tDbG9uZSAmJiBBZS50ZXN0KGQpKSB7DQoJCQkJcmV0dXJuIG4uZWFjaChmdW5jdGlvbihlKSB7DQoJCQkJCXZhciB0ID0gbi5lcShlKTsNCgkJCQkJaCAmJiAoclswXSA9IGQuY2FsbCh0aGlzLCBlLCB0Lmh0bWwoKSkpLCBIZSh0LCByLCBpLCBvKTsNCgkJCQl9KTsNCgkJCX0NCgkJCWlmKGYgJiYgKHQgPSAoZSA9IHhlKHIsIG5bMF0ub3duZXJEb2N1bWVudCwgITEsIG4sIG8pKS5maXJzdENoaWxkLCAxID09PSBlLmNoaWxkTm9kZXMubGVuZ3RoICYmIChlID0gdCksIHQgfHwgbykpIHsNCgkJCQlmb3IocyA9IChhID0gUy5tYXAoeWUoZSwgInNjcmlwdCIpLCBEZSkpLmxlbmd0aDsgYyA8IGY7IGMrKykgdSA9IGUsIGMgIT09IHAgJiYgKHUgPSBTLmNsb25lKHUsICEwLCAhMCksIHMgJiYgUy5tZXJnZShhLCB5ZSh1LCAic2NyaXB0IikpKSwgaS5jYWxsKG5bY10sIHUsIGMpOw0KCQkJCWlmKHMpIGZvcihsID0gYVthLmxlbmd0aCAtIDFdLm93bmVyRG9jdW1lbnQsIFMubWFwKGEsIHFlKSwgYyA9IDA7IGMgPCBzOyBjKyspIHUgPSBhW2NdLCBoZS50ZXN0KHUudHlwZSB8fCAiIikgJiYNCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIVkuYWNjZXNzKHUsICJnbG9iYWxFdmFsIikgJiYNCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUy5jb250YWlucyhsLCB1KSAmJg0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodS5zcmMgJiYgIm1vZHVsZSIgIT09ICh1LnR5cGUgfHwgIiIpLnRvTG93ZXJDYXNlKCkgPyBTLl9ldmFsVXJsICYmICF1Lm5vTW9kdWxlICYmIFMuX2V2YWxVcmwodS5zcmMsIHtub25jZTogdS5ub25jZSB8fCB1LmdldEF0dHJpYnV0ZSgibm9uY2UiKX0sIGwpIDogYih1LnRleHRDb250ZW50LnJlcGxhY2UoTmUsICIiKSwgdSwgbCkpOw0KCQkJfQ0KCQkJcmV0dXJuIG47DQoJCX0NCg0KCQlmdW5jdGlvbiBPZShlLCB0LCBuKSB7DQoJCQlmb3IodmFyIHIsIGkgPSB0ID8gUy5maWx0ZXIodCwgZSkgOiBlLCBvID0gMDsgbnVsbCAhPSAociA9IGlbb10pOyBvKyspIG4gfHwgMSAhPT0gci5ub2RlVHlwZSB8fCBTLmNsZWFuRGF0YSh5ZShyKSksIHIucGFyZW50Tm9kZSAmJiAobiAmJiBpZShyKSAmJiB2ZSh5ZShyLCAic2NyaXB0IikpLCByLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocikpOw0KCQkJcmV0dXJuIGU7DQoJCX0NCg0KCQlTLmV4dGVuZCh7DQoJCQlodG1sUHJlZmlsdGVyOiBmdW5jdGlvbihlKSB7cmV0dXJuIGU7fSwNCgkJCWNsb25lOiBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJdmFyIHIsIGksIG8sIGEsIHMsIHUsIGwsIGMgPSBlLmNsb25lTm9kZSghMCksIGYgPSBpZShlKTsNCgkJCQlpZighKHYubm9DbG9uZUNoZWNrZWQgfHwgMSAhPT0gZS5ub2RlVHlwZSAmJiAxMSAhPT0gZS5ub2RlVHlwZSB8fCBTLmlzWE1MRG9jKGUpKSkgZm9yKGEgPSB5ZShjKSwgciA9IDAsIGkgPSAobyA9IHllKGUpKS5sZW5ndGg7IHIgPCBpOyByKyspIHMgPSBvW3JdLCB1ID0gYVtyXSwgdm9pZCAwLCAiaW5wdXQiID09PSAobCA9IHUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSkgJiYgcGUudGVzdChzLnR5cGUpID8NCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LmNoZWNrZWQgPSBzLmNoZWNrZWQgOg0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpbnB1dCIgIT09IGwgJiYgInRleHRhcmVhIiAhPT0gbCB8fCAodS5kZWZhdWx0VmFsdWUgPSBzLmRlZmF1bHRWYWx1ZSk7DQoJCQkJaWYodCkgaWYobikgZm9yKG8gPSBvIHx8IHllKGUpLCBhID0gYSB8fCB5ZShjKSwgciA9IDAsIGkgPSBvLmxlbmd0aDsgciA8IGk7IHIrKykgTGUob1tyXSwgYVtyXSk7IGVsc2UgTGUoZSwgYyk7DQoJCQkJcmV0dXJuIDAgPCAoYSA9IHllKGMsICJzY3JpcHQiKSkubGVuZ3RoICYmIHZlKGEsICFmICYmIHllKGUsICJzY3JpcHQiKSksIGM7DQoJCQl9LA0KCQkJY2xlYW5EYXRhOiBmdW5jdGlvbihlKSB7DQoJCQkJZm9yKHZhciB0LCBuLCByLCBpID0gUy5ldmVudC5zcGVjaWFsLCBvID0gMDsgdm9pZCAwICE9PSAobiA9IGVbb10pOyBvKyspIHsNCgkJCQkJaWYoVihuKSkgew0KCQkJCQkJaWYodCA9IG5bWS5leHBhbmRvXSkgew0KCQkJCQkJCWlmKHQuZXZlbnRzKSBmb3IociBpbiB0LmV2ZW50cykgaVtyXSA/IFMuZXZlbnQucmVtb3ZlKG4sIHIpIDogUy5yZW1vdmVFdmVudChuLCByLCB0LmhhbmRsZSk7DQoJCQkJCQkJbltZLmV4cGFuZG9dID0gdm9pZCAwOw0KCQkJCQkJfQ0KCQkJCQkJbltRLmV4cGFuZG9dICYmIChuW1EuZXhwYW5kb10gPSB2b2lkIDApOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KCQl9KSwgUy5mbi5leHRlbmQoew0KCQkJZGV0YWNoOiBmdW5jdGlvbihlKSB7cmV0dXJuIE9lKHRoaXMsIGUsICEwKTt9LA0KCQkJcmVtb3ZlOiBmdW5jdGlvbihlKSB7cmV0dXJuIE9lKHRoaXMsIGUpO30sDQoJCQl0ZXh0OiBmdW5jdGlvbihlKSB7DQoJCQkJcmV0dXJuIEIodGhpcywgZnVuY3Rpb24oZSkgew0KCQkJCQlyZXR1cm4gdm9pZCAwID09PSBlID8gUy50ZXh0KHRoaXMpIDogdGhpcy5lbXB0eSgpDQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24oKSB7MSAhPT0gdGhpcy5ub2RlVHlwZSAmJiAxMSAhPT0gdGhpcy5ub2RlVHlwZSAmJiA5ICE9PSB0aGlzLm5vZGVUeXBlIHx8ICh0aGlzLnRleHRDb250ZW50ID0gZSk7fSk7DQoJCQkJfSwgbnVsbCwgZSwgYXJndW1lbnRzLmxlbmd0aCk7DQoJCQl9LA0KCQkJYXBwZW5kOiBmdW5jdGlvbigpIHtyZXR1cm4gSGUodGhpcywgYXJndW1lbnRzLCBmdW5jdGlvbihlKSB7MSAhPT0gdGhpcy5ub2RlVHlwZSAmJiAxMSAhPT0gdGhpcy5ub2RlVHlwZSAmJiA5ICE9PSB0aGlzLm5vZGVUeXBlIHx8IGplKHRoaXMsIGUpLmFwcGVuZENoaWxkKGUpO30pO30sDQoJCQlwcmVwZW5kOiBmdW5jdGlvbigpIHsNCgkJCQlyZXR1cm4gSGUodGhpcywgYXJndW1lbnRzLCBmdW5jdGlvbihlKSB7DQoJCQkJCWlmKDEgPT09IHRoaXMubm9kZVR5cGUgfHwgMTEgPT09IHRoaXMubm9kZVR5cGUgfHwgOSA9PT0gdGhpcy5ub2RlVHlwZSkgew0KCQkJCQkJdmFyIHQgPSBqZSh0aGlzLCBlKTsNCgkJCQkJCXQuaW5zZXJ0QmVmb3JlKGUsIHQuZmlyc3RDaGlsZCk7DQoJCQkJCX0NCgkJCQl9KTsNCgkJCX0sDQoJCQliZWZvcmU6IGZ1bmN0aW9uKCkge3JldHVybiBIZSh0aGlzLCBhcmd1bWVudHMsIGZ1bmN0aW9uKGUpIHt0aGlzLnBhcmVudE5vZGUgJiYgdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlLCB0aGlzKTt9KTt9LA0KCQkJYWZ0ZXI6IGZ1bmN0aW9uKCkge3JldHVybiBIZSh0aGlzLCBhcmd1bWVudHMsIGZ1bmN0aW9uKGUpIHt0aGlzLnBhcmVudE5vZGUgJiYgdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlLCB0aGlzLm5leHRTaWJsaW5nKTt9KTt9LA0KCQkJZW1wdHk6IGZ1bmN0aW9uKCkgew0KCQkJCWZvcih2YXIgZSwgdCA9IDA7IG51bGwgIT0gKGUgPSB0aGlzW3RdKTsgdCsrKSAxID09PSBlLm5vZGVUeXBlICYmIChTLmNsZWFuRGF0YSh5ZShlLCAhMSkpLCBlLnRleHRDb250ZW50ID0gIiIpOw0KCQkJCXJldHVybiB0aGlzOw0KCQkJfSwNCgkJCWNsb25lOiBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIGUgPSBudWxsICE9IGUgJiYgZSwgdCA9IG51bGwgPT0gdCA/IGUgOiB0LCB0aGlzLm1hcChmdW5jdGlvbigpIHtyZXR1cm4gUy5jbG9uZSh0aGlzLCBlLCB0KTt9KTt9LA0KCQkJaHRtbDogZnVuY3Rpb24oZSkgew0KCQkJCXJldHVybiBCKHRoaXMsIGZ1bmN0aW9uKGUpIHsNCgkJCQkJdmFyIHQgPSB0aGlzWzBdIHx8IHt9LCBuID0gMCwgciA9IHRoaXMubGVuZ3RoOw0KCQkJCQlpZih2b2lkIDAgPT09IGUgJiYgMSA9PT0gdC5ub2RlVHlwZSkgcmV0dXJuIHQuaW5uZXJIVE1MOw0KCQkJCQlpZigic3RyaW5nIiA9PSB0eXBlb2YgZSAmJiAha2UudGVzdChlKSAmJiAhZ2VbKGRlLmV4ZWMoZSkgfHwgWyIiLCAiIl0pWzFdLnRvTG93ZXJDYXNlKCldKSB7DQoJCQkJCQllID0gUy5odG1sUHJlZmlsdGVyKGUpOw0KCQkJCQkJdHJ5IHsNCgkJCQkJCQlmb3IoOyBuIDwgcjsgbisrKSAxID09PSAodCA9IHRoaXNbbl0gfHwge30pLm5vZGVUeXBlICYmIChTLmNsZWFuRGF0YSh5ZSh0LCAhMSkpLCB0LmlubmVySFRNTCA9IGUpOw0KCQkJCQkJCXQgPSAwOw0KCQkJCQkJfSBjYXRjaChlKSB7fQ0KCQkJCQl9DQoJCQkJCXQgJiYgdGhpcy5lbXB0eSgpLmFwcGVuZChlKTsNCgkJCQl9LCBudWxsLCBlLCBhcmd1bWVudHMubGVuZ3RoKTsNCgkJCX0sDQoJCQlyZXBsYWNlV2l0aDogZnVuY3Rpb24oKSB7DQoJCQkJdmFyIG4gPSBbXTsNCgkJCQlyZXR1cm4gSGUodGhpcywgYXJndW1lbnRzLCBmdW5jdGlvbihlKSB7DQoJCQkJCXZhciB0ID0gdGhpcy5wYXJlbnROb2RlOw0KCQkJCQlTLmluQXJyYXkodGhpcywgbikgPCAwICYmIChTLmNsZWFuRGF0YSh5ZSh0aGlzKSksIHQgJiYgdC5yZXBsYWNlQ2hpbGQoZSwgdGhpcykpOw0KCQkJCX0sIG4pOw0KCQkJfQ0KCQl9KSwgUy5lYWNoKHsNCgkJCWFwcGVuZFRvOiAiYXBwZW5kIiwNCgkJCXByZXBlbmRUbzogInByZXBlbmQiLA0KCQkJaW5zZXJ0QmVmb3JlOiAiYmVmb3JlIiwNCgkJCWluc2VydEFmdGVyOiAiYWZ0ZXIiLA0KCQkJcmVwbGFjZUFsbDogInJlcGxhY2VXaXRoIg0KCQl9LCBmdW5jdGlvbihlLCBhKSB7DQoJCQlTLmZuW2VdID0gZnVuY3Rpb24oZSkgew0KCQkJCWZvcih2YXIgdCwgbiA9IFtdLCByID0gUyhlKSwgaSA9IHIubGVuZ3RoIC0gMSwgbyA9IDA7IG8gPD0gaTsgbysrKSB0ID0gbyA9PT0gaSA/IHRoaXMgOiB0aGlzLmNsb25lKCEwKSwgUyhyW29dKVthXSh0KSwgdS5hcHBseShuLCB0LmdldCgpKTsNCgkJCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2sobik7DQoJCQl9Ow0KCQl9KTsNCgkJdmFyIFBlID0gbmV3IFJlZ0V4cCgiXigiICsgZWUgKyAiKSg/IXB4KVthLXolXSskIiwgImkiKSwgUmUgPSAvXi0tLywgTWUgPSBmdW5jdGlvbihlKSB7DQoJCQl2YXIgdCA9IGUub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldzsNCgkJCXJldHVybiB0ICYmIHQub3BlbmVyIHx8ICh0ID0gQyksIHQuZ2V0Q29tcHV0ZWRTdHlsZShlKTsNCgkJfSwgSWUgID0gZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJdmFyIHIsIGksIG8gPSB7fTsNCgkJCWZvcihpIGluIHQpIG9baV0gPSBlLnN0eWxlW2ldLCBlLnN0eWxlW2ldID0gdFtpXTsNCgkJCWZvcihpIGluIHIgPSBuLmNhbGwoZSksIHQpIGUuc3R5bGVbaV0gPSBvW2ldOw0KCQkJcmV0dXJuIHI7DQoJCX0sIFdlICA9IG5ldyBSZWdFeHAobmUuam9pbigifCIpLCAiaSIpLCBGZSA9ICJbXFx4MjBcXHRcXHJcXG5cXGZdIiwgJGUgPSBuZXcgUmVnRXhwKCJeIiArIEZlICsgIit8KCg/Ol58W15cXFxcXSkoPzpcXFxcLikqKSIgKyBGZSArICIrJCIsICJnIik7DQoNCgkJZnVuY3Rpb24gQmUoZSwgdCwgbikgew0KCQkJdmFyIHIsIGksIG8sIGEsIHMgPSBSZS50ZXN0KHQpLCB1ID0gZS5zdHlsZTsNCgkJCXJldHVybiAobiA9IG4gfHwgTWUoZSkpICYmDQoJCQkgICAgICAgKGEgPSBuLmdldFByb3BlcnR5VmFsdWUodCkgfHwgblt0XSwgcyAmJiBhICYmIChhID0gYS5yZXBsYWNlKCRlLCAiJDEiKSB8fCB2b2lkIDApLCAiIiAhPT0gYSB8fCBpZShlKSB8fCAoYSA9IFMuc3R5bGUoZSwgdCkpLCAhdi5waXhlbEJveFN0eWxlcygpICYmDQoJCQkgICAgICAgUGUudGVzdChhKSAmJg0KCQkJICAgICAgIFdlLnRlc3QodCkgJiYNCgkJCSAgICAgICAociA9IHUud2lkdGgsIGkgPSB1Lm1pbldpZHRoLCBvID0gdS5tYXhXaWR0aCwgdS5taW5XaWR0aCA9IHUubWF4V2lkdGggPSB1LndpZHRoID0gYSwgYSA9IG4ud2lkdGgsIHUud2lkdGggPSByLCB1Lm1pbldpZHRoID0gaSwgdS5tYXhXaWR0aCA9IG8pKSwgdm9pZCAwICE9PSBhID8gYSArICIiIDogYTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIF9lKGUsIHQpIHsNCgkJCXJldHVybiB7DQoJCQkJZ2V0OiBmdW5jdGlvbigpIHsNCgkJCQkJaWYoIWUoKSkgcmV0dXJuICh0aGlzLmdldCA9IHQpLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7DQoJCQkJCWRlbGV0ZSB0aGlzLmdldDsNCgkJCQl9DQoJCQl9Ow0KCQl9DQoNCgkJIWZ1bmN0aW9uKCkgew0KCQkJZnVuY3Rpb24gZSgpIHsNCgkJCQlpZihsKSB7DQoJCQkJCXUuc3R5bGUuY3NzVGV4dCA9ICJwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0Oi0xMTExMXB4O3dpZHRoOjYwcHg7bWFyZ2luLXRvcDoxcHg7cGFkZGluZzowO2JvcmRlcjowIiwgbC5zdHlsZS5jc3NUZXh0ID0gInBvc2l0aW9uOnJlbGF0aXZlO2Rpc3BsYXk6YmxvY2s7Ym94LXNpemluZzpib3JkZXItYm94O292ZXJmbG93OnNjcm9sbDttYXJnaW46YXV0bztib3JkZXI6MXB4O3BhZGRpbmc6MXB4O3dpZHRoOjYwJTt0b3A6MSUiLCByZS5hcHBlbmRDaGlsZCh1KQ0KCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kQ2hpbGQobCk7DQoJCQkJCXZhciBlID0gQy5nZXRDb21wdXRlZFN0eWxlKGwpOw0KCQkJCQluID0gIjElIiAhPT0gZS50b3AsIHMgPSAxMiA9PT0gdChlLm1hcmdpbkxlZnQpLCBsLnN0eWxlLnJpZ2h0ID0gIjYwJSIsIG8gPSAzNiA9PT0gdChlLnJpZ2h0KSwgciA9IDM2ID09PSB0KGUud2lkdGgpLCBsLnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIiwgaSA9IDEyID09PSB0KGwub2Zmc2V0V2lkdGggLyAzKSwgcmUucmVtb3ZlQ2hpbGQodSksIGwgPSBudWxsOw0KCQkJCX0NCgkJCX0NCg0KCQkJZnVuY3Rpb24gdChlKSB7cmV0dXJuIE1hdGgucm91bmQocGFyc2VGbG9hdChlKSk7fQ0KDQoJCQl2YXIgbiwgciwgaSwgbywgYSwgcywgdSA9IEUuY3JlYXRlRWxlbWVudCgiZGl2IiksIGwgPSBFLmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KCQkJbC5zdHlsZSAmJiAobC5zdHlsZS5iYWNrZ3JvdW5kQ2xpcCA9ICJjb250ZW50LWJveCIsIGwuY2xvbmVOb2RlKCEwKS5zdHlsZS5iYWNrZ3JvdW5kQ2xpcCA9ICIiLCB2LmNsZWFyQ2xvbmVTdHlsZSA9ICJjb250ZW50LWJveCIgPT09IGwuc3R5bGUuYmFja2dyb3VuZENsaXAsIFMuZXh0ZW5kKHYsIHsNCgkJCQlib3hTaXppbmdSZWxpYWJsZTogZnVuY3Rpb24oKSB7cmV0dXJuIGUoKSwgcjt9LA0KCQkJCXBpeGVsQm94U3R5bGVzOiBmdW5jdGlvbigpIHtyZXR1cm4gZSgpLCBvO30sDQoJCQkJcGl4ZWxQb3NpdGlvbjogZnVuY3Rpb24oKSB7cmV0dXJuIGUoKSwgbjt9LA0KCQkJCXJlbGlhYmxlTWFyZ2luTGVmdDogZnVuY3Rpb24oKSB7cmV0dXJuIGUoKSwgczt9LA0KCQkJCXNjcm9sbGJveFNpemU6IGZ1bmN0aW9uKCkge3JldHVybiBlKCksIGk7fSwNCgkJCQlyZWxpYWJsZVRyRGltZW5zaW9uczogZnVuY3Rpb24oKSB7DQoJCQkJCXZhciBlLCB0LCBuLCByOw0KCQkJCQlyZXR1cm4gbnVsbCA9PQ0KCQkJCQkgICAgICAgYSAmJg0KCQkJCQkgICAgICAgKGUgPSBFLmNyZWF0ZUVsZW1lbnQoInRhYmxlIiksIHQgPSBFLmNyZWF0ZUVsZW1lbnQoInRyIiksIG4gPSBFLmNyZWF0ZUVsZW1lbnQoImRpdiIpLCBlLnN0eWxlLmNzc1RleHQgPSAicG9zaXRpb246YWJzb2x1dGU7bGVmdDotMTExMTFweDtib3JkZXItY29sbGFwc2U6c2VwYXJhdGUiLCB0LnN0eWxlLmNzc1RleHQgPSAiYm9yZGVyOjFweCBzb2xpZCIsIHQuc3R5bGUuaGVpZ2h0ID0gIjFweCIsIG4uc3R5bGUuaGVpZ2h0ID0gIjlweCIsIG4uc3R5bGUuZGlzcGxheSA9DQoJCQkJCQkgICAgICAgImJsb2NrIiwgcmUuYXBwZW5kQ2hpbGQoZSkNCgkJCQkJICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmRDaGlsZCh0KQ0KCQkJCQkgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZENoaWxkKG4pLCByID0gQy5nZXRDb21wdXRlZFN0eWxlKHQpLCBhID0gcGFyc2VJbnQoci5oZWlnaHQsIDEwKSArIHBhcnNlSW50KHIuYm9yZGVyVG9wV2lkdGgsIDEwKSArIHBhcnNlSW50KHIuYm9yZGVyQm90dG9tV2lkdGgsIDEwKSA9PT0gdC5vZmZzZXRIZWlnaHQsIHJlLnJlbW92ZUNoaWxkKGUpKSwgYTsNCgkJCQl9DQoJCQl9KSk7DQoJCX0oKTsNCgkJdmFyIHplID0gWyJXZWJraXQiLCAiTW96IiwgIm1zIl0sIFVlID0gRS5jcmVhdGVFbGVtZW50KCJkaXYiKS5zdHlsZSwgWGUgPSB7fTsNCg0KCQlmdW5jdGlvbiBWZShlKSB7DQoJCQl2YXIgdCA9IFMuY3NzUHJvcHNbZV0gfHwgWGVbZV07DQoJCQlyZXR1cm4gdCB8fCAoZSBpbiBVZSA/IGUgOiBYZVtlXSA9IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCA9IGVbMF0udG9VcHBlckNhc2UoKSArIGUuc2xpY2UoMSksIG4gPSB6ZS5sZW5ndGg7DQoJCQkJd2hpbGUobi0tKSBpZigoZSA9IHplW25dICsgdCkgaW4gVWUpIHJldHVybiBlOw0KCQkJfShlKSB8fCBlKTsNCgkJfQ0KDQoJCXZhciBHZSA9IC9eKG5vbmV8dGFibGUoPyEtY1tlYV0pLispLywgWWUgPSB7cG9zaXRpb246ICJhYnNvbHV0ZSIsIHZpc2liaWxpdHk6ICJoaWRkZW4iLCBkaXNwbGF5OiAiYmxvY2sifSwgUWUgPSB7bGV0dGVyU3BhY2luZzogIjAiLCBmb250V2VpZ2h0OiAiNDAwIn07DQoNCgkJZnVuY3Rpb24gSmUoZSwgdCwgbikgew0KCQkJdmFyIHIgPSB0ZS5leGVjKHQpOw0KCQkJcmV0dXJuIHIgPyBNYXRoLm1heCgwLCByWzJdIC0gKG4gfHwgMCkpICsgKHJbM10gfHwgInB4IikgOiB0Ow0KCQl9DQoNCgkJZnVuY3Rpb24gS2UoZSwgdCwgbiwgciwgaSwgbykgew0KCQkJdmFyIGEgPSAid2lkdGgiID09PSB0ID8gMSA6IDAsIHMgPSAwLCB1ID0gMDsNCgkJCWlmKG4gPT09IChyID8gImJvcmRlciIgOiAiY29udGVudCIpKSByZXR1cm4gMDsNCgkJCWZvcig7IGEgPCA0OyBhICs9IDIpICJtYXJnaW4iID09PSBuICYmICh1ICs9IFMuY3NzKGUsIG4gKyBuZVthXSwgITAsIGkpKSwgciA/DQoJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgiY29udGVudCIgPT09IG4gJiYgKHUgLT0gUy5jc3MoZSwgInBhZGRpbmciICsgbmVbYV0sICEwLCBpKSksICJtYXJnaW4iICE9PSBuICYmICh1IC09IFMuY3NzKGUsICJib3JkZXIiICsgbmVbYV0gKyAiV2lkdGgiLCAhMCwgaSkpKSA6DQoJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh1ICs9IFMuY3NzKGUsICJwYWRkaW5nIiArIG5lW2FdLCAhMCwgaSksICJwYWRkaW5nIiAhPT0gbiA/IHUgKz0gUy5jc3MoZSwgImJvcmRlciIgKyBuZVthXSArICJXaWR0aCIsICEwLCBpKSA6IHMgKz0gUy5jc3MoZSwgImJvcmRlciIgKyBuZVthXSArICJXaWR0aCIsICEwLCBpKSk7DQoJCQlyZXR1cm4gIXIgJiYgMCA8PSBvICYmICh1ICs9IE1hdGgubWF4KDAsIE1hdGguY2VpbChlWyJvZmZzZXQiICsgdFswXS50b1VwcGVyQ2FzZSgpICsgdC5zbGljZSgxKV0gLSBvIC0gdSAtIHMgLSAuNSkpIHx8IDApLCB1Ow0KCQl9DQoNCgkJZnVuY3Rpb24gWmUoZSwgdCwgbikgew0KCQkJdmFyIHIgPSBNZShlKSwgaSA9ICghdi5ib3hTaXppbmdSZWxpYWJsZSgpIHx8IG4pICYmICJib3JkZXItYm94IiA9PT0gUy5jc3MoZSwgImJveFNpemluZyIsICExLCByKSwgbyA9IGksIGEgPSBCZShlLCB0LCByKSwgcyA9ICJvZmZzZXQiICsgdFswXS50b1VwcGVyQ2FzZSgpICsgdC5zbGljZSgxKTsNCgkJCWlmKFBlLnRlc3QoYSkpIHsNCgkJCQlpZighbikgcmV0dXJuIGE7DQoJCQkJYSA9ICJhdXRvIjsNCgkJCX0NCgkJCXJldHVybiAoIXYuYm94U2l6aW5nUmVsaWFibGUoKSAmJiBpIHx8ICF2LnJlbGlhYmxlVHJEaW1lbnNpb25zKCkgJiYgQShlLCAidHIiKSB8fCAiYXV0byIgPT09IGEgfHwgIXBhcnNlRmxvYXQoYSkgJiYgImlubGluZSIgPT09IFMuY3NzKGUsICJkaXNwbGF5IiwgITEsIHIpKSAmJiBlLmdldENsaWVudFJlY3RzKCkubGVuZ3RoICYmIChpID0gImJvcmRlci1ib3giID09PSBTLmNzcyhlLCAiYm94U2l6aW5nIiwgITEsIHIpLCAobyA9IHMgaW4gZSkgJiYgKGEgPSBlW3NdKSksIChhID0NCgkJCQlwYXJzZUZsb2F0KGEpIHx8IDApICsgS2UoZSwgdCwgbiB8fCAoaSA/ICJib3JkZXIiIDogImNvbnRlbnQiKSwgbywgciwgYSkgKyAicHgiOw0KCQl9DQoNCgkJZnVuY3Rpb24gZXQoZSwgdCwgbiwgciwgaSkge3JldHVybiBuZXcgZXQucHJvdG90eXBlLmluaXQoZSwgdCwgbiwgciwgaSk7fQ0KDQoJCVMuZXh0ZW5kKHsNCgkJCWNzc0hvb2tzOiB7DQoJCQkJb3BhY2l0eTogew0KCQkJCQlnZXQ6IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJCWlmKHQpIHsNCgkJCQkJCQl2YXIgbiA9IEJlKGUsICJvcGFjaXR5Iik7DQoJCQkJCQkJcmV0dXJuICIiID09PSBuID8gIjEiIDogbjsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0NCgkJCX0sDQoJCQljc3NOdW1iZXI6IHsNCgkJCQlhbmltYXRpb25JdGVyYXRpb25Db3VudDogITAsDQoJCQkJY29sdW1uQ291bnQ6ICEwLA0KCQkJCWZpbGxPcGFjaXR5OiAhMCwNCgkJCQlmbGV4R3JvdzogITAsDQoJCQkJZmxleFNocmluazogITAsDQoJCQkJZm9udFdlaWdodDogITAsDQoJCQkJZ3JpZEFyZWE6ICEwLA0KCQkJCWdyaWRDb2x1bW46ICEwLA0KCQkJCWdyaWRDb2x1bW5FbmQ6ICEwLA0KCQkJCWdyaWRDb2x1bW5TdGFydDogITAsDQoJCQkJZ3JpZFJvdzogITAsDQoJCQkJZ3JpZFJvd0VuZDogITAsDQoJCQkJZ3JpZFJvd1N0YXJ0OiAhMCwNCgkJCQlsaW5lSGVpZ2h0OiAhMCwNCgkJCQlvcGFjaXR5OiAhMCwNCgkJCQlvcmRlcjogITAsDQoJCQkJb3JwaGFuczogITAsDQoJCQkJd2lkb3dzOiAhMCwNCgkJCQl6SW5kZXg6ICEwLA0KCQkJCXpvb206ICEwDQoJCQl9LA0KCQkJY3NzUHJvcHM6IHt9LA0KCQkJc3R5bGU6IGZ1bmN0aW9uKGUsIHQsIG4sIHIpIHsNCgkJCQlpZihlICYmIDMgIT09IGUubm9kZVR5cGUgJiYgOCAhPT0gZS5ub2RlVHlwZSAmJiBlLnN0eWxlKSB7DQoJCQkJCXZhciBpLCBvLCBhLCBzID0gWCh0KSwgdSA9IFJlLnRlc3QodCksIGwgPSBlLnN0eWxlOw0KCQkJCQlpZih1IHx8ICh0ID0gVmUocykpLCBhID0gUy5jc3NIb29rc1t0XSB8fCBTLmNzc0hvb2tzW3NdLCB2b2lkIDAgPT09IG4pIHJldHVybiBhICYmICJnZXQiIGluIGEgJiYgdm9pZCAwICE9PSAoaSA9IGEuZ2V0KGUsICExLCByKSkgPyBpIDogbFt0XTsNCgkJCQkJInN0cmluZyIgPT09IChvID0gdHlwZW9mIG4pICYmIChpID0gdGUuZXhlYyhuKSkgJiYgaVsxXSAmJiAobiA9IHNlKGUsIHQsIGkpLCBvID0gIm51bWJlciIpLCBudWxsICE9DQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiAmJg0KCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gPT0NCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuICYmDQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCJudW1iZXIiICE9PSBvIHx8IHUgfHwgKG4gKz0gaSAmJiBpWzNdIHx8IChTLmNzc051bWJlcltzXSA/ICIiIDogInB4IikpLCB2LmNsZWFyQ2xvbmVTdHlsZSB8fCAiIiAhPT0gbiB8fCAwICE9PSB0LmluZGV4T2YoImJhY2tncm91bmQiKSB8fCAobFt0XSA9ICJpbmhlcml0IiksIGEgJiYNCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNldCIgaW4NCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSAmJg0KCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkIDAgPT09DQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChuID0gYS5zZXQoZSwgbiwgcikpIHx8DQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh1ID8NCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwuc2V0UHJvcGVydHkodCwgbikgOg0KCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbFt0XSA9IG4pKTsNCgkJCQl9DQoJCQl9LA0KCQkJY3NzOiBmdW5jdGlvbihlLCB0LCBuLCByKSB7DQoJCQkJdmFyIGksIG8sIGEsIHMgPSBYKHQpOw0KCQkJCXJldHVybiBSZS50ZXN0KHQpIHx8ICh0ID0gVmUocykpLCAoYSA9IFMuY3NzSG9va3NbdF0gfHwgUy5jc3NIb29rc1tzXSkgJiYgImdldCIgaW4gYSAmJiAoaSA9IGEuZ2V0KGUsICEwLCBuKSksIHZvaWQgMCA9PT0gaSAmJiAoaSA9IEJlKGUsIHQsIHIpKSwgIm5vcm1hbCIgPT09IGkgJiYgdCBpbiBRZSAmJiAoaSA9IFFlW3RdKSwgIiIgPT09IG4gfHwgbiA/IChvID0gcGFyc2VGbG9hdChpKSwgITAgPT09IG4gfHwgaXNGaW5pdGUobykgPyBvIHx8IDAgOiBpKSA6IGk7DQoJCQl9DQoJCX0pLCBTLmVhY2goWyJoZWlnaHQiLA0KCQkgICAgICAgICAgICAid2lkdGgiXSwgZnVuY3Rpb24oZSwgdSkgew0KCQkJUy5jc3NIb29rc1t1XSA9IHsNCgkJCQlnZXQ6IGZ1bmN0aW9uKGUsIHQsIG4pIHtpZih0KSByZXR1cm4gIUdlLnRlc3QoUy5jc3MoZSwgImRpc3BsYXkiKSkgfHwgZS5nZXRDbGllbnRSZWN0cygpLmxlbmd0aCAmJiBlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoID8gWmUoZSwgdSwgbikgOiBJZShlLCBZZSwgZnVuY3Rpb24oKSB7cmV0dXJuIFplKGUsIHUsIG4pO30pO30sDQoJCQkJc2V0OiBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJCXZhciByLCBpID0gTWUoZSksIG8gPSAhdi5zY3JvbGxib3hTaXplKCkgJiYgImFic29sdXRlIiA9PT0gaS5wb3NpdGlvbiwgYSA9IChvIHx8IG4pICYmICJib3JkZXItYm94IiA9PT0gUy5jc3MoZSwgImJveFNpemluZyIsICExLCBpKSwgcyA9IG4gPyBLZShlLCB1LCBuLCBhLCBpKSA6IDA7DQoJCQkJCXJldHVybiBhICYmIG8gJiYgKHMgLT0gTWF0aC5jZWlsKGVbIm9mZnNldCIgKyB1WzBdLnRvVXBwZXJDYXNlKCkgKyB1LnNsaWNlKDEpXSAtIHBhcnNlRmxvYXQoaVt1XSkgLSBLZShlLCB1LCAiYm9yZGVyIiwgITEsIGkpIC0gLjUpKSwgcyAmJiAociA9IHRlLmV4ZWModCkpICYmICJweCIgIT09IChyWzNdIHx8ICJweCIpICYmIChlLnN0eWxlW3VdID0gdCwgdCA9IFMuY3NzKGUsIHUpKSwgSmUoMCwgdCwgcyk7DQoJCQkJfQ0KCQkJfTsNCgkJfSksIFMuY3NzSG9va3MubWFyZ2luTGVmdCA9IF9lKHYucmVsaWFibGVNYXJnaW5MZWZ0LCBmdW5jdGlvbihlLCB0KSB7aWYodCkgcmV0dXJuIChwYXJzZUZsb2F0KEJlKGUsICJtYXJnaW5MZWZ0IikpIHx8IGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCAtIEllKGUsIHttYXJnaW5MZWZ0OiAwfSwgZnVuY3Rpb24oKSB7cmV0dXJuIGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdDt9KSkgKyAicHgiO30pLCBTLmVhY2goew0KCQkJbWFyZ2luOiAiIiwNCgkJCXBhZGRpbmc6ICIiLA0KCQkJYm9yZGVyOiAiV2lkdGgiDQoJCX0sIGZ1bmN0aW9uKGksIG8pIHsNCgkJCVMuY3NzSG9va3NbaSArIG9dID0gew0KCQkJCWV4cGFuZDogZnVuY3Rpb24oZSkgew0KCQkJCQlmb3IodmFyIHQgPSAwLCBuID0ge30sIHIgPSAic3RyaW5nIiA9PSB0eXBlb2YgZSA/IGUuc3BsaXQoIiAiKSA6IFtlXTsgdCA8IDQ7IHQrKykgbltpICsgbmVbdF0gKyBvXSA9IHJbdF0gfHwgclt0IC0gMl0gfHwgclswXTsNCgkJCQkJcmV0dXJuIG47DQoJCQkJfQ0KCQkJfSwgIm1hcmdpbiIgIT09IGkgJiYgKFMuY3NzSG9va3NbaSArIG9dLnNldCA9IEplKTsNCgkJfSksIFMuZm4uZXh0ZW5kKHsNCgkJCWNzczogZnVuY3Rpb24oZSwgdCkgew0KCQkJCXJldHVybiBCKHRoaXMsIGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQkJdmFyIHIsIGksIG8gPSB7fSwgYSA9IDA7DQoJCQkJCWlmKEFycmF5LmlzQXJyYXkodCkpIHsNCgkJCQkJCWZvcihyID0gTWUoZSksIGkgPSB0Lmxlbmd0aDsgYSA8IGk7IGErKykgb1t0W2FdXSA9IFMuY3NzKGUsIHRbYV0sICExLCByKTsNCgkJCQkJCXJldHVybiBvOw0KCQkJCQl9DQoJCQkJCXJldHVybiB2b2lkIDAgIT09IG4gPyBTLnN0eWxlKGUsIHQsIG4pIDogUy5jc3MoZSwgdCk7DQoJCQkJfSwgZSwgdCwgMSA8IGFyZ3VtZW50cy5sZW5ndGgpOw0KCQkJfQ0KCQl9KSwgKChTLlR3ZWVuID0gZXQpLnByb3RvdHlwZSA9IHsNCgkJCWNvbnN0cnVjdG9yOiBldCwNCgkJCWluaXQ6IGZ1bmN0aW9uKGUsIHQsIG4sIHIsIGksIG8pIHt0aGlzLmVsZW0gPSBlLCB0aGlzLnByb3AgPSBuLCB0aGlzLmVhc2luZyA9IGkgfHwgUy5lYXNpbmcuX2RlZmF1bHQsIHRoaXMub3B0aW9ucyA9IHQsIHRoaXMuc3RhcnQgPSB0aGlzLm5vdyA9IHRoaXMuY3VyKCksIHRoaXMuZW5kID0gciwgdGhpcy51bml0ID0gbyB8fCAoUy5jc3NOdW1iZXJbbl0gPyAiIiA6ICJweCIpO30sDQoJCQljdXI6IGZ1bmN0aW9uKCkgew0KCQkJCXZhciBlID0gZXQucHJvcEhvb2tzW3RoaXMucHJvcF07DQoJCQkJcmV0dXJuIGUgJiYgZS5nZXQgPyBlLmdldCh0aGlzKSA6IGV0LnByb3BIb29rcy5fZGVmYXVsdC5nZXQodGhpcyk7DQoJCQl9LA0KCQkJcnVuOiBmdW5jdGlvbihlKSB7DQoJCQkJdmFyIHQsIG4gPSBldC5wcm9wSG9va3NbdGhpcy5wcm9wXTsNCgkJCQlyZXR1cm4gdGhpcy5vcHRpb25zLmR1cmF0aW9uID8gdGhpcy5wb3MgPSB0ID0gUy5lYXNpbmdbdGhpcy5lYXNpbmddKGUsIHRoaXMub3B0aW9ucy5kdXJhdGlvbiAqIGUsIDAsIDEsIHRoaXMub3B0aW9ucy5kdXJhdGlvbikgOiB0aGlzLnBvcyA9IHQgPSBlLCB0aGlzLm5vdyA9ICh0aGlzLmVuZCAtIHRoaXMuc3RhcnQpICogdCArIHRoaXMuc3RhcnQsIHRoaXMub3B0aW9ucy5zdGVwICYmIHRoaXMub3B0aW9ucy5zdGVwLmNhbGwodGhpcy5lbGVtLCB0aGlzLm5vdywgdGhpcyksIG4gJiYgbi5zZXQgPw0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5zZXQodGhpcykgOg0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXQucHJvcEhvb2tzLl9kZWZhdWx0LnNldCh0aGlzKSwgdGhpczsNCgkJCX0NCgkJfSkuaW5pdC5wcm90b3R5cGUgPSBldC5wcm90b3R5cGUsIChldC5wcm9wSG9va3MgPSB7DQoJCQlfZGVmYXVsdDogew0KCQkJCWdldDogZnVuY3Rpb24oZSkgew0KCQkJCQl2YXIgdDsNCgkJCQkJcmV0dXJuIDEgIT09IGUuZWxlbS5ub2RlVHlwZSB8fCBudWxsICE9IGUuZWxlbVtlLnByb3BdICYmIG51bGwgPT0gZS5lbGVtLnN0eWxlW2UucHJvcF0gPyBlLmVsZW1bZS5wcm9wXSA6ICh0ID0gUy5jc3MoZS5lbGVtLCBlLnByb3AsICIiKSkgJiYgImF1dG8iICE9PSB0ID8gdCA6IDA7DQoJCQkJfSwNCgkJCQlzZXQ6IGZ1bmN0aW9uKGUpIHtTLmZ4LnN0ZXBbZS5wcm9wXSA/IFMuZnguc3RlcFtlLnByb3BdKGUpIDogMSAhPT0gZS5lbGVtLm5vZGVUeXBlIHx8ICFTLmNzc0hvb2tzW2UucHJvcF0gJiYgbnVsbCA9PSBlLmVsZW0uc3R5bGVbVmUoZS5wcm9wKV0gPyBlLmVsZW1bZS5wcm9wXSA9IGUubm93IDogUy5zdHlsZShlLmVsZW0sIGUucHJvcCwgZS5ub3cgKyBlLnVuaXQpO30NCgkJCX0NCgkJfSkuc2Nyb2xsVG9wID0gZXQucHJvcEhvb2tzLnNjcm9sbExlZnQgPSB7c2V0OiBmdW5jdGlvbihlKSB7ZS5lbGVtLm5vZGVUeXBlICYmIGUuZWxlbS5wYXJlbnROb2RlICYmIChlLmVsZW1bZS5wcm9wXSA9IGUubm93KTt9fSwgUy5lYXNpbmcgPSB7DQoJCQlsaW5lYXI6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gZTt9LA0KCQkJc3dpbmc6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gLjUgLSBNYXRoLmNvcyhlICogTWF0aC5QSSkgLyAyO30sDQoJCQlfZGVmYXVsdDogInN3aW5nIg0KCQl9LCBTLmZ4ID0gZXQucHJvdG90eXBlLmluaXQsIFMuZnguc3RlcCA9IHt9Ow0KCQl2YXIgdHQsIG50LCBydCwgaXQsIG90ID0gL14oPzp0b2dnbGV8c2hvd3xoaWRlKSQvLCBhdCA9IC9xdWV1ZUhvb2tzJC87DQoNCgkJZnVuY3Rpb24gc3QoKSB7bnQgJiYgKCExID09PSBFLmhpZGRlbiAmJiBDLnJlcXVlc3RBbmltYXRpb25GcmFtZSA/IEMucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHN0KSA6IEMuc2V0VGltZW91dChzdCwgUy5meC5pbnRlcnZhbCksIFMuZngudGljaygpKTt9DQoNCgkJZnVuY3Rpb24gdXQoKSB7cmV0dXJuIEMuc2V0VGltZW91dChmdW5jdGlvbigpIHt0dCA9IHZvaWQgMDt9KSwgdHQgPSBEYXRlLm5vdygpO30NCg0KCQlmdW5jdGlvbiBsdChlLCB0KSB7DQoJCQl2YXIgbiwgciA9IDAsIGkgPSB7aGVpZ2h0OiBlfTsNCgkJCWZvcih0ID0gdCA/IDEgOiAwOyByIDwgNDsgciArPSAyIC0gdCkgaVsibWFyZ2luIiArIChuID0gbmVbcl0pXSA9IGlbInBhZGRpbmciICsgbl0gPSBlOw0KCQkJcmV0dXJuIHQgJiYgKGkub3BhY2l0eSA9IGkud2lkdGggPSBlKSwgaTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIGN0KGUsIHQsIG4pIHtmb3IodmFyIHIsIGkgPSAoZnQudHdlZW5lcnNbdF0gfHwgW10pLmNvbmNhdChmdC50d2VlbmVyc1siKiJdKSwgbyA9IDAsIGEgPSBpLmxlbmd0aDsgbyA8IGE7IG8rKykgaWYociA9IGlbb10uY2FsbChuLCB0LCBlKSkgcmV0dXJuIHI7fQ0KDQoJCWZ1bmN0aW9uIGZ0KG8sIGUsIHQpIHsNCgkJCXZhciBuLA0KCQkJICAgIGEsDQoJCQkgICAgciA9IDAsDQoJCQkgICAgaSA9IGZ0LnByZWZpbHRlcnMubGVuZ3RoLA0KCQkJICAgIHMgPSBTLkRlZmVycmVkKCkuYWx3YXlzKGZ1bmN0aW9uKCkge2RlbGV0ZSB1LmVsZW07fSksDQoJCQkgICAgdSA9IGZ1bmN0aW9uKCkgew0KCQkJCSAgICBpZihhKSByZXR1cm4gITE7DQoJCQkJICAgIGZvcih2YXIgZSA9IHR0IHx8IHV0KCksIHQgPSBNYXRoLm1heCgwLCBsLnN0YXJ0VGltZSArIGwuZHVyYXRpb24gLSBlKSwgbiA9IDEgLSAodCAvIGwuZHVyYXRpb24gfHwgMCksIHIgPSAwLCBpID0gbC50d2VlbnMubGVuZ3RoOyByIDwgaTsgcisrKSBsLnR3ZWVuc1tyXS5ydW4obik7DQoJCQkJICAgIHJldHVybiBzLm5vdGlmeVdpdGgobywgW2wsIG4sIHRdKSwgbiA8IDEgJiYgaSA/IHQgOiAoaSB8fCBzLm5vdGlmeVdpdGgobywgW2wsIDEsIDBdKSwgcy5yZXNvbHZlV2l0aChvLCBbbF0pLCAhMSk7DQoJCQkgICAgfSwNCgkJCSAgICBsID0gcy5wcm9taXNlKHsNCgkJCQkgICAgZWxlbTogbywNCgkJCQkgICAgcHJvcHM6IFMuZXh0ZW5kKHt9LCBlKSwNCgkJCQkgICAgb3B0czogUy5leHRlbmQoITAsIHtzcGVjaWFsRWFzaW5nOiB7fSwgZWFzaW5nOiBTLmVhc2luZy5fZGVmYXVsdH0sIHQpLA0KCQkJCSAgICBvcmlnaW5hbFByb3BlcnRpZXM6IGUsDQoJCQkJICAgIG9yaWdpbmFsT3B0aW9uczogdCwNCgkJCQkgICAgc3RhcnRUaW1lOiB0dCB8fCB1dCgpLA0KCQkJCSAgICBkdXJhdGlvbjogdC5kdXJhdGlvbiwNCgkJCQkgICAgdHdlZW5zOiBbXSwNCgkJCQkgICAgY3JlYXRlVHdlZW46IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJICAgIHZhciBuID0gUy5Ud2VlbihvLCBsLm9wdHMsIGUsIHQsIGwub3B0cy5zcGVjaWFsRWFzaW5nW2VdIHx8IGwub3B0cy5lYXNpbmcpOw0KCQkJCQkgICAgcmV0dXJuIGwudHdlZW5zLnB1c2gobiksIG47DQoJCQkJICAgIH0sDQoJCQkJICAgIHN0b3A6IGZ1bmN0aW9uKGUpIHsNCgkJCQkJICAgIHZhciB0ID0gMCwgbiA9IGUgPyBsLnR3ZWVucy5sZW5ndGggOiAwOw0KCQkJCQkgICAgaWYoYSkgcmV0dXJuIHRoaXM7DQoJCQkJCSAgICBmb3IoYSA9ICEwOyB0IDwgbjsgdCsrKSBsLnR3ZWVuc1t0XS5ydW4oMSk7DQoJCQkJCSAgICByZXR1cm4gZSA/IChzLm5vdGlmeVdpdGgobywgW2wsIDEsIDBdKSwgcy5yZXNvbHZlV2l0aChvLCBbbCwgZV0pKSA6IHMucmVqZWN0V2l0aChvLCBbbCwgZV0pLCB0aGlzOw0KCQkJCSAgICB9DQoJCQkgICAgfSksDQoJCQkgICAgYyA9IGwucHJvcHM7DQoJCQlmb3IoIWZ1bmN0aW9uKGUsIHQpIHsNCgkJCQl2YXIgbiwgciwgaSwgbywgYTsNCgkJCQlmb3IobiBpbiBlKSBpZihpID0gdFtyID0gWChuKV0sIG8gPSBlW25dLCBBcnJheS5pc0FycmF5KG8pICYmIChpID0gb1sxXSwgbyA9IGVbbl0gPSBvWzBdKSwgbiAhPT0gciAmJiAoZVtyXSA9IG8sIGRlbGV0ZSBlW25dKSwgKGEgPSBTLmNzc0hvb2tzW3JdKSAmJiAiZXhwYW5kIiBpbiBhKSBmb3IobiBpbiBvID0gYS5leHBhbmQobyksIGRlbGV0ZSBlW3JdLCBvKSBuIGluIGUgfHwgKGVbbl0gPSBvW25dLCB0W25dID0gaSk7IGVsc2UgdFtyXSA9IGk7DQoJCQl9KGMsIGwub3B0cy5zcGVjaWFsRWFzaW5nKTsgciA8IGk7IHIrKykgew0KCQkJCWlmKG4gPSBmdC5wcmVmaWx0ZXJzW3JdLmNhbGwobCwgbywgYywgbC5vcHRzKSkgcmV0dXJuIG0obi5zdG9wKSAmJiAoUy5fcXVldWVIb29rcyhsLmVsZW0sIGwub3B0cy5xdWV1ZSkuc3RvcCA9IG4uc3RvcC5iaW5kKG4pKSwgbjsNCgkJCX0NCgkJCXJldHVybiBTLm1hcChjLCBjdCwgbCksIG0obC5vcHRzLnN0YXJ0KSAmJiBsLm9wdHMuc3RhcnQuY2FsbChvLCBsKSwgbC5wcm9ncmVzcyhsLm9wdHMucHJvZ3Jlc3MpDQoJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZG9uZShsLm9wdHMuZG9uZSwgbC5vcHRzLmNvbXBsZXRlKQ0KCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZhaWwobC5vcHRzLmZhaWwpDQoJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWx3YXlzKGwub3B0cy5hbHdheXMpLCBTLmZ4LnRpbWVyKFMuZXh0ZW5kKHUsIHtlbGVtOiBvLCBhbmltOiBsLCBxdWV1ZTogbC5vcHRzLnF1ZXVlfSkpLCBsOw0KCQl9DQoNCgkJUy5BbmltYXRpb24gPSBTLmV4dGVuZChmdCwgew0KCQkJdHdlZW5lcnM6IHsNCgkJCQkiKiI6IFtmdW5jdGlvbihlLCB0KSB7DQoJCQkJCXZhciBuID0gdGhpcy5jcmVhdGVUd2VlbihlLCB0KTsNCgkJCQkJcmV0dXJuIHNlKG4uZWxlbSwgZSwgdGUuZXhlYyh0KSwgbiksIG47DQoJCQkJfV0NCgkJCX0sIHR3ZWVuZXI6IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQltKGUpID8gKHQgPSBlLCBlID0gWyIqIl0pIDogZSA9IGUubWF0Y2goUCk7DQoJCQkJZm9yKHZhciBuLCByID0gMCwgaSA9IGUubGVuZ3RoOyByIDwgaTsgcisrKSBuID0gZVtyXSwgZnQudHdlZW5lcnNbbl0gPSBmdC50d2VlbmVyc1tuXSB8fCBbXSwgZnQudHdlZW5lcnNbbl0udW5zaGlmdCh0KTsNCgkJCX0sIHByZWZpbHRlcnM6IFtmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJdmFyIHIsIGksIG8sIGEsIHMsIHUsIGwsIGMsIGYgPSAid2lkdGgiIGluIHQgfHwgImhlaWdodCIgaW4gdCwgcCA9IHRoaXMsIGQgPSB7fSwgaCA9IGUuc3R5bGUsIGcgPSBlLm5vZGVUeXBlICYmIGFlKGUpLCB5ID0gWS5nZXQoZSwgImZ4c2hvdyIpOw0KCQkJCWZvcihyIGluIG4ucXVldWUgfHwgKG51bGwgPT0gKGEgPSBTLl9xdWV1ZUhvb2tzKGUsICJmeCIpKS51bnF1ZXVlZCAmJiAoYS51bnF1ZXVlZCA9IDAsIHMgPSBhLmVtcHR5LmZpcmUsIGEuZW1wdHkuZmlyZSA9IGZ1bmN0aW9uKCkge2EudW5xdWV1ZWQgfHwgcygpO30pLCBhLnVucXVldWVkKyssIHAuYWx3YXlzKGZ1bmN0aW9uKCkge3AuYWx3YXlzKGZ1bmN0aW9uKCkge2EudW5xdWV1ZWQtLSwgUy5xdWV1ZShlLCAiZngiKS5sZW5ndGggfHwgYS5lbXB0eS5maXJlKCk7fSk7fSkpLCB0KSB7DQoJCQkJCWlmKGkgPSB0W3JdLCBvdC50ZXN0KGkpKSB7DQoJCQkJCQlpZihkZWxldGUgdFtyXSwgbyA9IG8gfHwgInRvZ2dsZSIgPT09IGksIGkgPT09IChnID8gImhpZGUiIDogInNob3ciKSkgew0KCQkJCQkJCWlmKCJzaG93IiAhPT0gaSB8fCAheSB8fCB2b2lkIDAgPT09IHlbcl0pIGNvbnRpbnVlOw0KCQkJCQkJCWcgPSAhMDsNCgkJCQkJCX0NCgkJCQkJCWRbcl0gPSB5ICYmIHlbcl0gfHwgUy5zdHlsZShlLCByKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCQlpZigodSA9ICFTLmlzRW1wdHlPYmplY3QodCkpIHx8ICFTLmlzRW1wdHlPYmplY3QoZCkpIHsNCgkJCQkJZm9yKHIgaW4gZiAmJiAxID09PSBlLm5vZGVUeXBlICYmIChuLm92ZXJmbG93ID0gW2gub3ZlcmZsb3csDQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoLm92ZXJmbG93WCwNCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGgub3ZlcmZsb3dZXSwgbnVsbCA9PSAobCA9IHkgJiYgeS5kaXNwbGF5KSAmJiAobCA9IFkuZ2V0KGUsICJkaXNwbGF5IikpLCAibm9uZSIgPT09IChjID0gUy5jc3MoZSwgImRpc3BsYXkiKSkgJiYgKGwgPyBjID0gbCA6IChsZShbZV0sICEwKSwgbCA9IGUuc3R5bGUuZGlzcGxheSB8fCBsLCBjID0gUy5jc3MoZSwgImRpc3BsYXkiKSwgbGUoW2VdKSkpLCAoImlubGluZSIgPT09DQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgfHwNCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImlubGluZS1ibG9jayIgPT09DQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgJiYNCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPQ0KCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsKSAmJg0KCQkJCQkgICAgICAgICAibm9uZSIgPT09DQoJCQkJCSAgICAgICAgIFMuY3NzKGUsICJmbG9hdCIpICYmDQoJCQkJCSAgICAgICAgICh1IHx8IChwLmRvbmUoZnVuY3Rpb24oKSB7aC5kaXNwbGF5ID0gbDt9KSwgbnVsbCA9PSBsICYmIChjID0gaC5kaXNwbGF5LCBsID0gIm5vbmUiID09PSBjID8gIiIgOiBjKSksIGguZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siKSksIG4ub3ZlcmZsb3cgJiYNCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGgub3ZlcmZsb3cgPSAiaGlkZGVuIiwgcC5hbHdheXMoZnVuY3Rpb24oKSB7aC5vdmVyZmxvdyA9IG4ub3ZlcmZsb3dbMF0sIGgub3ZlcmZsb3dYID0gbi5vdmVyZmxvd1sxXSwgaC5vdmVyZmxvd1kgPSBuLm92ZXJmbG93WzJdO30pKSwgdSA9DQoJCQkJCQkhMSwgZCkgew0KCQkJCQkJdSB8fCAoeSA/ICJoaWRkZW4iIGluIHkgJiYgKGcgPSB5LmhpZGRlbikgOiB5ID0gWS5hY2Nlc3MoZSwgImZ4c2hvdyIsIHtkaXNwbGF5OiBsfSksIG8gJiYgKHkuaGlkZGVuID0gIWcpLCBnICYmIGxlKFtlXSwgITApLCBwLmRvbmUoZnVuY3Rpb24oKSB7Zm9yKHIgaW4gZyB8fCBsZShbZV0pLCBZLnJlbW92ZShlLCAiZnhzaG93IiksIGQpIFMuc3R5bGUoZSwgciwgZFtyXSk7fSkpLCB1ID0gY3QoZyA/IHlbcl0gOiAwLCByLCBwKSwgciBpbg0KCQkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeSB8fA0KCQkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHlbcl0gPSB1LnN0YXJ0LCBnICYmDQoJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh1LmVuZCA9DQoJCQkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LnN0YXJ0LCB1LnN0YXJ0ID0NCgkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDApKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX1dLCBwcmVmaWx0ZXI6IGZ1bmN0aW9uKGUsIHQpIHt0ID8gZnQucHJlZmlsdGVycy51bnNoaWZ0KGUpIDogZnQucHJlZmlsdGVycy5wdXNoKGUpO30NCgkJfSksIFMuc3BlZWQgPSBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQl2YXIgciA9IGUgJiYgIm9iamVjdCIgPT0gdHlwZW9mIGUgPyBTLmV4dGVuZCh7fSwgZSkgOiB7Y29tcGxldGU6IG4gfHwgIW4gJiYgdCB8fCBtKGUpICYmIGUsIGR1cmF0aW9uOiBlLCBlYXNpbmc6IG4gJiYgdCB8fCB0ICYmICFtKHQpICYmIHR9Ow0KCQkJcmV0dXJuIFMuZngub2ZmID8gci5kdXJhdGlvbiA9IDAgOiAibnVtYmVyIiAhPSB0eXBlb2Ygci5kdXJhdGlvbiAmJiAoci5kdXJhdGlvbiBpbiBTLmZ4LnNwZWVkcyA/IHIuZHVyYXRpb24gPSBTLmZ4LnNwZWVkc1tyLmR1cmF0aW9uXSA6IHIuZHVyYXRpb24gPSBTLmZ4LnNwZWVkcy5fZGVmYXVsdCksIG51bGwgIT0gci5xdWV1ZSAmJiAhMCAhPT0gci5xdWV1ZSB8fCAoci5xdWV1ZSA9ICJmeCIpLCByLm9sZCA9IHIuY29tcGxldGUsIHIuY29tcGxldGUgPQ0KCQkJCWZ1bmN0aW9uKCkge20oci5vbGQpICYmIHIub2xkLmNhbGwodGhpcyksIHIucXVldWUgJiYgUy5kZXF1ZXVlKHRoaXMsIHIucXVldWUpO30sIHI7DQoJCX0sIFMuZm4uZXh0ZW5kKHsNCgkJCWZhZGVUbzogZnVuY3Rpb24oZSwgdCwgbiwgcikge3JldHVybiB0aGlzLmZpbHRlcihhZSkuY3NzKCJvcGFjaXR5IiwgMCkuc2hvdygpLmVuZCgpLmFuaW1hdGUoe29wYWNpdHk6IHR9LCBlLCBuLCByKTt9LA0KCQkJYW5pbWF0ZTogZnVuY3Rpb24odCwgZSwgbiwgcikgew0KCQkJCXZhciBpID0gUy5pc0VtcHR5T2JqZWN0KHQpLCBvID0gUy5zcGVlZChlLCBuLCByKSwgYSA9IGZ1bmN0aW9uKCkgew0KCQkJCQl2YXIgZSA9IGZ0KHRoaXMsIFMuZXh0ZW5kKHt9LCB0KSwgbyk7DQoJCQkJCShpIHx8IFkuZ2V0KHRoaXMsICJmaW5pc2giKSkgJiYgZS5zdG9wKCEwKTsNCgkJCQl9Ow0KCQkJCXJldHVybiBhLmZpbmlzaCA9IGEsIGkgfHwgITEgPT09IG8ucXVldWUgPyB0aGlzLmVhY2goYSkgOiB0aGlzLnF1ZXVlKG8ucXVldWUsIGEpOw0KCQkJfSwNCgkJCXN0b3A6IGZ1bmN0aW9uKGksIGUsIG8pIHsNCgkJCQl2YXIgYSA9IGZ1bmN0aW9uKGUpIHsNCgkJCQkJdmFyIHQgPSBlLnN0b3A7DQoJCQkJCWRlbGV0ZSBlLnN0b3AsIHQobyk7DQoJCQkJfTsNCgkJCQlyZXR1cm4gInN0cmluZyIgIT0gdHlwZW9mIGkgJiYgKG8gPSBlLCBlID0gaSwgaSA9IHZvaWQgMCksIGUgJiYgdGhpcy5xdWV1ZShpIHx8ICJmeCIsIFtdKSwgdGhpcy5lYWNoKGZ1bmN0aW9uKCkgew0KCQkJCQl2YXIgZSA9ICEwLA0KCQkJCQkgICAgdCA9IG51bGwgIT0gaSAmJiBpICsgInF1ZXVlSG9va3MiLA0KCQkJCQkgICAgbiA9IFMudGltZXJzLA0KCQkJCQkgICAgciA9IFkuZ2V0KHRoaXMpOw0KCQkJCQlpZih0KSByW3RdICYmIHJbdF0uc3RvcCAmJiBhKHJbdF0pOyBlbHNlIGZvcih0IGluIHIpIHJbdF0gJiYgclt0XS5zdG9wICYmIGF0LnRlc3QodCkgJiYgYShyW3RdKTsNCgkJCQkJZm9yKHQgPSBuLmxlbmd0aDsgdC0tOykgblt0XS5lbGVtICE9PSB0aGlzIHx8IG51bGwgIT0gaSAmJiBuW3RdLnF1ZXVlICE9PSBpIHx8IChuW3RdLmFuaW0uc3RvcChvKSwgZSA9ICExLCBuLnNwbGljZSh0LCAxKSk7DQoJCQkJCSFlICYmIG8gfHwgUy5kZXF1ZXVlKHRoaXMsIGkpOw0KCQkJCX0pOw0KCQkJfSwNCgkJCWZpbmlzaDogZnVuY3Rpb24oYSkgew0KCQkJCXJldHVybiAhMSAhPT0gYSAmJiAoYSA9IGEgfHwgImZ4IiksIHRoaXMuZWFjaChmdW5jdGlvbigpIHsNCgkJCQkJdmFyIGUsIHQgPSBZLmdldCh0aGlzKSwgbiA9IHRbYSArICJxdWV1ZSJdLCByID0gdFthICsgInF1ZXVlSG9va3MiXSwgaSA9IFMudGltZXJzLCBvID0gbiA/IG4ubGVuZ3RoIDogMDsNCgkJCQkJZm9yKHQuZmluaXNoID0gITAsIFMucXVldWUodGhpcywgYSwgW10pLCByICYmIHIuc3RvcCAmJiByLnN0b3AuY2FsbCh0aGlzLCAhMCksIGUgPSBpLmxlbmd0aDsgZS0tOykgaVtlXS5lbGVtID09PSB0aGlzICYmIGlbZV0ucXVldWUgPT09IGEgJiYgKGlbZV0uYW5pbS5zdG9wKCEwKSwgaS5zcGxpY2UoZSwgMSkpOw0KCQkJCQlmb3IoZSA9IDA7IGUgPCBvOyBlKyspIG5bZV0gJiYgbltlXS5maW5pc2ggJiYgbltlXS5maW5pc2guY2FsbCh0aGlzKTsNCgkJCQkJZGVsZXRlIHQuZmluaXNoOw0KCQkJCX0pOw0KCQkJfQ0KCQl9KSwgUy5lYWNoKFsidG9nZ2xlIiwgInNob3ciLCAiaGlkZSJdLCBmdW5jdGlvbihlLCByKSB7DQoJCQl2YXIgaSA9IFMuZm5bcl07DQoJCQlTLmZuW3JdID0gZnVuY3Rpb24oZSwgdCwgbikge3JldHVybiBudWxsID09IGUgfHwgImJvb2xlYW4iID09IHR5cGVvZiBlID8gaS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIDogdGhpcy5hbmltYXRlKGx0KHIsICEwKSwgZSwgdCwgbik7fTsNCgkJfSksIFMuZWFjaCh7DQoJCQlzbGlkZURvd246IGx0KCJzaG93IiksDQoJCQlzbGlkZVVwOiBsdCgiaGlkZSIpLA0KCQkJc2xpZGVUb2dnbGU6IGx0KCJ0b2dnbGUiKSwNCgkJCWZhZGVJbjoge29wYWNpdHk6ICJzaG93In0sDQoJCQlmYWRlT3V0OiB7b3BhY2l0eTogImhpZGUifSwNCgkJCWZhZGVUb2dnbGU6IHtvcGFjaXR5OiAidG9nZ2xlIn0NCgkJfSwgZnVuY3Rpb24oZSwgcikge1MuZm5bZV0gPSBmdW5jdGlvbihlLCB0LCBuKSB7cmV0dXJuIHRoaXMuYW5pbWF0ZShyLCBlLCB0LCBuKTt9O30pLCBTLnRpbWVycyA9IFtdLCBTLmZ4LnRpY2sgPSBmdW5jdGlvbigpIHsNCgkJCXZhciBlLCB0ID0gMCwgbiA9IFMudGltZXJzOw0KCQkJZm9yKHR0ID0gRGF0ZS5ub3coKTsgdCA8IG4ubGVuZ3RoOyB0KyspIChlID0gblt0XSkoKSB8fCBuW3RdICE9PSBlIHx8IG4uc3BsaWNlKHQtLSwgMSk7DQoJCQluLmxlbmd0aCB8fCBTLmZ4LnN0b3AoKSwgdHQgPSB2b2lkIDA7DQoJCX0sIFMuZngudGltZXIgPSBmdW5jdGlvbihlKSB7Uy50aW1lcnMucHVzaChlKSwgUy5meC5zdGFydCgpO30sIFMuZnguaW50ZXJ2YWwgPSAxMywgUy5meC5zdGFydCA9IGZ1bmN0aW9uKCkge250IHx8IChudCA9ICEwLCBzdCgpKTt9LCBTLmZ4LnN0b3AgPSBmdW5jdGlvbigpIHtudCA9IG51bGw7fSwgUy5meC5zcGVlZHMgPSB7DQoJCQlzbG93OiA2MDAsDQoJCQlmYXN0OiAyMDAsDQoJCQlfZGVmYXVsdDogNDAwDQoJCX0sIFMuZm4uZGVsYXkgPSBmdW5jdGlvbihyLCBlKSB7DQoJCQlyZXR1cm4gciA9IFMuZnggJiYgUy5meC5zcGVlZHNbcl0gfHwgciwgZSA9IGUgfHwgImZ4IiwgdGhpcy5xdWV1ZShlLCBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4gPSBDLnNldFRpbWVvdXQoZSwgcik7DQoJCQkJdC5zdG9wID0gZnVuY3Rpb24oKSB7Qy5jbGVhclRpbWVvdXQobik7fTsNCgkJCX0pOw0KCQl9LCBydCA9IEUuY3JlYXRlRWxlbWVudCgiaW5wdXQiKSwgaXQgPSBFLmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpDQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kQ2hpbGQoRS5jcmVhdGVFbGVtZW50KCJvcHRpb24iKSksIHJ0LnR5cGUgPSAiY2hlY2tib3giLCB2LmNoZWNrT24gPSAiIiAhPT0gcnQudmFsdWUsIHYub3B0U2VsZWN0ZWQgPSBpdC5zZWxlY3RlZCwgKHJ0ID0gRS5jcmVhdGVFbGVtZW50KCJpbnB1dCIpKS52YWx1ZSA9ICJ0IiwgcnQudHlwZSA9ICJyYWRpbyIsIHYucmFkaW9WYWx1ZSA9ICJ0IiA9PT0gcnQudmFsdWU7DQoJCXZhciBwdCwgZHQgPSBTLmV4cHIuYXR0ckhhbmRsZTsNCgkJUy5mbi5leHRlbmQoew0KCQkJYXR0cjogZnVuY3Rpb24oZSwgdCkge3JldHVybiBCKHRoaXMsIFMuYXR0ciwgZSwgdCwgMSA8IGFyZ3VtZW50cy5sZW5ndGgpO30sDQoJCQlyZW1vdmVBdHRyOiBmdW5jdGlvbihlKSB7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtTLnJlbW92ZUF0dHIodGhpcywgZSk7fSk7fQ0KCQl9KSwgUy5leHRlbmQoew0KCQkJYXR0cjogZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCXZhciByLCBpLCBvID0gZS5ub2RlVHlwZTsNCgkJCQlpZigzICE9PSBvICYmIDggIT09IG8gJiYgMiAhPT0gbykgcmV0dXJuICJ1bmRlZmluZWQiID09IHR5cGVvZiBlLmdldEF0dHJpYnV0ZSA/DQoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTLnByb3AoZSwgdCwgbikgOg0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKDEgPT09IG8gJiYgUy5pc1hNTERvYyhlKSB8fCAoaSA9IFMuYXR0ckhvb2tzW3QudG9Mb3dlckNhc2UoKV0gfHwgKFMuZXhwci5tYXRjaC5ib29sLnRlc3QodCkgPyBwdCA6IHZvaWQgMCkpLCB2b2lkIDAgIT09IG4gPw0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsID09PSBuID8gdm9pZCBTLnJlbW92ZUF0dHIoZSwgdCkgOiBpICYmICJzZXQiIGluIGkgJiYgdm9pZCAwICE9PSAociA9IGkuc2V0KGUsIG4sIHQpKSA/IHIgOiAoZS5zZXRBdHRyaWJ1dGUodCwgbiArICIiKSwgbikgOg0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpICYmICJnZXQiIGluIGkgJiYgbnVsbCAhPT0gKHIgPSBpLmdldChlLCB0KSkgPyByIDogbnVsbCA9PSAociA9IFMuZmluZC5hdHRyKGUsIHQpKSA/IHZvaWQgMCA6IHIpOw0KCQkJfSwgYXR0ckhvb2tzOiB7DQoJCQkJdHlwZTogew0KCQkJCQlzZXQ6IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJCWlmKCF2LnJhZGlvVmFsdWUgJiYgInJhZGlvIiA9PT0gdCAmJiBBKGUsICJpbnB1dCIpKSB7DQoJCQkJCQkJdmFyIG4gPSBlLnZhbHVlOw0KCQkJCQkJCXJldHVybiBlLnNldEF0dHJpYnV0ZSgidHlwZSIsIHQpLCBuICYmIChlLnZhbHVlID0gbiksIHQ7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9DQoJCQl9LCByZW1vdmVBdHRyOiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4sIHIgPSAwLCBpID0gdCAmJiB0Lm1hdGNoKFApOw0KCQkJCWlmKGkgJiYgMSA9PT0gZS5ub2RlVHlwZSkgd2hpbGUobiA9IGlbcisrXSkgZS5yZW1vdmVBdHRyaWJ1dGUobik7DQoJCQl9DQoJCX0pLCBwdCA9IHtzZXQ6IGZ1bmN0aW9uKGUsIHQsIG4pIHtyZXR1cm4gITEgPT09IHQgPyBTLnJlbW92ZUF0dHIoZSwgbikgOiBlLnNldEF0dHJpYnV0ZShuLCBuKSwgbjt9fSwgUy5lYWNoKFMuZXhwci5tYXRjaC5ib29sLnNvdXJjZS5tYXRjaCgvXHcrL2cpLCBmdW5jdGlvbihlLCB0KSB7DQoJCQl2YXIgYSA9IGR0W3RdIHx8IFMuZmluZC5hdHRyOw0KCQkJZHRbdF0gPSBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJdmFyIHIsIGksIG8gPSB0LnRvTG93ZXJDYXNlKCk7DQoJCQkJcmV0dXJuIG4gfHwgKGkgPSBkdFtvXSwgZHRbb10gPSByLCByID0gbnVsbCAhPSBhKGUsIHQsIG4pID8gbyA6IG51bGwsIGR0W29dID0gaSksIHI7DQoJCQl9Ow0KCQl9KTsNCgkJdmFyIGh0ID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uKSQvaSwgZ3QgPSAvXig/OmF8YXJlYSkkL2k7DQoNCgkJZnVuY3Rpb24geXQoZSkge3JldHVybiAoZS5tYXRjaChQKSB8fCBbXSkuam9pbigiICIpO30NCg0KCQlmdW5jdGlvbiB2dChlKSB7cmV0dXJuIGUuZ2V0QXR0cmlidXRlICYmIGUuZ2V0QXR0cmlidXRlKCJjbGFzcyIpIHx8ICIiO30NCg0KCQlmdW5jdGlvbiBtdChlKSB7cmV0dXJuIEFycmF5LmlzQXJyYXkoZSkgPyBlIDogInN0cmluZyIgPT0gdHlwZW9mIGUgJiYgZS5tYXRjaChQKSB8fCBbXTt9DQoNCgkJUy5mbi5leHRlbmQoew0KCQkJcHJvcDogZnVuY3Rpb24oZSwgdCkge3JldHVybiBCKHRoaXMsIFMucHJvcCwgZSwgdCwgMSA8IGFyZ3VtZW50cy5sZW5ndGgpO30sDQoJCQlyZW1vdmVQcm9wOiBmdW5jdGlvbihlKSB7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtkZWxldGUgdGhpc1tTLnByb3BGaXhbZV0gfHwgZV07fSk7fQ0KCQl9KSwgUy5leHRlbmQoew0KCQkJcHJvcDogZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCXZhciByLCBpLCBvID0gZS5ub2RlVHlwZTsNCgkJCQlpZigzICE9PSBvICYmIDggIT09IG8gJiYgMiAhPT0gbykgcmV0dXJuIDEgPT09IG8gJiYgUy5pc1hNTERvYyhlKSB8fCAodCA9IFMucHJvcEZpeFt0XSB8fCB0LCBpID0gUy5wcm9wSG9va3NbdF0pLCB2b2lkIDAgIT09IG4gPyBpICYmICJzZXQiIGluIGkgJiYgdm9pZCAwICE9PSAociA9IGkuc2V0KGUsIG4sIHQpKSA/IHIgOiBlW3RdID0gbiA6IGkgJiYgImdldCIgaW4gaSAmJiBudWxsICE9PSAociA9IGkuZ2V0KGUsIHQpKSA/IHIgOiBlW3RdOw0KCQkJfSwgcHJvcEhvb2tzOiB7DQoJCQkJdGFiSW5kZXg6IHsNCgkJCQkJZ2V0OiBmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgdCA9IFMuZmluZC5hdHRyKGUsICJ0YWJpbmRleCIpOw0KCQkJCQkJcmV0dXJuIHQgPyBwYXJzZUludCh0LCAxMCkgOiBodC50ZXN0KGUubm9kZU5hbWUpIHx8IGd0LnRlc3QoZS5ub2RlTmFtZSkgJiYgZS5ocmVmID8gMCA6IC0xOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfSwgcHJvcEZpeDogeyJmb3IiOiAiaHRtbEZvciIsICJjbGFzcyI6ICJjbGFzc05hbWUifQ0KCQl9KSwgdi5vcHRTZWxlY3RlZCB8fCAoUy5wcm9wSG9va3Muc2VsZWN0ZWQgPSB7DQoJCQlnZXQ6IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCA9IGUucGFyZW50Tm9kZTsNCgkJCQlyZXR1cm4gdCAmJiB0LnBhcmVudE5vZGUgJiYgdC5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXgsIG51bGw7DQoJCQl9LCBzZXQ6IGZ1bmN0aW9uKGUpIHsNCgkJCQl2YXIgdCA9IGUucGFyZW50Tm9kZTsNCgkJCQl0ICYmICh0LnNlbGVjdGVkSW5kZXgsIHQucGFyZW50Tm9kZSAmJiB0LnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleCk7DQoJCQl9DQoJCX0pLCBTLmVhY2goWyJ0YWJJbmRleCIsDQoJCSAgICAgICAgICAgICJyZWFkT25seSIsDQoJCSAgICAgICAgICAgICJtYXhMZW5ndGgiLA0KCQkgICAgICAgICAgICAiY2VsbFNwYWNpbmciLA0KCQkgICAgICAgICAgICAiY2VsbFBhZGRpbmciLA0KCQkgICAgICAgICAgICAicm93U3BhbiIsDQoJCSAgICAgICAgICAgICJjb2xTcGFuIiwNCgkJICAgICAgICAgICAgInVzZU1hcCIsDQoJCSAgICAgICAgICAgICJmcmFtZUJvcmRlciIsDQoJCSAgICAgICAgICAgICJjb250ZW50RWRpdGFibGUiXSwgZnVuY3Rpb24oKSB7Uy5wcm9wRml4W3RoaXMudG9Mb3dlckNhc2UoKV0gPSB0aGlzO30pLCBTLmZuLmV4dGVuZCh7DQoJCQlhZGRDbGFzczogZnVuY3Rpb24odCkgew0KCQkJCXZhciBlLCBuLCByLCBpLCBvLCBhOw0KCQkJCXJldHVybiBtKHQpID8gdGhpcy5lYWNoKGZ1bmN0aW9uKGUpIHsNCgkJCQkJUyh0aGlzKQ0KCQkJCQkJLmFkZENsYXNzKHQuY2FsbCh0aGlzLCBlLCB2dCh0aGlzKSkpOw0KCQkJCX0pIDogKGUgPSBtdCh0KSkubGVuZ3RoID8gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgew0KCQkJCQlpZihyID0gdnQodGhpcyksIG4gPSAxID09PSB0aGlzLm5vZGVUeXBlICYmICIgIiArIHl0KHIpICsgIiAiKSB7DQoJCQkJCQlmb3IobyA9IDA7IG8gPCBlLmxlbmd0aDsgbysrKSBpID0gZVtvXSwgbi5pbmRleE9mKCIgIiArIGkgKyAiICIpIDwgMCAmJiAobiArPSBpICsgIiAiKTsNCgkJCQkJCWEgPSB5dChuKSwgciAhPT0gYSAmJiB0aGlzLnNldEF0dHJpYnV0ZSgiY2xhc3MiLCBhKTsNCgkJCQkJfQ0KCQkJCX0pIDogdGhpczsNCgkJCX0sIHJlbW92ZUNsYXNzOiBmdW5jdGlvbih0KSB7DQoJCQkJdmFyIGUsIG4sIHIsIGksIG8sIGE7DQoJCQkJcmV0dXJuIG0odCkgPyB0aGlzLmVhY2goZnVuY3Rpb24oZSkgew0KCQkJCQlTKHRoaXMpDQoJCQkJCQkucmVtb3ZlQ2xhc3ModC5jYWxsKHRoaXMsIGUsIHZ0KHRoaXMpKSk7DQoJCQkJfSkgOiBhcmd1bWVudHMubGVuZ3RoID8gKGUgPSBtdCh0KSkubGVuZ3RoID8gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgew0KCQkJCQlpZihyID0gdnQodGhpcyksIG4gPSAxID09PSB0aGlzLm5vZGVUeXBlICYmICIgIiArIHl0KHIpICsgIiAiKSB7DQoJCQkJCQlmb3IobyA9IDA7IG8gPCBlLmxlbmd0aDsgbysrKSB7DQoJCQkJCQkJaSA9IGVbb107DQoJCQkJCQkJd2hpbGUoLTEgPCBuLmluZGV4T2YoIiAiICsgaSArICIgIikpIG4gPSBuLnJlcGxhY2UoIiAiICsgaSArICIgIiwgIiAiKTsNCgkJCQkJCX0NCgkJCQkJCWEgPSB5dChuKSwgciAhPT0gYSAmJiB0aGlzLnNldEF0dHJpYnV0ZSgiY2xhc3MiLCBhKTsNCgkJCQkJfQ0KCQkJCX0pIDogdGhpcyA6IHRoaXMuYXR0cigiY2xhc3MiLCAiIik7DQoJCQl9LCB0b2dnbGVDbGFzczogZnVuY3Rpb24odCwgbikgew0KCQkJCXZhciBlLCByLCBpLCBvLCBhID0gdHlwZW9mIHQsIHMgPSAic3RyaW5nIiA9PT0gYSB8fCBBcnJheS5pc0FycmF5KHQpOw0KCQkJCXJldHVybiBtKHQpID8NCgkJCQkgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKGUpIHsNCgkJCQkJICAgICAgIFModGhpcykNCgkJCQkJCSAgICAgICAudG9nZ2xlQ2xhc3ModC5jYWxsKHRoaXMsIGUsIHZ0KHRoaXMpLCBuKSwgbik7DQoJCQkJICAgICAgIH0pIDoNCgkJCQkgICAgICAgImJvb2xlYW4iID09IHR5cGVvZiBuICYmIHMgPw0KCQkJCSAgICAgICBuID8gdGhpcy5hZGRDbGFzcyh0KSA6IHRoaXMucmVtb3ZlQ2xhc3ModCkgOg0KCQkJCSAgICAgICAoZSA9IG10KHQpLCB0aGlzLmVhY2goZnVuY3Rpb24oKSB7DQoJCQkJCSAgICAgICBpZihzKSBmb3IobyA9IFModGhpcyksIGkgPSAwOyBpIDwgZS5sZW5ndGg7IGkrKykgciA9IGVbaV0sIG8uaGFzQ2xhc3MocikgPyBvLnJlbW92ZUNsYXNzKHIpIDogby5hZGRDbGFzcyhyKTsgZWxzZSB2b2lkIDAgIT09DQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ICYmDQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYm9vbGVhbiIgIT09DQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhIHx8DQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKHIgPSB2dCh0aGlzKSkgJiYgWS5zZXQodGhpcywgIl9fY2xhc3NOYW1lX18iLCByKSwgdGhpcy5zZXRBdHRyaWJ1dGUgJiYgdGhpcy5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgciB8fCAhMSA9PT0gdCA/ICIiIDogWS5nZXQodGhpcywgIl9fY2xhc3NOYW1lX18iKSB8fCAiIikpOw0KCQkJCSAgICAgICB9KSk7DQoJCQl9LCBoYXNDbGFzczogZnVuY3Rpb24oZSkgew0KCQkJCXZhciB0LCBuLCByID0gMDsNCgkJCQl0ID0gIiAiICsgZSArICIgIjsNCgkJCQl3aGlsZShuID0gdGhpc1tyKytdKSBpZigxID09PSBuLm5vZGVUeXBlICYmIC0xIDwgKCIgIiArIHl0KHZ0KG4pKSArICIgIikuaW5kZXhPZih0KSkgcmV0dXJuICEwOw0KCQkJCXJldHVybiAhMTsNCgkJCX0NCgkJfSk7DQoJCXZhciB4dCA9IC9cci9nOw0KCQlTLmZuLmV4dGVuZCh7DQoJCQl2YWw6IGZ1bmN0aW9uKG4pIHsNCgkJCQl2YXIgciwgZSwgaSwgdCA9IHRoaXNbMF07DQoJCQkJcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoaSA9IG0obiksIHRoaXMuZWFjaChmdW5jdGlvbihlKSB7DQoJCQkJCXZhciB0Ow0KCQkJCQkxID09PSB0aGlzLm5vZGVUeXBlICYmIChudWxsID09ICh0ID0gaSA/IG4uY2FsbCh0aGlzLCBlLCBTKHRoaXMpDQoJCQkJCQkudmFsKCkpIDogbikgPyB0ID0gIiIgOiAibnVtYmVyIiA9PSB0eXBlb2YgdCA/IHQgKz0gIiIgOiBBcnJheS5pc0FycmF5KHQpICYmICh0ID0gUy5tYXAodCwgZnVuY3Rpb24oZSkge3JldHVybiBudWxsID09IGUgPyAiIiA6IGUgKyAiIjt9KSksIChyID0gUy52YWxIb29rc1t0aGlzLnR5cGVdIHx8IFMudmFsSG9va3NbdGhpcy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXSkgJiYNCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNldCIgaW4NCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciAmJg0KCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkIDAgIT09DQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIuc2V0KHRoaXMsIHQsICJ2YWx1ZSIpIHx8DQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLnZhbHVlID0gdCkpOw0KCQkJCX0pKSA6IHQgPyAociA9IFMudmFsSG9va3NbdC50eXBlXSB8fCBTLnZhbEhvb2tzW3Qubm9kZU5hbWUudG9Mb3dlckNhc2UoKV0pICYmICJnZXQiIGluIHIgJiYgdm9pZCAwICE9PSAoZSA9IHIuZ2V0KHQsICJ2YWx1ZSIpKSA/IGUgOiAic3RyaW5nIiA9PSB0eXBlb2YgKGUgPSB0LnZhbHVlKSA/IGUucmVwbGFjZSh4dCwgIiIpIDogbnVsbCA9PSBlID8gIiIgOiBlIDogdm9pZCAwOw0KCQkJfQ0KCQl9KSwgUy5leHRlbmQoew0KCQkJdmFsSG9va3M6IHsNCgkJCQlvcHRpb246IHsNCgkJCQkJZ2V0OiBmdW5jdGlvbihlKSB7DQoJCQkJCQl2YXIgdCA9IFMuZmluZC5hdHRyKGUsICJ2YWx1ZSIpOw0KCQkJCQkJcmV0dXJuIG51bGwgIT0gdCA/IHQgOiB5dChTLnRleHQoZSkpOw0KCQkJCQl9DQoJCQkJfSwgc2VsZWN0OiB7DQoJCQkJCWdldDogZnVuY3Rpb24oZSkgew0KCQkJCQkJdmFyIHQsIG4sIHIsIGkgPSBlLm9wdGlvbnMsIG8gPSBlLnNlbGVjdGVkSW5kZXgsIGEgPSAic2VsZWN0LW9uZSIgPT09IGUudHlwZSwgcyA9IGEgPyBudWxsIDogW10sIHUgPSBhID8gbyArIDEgOiBpLmxlbmd0aDsNCgkJCQkJCWZvcihyID0gbyA8IDAgPyB1IDogYSA/IG8gOiAwOyByIDwgdTsgcisrKSB7DQoJCQkJCQkJaWYoKChuID0gaVtyXSkuc2VsZWN0ZWQgfHwgciA9PT0gbykgJiYgIW4uZGlzYWJsZWQgJiYgKCFuLnBhcmVudE5vZGUuZGlzYWJsZWQgfHwgIUEobi5wYXJlbnROb2RlLCAib3B0Z3JvdXAiKSkpIHsNCgkJCQkJCQkJaWYodCA9IFMobikNCgkJCQkJCQkJCS52YWwoKSwgYSkgew0KCQkJCQkJCQkJcmV0dXJuIHQ7DQoJCQkJCQkJCX0NCgkJCQkJCQkJcy5wdXNoKHQpOw0KCQkJCQkJCX0NCgkJCQkJCX0NCgkJCQkJCXJldHVybiBzOw0KCQkJCQl9LCBzZXQ6IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJCXZhciBuLCByLCBpID0gZS5vcHRpb25zLCBvID0gUy5tYWtlQXJyYXkodCksIGEgPSBpLmxlbmd0aDsNCgkJCQkJCXdoaWxlKGEtLSkgKChyID0gaVthXSkuc2VsZWN0ZWQgPSAtMSA8IFMuaW5BcnJheShTLnZhbEhvb2tzLm9wdGlvbi5nZXQociksIG8pKSAmJiAobiA9ICEwKTsNCgkJCQkJCXJldHVybiBuIHx8IChlLnNlbGVjdGVkSW5kZXggPSAtMSksIG87DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCX0pLCBTLmVhY2goWyJyYWRpbyIsICJjaGVja2JveCJdLCBmdW5jdGlvbigpIHsNCgkJCVMudmFsSG9va3NbdGhpc10gPSB7DQoJCQkJc2V0OiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJCWlmKEFycmF5LmlzQXJyYXkodCkpIHsNCgkJCQkJCXJldHVybiBlLmNoZWNrZWQgPSAtMSA8IFMuaW5BcnJheShTKGUpDQoJCQkJCQkJLnZhbCgpLCB0KTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0sIHYuY2hlY2tPbiB8fCAoUy52YWxIb29rc1t0aGlzXS5nZXQgPSBmdW5jdGlvbihlKSB7cmV0dXJuIG51bGwgPT09IGUuZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpID8gIm9uIiA6IGUudmFsdWU7fSk7DQoJCX0pLCB2LmZvY3VzaW4gPSAib25mb2N1c2luIiBpbiBDOw0KCQl2YXIgYnQgPSAvXig/OmZvY3VzaW5mb2N1c3xmb2N1c291dGJsdXIpJC8sIHd0ID0gZnVuY3Rpb24oZSkge2Uuc3RvcFByb3BhZ2F0aW9uKCk7fTsNCgkJUy5leHRlbmQoUy5ldmVudCwgew0KCQkJdHJpZ2dlcjogZnVuY3Rpb24oZSwgdCwgbiwgcikgew0KCQkJCXZhciBpLCBvLCBhLCBzLCB1LCBsLCBjLCBmLCBwID0gW24gfHwgRV0sIGQgPSB5LmNhbGwoZSwgInR5cGUiKSA/IGUudHlwZSA6IGUsIGggPSB5LmNhbGwoZSwgIm5hbWVzcGFjZSIpID8gZS5uYW1lc3BhY2Uuc3BsaXQoIi4iKSA6IFtdOw0KCQkJCWlmKG8gPSBmID0gYSA9IG4gPSBuIHx8IEUsIDMgIT09DQoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5ub2RlVHlwZSAmJg0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgIDggIT09DQoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5ub2RlVHlwZSAmJg0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICFidC50ZXN0KGQgKyBTLmV2ZW50LnRyaWdnZXJlZCkgJiYNCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAoLTEgPCBkLmluZGV4T2YoIi4iKSAmJiAoZCA9IChoID0gZC5zcGxpdCgiLiIpKS5zaGlmdCgpLCBoLnNvcnQoKSksIHUgPSBkLmluZGV4T2YoIjoiKSA8IDAgJiYgIm9uIiArIGQsIChlID0gZVtTLmV4cGFuZG9dID8gZSA6IG5ldyBTLkV2ZW50KGQsICJvYmplY3QiID09IHR5cGVvZiBlICYmIGUpKS5pc1RyaWdnZXIgPSByID8gMiA6IDMsIGUubmFtZXNwYWNlID0gaC5qb2luKCIuIiksIGUucm5hbWVzcGFjZSA9DQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgIGUubmFtZXNwYWNlID8gbmV3IFJlZ0V4cCgiKF58XFwuKSIgKyBoLmpvaW4oIlxcLig/Oi4qXFwufCkiKSArICIoXFwufCQpIikgOiBudWxsLCBlLnJlc3VsdCA9IHZvaWQgMCwgZS50YXJnZXQgfHwgKGUudGFyZ2V0ID0gbiksIHQgPSBudWxsID09IHQgPyBbZV0gOiBTLm1ha2VBcnJheSh0LCBbZV0pLCBjID0gUy5ldmVudC5zcGVjaWFsW2RdIHx8IHt9LCByIHx8ICFjLnRyaWdnZXIgfHwgITEgIT09IGMudHJpZ2dlci5hcHBseShuLCB0KSkpIHsNCgkJCQkJaWYoIXIgJiYgIWMubm9CdWJibGUgJiYgIXgobikpIHsNCgkJCQkJCWZvcihzID0gYy5kZWxlZ2F0ZVR5cGUgfHwgZCwgYnQudGVzdChzICsgZCkgfHwgKG8gPSBvLnBhcmVudE5vZGUpOyBvOyBvID0gby5wYXJlbnROb2RlKSBwLnB1c2gobyksIGEgPSBvOw0KCQkJCQkJYSA9PT0gKG4ub3duZXJEb2N1bWVudCB8fCBFKSAmJiBwLnB1c2goYS5kZWZhdWx0VmlldyB8fCBhLnBhcmVudFdpbmRvdyB8fCBDKTsNCgkJCQkJfQ0KCQkJCQlpID0gMDsNCgkJCQkJd2hpbGUoKG8gPSBwW2krK10pICYmICFlLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkpIGYgPSBvLCBlLnR5cGUgPSAxIDwgaSA/IHMgOiBjLmJpbmRUeXBlIHx8IGQsIChsID0gKFkuZ2V0KG8sICJldmVudHMiKSB8fCBPYmplY3QuY3JlYXRlKG51bGwpKVtlLnR5cGVdICYmIFkuZ2V0KG8sICJoYW5kbGUiKSkgJiYgbC5hcHBseShvLCB0KSwgKGwgPSB1ICYmIG9bdV0pICYmDQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwuYXBwbHkgJiYNCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVihvKSAmJg0KCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZS5yZXN1bHQgPSBsLmFwcGx5KG8sIHQpLCAhMSA9PT0gZS5yZXN1bHQgJiYgZS5wcmV2ZW50RGVmYXVsdCgpKTsNCgkJCQkJcmV0dXJuIGUudHlwZSA9IGQsIHIgfHwNCgkJCQkJICAgICAgICAgICAgICAgICAgIGUuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwNCgkJCQkJICAgICAgICAgICAgICAgICAgIGMuX2RlZmF1bHQgJiYNCgkJCQkJICAgICAgICAgICAgICAgICAgICExICE9PQ0KCQkJCQkgICAgICAgICAgICAgICAgICAgYy5fZGVmYXVsdC5hcHBseShwLnBvcCgpLCB0KSB8fA0KCQkJCQkgICAgICAgICAgICAgICAgICAgIVYobikgfHwNCgkJCQkJICAgICAgICAgICAgICAgICAgIHUgJiYNCgkJCQkJICAgICAgICAgICAgICAgICAgIG0obltkXSkgJiYNCgkJCQkJICAgICAgICAgICAgICAgICAgICF4KG4pICYmDQoJCQkJCSAgICAgICAgICAgICAgICAgICAoKGEgPSBuW3VdKSAmJiAoblt1XSA9IG51bGwpLCBTLmV2ZW50LnRyaWdnZXJlZCA9IGQsIGUuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSAmJiBmLmFkZEV2ZW50TGlzdGVuZXIoZCwgd3QpLCBuW2RdKCksIGUuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSAmJiBmLnJlbW92ZUV2ZW50TGlzdGVuZXIoZCwgd3QpLCBTLmV2ZW50LnRyaWdnZXJlZCA9IHZvaWQgMCwgYSAmJiAoblt1XSA9IGEpKSwgZS5yZXN1bHQ7DQoJCQkJfQ0KCQkJfSwgc2ltdWxhdGU6IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCQl2YXIgciA9IFMuZXh0ZW5kKG5ldyBTLkV2ZW50LCBuLCB7dHlwZTogZSwgaXNTaW11bGF0ZWQ6ICEwfSk7DQoJCQkJUy5ldmVudC50cmlnZ2VyKHIsIG51bGwsIHQpOw0KCQkJfQ0KCQl9KSwgUy5mbi5leHRlbmQoew0KCQkJdHJpZ2dlcjogZnVuY3Rpb24oZSwgdCkge3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7Uy5ldmVudC50cmlnZ2VyKGUsIHQsIHRoaXMpO30pO30sIHRyaWdnZXJIYW5kbGVyOiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4gPSB0aGlzWzBdOw0KCQkJCWlmKG4pIHJldHVybiBTLmV2ZW50LnRyaWdnZXIoZSwgdCwgbiwgITApOw0KCQkJfQ0KCQl9KSwgdi5mb2N1c2luIHx8IFMuZWFjaCh7Zm9jdXM6ICJmb2N1c2luIiwgYmx1cjogImZvY3Vzb3V0In0sIGZ1bmN0aW9uKG4sIHIpIHsNCgkJCXZhciBpID0gZnVuY3Rpb24oZSkge1MuZXZlbnQuc2ltdWxhdGUociwgZS50YXJnZXQsIFMuZXZlbnQuZml4KGUpKTt9Ow0KCQkJUy5ldmVudC5zcGVjaWFsW3JdID0gew0KCQkJCXNldHVwOiBmdW5jdGlvbigpIHsNCgkJCQkJdmFyIGUgPSB0aGlzLm93bmVyRG9jdW1lbnQgfHwgdGhpcy5kb2N1bWVudCB8fCB0aGlzLCB0ID0gWS5hY2Nlc3MoZSwgcik7DQoJCQkJCXQgfHwgZS5hZGRFdmVudExpc3RlbmVyKG4sIGksICEwKSwgWS5hY2Nlc3MoZSwgciwgKHQgfHwgMCkgKyAxKTsNCgkJCQl9LCB0ZWFyZG93bjogZnVuY3Rpb24oKSB7DQoJCQkJCXZhciBlID0gdGhpcy5vd25lckRvY3VtZW50IHx8IHRoaXMuZG9jdW1lbnQgfHwgdGhpcywgdCA9IFkuYWNjZXNzKGUsIHIpIC0gMTsNCgkJCQkJdCA/IFkuYWNjZXNzKGUsIHIsIHQpIDogKGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihuLCBpLCAhMCksIFkucmVtb3ZlKGUsIHIpKTsNCgkJCQl9DQoJCQl9Ow0KCQl9KTsNCgkJdmFyIFR0ID0gQy5sb2NhdGlvbiwgQ3QgPSB7Z3VpZDogRGF0ZS5ub3coKX0sIEV0ID0gL1w/LzsNCgkJUy5wYXJzZVhNTCA9IGZ1bmN0aW9uKGUpIHsNCgkJCXZhciB0LCBuOw0KCQkJaWYoIWUgfHwgInN0cmluZyIgIT0gdHlwZW9mIGUpIHJldHVybiBudWxsOw0KCQkJdHJ5IHt0ID0gKG5ldyBDLkRPTVBhcnNlcikucGFyc2VGcm9tU3RyaW5nKGUsICJ0ZXh0L3htbCIpO30gY2F0Y2goZSkge30NCgkJCXJldHVybiBuID0gdCAmJiB0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJwYXJzZXJlcnJvciIpWzBdLCB0ICYmICFuIHx8IFMuZXJyb3IoIkludmFsaWQgWE1MOiAiICsgKG4gPyBTLm1hcChuLmNoaWxkTm9kZXMsIGZ1bmN0aW9uKGUpIHtyZXR1cm4gZS50ZXh0Q29udGVudDt9KS5qb2luKCJcbiIpIDogZSkpLCB0Ow0KCQl9Ow0KCQl2YXIgU3QgPSAvXFtcXSQvLCBrdCA9IC9ccj9cbi9nLCBBdCA9IC9eKD86c3VibWl0fGJ1dHRvbnxpbWFnZXxyZXNldHxmaWxlKSQvaSwgTnQgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxrZXlnZW4pL2k7DQoNCgkJZnVuY3Rpb24ganQobiwgZSwgciwgaSkgew0KCQkJdmFyIHQ7DQoJCQlpZihBcnJheS5pc0FycmF5KGUpKSBTLmVhY2goZSwgZnVuY3Rpb24oZSwgdCkge3IgfHwgU3QudGVzdChuKSA/IGkobiwgdCkgOiBqdChuICsgIlsiICsgKCJvYmplY3QiID09IHR5cGVvZiB0ICYmIG51bGwgIT0gdCA/IGUgOiAiIikgKyAiXSIsIHQsIHIsIGkpO30pOyBlbHNlIGlmKHIgfHwgIm9iamVjdCIgIT09IHcoZSkpIGkobiwgZSk7IGVsc2UgZm9yKHQgaW4gZSkganQobiArICJbIiArIHQgKyAiXSIsIGVbdF0sIHIsIGkpOw0KCQl9DQoNCgkJUy5wYXJhbSA9IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCXZhciBuLCByID0gW10sIGkgPSBmdW5jdGlvbihlLCB0KSB7DQoJCQkJdmFyIG4gPSBtKHQpID8gdCgpIDogdDsNCgkJCQlyW3IubGVuZ3RoXSA9IGVuY29kZVVSSUNvbXBvbmVudChlKSArICI9IiArIGVuY29kZVVSSUNvbXBvbmVudChudWxsID09IG4gPyAiIiA6IG4pOw0KCQkJfTsNCgkJCWlmKG51bGwgPT0gZSkgcmV0dXJuICIiOw0KCQkJaWYoQXJyYXkuaXNBcnJheShlKSB8fCBlLmpxdWVyeSAmJiAhUy5pc1BsYWluT2JqZWN0KGUpKSBTLmVhY2goZSwgZnVuY3Rpb24oKSB7aSh0aGlzLm5hbWUsIHRoaXMudmFsdWUpO30pOyBlbHNlIGZvcihuIGluIGUpIGp0KG4sIGVbbl0sIHQsIGkpOw0KCQkJcmV0dXJuIHIuam9pbigiJiIpOw0KCQl9LCBTLmZuLmV4dGVuZCh7DQoJCQlzZXJpYWxpemU6IGZ1bmN0aW9uKCkge3JldHVybiBTLnBhcmFtKHRoaXMuc2VyaWFsaXplQXJyYXkoKSk7fSwgc2VyaWFsaXplQXJyYXk6IGZ1bmN0aW9uKCkgew0KCQkJCXJldHVybiB0aGlzLm1hcChmdW5jdGlvbigpIHsNCgkJCQkJdmFyIGUgPSBTLnByb3AodGhpcywgImVsZW1lbnRzIik7DQoJCQkJCXJldHVybiBlID8gUy5tYWtlQXJyYXkoZSkgOiB0aGlzOw0KCQkJCX0pLmZpbHRlcihmdW5jdGlvbigpIHsNCgkJCQkJdmFyIGUgPSB0aGlzLnR5cGU7DQoJCQkJCXJldHVybiB0aGlzLm5hbWUgJiYgIVModGhpcykuaXMoIjpkaXNhYmxlZCIpICYmIE50LnRlc3QodGhpcy5ub2RlTmFtZSkgJiYgIUF0LnRlc3QoZSkgJiYgKHRoaXMuY2hlY2tlZCB8fCAhcGUudGVzdChlKSk7DQoJCQkJfSkubWFwKGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJdmFyIG4gPSBTKHRoaXMpLnZhbCgpOw0KCQkJCQlyZXR1cm4gbnVsbCA9PSBuID8gbnVsbCA6IEFycmF5LmlzQXJyYXkobikgPyBTLm1hcChuLCBmdW5jdGlvbihlKSB7cmV0dXJuIHtuYW1lOiB0Lm5hbWUsIHZhbHVlOiBlLnJlcGxhY2Uoa3QsICJcclxuIil9O30pIDoge25hbWU6IHQubmFtZSwgdmFsdWU6IG4ucmVwbGFjZShrdCwgIlxyXG4iKX07DQoJCQkJfSkuZ2V0KCk7DQoJCQl9DQoJCX0pOw0KCQl2YXIgRHQgPSAvJTIwL2csIHF0ID0gLyMuKiQvLCBMdCA9IC8oWz8mXSlfPVteJl0qLywgSHQgPSAvXiguKj8pOlsgXHRdKihbXlxyXG5dKikkL2dtLCBPdCA9IC9eKD86R0VUfEhFQUQpJC8sIFB0ID0gL15cL1wvLywgUnQgPSB7fSwgTXQgPSB7fSwgSXQgPSAiKi8iLmNvbmNhdCgiKiIpLCBXdCA9IEUuY3JlYXRlRWxlbWVudCgiYSIpOw0KDQoJCWZ1bmN0aW9uIEZ0KG8pIHsNCgkJCXJldHVybiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJInN0cmluZyIgIT0gdHlwZW9mIGUgJiYgKHQgPSBlLCBlID0gIioiKTsNCgkJCQl2YXIgbiwgciA9IDAsIGkgPSBlLnRvTG93ZXJDYXNlKCkubWF0Y2goUCkgfHwgW107DQoJCQkJaWYobSh0KSkgd2hpbGUobiA9IGlbcisrXSkgIisiID09PSBuWzBdID8gKG4gPSBuLnNsaWNlKDEpIHx8ICIqIiwgKG9bbl0gPSBvW25dIHx8IFtdKS51bnNoaWZ0KHQpKSA6IChvW25dID0gb1tuXSB8fCBbXSkucHVzaCh0KTsNCgkJCX07DQoJCX0NCg0KCQlmdW5jdGlvbiAkdCh0LCBpLCBvLCBhKSB7DQoJCQl2YXIgcyA9IHt9LCB1ID0gdCA9PT0gTXQ7DQoNCgkJCWZ1bmN0aW9uIGwoZSkgew0KCQkJCXZhciByOw0KCQkJCXJldHVybiBzW2VdID0gITAsIFMuZWFjaCh0W2VdIHx8IFtdLCBmdW5jdGlvbihlLCB0KSB7DQoJCQkJCXZhciBuID0gdChpLCBvLCBhKTsNCgkJCQkJcmV0dXJuICJzdHJpbmciICE9IHR5cGVvZiBuIHx8IHUgfHwgc1tuXSA/IHUgPyAhKHIgPSBuKSA6IHZvaWQgMCA6IChpLmRhdGFUeXBlcy51bnNoaWZ0KG4pLCBsKG4pLCAhMSk7DQoJCQkJfSksIHI7DQoJCQl9DQoNCgkJCXJldHVybiBsKGkuZGF0YVR5cGVzWzBdKSB8fCAhc1siKiJdICYmIGwoIioiKTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIEJ0KGUsIHQpIHsNCgkJCXZhciBuLCByLCBpID0gUy5hamF4U2V0dGluZ3MuZmxhdE9wdGlvbnMgfHwge307DQoJCQlmb3IobiBpbiB0KSB2b2lkIDAgIT09IHRbbl0gJiYgKChpW25dID8gZSA6IHIgfHwgKHIgPSB7fSkpW25dID0gdFtuXSk7DQoJCQlyZXR1cm4gciAmJiBTLmV4dGVuZCghMCwgZSwgciksIGU7DQoJCX0NCg0KCQlXdC5ocmVmID0gVHQuaHJlZiwgUy5leHRlbmQoew0KCQkJYWN0aXZlOiAwLA0KCQkJbGFzdE1vZGlmaWVkOiB7fSwNCgkJCWV0YWc6IHt9LA0KCQkJYWpheFNldHRpbmdzOiB7DQoJCQkJdXJsOiBUdC5ocmVmLA0KCQkJCXR5cGU6ICJHRVQiLA0KCQkJCWlzTG9jYWw6IC9eKD86YWJvdXR8YXBwfGFwcC1zdG9yYWdlfC4rLWV4dGVuc2lvbnxmaWxlfHJlc3x3aWRnZXQpOiQvLnRlc3QoVHQucHJvdG9jb2wpLA0KCQkJCWdsb2JhbDogITAsDQoJCQkJcHJvY2Vzc0RhdGE6ICEwLA0KCQkJCWFzeW5jOiAhMCwNCgkJCQljb250ZW50VHlwZTogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCIsDQoJCQkJYWNjZXB0czogeyIqIjogSXQsIHRleHQ6ICJ0ZXh0L3BsYWluIiwgaHRtbDogInRleHQvaHRtbCIsIHhtbDogImFwcGxpY2F0aW9uL3htbCwgdGV4dC94bWwiLCBqc29uOiAiYXBwbGljYXRpb24vanNvbiwgdGV4dC9qYXZhc2NyaXB0In0sDQoJCQkJY29udGVudHM6IHt4bWw6IC9cYnhtbFxiLywgaHRtbDogL1xiaHRtbC8sIGpzb246IC9cYmpzb25cYi99LA0KCQkJCXJlc3BvbnNlRmllbGRzOiB7eG1sOiAicmVzcG9uc2VYTUwiLCB0ZXh0OiAicmVzcG9uc2VUZXh0IiwganNvbjogInJlc3BvbnNlSlNPTiJ9LA0KCQkJCWNvbnZlcnRlcnM6IHsiKiB0ZXh0IjogU3RyaW5nLCAidGV4dCBodG1sIjogITAsICJ0ZXh0IGpzb24iOiBKU09OLnBhcnNlLCAidGV4dCB4bWwiOiBTLnBhcnNlWE1MfSwNCgkJCQlmbGF0T3B0aW9uczoge3VybDogITAsIGNvbnRleHQ6ICEwfQ0KCQkJfSwNCgkJCWFqYXhTZXR1cDogZnVuY3Rpb24oZSwgdCkge3JldHVybiB0ID8gQnQoQnQoZSwgUy5hamF4U2V0dGluZ3MpLCB0KSA6IEJ0KFMuYWpheFNldHRpbmdzLCBlKTt9LA0KCQkJYWpheFByZWZpbHRlcjogRnQoUnQpLA0KCQkJYWpheFRyYW5zcG9ydDogRnQoTXQpLA0KCQkJYWpheDogZnVuY3Rpb24oZSwgdCkgew0KCQkJCSJvYmplY3QiID09IHR5cGVvZiBlICYmICh0ID0gZSwgZSA9IHZvaWQgMCksIHQgPSB0IHx8IHt9Ow0KCQkJCXZhciBjLA0KCQkJCSAgICBmLA0KCQkJCSAgICBwLA0KCQkJCSAgICBuLA0KCQkJCSAgICBkLA0KCQkJCSAgICByLA0KCQkJCSAgICBoLA0KCQkJCSAgICBnLA0KCQkJCSAgICBpLA0KCQkJCSAgICBvLA0KCQkJCSAgICB5ID0gUy5hamF4U2V0dXAoe30sIHQpLA0KCQkJCSAgICB2ID0geS5jb250ZXh0IHx8IHksDQoJCQkJICAgIG0gPSB5LmNvbnRleHQgJiYgKHYubm9kZVR5cGUgfHwgdi5qcXVlcnkpID8gUyh2KSA6IFMuZXZlbnQsDQoJCQkJICAgIHggPSBTLkRlZmVycmVkKCksDQoJCQkJICAgIGIgPSBTLkNhbGxiYWNrcygib25jZSBtZW1vcnkiKSwNCgkJCQkgICAgdyA9IHkuc3RhdHVzQ29kZSB8fCB7fSwNCgkJCQkgICAgYSA9IHt9LA0KCQkJCSAgICBzID0ge30sDQoJCQkJICAgIHUgPSAiY2FuY2VsZWQiLA0KCQkJCSAgICBUID0gew0KCQkJCQkgICAgcmVhZHlTdGF0ZTogMCwNCgkJCQkJICAgIGdldFJlc3BvbnNlSGVhZGVyOiBmdW5jdGlvbihlKSB7DQoJCQkJCQkgICAgdmFyIHQ7DQoJCQkJCQkgICAgaWYoaCkgew0KCQkJCQkJCSAgICBpZighbikgew0KCQkJCQkJCQkgICAgbiA9IHt9Ow0KCQkJCQkJCQkgICAgd2hpbGUodCA9IEh0LmV4ZWMocCkpIG5bdFsxXS50b0xvd2VyQ2FzZSgpICsgIiAiXSA9IChuW3RbMV0udG9Mb3dlckNhc2UoKSArICIgIl0gfHwgW10pLmNvbmNhdCh0WzJdKTsNCgkJCQkJCQkgICAgfQ0KCQkJCQkJCSAgICB0ID0gbltlLnRvTG93ZXJDYXNlKCkgKyAiICJdOw0KCQkJCQkJICAgIH0NCgkJCQkJCSAgICByZXR1cm4gbnVsbCA9PSB0ID8gbnVsbCA6IHQuam9pbigiLCAiKTsNCgkJCQkJICAgIH0sDQoJCQkJCSAgICBnZXRBbGxSZXNwb25zZUhlYWRlcnM6IGZ1bmN0aW9uKCkge3JldHVybiBoID8gcCA6IG51bGw7fSwNCgkJCQkJICAgIHNldFJlcXVlc3RIZWFkZXI6IGZ1bmN0aW9uKGUsIHQpIHtyZXR1cm4gbnVsbCA9PSBoICYmIChlID0gc1tlLnRvTG93ZXJDYXNlKCldID0gc1tlLnRvTG93ZXJDYXNlKCldIHx8IGUsIGFbZV0gPSB0KSwgdGhpczt9LA0KCQkJCQkgICAgb3ZlcnJpZGVNaW1lVHlwZTogZnVuY3Rpb24oZSkge3JldHVybiBudWxsID09IGggJiYgKHkubWltZVR5cGUgPSBlKSwgdGhpczt9LA0KCQkJCQkgICAgc3RhdHVzQ29kZTogZnVuY3Rpb24oZSkgew0KCQkJCQkJICAgIHZhciB0Ow0KCQkJCQkJICAgIGlmKGUpIGlmKGgpIFQuYWx3YXlzKGVbVC5zdGF0dXNdKTsgZWxzZSBmb3IodCBpbiBlKSB3W3RdID0gW3dbdF0sIGVbdF1dOw0KCQkJCQkJICAgIHJldHVybiB0aGlzOw0KCQkJCQkgICAgfSwNCgkJCQkJICAgIGFib3J0OiBmdW5jdGlvbihlKSB7DQoJCQkJCQkgICAgdmFyIHQgPSBlIHx8IHU7DQoJCQkJCQkgICAgcmV0dXJuIGMgJiYgYy5hYm9ydCh0KSwgbCgwLCB0KSwgdGhpczsNCgkJCQkJICAgIH0NCgkJCQkgICAgfTsNCgkJCQlpZih4LnByb21pc2UoVCksIHkudXJsID0gKChlIHx8IHkudXJsIHx8IFR0LmhyZWYpICsgIiIpLnJlcGxhY2UoUHQsIFR0LnByb3RvY29sICsgIi8vIiksIHkudHlwZSA9IHQubWV0aG9kIHx8IHQudHlwZSB8fCB5Lm1ldGhvZCB8fCB5LnR5cGUsIHkuZGF0YVR5cGVzID0gKHkuZGF0YVR5cGUgfHwgIioiKS50b0xvd2VyQ2FzZSgpDQoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWF0Y2goUCkgfHwgWyIiXSwgbnVsbCA9PSB5LmNyb3NzRG9tYWluKSB7DQoJCQkJCXIgPSBFLmNyZWF0ZUVsZW1lbnQoImEiKTsNCgkJCQkJdHJ5IHtyLmhyZWYgPSB5LnVybCwgci5ocmVmID0gci5ocmVmLCB5LmNyb3NzRG9tYWluID0gV3QucHJvdG9jb2wgKyAiLy8iICsgV3QuaG9zdCAhPSByLnByb3RvY29sICsgIi8vIiArIHIuaG9zdDt9IGNhdGNoKGUpIHt5LmNyb3NzRG9tYWluID0gITA7fQ0KCQkJCX0NCgkJCQlpZih5LmRhdGEgJiYgeS5wcm9jZXNzRGF0YSAmJiAic3RyaW5nIiAhPSB0eXBlb2YgeS5kYXRhICYmICh5LmRhdGEgPSBTLnBhcmFtKHkuZGF0YSwgeS50cmFkaXRpb25hbCkpLCAkdChSdCwgeSwgdCwgVCksIGgpIHJldHVybiBUOw0KCQkJCWZvcihpIGluIChnID0gUy5ldmVudCAmJiB5Lmdsb2JhbCkgJiYgMCA9PSBTLmFjdGl2ZSsrICYmIFMuZXZlbnQudHJpZ2dlcigiYWpheFN0YXJ0IiksIHkudHlwZSA9IHkudHlwZS50b1VwcGVyQ2FzZSgpLCB5Lmhhc0NvbnRlbnQgPSAhT3QudGVzdCh5LnR5cGUpLCBmID0geS51cmwucmVwbGFjZShxdCwgIiIpLCB5Lmhhc0NvbnRlbnQgPw0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5LmRhdGEgJiYNCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeS5wcm9jZXNzRGF0YSAmJg0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwID09PQ0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoeS5jb250ZW50VHlwZSB8fCAiIikuaW5kZXhPZigiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIikgJiYNCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHkuZGF0YSA9IHkuZGF0YS5yZXBsYWNlKER0LCAiKyIpKSA6DQoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChvID0geS51cmwuc2xpY2UoZi5sZW5ndGgpLCB5LmRhdGEgJiYNCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh5LnByb2Nlc3NEYXRhIHx8ICJzdHJpbmciID09IHR5cGVvZiB5LmRhdGEpICYmDQoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZiArPSAoRXQudGVzdChmKSA/ICImIiA6ICI/IikgKyB5LmRhdGEsIGRlbGV0ZSB5LmRhdGEpLCAhMSA9PT0NCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkuY2FjaGUgJiYNCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChmID0NCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLnJlcGxhY2UoTHQsICIkMSIpLCBvID0NCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoRXQudGVzdChmKSA/DQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICImIiA6DQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICI/IikgKw0KCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJfPSIgKw0KCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEN0Lmd1aWQrKyArDQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbyksIHkudXJsID0NCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgKyBvKSwgeS5pZk1vZGlmaWVkICYmDQoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChTLmxhc3RNb2RpZmllZFtmXSAmJiBULnNldFJlcXVlc3RIZWFkZXIoIklmLU1vZGlmaWVkLVNpbmNlIiwgUy5sYXN0TW9kaWZpZWRbZl0pLCBTLmV0YWdbZl0gJiYNCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVC5zZXRSZXF1ZXN0SGVhZGVyKCJJZi1Ob25lLU1hdGNoIiwgUy5ldGFnW2ZdKSksICh5LmRhdGEgJiYNCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5Lmhhc0NvbnRlbnQgJiYNCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhMSAhPT0NCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5LmNvbnRlbnRUeXBlIHx8DQoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5jb250ZW50VHlwZSkgJiYNCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQuc2V0UmVxdWVzdEhlYWRlcigiQ29udGVudC1UeXBlIiwgeS5jb250ZW50VHlwZSksIFQuc2V0UmVxdWVzdEhlYWRlcigiQWNjZXB0IiwgeS5kYXRhVHlwZXNbMF0gJiYNCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeS5hY2NlcHRzW3kuZGF0YVR5cGVzWzBdXSA/DQoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkuYWNjZXB0c1t5LmRhdGFUeXBlc1swXV0gKw0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoIioiICE9PQ0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeS5kYXRhVHlwZXNbMF0gPw0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLCAiICsNCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSXQgKw0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiOyBxPTAuMDEiIDoNCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIiKSA6DQoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkuYWNjZXB0c1siKiJdKSwgeS5oZWFkZXJzKSBULnNldFJlcXVlc3RIZWFkZXIoaSwgeS5oZWFkZXJzW2ldKTsNCgkJCQlpZih5LmJlZm9yZVNlbmQgJiYgKCExID09PSB5LmJlZm9yZVNlbmQuY2FsbCh2LCBULCB5KSB8fCBoKSkgcmV0dXJuIFQuYWJvcnQoKTsNCgkJCQlpZih1ID0gImFib3J0IiwgYi5hZGQoeS5jb21wbGV0ZSksIFQuZG9uZSh5LnN1Y2Nlc3MpLCBULmZhaWwoeS5lcnJvciksIGMgPSAkdChNdCwgeSwgdCwgVCkpIHsNCgkJCQkJaWYoVC5yZWFkeVN0YXRlID0gMSwgZyAmJiBtLnRyaWdnZXIoImFqYXhTZW5kIiwgW1QsIHldKSwgaCkgcmV0dXJuIFQ7DQoJCQkJCXkuYXN5bmMgJiYgMCA8IHkudGltZW91dCAmJiAoZCA9IEMuc2V0VGltZW91dChmdW5jdGlvbigpIHtULmFib3J0KCJ0aW1lb3V0Iik7fSwgeS50aW1lb3V0KSk7DQoJCQkJCXRyeSB7aCA9ICExLCBjLnNlbmQoYSwgbCk7fSBjYXRjaChlKSB7DQoJCQkJCQlpZihoKSB0aHJvdyBlOw0KCQkJCQkJbCgtMSwgZSk7DQoJCQkJCX0NCgkJCQl9IGVsc2Ugew0KCQkJCQlsKC0xLCAiTm8gVHJhbnNwb3J0Iik7DQoJCQkJfQ0KDQoJCQkJZnVuY3Rpb24gbChlLCB0LCBuLCByKSB7DQoJCQkJCXZhciBpLCBvLCBhLCBzLCB1LCBsID0gdDsNCgkJCQkJaCB8fCAoaCA9ICEwLCBkICYmIEMuY2xlYXJUaW1lb3V0KGQpLCBjID0gdm9pZCAwLCBwID0gciB8fCAiIiwgVC5yZWFkeVN0YXRlID0gMCA8IGUgPyA0IDogMCwgaSA9IDIwMCA8PSBlICYmIGUgPCAzMDAgfHwgMzA0ID09PSBlLCBuICYmIChzID0gZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCQkJdmFyIHIsDQoJCQkJCQkgICAgaSwNCgkJCQkJCSAgICBvLA0KCQkJCQkJICAgIGEsDQoJCQkJCQkgICAgcyA9IGUuY29udGVudHMsDQoJCQkJCQkgICAgdSA9IGUuZGF0YVR5cGVzOw0KCQkJCQkJd2hpbGUoIioiID09PSB1WzBdKSB1LnNoaWZ0KCksIHZvaWQgMCA9PT0gciAmJiAociA9IGUubWltZVR5cGUgfHwgdC5nZXRSZXNwb25zZUhlYWRlcigiQ29udGVudC1UeXBlIikpOw0KCQkJCQkJaWYocikgew0KCQkJCQkJCWZvcihpIGluIHMpIHsNCgkJCQkJCQkJaWYoc1tpXSAmJiBzW2ldLnRlc3QocikpIHsNCgkJCQkJCQkJCXUudW5zaGlmdChpKTsNCgkJCQkJCQkJCWJyZWFrOw0KCQkJCQkJCQl9DQoJCQkJCQkJfQ0KCQkJCQkJfQ0KCQkJCQkJaWYodVswXSBpbiBuKSB7DQoJCQkJCQkJbyA9IHVbMF07DQoJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCWZvcihpIGluIG4pIHsNCgkJCQkJCQkJaWYoIXVbMF0gfHwgZS5jb252ZXJ0ZXJzW2kgKyAiICIgKyB1WzBdXSkgew0KCQkJCQkJCQkJbyA9IGk7DQoJCQkJCQkJCQlicmVhazsNCgkJCQkJCQkJfQ0KCQkJCQkJCQlhIHx8IChhID0gaSk7DQoJCQkJCQkJfQ0KCQkJCQkJCW8gPSBvIHx8IGE7DQoJCQkJCQl9DQoJCQkJCQlpZihvKSByZXR1cm4gbyAhPT0gdVswXSAmJiB1LnVuc2hpZnQobyksIG5bb107DQoJCQkJCX0oeSwgVCwgbikpLCAhaSAmJiAtMSA8IFMuaW5BcnJheSgic2NyaXB0IiwgeS5kYXRhVHlwZXMpICYmIFMuaW5BcnJheSgianNvbiIsIHkuZGF0YVR5cGVzKSA8IDAgJiYgKHkuY29udmVydGVyc1sidGV4dCBzY3JpcHQiXSA9IGZ1bmN0aW9uKCkge30pLCBzID0gZnVuY3Rpb24oZSwgdCwgbiwgcikgew0KCQkJCQkJdmFyIGksDQoJCQkJCQkgICAgbywNCgkJCQkJCSAgICBhLA0KCQkJCQkJICAgIHMsDQoJCQkJCQkgICAgdSwNCgkJCQkJCSAgICBsID0ge30sDQoJCQkJCQkgICAgYyA9IGUuZGF0YVR5cGVzLnNsaWNlKCk7DQoJCQkJCQlpZihjWzFdKSBmb3IoYSBpbiBlLmNvbnZlcnRlcnMpIGxbYS50b0xvd2VyQ2FzZSgpXSA9IGUuY29udmVydGVyc1thXTsNCgkJCQkJCW8gPSBjLnNoaWZ0KCk7DQoJCQkJCQl3aGlsZShvKSB7DQoJCQkJCQkJaWYoZS5yZXNwb25zZUZpZWxkc1tvXSAmJiAobltlLnJlc3BvbnNlRmllbGRzW29dXSA9IHQpLCAhdSAmJiByICYmIGUuZGF0YUZpbHRlciAmJiAodCA9IGUuZGF0YUZpbHRlcih0LCBlLmRhdGFUeXBlKSksIHUgPSBvLCBvID0gYy5zaGlmdCgpKSB7DQoJCQkJCQkJCWlmKCIqIiA9PT0gbykgew0KCQkJCQkJCQkJbyA9IHU7DQoJCQkJCQkJCX0gZWxzZSBpZigiKiIgIT09IHUgJiYgdSAhPT0gbykgew0KCQkJCQkJCQkJaWYoIShhID0gbFt1ICsgIiAiICsgb10gfHwgbFsiKiAiICsgb10pKSB7DQoJCQkJCQkJCQkJZm9yKGkgaW4gbCkgew0KCQkJCQkJCQkJCQlpZigocyA9IGkuc3BsaXQoIiAiKSlbMV0gPT09IG8gJiYgKGEgPSBsW3UgKyAiICIgKyBzWzBdXSB8fCBsWyIqICIgKyBzWzBdXSkpIHsNCgkJCQkJCQkJCQkJCSEwID09PSBhID8gYSA9IGxbaV0gOiAhMCAhPT0gbFtpXSAmJiAobyA9IHNbMF0sIGMudW5zaGlmdChzWzFdKSk7DQoJCQkJCQkJCQkJCQlicmVhazsNCgkJCQkJCQkJCQkJfQ0KCQkJCQkJCQkJCX0NCgkJCQkJCQkJCX0NCgkJCQkJCQkJCWlmKCEwICE9PSBhKSBpZihhICYmIGVbInRocm93cyJdKSB0ID0gYSh0KTsgZWxzZSB0cnkge3QgPSBhKHQpO30gY2F0Y2goZSkge3JldHVybiB7c3RhdGU6ICJwYXJzZXJlcnJvciIsIGVycm9yOiBhID8gZSA6ICJObyBjb252ZXJzaW9uIGZyb20gIiArIHUgKyAiIHRvICIgKyBvfTt9DQoJCQkJCQkJCX0NCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJCQlyZXR1cm4ge3N0YXRlOiAic3VjY2VzcyIsIGRhdGE6IHR9Ow0KCQkJCQl9KHksIHMsIFQsIGkpLCBpID8NCgkJCQkJICAgICAgICAgICAgICAgKHkuaWZNb2RpZmllZCAmJiAoKHUgPSBULmdldFJlc3BvbnNlSGVhZGVyKCJMYXN0LU1vZGlmaWVkIikpICYmIChTLmxhc3RNb2RpZmllZFtmXSA9IHUpLCAodSA9IFQuZ2V0UmVzcG9uc2VIZWFkZXIoImV0YWciKSkgJiYgKFMuZXRhZ1tmXSA9IHUpKSwgMjA0ID09PSBlIHx8ICJIRUFEIiA9PT0geS50eXBlID8NCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9ICJub2NvbnRlbnQiIDoNCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMzA0ID09PSBlID8gbCA9ICJub3Rtb2RpZmllZCIgOiAobCA9IHMuc3RhdGUsIG8gPSBzLmRhdGEsIGkgPSAhKGEgPSBzLmVycm9yKSkpIDoNCgkJCQkJICAgICAgICAgICAgICAgKGEgPSBsLCAhZSAmJiBsIHx8IChsID0gImVycm9yIiwgZSA8IDAgJiYgKGUgPSAwKSkpLCBULnN0YXR1cyA9IGUsIFQuc3RhdHVzVGV4dCA9ICh0IHx8IGwpICsgIiIsIGkgPyB4LnJlc29sdmVXaXRoKHYsIFtvLA0KCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwsDQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVF0pIDogeC5yZWplY3RXaXRoKHYsIFtULA0KCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCwNCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFdKSwgVC5zdGF0dXNDb2RlKHcpLCB3ID0gdm9pZCAwLCBnICYmIG0udHJpZ2dlcihpID8gImFqYXhTdWNjZXNzIiA6ICJhamF4RXJyb3IiLCBbVCwNCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeSwNCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaSA/IG8gOiBhXSksIGIuZmlyZVdpdGgodiwgW1QsDQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsXSksIGcgJiYNCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG0udHJpZ2dlcigiYWpheENvbXBsZXRlIiwgW1QsDQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5XSksIC0tUy5hY3RpdmUgfHwNCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUy5ldmVudC50cmlnZ2VyKCJhamF4U3RvcCIpKSk7DQoJCQkJfQ0KDQoJCQkJcmV0dXJuIFQ7DQoJCQl9LA0KCQkJZ2V0SlNPTjogZnVuY3Rpb24oZSwgdCwgbikge3JldHVybiBTLmdldChlLCB0LCBuLCAianNvbiIpO30sDQoJCQlnZXRTY3JpcHQ6IGZ1bmN0aW9uKGUsIHQpIHtyZXR1cm4gUy5nZXQoZSwgdm9pZCAwLCB0LCAic2NyaXB0Iik7fQ0KCQl9KSwgUy5lYWNoKFsiZ2V0IiwgInBvc3QiXSwgZnVuY3Rpb24oZSwgaSkgew0KCQkJU1tpXSA9IGZ1bmN0aW9uKGUsIHQsIG4sIHIpIHsNCgkJCQlyZXR1cm4gbSh0KSAmJiAociA9IHIgfHwgbiwgbiA9IHQsIHQgPSB2b2lkIDApLCBTLmFqYXgoUy5leHRlbmQoew0KCQkJCQl1cmw6IGUsDQoJCQkJCXR5cGU6IGksDQoJCQkJCWRhdGFUeXBlOiByLA0KCQkJCQlkYXRhOiB0LA0KCQkJCQlzdWNjZXNzOiBuDQoJCQkJfSwgUy5pc1BsYWluT2JqZWN0KGUpICYmIGUpKTsNCgkJCX07DQoJCX0pLCBTLmFqYXhQcmVmaWx0ZXIoZnVuY3Rpb24oZSkgew0KCQkJdmFyIHQ7DQoJCQlmb3IodCBpbiBlLmhlYWRlcnMpICJjb250ZW50LXR5cGUiID09PSB0LnRvTG93ZXJDYXNlKCkgJiYgKGUuY29udGVudFR5cGUgPSBlLmhlYWRlcnNbdF0gfHwgIiIpOw0KCQl9KSwgUy5fZXZhbFVybCA9IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCXJldHVybiBTLmFqYXgoew0KCQkJCXVybDogZSwNCgkJCQl0eXBlOiAiR0VUIiwNCgkJCQlkYXRhVHlwZTogInNjcmlwdCIsDQoJCQkJY2FjaGU6ICEwLA0KCQkJCWFzeW5jOiAhMSwNCgkJCQlnbG9iYWw6ICExLA0KCQkJCWNvbnZlcnRlcnM6IHsidGV4dCBzY3JpcHQiOiBmdW5jdGlvbigpIHt9fSwNCgkJCQlkYXRhRmlsdGVyOiBmdW5jdGlvbihlKSB7Uy5nbG9iYWxFdmFsKGUsIHQsIG4pO30NCgkJCX0pOw0KCQl9LCBTLmZuLmV4dGVuZCh7DQoJCQl3cmFwQWxsOiBmdW5jdGlvbihlKSB7DQoJCQkJdmFyIHQ7DQoJCQkJcmV0dXJuIHRoaXNbMF0gJiYgKG0oZSkgJiYgKGUgPSBlLmNhbGwodGhpc1swXSkpLCB0ID0gUyhlLCB0aGlzWzBdLm93bmVyRG9jdW1lbnQpLmVxKDApLmNsb25lKCEwKSwgdGhpc1swXS5wYXJlbnROb2RlICYmIHQuaW5zZXJ0QmVmb3JlKHRoaXNbMF0pLCB0Lm1hcChmdW5jdGlvbigpIHsNCgkJCQkJdmFyIGUgPSB0aGlzOw0KCQkJCQl3aGlsZShlLmZpcnN0RWxlbWVudENoaWxkKSBlID0gZS5maXJzdEVsZW1lbnRDaGlsZDsNCgkJCQkJcmV0dXJuIGU7DQoJCQkJfSkuYXBwZW5kKHRoaXMpKSwgdGhpczsNCgkJCX0sIHdyYXBJbm5lcjogZnVuY3Rpb24obikgew0KCQkJCXJldHVybiBtKG4pID8gdGhpcy5lYWNoKGZ1bmN0aW9uKGUpIHtTKHRoaXMpLndyYXBJbm5lcihuLmNhbGwodGhpcywgZSkpO30pIDogdGhpcy5lYWNoKGZ1bmN0aW9uKCkgew0KCQkJCQl2YXIgZSA9IFModGhpcyksIHQgPSBlLmNvbnRlbnRzKCk7DQoJCQkJCXQubGVuZ3RoID8gdC53cmFwQWxsKG4pIDogZS5hcHBlbmQobik7DQoJCQkJfSk7DQoJCQl9LCB3cmFwOiBmdW5jdGlvbih0KSB7DQoJCQkJdmFyIG4gPSBtKHQpOw0KCQkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oZSkge1ModGhpcykud3JhcEFsbChuID8gdC5jYWxsKHRoaXMsIGUpIDogdCk7fSk7DQoJCQl9LCB1bndyYXA6IGZ1bmN0aW9uKGUpIHtyZXR1cm4gdGhpcy5wYXJlbnQoZSkubm90KCJib2R5IikuZWFjaChmdW5jdGlvbigpIHtTKHRoaXMpLnJlcGxhY2VXaXRoKHRoaXMuY2hpbGROb2Rlcyk7fSksIHRoaXM7fQ0KCQl9KSwgUy5leHByLnBzZXVkb3MuaGlkZGVuID0gZnVuY3Rpb24oZSkge3JldHVybiAhUy5leHByLnBzZXVkb3MudmlzaWJsZShlKTt9LCBTLmV4cHIucHNldWRvcy52aXNpYmxlID0gZnVuY3Rpb24oZSkge3JldHVybiAhIShlLm9mZnNldFdpZHRoIHx8IGUub2Zmc2V0SGVpZ2h0IHx8IGUuZ2V0Q2xpZW50UmVjdHMoKS5sZW5ndGgpO30sIFMuYWpheFNldHRpbmdzLnhociA9IGZ1bmN0aW9uKCkge3RyeSB7cmV0dXJuIG5ldyBDLlhNTEh0dHBSZXF1ZXN0O30gY2F0Y2goZSkge319Ow0KCQl2YXIgX3QgPSB7MDogMjAwLCAxMjIzOiAyMDR9LCB6dCA9IFMuYWpheFNldHRpbmdzLnhocigpOw0KCQl2LmNvcnMgPSAhIXp0ICYmICJ3aXRoQ3JlZGVudGlhbHMiIGluIHp0LCB2LmFqYXggPSB6dCA9ICEhenQsIFMuYWpheFRyYW5zcG9ydChmdW5jdGlvbihpKSB7DQoJCQl2YXIgbywgYTsNCgkJCWlmKHYuY29ycyB8fCB6dCAmJiAhaS5jcm9zc0RvbWFpbikgew0KCQkJCXJldHVybiB7DQoJCQkJCXNlbmQ6IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJCXZhciBuLCByID0gaS54aHIoKTsNCgkJCQkJCWlmKHIub3BlbihpLnR5cGUsIGkudXJsLCBpLmFzeW5jLCBpLnVzZXJuYW1lLCBpLnBhc3N3b3JkKSwgaS54aHJGaWVsZHMpIGZvcihuIGluIGkueGhyRmllbGRzKSByW25dID0gaS54aHJGaWVsZHNbbl07DQoJCQkJCQlmb3IobiBpbiBpLm1pbWVUeXBlICYmIHIub3ZlcnJpZGVNaW1lVHlwZSAmJiByLm92ZXJyaWRlTWltZVR5cGUoaS5taW1lVHlwZSksIGkuY3Jvc3NEb21haW4gfHwgZVsiWC1SZXF1ZXN0ZWQtV2l0aCJdIHx8IChlWyJYLVJlcXVlc3RlZC1XaXRoIl0gPSAiWE1MSHR0cFJlcXVlc3QiKSwgZSkgci5zZXRSZXF1ZXN0SGVhZGVyKG4sIGVbbl0pOw0KCQkJCQkJbyA9DQoJCQkJCQkJZnVuY3Rpb24oZSkgew0KCQkJCQkJCQlyZXR1cm4gZnVuY3Rpb24oKSB7DQoJCQkJCQkJCQlvICYmDQoJCQkJCQkJCQkobyA9IGEgPSByLm9ubG9hZCA9IHIub25lcnJvciA9IHIub25hYm9ydCA9IHIub250aW1lb3V0ID0gci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBudWxsLCAiYWJvcnQiID09PSBlID8NCgkJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIuYWJvcnQoKSA6DQoJCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZXJyb3IiID09PSBlID8NCgkJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJudW1iZXIiICE9IHR5cGVvZiByLnN0YXR1cyA/IHQoMCwgImVycm9yIikgOiB0KHIuc3RhdHVzLCByLnN0YXR1c1RleHQpIDoNCgkJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQoX3Rbci5zdGF0dXNdIHx8IHIuc3RhdHVzLCByLnN0YXR1c1RleHQsICJ0ZXh0IiAhPT0gKHIucmVzcG9uc2VUeXBlIHx8ICJ0ZXh0IikgfHwgInN0cmluZyIgIT0gdHlwZW9mIHIucmVzcG9uc2VUZXh0ID8NCgkJCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7YmluYXJ5OiByLnJlc3BvbnNlfSA6DQoJCQkJCQkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3RleHQ6IHIucmVzcG9uc2VUZXh0fSwgci5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKSkpOw0KCQkJCQkJCQl9Ow0KCQkJCQkJCX0sIHIub25sb2FkID0gbygpLCBhID0gci5vbmVycm9yID0gci5vbnRpbWVvdXQgPSBvKCJlcnJvciIpLCB2b2lkIDAgIT09IHIub25hYm9ydCA/IHIub25hYm9ydCA9IGEgOiByLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkgezQgPT09IHIucmVhZHlTdGF0ZSAmJiBDLnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7byAmJiBhKCk7fSk7fSwgbyA9IG8oImFib3J0Iik7DQoJCQkJCQl0cnkge3Iuc2VuZChpLmhhc0NvbnRlbnQgJiYgaS5kYXRhIHx8IG51bGwpO30gY2F0Y2goZSkge2lmKG8pIHRocm93IGU7fQ0KCQkJCQl9LCBhYm9ydDogZnVuY3Rpb24oKSB7byAmJiBvKCk7fQ0KCQkJCX07DQoJCQl9DQoJCX0pLCBTLmFqYXhQcmVmaWx0ZXIoZnVuY3Rpb24oZSkge2UuY3Jvc3NEb21haW4gJiYgKGUuY29udGVudHMuc2NyaXB0ID0gITEpO30pLCBTLmFqYXhTZXR1cCh7DQoJCQlhY2NlcHRzOiB7c2NyaXB0OiAidGV4dC9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9lY21hc2NyaXB0LCBhcHBsaWNhdGlvbi94LWVjbWFzY3JpcHQifSwNCgkJCWNvbnRlbnRzOiB7c2NyaXB0OiAvXGIoPzpqYXZhfGVjbWEpc2NyaXB0XGIvfSwNCgkJCWNvbnZlcnRlcnM6IHsidGV4dCBzY3JpcHQiOiBmdW5jdGlvbihlKSB7cmV0dXJuIFMuZ2xvYmFsRXZhbChlKSwgZTt9fQ0KCQl9KSwgUy5hamF4UHJlZmlsdGVyKCJzY3JpcHQiLCBmdW5jdGlvbihlKSB7dm9pZCAwID09PSBlLmNhY2hlICYmIChlLmNhY2hlID0gITEpLCBlLmNyb3NzRG9tYWluICYmIChlLnR5cGUgPSAiR0VUIik7fSksIFMuYWpheFRyYW5zcG9ydCgic2NyaXB0IiwgZnVuY3Rpb24obikgew0KCQkJdmFyIHIsIGk7DQoJCQlpZihuLmNyb3NzRG9tYWluIHx8IG4uc2NyaXB0QXR0cnMpIHsNCgkJCQlyZXR1cm4gew0KCQkJCQlzZW5kOiBmdW5jdGlvbihlLCB0KSB7DQoJCQkJCQlyID0gUygiPHNjcmlwdD4iKQ0KCQkJCQkJCS5hdHRyKG4uc2NyaXB0QXR0cnMgfHwge30pDQoJCQkJCQkJLnByb3Aoe2NoYXJzZXQ6IG4uc2NyaXB0Q2hhcnNldCwgc3JjOiBuLnVybH0pDQoJCQkJCQkJLm9uKCJsb2FkIGVycm9yIiwgaSA9IGZ1bmN0aW9uKGUpIHtyLnJlbW92ZSgpLCBpID0gbnVsbCwgZSAmJiB0KCJlcnJvciIgPT09IGUudHlwZSA/IDQwNCA6IDIwMCwgZS50eXBlKTt9KSwgRS5oZWFkLmFwcGVuZENoaWxkKHJbMF0pOw0KCQkJCQl9LCBhYm9ydDogZnVuY3Rpb24oKSB7aSAmJiBpKCk7fQ0KCQkJCX07DQoJCQl9DQoJCX0pOw0KCQl2YXIgVXQsIFh0ID0gW10sIFZ0ID0gLyg9KVw/KD89JnwkKXxcP1w/LzsNCgkJUy5hamF4U2V0dXAoew0KCQkJanNvbnA6ICJjYWxsYmFjayIsIGpzb25wQ2FsbGJhY2s6IGZ1bmN0aW9uKCkgew0KCQkJCXZhciBlID0gWHQucG9wKCkgfHwgUy5leHBhbmRvICsgIl8iICsgQ3QuZ3VpZCsrOw0KCQkJCXJldHVybiB0aGlzW2VdID0gITAsIGU7DQoJCQl9DQoJCX0pLCBTLmFqYXhQcmVmaWx0ZXIoImpzb24ganNvbnAiLCBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQl2YXIgciwNCgkJCSAgICBpLA0KCQkJICAgIG8sDQoJCQkgICAgYSA9ICExICE9PSBlLmpzb25wICYmIChWdC50ZXN0KGUudXJsKSA/ICJ1cmwiIDogInN0cmluZyIgPT0gdHlwZW9mIGUuZGF0YSAmJiAwID09PSAoZS5jb250ZW50VHlwZSB8fCAiIikuaW5kZXhPZigiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIikgJiYgVnQudGVzdChlLmRhdGEpICYmICJkYXRhIik7DQoJCQlpZihhIHx8ICJqc29ucCIgPT09IGUuZGF0YVR5cGVzWzBdKSB7DQoJCQkJcmV0dXJuIHIgPSBlLmpzb25wQ2FsbGJhY2sgPSBtKGUuanNvbnBDYWxsYmFjaykgPyBlLmpzb25wQ2FsbGJhY2soKSA6IGUuanNvbnBDYWxsYmFjaywgYSA/IGVbYV0gPSBlW2FdLnJlcGxhY2UoVnQsICIkMSIgKyByKSA6ICExICE9PSBlLmpzb25wICYmIChlLnVybCArPSAoRXQudGVzdChlLnVybCkgPyAiJiIgOiAiPyIpICsgZS5qc29ucCArICI9IiArIHIpLCBlLmNvbnZlcnRlcnNbInNjcmlwdCBqc29uIl0gPQ0KCQkJCQlmdW5jdGlvbigpIHtyZXR1cm4gbyB8fCBTLmVycm9yKHIgKyAiIHdhcyBub3QgY2FsbGVkIiksIG9bMF07fSwgZS5kYXRhVHlwZXNbMF0gPSAianNvbiIsIGkgPSBDW3JdLCBDW3JdID0gZnVuY3Rpb24oKSB7byA9IGFyZ3VtZW50czt9LCBuLmFsd2F5cyhmdW5jdGlvbigpIHsNCgkJCQkJdm9pZCAwID09PSBpID8gUyhDKQ0KCQkJCQkJLnJlbW92ZVByb3AocikgOiBDW3JdID0gaSwgZVtyXSAmJiAoZS5qc29ucENhbGxiYWNrID0gdC5qc29ucENhbGxiYWNrLCBYdC5wdXNoKHIpKSwgbyAmJiBtKGkpICYmIGkob1swXSksIG8gPSBpID0gdm9pZCAwOw0KCQkJCX0pLCAic2NyaXB0IjsNCgkJCX0NCgkJfSksIHYuY3JlYXRlSFRNTERvY3VtZW50ID0gKChVdCA9IEUuaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50KCIiKS5ib2R5KS5pbm5lckhUTUwgPSAiPGZvcm0+PC9mb3JtPjxmb3JtPjwvZm9ybT4iLCAyID09PSBVdC5jaGlsZE5vZGVzLmxlbmd0aCksIFMucGFyc2VIVE1MID0gZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJcmV0dXJuICJzdHJpbmciICE9IHR5cGVvZiBlID8NCgkJCQlbXSA6DQoJCQkJICAgKCJib29sZWFuIiA9PSB0eXBlb2YgdCAmJiAobiA9IHQsIHQgPSAhMSksIHQgfHwgKHYuY3JlYXRlSFRNTERvY3VtZW50ID8gKChyID0gKHQgPSBFLmltcGxlbWVudGF0aW9uLmNyZWF0ZUhUTUxEb2N1bWVudCgiIikpLmNyZWF0ZUVsZW1lbnQoImJhc2UiKSkuaHJlZiA9IEUubG9jYXRpb24uaHJlZiwgdC5oZWFkLmFwcGVuZENoaWxkKHIpKSA6IHQgPSBFKSwgbyA9ICFuICYmIFtdLCAoaSA9IE4uZXhlYyhlKSkgPw0KCQkJCQkgICBbdC5jcmVhdGVFbGVtZW50KGlbMV0pXSA6DQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaSA9IHhlKFtlXSwgdCwgbyksIG8gJiYgby5sZW5ndGggJiYgUyhvKQ0KCQkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZW1vdmUoKSwgUy5tZXJnZShbXSwgaS5jaGlsZE5vZGVzKSkpOw0KCQkJdmFyIHIsIGksIG87DQoJCX0sIFMuZm4ubG9hZCA9IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCgkJCXZhciByLCBpLCBvLCBhID0gdGhpcywgcyA9IGUuaW5kZXhPZigiICIpOw0KCQkJcmV0dXJuIC0xIDwgcyAmJiAociA9IHl0KGUuc2xpY2UocykpLCBlID0gZS5zbGljZSgwLCBzKSksIG0odCkgPyAobiA9IHQsIHQgPSB2b2lkIDApIDogdCAmJiAib2JqZWN0IiA9PSB0eXBlb2YgdCAmJiAoaSA9ICJQT1NUIiksIDAgPCBhLmxlbmd0aCAmJiBTLmFqYXgoew0KCQkJCXVybDogZSwNCgkJCQl0eXBlOiBpIHx8ICJHRVQiLA0KCQkJCWRhdGFUeXBlOiAiaHRtbCIsDQoJCQkJZGF0YTogdA0KCQkJfSkuZG9uZShmdW5jdGlvbihlKSB7byA9IGFyZ3VtZW50cywgYS5odG1sKHIgPyBTKCI8ZGl2PiIpLmFwcGVuZChTLnBhcnNlSFRNTChlKSkuZmluZChyKSA6IGUpO30pLmFsd2F5cyhuICYmIGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQlhLmVhY2goZnVuY3Rpb24oKSB7DQoJCQkJCW4uYXBwbHkodGhpcywgbyB8fCBbZS5yZXNwb25zZVRleHQsDQoJCQkJCSAgICAgICAgICAgICAgICAgICAgdCwNCgkJCQkJICAgICAgICAgICAgICAgICAgICBlXSk7DQoJCQkJfSk7DQoJCQl9KSwgdGhpczsNCgkJfSwgUy5leHByLnBzZXVkb3MuYW5pbWF0ZWQgPSBmdW5jdGlvbih0KSB7cmV0dXJuIFMuZ3JlcChTLnRpbWVycywgZnVuY3Rpb24oZSkge3JldHVybiB0ID09PSBlLmVsZW07fSkubGVuZ3RoO30sIFMub2Zmc2V0ID0gew0KCQkJc2V0T2Zmc2V0OiBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJdmFyIHIsDQoJCQkJICAgIGksDQoJCQkJICAgIG8sDQoJCQkJICAgIGEsDQoJCQkJICAgIHMsDQoJCQkJICAgIHUsDQoJCQkJICAgIGwgPSBTLmNzcyhlLCAicG9zaXRpb24iKSwNCgkJCQkgICAgYyA9IFMoZSksDQoJCQkJICAgIGYgPSB7fTsNCgkJCQkic3RhdGljIiA9PT0gbCAmJiAoZS5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSIpLCBzID0gYy5vZmZzZXQoKSwgbyA9IFMuY3NzKGUsICJ0b3AiKSwgdSA9IFMuY3NzKGUsICJsZWZ0IiksICgiYWJzb2x1dGUiID09PSBsIHx8ICJmaXhlZCIgPT09IGwpICYmIC0xIDwgKG8gKyB1KS5pbmRleE9mKCJhdXRvIikgPyAoYSA9IChyID0gYy5wb3NpdGlvbigpKS50b3AsIGkgPSByLmxlZnQpIDogKGEgPSBwYXJzZUZsb2F0KG8pIHx8IDAsIGkgPSBwYXJzZUZsb2F0KHUpIHx8IDApLCBtKHQpICYmDQoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHQgPQ0KCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmNhbGwoZSwgbiwgUy5leHRlbmQoe30sIHMpKSksIG51bGwgIT0NCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnRvcCAmJg0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChmLnRvcCA9DQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQudG9wIC0NCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcy50b3AgKw0KCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKSwgbnVsbCAhPQ0KCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5sZWZ0ICYmDQoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZi5sZWZ0ID0NCgkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmxlZnQgLQ0KCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMubGVmdCArDQoJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaSksICJ1c2luZyIgaW4NCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdCA/DQoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQudXNpbmcuY2FsbChlLCBmKSA6DQoJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMuY3NzKGYpOw0KCQkJfQ0KCQl9LCBTLmZuLmV4dGVuZCh7DQoJCQlvZmZzZXQ6IGZ1bmN0aW9uKHQpIHsNCgkJCQlpZihhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdm9pZCAwID09PSB0ID8gdGhpcyA6IHRoaXMuZWFjaChmdW5jdGlvbihlKSB7Uy5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsIHQsIGUpO30pOw0KCQkJCXZhciBlLCBuLCByID0gdGhpc1swXTsNCgkJCQlyZXR1cm4gciA/IHIuZ2V0Q2xpZW50UmVjdHMoKS5sZW5ndGggPyAoZSA9IHIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksIG4gPSByLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcsIHt0b3A6IGUudG9wICsgbi5wYWdlWU9mZnNldCwgbGVmdDogZS5sZWZ0ICsgbi5wYWdlWE9mZnNldH0pIDogew0KCQkJCQl0b3A6IDAsDQoJCQkJCWxlZnQ6IDANCgkJCQl9IDogdm9pZCAwOw0KCQkJfSwgcG9zaXRpb246IGZ1bmN0aW9uKCkgew0KCQkJCWlmKHRoaXNbMF0pIHsNCgkJCQkJdmFyIGUsIHQsIG4sIHIgPSB0aGlzWzBdLCBpID0ge3RvcDogMCwgbGVmdDogMH07DQoJCQkJCWlmKCJmaXhlZCIgPT09IFMuY3NzKHIsICJwb3NpdGlvbiIpKSB7DQoJCQkJCQl0ID0gci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXQgPSB0aGlzLm9mZnNldCgpLCBuID0gci5vd25lckRvY3VtZW50LCBlID0gci5vZmZzZXRQYXJlbnQgfHwgbi5kb2N1bWVudEVsZW1lbnQ7DQoJCQkJCQl3aGlsZShlICYmIChlID09PSBuLmJvZHkgfHwgZSA9PT0gbi5kb2N1bWVudEVsZW1lbnQpICYmICJzdGF0aWMiID09PSBTLmNzcyhlLCAicG9zaXRpb24iKSkgZSA9IGUucGFyZW50Tm9kZTsNCgkJCQkJCWUgJiYgZSAhPT0gciAmJiAxID09PSBlLm5vZGVUeXBlICYmICgoaSA9IFMoZSkub2Zmc2V0KCkpLnRvcCArPSBTLmNzcyhlLCAiYm9yZGVyVG9wV2lkdGgiLCAhMCksIGkubGVmdCArPSBTLmNzcyhlLCAiYm9yZGVyTGVmdFdpZHRoIiwgITApKTsNCgkJCQkJfQ0KCQkJCQlyZXR1cm4ge3RvcDogdC50b3AgLSBpLnRvcCAtIFMuY3NzKHIsICJtYXJnaW5Ub3AiLCAhMCksIGxlZnQ6IHQubGVmdCAtIGkubGVmdCAtIFMuY3NzKHIsICJtYXJnaW5MZWZ0IiwgITApfTsNCgkJCQl9DQoJCQl9LCBvZmZzZXRQYXJlbnQ6IGZ1bmN0aW9uKCkgew0KCQkJCXJldHVybiB0aGlzLm1hcChmdW5jdGlvbigpIHsNCgkJCQkJdmFyIGUgPSB0aGlzLm9mZnNldFBhcmVudDsNCgkJCQkJd2hpbGUoZSAmJiAic3RhdGljIiA9PT0gUy5jc3MoZSwgInBvc2l0aW9uIikpIGUgPSBlLm9mZnNldFBhcmVudDsNCgkJCQkJcmV0dXJuIGUgfHwgcmU7DQoJCQkJfSk7DQoJCQl9DQoJCX0pLCBTLmVhY2goe3Njcm9sbExlZnQ6ICJwYWdlWE9mZnNldCIsIHNjcm9sbFRvcDogInBhZ2VZT2Zmc2V0In0sIGZ1bmN0aW9uKHQsIGkpIHsNCgkJCXZhciBvID0gInBhZ2VZT2Zmc2V0IiA9PT0gaTsNCgkJCVMuZm5bdF0gPSBmdW5jdGlvbihlKSB7DQoJCQkJcmV0dXJuIEIodGhpcywgZnVuY3Rpb24oZSwgdCwgbikgew0KCQkJCQl2YXIgcjsNCgkJCQkJaWYoeChlKSA/IHIgPSBlIDogOSA9PT0gZS5ub2RlVHlwZSAmJiAociA9IGUuZGVmYXVsdFZpZXcpLCB2b2lkIDAgPT09IG4pIHJldHVybiByID8gcltpXSA6IGVbdF07DQoJCQkJCXIgPyByLnNjcm9sbFRvKG8gPyByLnBhZ2VYT2Zmc2V0IDogbiwgbyA/IG4gOiByLnBhZ2VZT2Zmc2V0KSA6IGVbdF0gPSBuOw0KCQkJCX0sIHQsIGUsIGFyZ3VtZW50cy5sZW5ndGgpOw0KCQkJfTsNCgkJfSksIFMuZWFjaChbInRvcCIsICJsZWZ0Il0sIGZ1bmN0aW9uKGUsIG4pIHsNCgkJCVMuY3NzSG9va3Nbbl0gPSBfZSh2LnBpeGVsUG9zaXRpb24sIGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQlpZih0KSB7DQoJCQkJCXJldHVybiB0ID0gQmUoZSwgbiksIFBlLnRlc3QodCkgPyBTKGUpDQoJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnBvc2l0aW9uKClbbl0gKyAicHgiIDogdDsNCgkJCQl9DQoJCQl9KTsNCgkJfSksIFMuZWFjaCh7SGVpZ2h0OiAiaGVpZ2h0IiwgV2lkdGg6ICJ3aWR0aCJ9LCBmdW5jdGlvbihhLCBzKSB7DQoJCQlTLmVhY2goew0KCQkJCXBhZGRpbmc6ICJpbm5lciIgKyBhLA0KCQkJCWNvbnRlbnQ6IHMsDQoJCQkJIiI6ICJvdXRlciIgKyBhDQoJCQl9LCBmdW5jdGlvbihyLCBvKSB7DQoJCQkJUy5mbltvXSA9IGZ1bmN0aW9uKGUsIHQpIHsNCgkJCQkJdmFyIG4gPSBhcmd1bWVudHMubGVuZ3RoICYmIChyIHx8ICJib29sZWFuIiAhPSB0eXBlb2YgZSksIGkgPSByIHx8ICghMCA9PT0gZSB8fCAhMCA9PT0gdCA/ICJtYXJnaW4iIDogImJvcmRlciIpOw0KCQkJCQlyZXR1cm4gQih0aGlzLCBmdW5jdGlvbihlLCB0LCBuKSB7DQoJCQkJCQl2YXIgcjsNCgkJCQkJCXJldHVybiB4KGUpID8NCgkJCQkJCSAgICAgICAwID09PSBvLmluZGV4T2YoIm91dGVyIikgPyBlWyJpbm5lciIgKyBhXSA6IGUuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50WyJjbGllbnQiICsgYV0gOg0KCQkJCQkJICAgICAgIDkgPT09IGUubm9kZVR5cGUgPyAociA9IGUuZG9jdW1lbnRFbGVtZW50LCBNYXRoLm1heChlLmJvZHlbInNjcm9sbCIgKyBhXSwgclsic2Nyb2xsIiArIGFdLCBlLmJvZHlbIm9mZnNldCIgKyBhXSwgclsib2Zmc2V0IiArIGFdLCByWyJjbGllbnQiICsgYV0pKSA6IHZvaWQgMCA9PT0gbiA/IFMuY3NzKGUsIHQsIGkpIDogUy5zdHlsZShlLCB0LCBuLCBpKTsNCgkJCQkJfSwgcywgbiA/IGUgOiB2b2lkIDAsIG4pOw0KCQkJCX07DQoJCQl9KTsNCgkJfSksIFMuZWFjaChbImFqYXhTdGFydCIsDQoJCSAgICAgICAgICAgICJhamF4U3RvcCIsDQoJCSAgICAgICAgICAgICJhamF4Q29tcGxldGUiLA0KCQkgICAgICAgICAgICAiYWpheEVycm9yIiwNCgkJICAgICAgICAgICAgImFqYXhTdWNjZXNzIiwNCgkJICAgICAgICAgICAgImFqYXhTZW5kIl0sIGZ1bmN0aW9uKGUsIHQpIHtTLmZuW3RdID0gZnVuY3Rpb24oZSkge3JldHVybiB0aGlzLm9uKHQsIGUpO307fSksIFMuZm4uZXh0ZW5kKHsNCgkJCWJpbmQ6IGZ1bmN0aW9uKGUsIHQsIG4pIHtyZXR1cm4gdGhpcy5vbihlLCBudWxsLCB0LCBuKTt9LA0KCQkJdW5iaW5kOiBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIHRoaXMub2ZmKGUsIG51bGwsIHQpO30sDQoJCQlkZWxlZ2F0ZTogZnVuY3Rpb24oZSwgdCwgbiwgcikge3JldHVybiB0aGlzLm9uKHQsIGUsIG4sIHIpO30sDQoJCQl1bmRlbGVnYXRlOiBmdW5jdGlvbihlLCB0LCBuKSB7cmV0dXJuIDEgPT09IGFyZ3VtZW50cy5sZW5ndGggPyB0aGlzLm9mZihlLCAiKioiKSA6IHRoaXMub2ZmKHQsIGUgfHwgIioqIiwgbik7fSwNCgkJCWhvdmVyOiBmdW5jdGlvbihlLCB0KSB7cmV0dXJuIHRoaXMubW91c2VlbnRlcihlKS5tb3VzZWxlYXZlKHQgfHwgZSk7fQ0KCQl9KSwgUy5lYWNoKCJibHVyIGZvY3VzIGZvY3VzaW4gZm9jdXNvdXQgcmVzaXplIHNjcm9sbCBjbGljayBkYmxjbGljayBtb3VzZWRvd24gbW91c2V1cCBtb3VzZW1vdmUgbW91c2VvdmVyIG1vdXNlb3V0IG1vdXNlZW50ZXIgbW91c2VsZWF2ZSBjaGFuZ2Ugc2VsZWN0IHN1Ym1pdCBrZXlkb3duIGtleXByZXNzIGtleXVwIGNvbnRleHRtZW51Ii5zcGxpdCgiICIpLCBmdW5jdGlvbihlLCBuKSB7DQoJCQlTLmZuW25dID0NCgkJCQlmdW5jdGlvbihlLCB0KSB7cmV0dXJuIDAgPCBhcmd1bWVudHMubGVuZ3RoID8gdGhpcy5vbihuLCBudWxsLCBlLCB0KSA6IHRoaXMudHJpZ2dlcihuKTt9Ow0KCQl9KTsNCgkJdmFyIEd0ID0gL15bXHNcdUZFRkZceEEwXSt8KFteXHNcdUZFRkZceEEwXSlbXHNcdUZFRkZceEEwXSskL2c7DQoJCVMucHJveHkgPSBmdW5jdGlvbihlLCB0KSB7DQoJCQl2YXIgbiwgciwgaTsNCgkJCWlmKCJzdHJpbmciID09IHR5cGVvZiB0ICYmIChuID0gZVt0XSwgdCA9IGUsIGUgPSBuKSwgbShlKSkgcmV0dXJuIHIgPSBzLmNhbGwoYXJndW1lbnRzLCAyKSwgKGkgPSBmdW5jdGlvbigpIHtyZXR1cm4gZS5hcHBseSh0IHx8IHRoaXMsIHIuY29uY2F0KHMuY2FsbChhcmd1bWVudHMpKSk7fSkuZ3VpZCA9IGUuZ3VpZCA9IGUuZ3VpZCB8fCBTLmd1aWQrKywgaTsNCgkJfSwgUy5ob2xkUmVhZHkgPSBmdW5jdGlvbihlKSB7ZSA/IFMucmVhZHlXYWl0KysgOiBTLnJlYWR5KCEwKTt9LCBTLmlzQXJyYXkgPSBBcnJheS5pc0FycmF5LCBTLnBhcnNlSlNPTiA9IEpTT04ucGFyc2UsIFMubm9kZU5hbWUgPSBBLCBTLmlzRnVuY3Rpb24gPSBtLCBTLmlzV2luZG93ID0geCwgUy5jYW1lbENhc2UgPSBYLCBTLnR5cGUgPSB3LCBTLm5vdyA9IERhdGUubm93LCBTLmlzTnVtZXJpYyA9IGZ1bmN0aW9uKGUpIHsNCgkJCXZhciB0ID0gUy50eXBlKGUpOw0KCQkJcmV0dXJuICgibnVtYmVyIiA9PT0gdCB8fCAic3RyaW5nIiA9PT0gdCkgJiYgIWlzTmFOKGUgLSBwYXJzZUZsb2F0KGUpKTsNCgkJfSwgUy50cmltID0gZnVuY3Rpb24oZSkge3JldHVybiBudWxsID09IGUgPyAiIiA6IChlICsgIiIpLnJlcGxhY2UoR3QsICIkMSIpO30sICJmdW5jdGlvbiIgPT0gdHlwZW9mIGRlZmluZSAmJiBkZWZpbmUuYW1kICYmIGRlZmluZSgianF1ZXJ5IiwgW10sIGZ1bmN0aW9uKCkge3JldHVybiBTO30pOw0KCQl2YXIgWXQgPSBDLmpRdWVyeSwgUXQgPSBDLiQ7DQoJCXJldHVybiBTLm5vQ29uZmxpY3QgPSBmdW5jdGlvbihlKSB7cmV0dXJuIEMuJCA9PT0gUyAmJiAoQy4kID0gUXQpLCBlICYmIEMualF1ZXJ5ID09PSBTICYmIChDLmpRdWVyeSA9IFl0KSwgUzt9LCAidW5kZWZpbmVkIiA9PSB0eXBlb2YgZSAmJiAoQy5qUXVlcnkgPSBDLiQgPSBTKSwgUzsNCgl9KTsNCn0NCg0KY29uc3QgU1VLSUluc3RhbmNlcyA9IHsNCglpbnN0YW5jZXM6IHt9LCBvbkNoYW5nZUxpc3RlbmVyOiB7fSwgb25DcmVhdGVMaXN0ZW5lcjoge30sDQoNCgkvKioNCgkgKiBBZGQgYSBsb2FkZWQgPGI+U0dOVUlLaXQ8L2I+IGNvbXBvbmVudC4NCgkgKg0KCSAqIEBwYXJhbSB7e319IHZhbHVlIFRoZSA8Yj48aT5KU09OPC9pPjwvYj4gb2JqZWN0IG9mIHRoZSBsb2FkZWQgPGI+U0dOVUlLaXQ8L2I+IGNvbXBvbmVudC4NCgkgKi8NCglzZXQgaW5zdGFuY2UodmFsdWUpIHsNCgkJaWYodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gIiIpIHZhbHVlID0ge307DQoJCXB1c2godGhpcy5pbnN0YW5jZXMsIHZhbHVlKTsNCg0KCQlmb3JFYWNoKHRoaXMub25DaGFuZ2VMaXN0ZW5lciwgKGxpc3RlbmVyKSA9PiBsaXN0ZW5lcih2YWx1ZSwgdGhpcy5pbnN0YW5jZXMpKTsNCgl9LA0KDQoJLyoqDQoJICogR2V0IHRoZSBsaXN0IG9mIGxvYWRlZCA8Yj5TR05VSUtpdDwvYj4gY29tcG9uZW50cy4NCgkgKg0KCSAqIEByZXR1cm4ge29iamVjdH0gVGhlIDxiPjxpPkpTT048L2k+PC9iPiBvYmplY3Qgb2YgbG9hZGVkIDxiPlNHTlVJS2l0PC9iPiBjb21wb25lbnRzLCBvciBhbiBlbXB0eSA8Yj48aT5KU09OPC9pPjwvYj4gb2JqZWN0IGlmIG5vIGNvbXBvbmVudHMgbG9hZGVkLg0KCSAqLw0KCWdldCBpbnN0YW5jZSgpIHsNCgkJcmV0dXJuIHRoaXMuaW5zdGFuY2VzOw0KCX0sIC8qKg0KCSAqIFNldCB0aGUgaGFuZGxlciBmb3IgPGI+U0dOVUlLaXQ8L2I+IDxiPjxpPk9uQ2hhbmdlPC9pPjwvYj4gZXZlbnQsIHdoaWNoIHdpbGwgYmUgdHJpZ2dlcmVkIHdoZW4gYSBjb21wb25lbnQgaXMgbG9hZGVkL3JlbW92ZWQgb3IgdGhlIHN0YXR1cyBvZiByZWFkaW5lc3MgaXMgY2hhbmdlZC4NCgkgKg0KCSAqIEBwYXJhbSB7KG5ld0luc3RhbmNlOnt9LCBpbnN0YW5jZXM6e30pPT52b2lkfWxpc3RlbmVyDQoJICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfVtpZD11bmRlZmluZWRdDQoJICovDQoJc2V0T25DaGFuZ2VMaXN0ZW5lcjogZnVuY3Rpb24obGlzdGVuZXIsIGlkKSB7DQoJCWlmKHR5cGVvZiBpZCAhPT0gInN0cmluZyIgfHwgJC5pc051bWVyaWMoaWQpKSB0aGlzLm9uQ2hhbmdlTGlzdGVuZXJbaWRdID0gbGlzdGVuZXI7IGVsc2UgcHVzaCh0aGlzLm9uQ2hhbmdlTGlzdGVuZXIsIGxpc3RlbmVyKTsNCg0KCQlmb3JFYWNoKHRoaXMub25DaGFuZ2VMaXN0ZW5lciwgKGxpc3RlbmVyKSA9PiBsaXN0ZW5lcigiIiwgdGhpcy5pbnN0YW5jZXMpKTsNCgl9LA0KDQoJLyoqDQoJICogU2V0IHRoZSBoYW5kbGVyIGZvciA8Yj5TR05VSUtpdDwvYj4gPGI+PGk+T25DaGFuZ2U8L2k+PC9iPiBldmVudCwgd2hpY2ggd2lsbCBiZSB0cmlnZ2VyZWQgd2hlbiBhIGNvbXBvbmVudCBpcyBsb2FkZWQvcmVtb3ZlZCBvciB0aGUgc3RhdHVzIG9mIHJlYWRpbmVzcyBpcyBjaGFuZ2VkLg0KCSAqDQoJICogQHBhcmFtIHsobmV3SW5zdGFuY2U6e30sIGluc3RhbmNlczp7fSk9PnZvaWR9bGlzdGVuZXINCgkgKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ9W2lkPXVuZGVmaW5lZF0NCgkgKi8NCglzZXRPbkNyZWF0ZUxpc3RlbmVyOiBmdW5jdGlvbihsaXN0ZW5lciwgaWQpIHsNCgkJaWYodHlwZW9mIGlkICE9PSAic3RyaW5nIiB8fCAkLmlzTnVtZXJpYyhpZCkpIHRoaXMub25DcmVhdGVMaXN0ZW5lcltpZF0gPSBsaXN0ZW5lcjsgZWxzZSBwdXNoKHRoaXMub25DcmVhdGVMaXN0ZW5lciwgbGlzdGVuZXIpOw0KDQoJCVNHTlVJS2l0LnNldE9uUmVhZHlMaXN0ZW5lcigoKSA9PiBmb3JFYWNoKHRoaXMub25DcmVhdGVMaXN0ZW5lciwgKGxpc3RlbmVyKSA9PiBsaXN0ZW5lcih0aGlzLmluc3RhbmNlcykpLCAic2duLXVrci1jcmVhdGUtbGlzdGVuZXIiKTsNCgl9LA0KfTsNCmNvbnN0IFNVS1JJbnN0YW5jZXMgPSB7DQoJaW5zdGFuY2VzOiB7fSwgb25DaGFuZ2VMaXN0ZW5lcjoge30sIG9uQ3JlYXRlTGlzdGVuZXI6IHt9LA0KDQoJLyoqDQoJICogQWRkIGEgbG9hZGVkIDxiPlNHTlVJS2l0PC9iPiBjb21wb25lbnQuDQoJICoNCgkgKiBAcGFyYW0ge3t9fSB2YWx1ZSBUaGUgPGI+PGk+SlNPTjwvaT48L2I+IG9iamVjdCBvZiB0aGUgbG9hZGVkIDxiPlNHTlVJS2l0PC9iPiBjb21wb25lbnQuDQoJICovDQoJc2V0IGluc3RhbmNlKHZhbHVlKSB7DQoJCWlmKHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09ICIiKSB2YWx1ZSA9IHt9Ow0KCQlwdXNoKHRoaXMuaW5zdGFuY2VzLCB2YWx1ZSk7DQoNCgkJZm9yRWFjaCh0aGlzLm9uQ2hhbmdlTGlzdGVuZXIsIChsaXN0ZW5lcikgPT4gbGlzdGVuZXIodmFsdWUsIHRoaXMuaW5zdGFuY2VzKSk7DQoJfSwNCg0KCS8qKg0KCSAqIEdldCB0aGUgbGlzdCBvZiBsb2FkZWQgPGI+U0dOVUlLaXQ8L2I+IGNvbXBvbmVudHMuDQoJICoNCgkgKiBAcmV0dXJuIHtvYmplY3R9IFRoZSA8Yj48aT5KU09OPC9pPjwvYj4gb2JqZWN0IG9mIGxvYWRlZCA8Yj5TR05VSUtpdDwvYj4gY29tcG9uZW50cywgb3IgYW4gZW1wdHkgPGI+PGk+SlNPTjwvaT48L2I+IG9iamVjdCBpZiBubyBjb21wb25lbnRzIGxvYWRlZC4NCgkgKi8NCglnZXQgaW5zdGFuY2UoKSB7DQoJCXJldHVybiB0aGlzLmluc3RhbmNlczsNCgl9LCAvKioNCgkgKiBTZXQgdGhlIGhhbmRsZXIgZm9yIDxiPlNHTlVJS2l0PC9iPiA8Yj48aT5PbkNoYW5nZTwvaT48L2I+IGV2ZW50LCB3aGljaCB3aWxsIGJlIHRyaWdnZXJlZCB3aGVuIGEgY29tcG9uZW50IGlzIGxvYWRlZC9yZW1vdmVkIG9yIHRoZSBzdGF0dXMgb2YgcmVhZGluZXNzIGlzIGNoYW5nZWQuDQoJICoNCgkgKiBAcGFyYW0geyhuZXdJbnN0YW5jZTp7fSwgaW5zdGFuY2VzOnt9KT0+dm9pZH1saXN0ZW5lcg0KCSAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn1baWQ9dW5kZWZpbmVkXQ0KCSAqLw0KCXNldE9uQ2hhbmdlTGlzdGVuZXI6IGZ1bmN0aW9uKGxpc3RlbmVyLCBpZCkgew0KCQlpZih0eXBlb2YgaWQgIT09ICJzdHJpbmciIHx8ICQuaXNOdW1lcmljKGlkKSkgdGhpcy5vbkNoYW5nZUxpc3RlbmVyW2lkXSA9IGxpc3RlbmVyOyBlbHNlIHB1c2godGhpcy5vbkNoYW5nZUxpc3RlbmVyLCBsaXN0ZW5lcik7DQoNCgkJZm9yRWFjaCh0aGlzLm9uQ2hhbmdlTGlzdGVuZXIsIChsaXN0ZW5lcikgPT4gbGlzdGVuZXIoIiIsIHRoaXMuaW5zdGFuY2VzKSk7DQoJfSwNCg0KCS8qKg0KCSAqIFNldCB0aGUgaGFuZGxlciBmb3IgPGI+U0dOVUlLaXQ8L2I+IDxiPjxpPk9uQ2hhbmdlPC9pPjwvYj4gZXZlbnQsIHdoaWNoIHdpbGwgYmUgdHJpZ2dlcmVkIHdoZW4gYSBjb21wb25lbnQgaXMgbG9hZGVkL3JlbW92ZWQgb3IgdGhlIHN0YXR1cyBvZiByZWFkaW5lc3MgaXMgY2hhbmdlZC4NCgkgKg0KCSAqIEBwYXJhbSB7KG5ld0luc3RhbmNlOnt9LCBpbnN0YW5jZXM6e30pPT52b2lkfWxpc3RlbmVyDQoJICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfVtpZD11bmRlZmluZWRdDQoJICovDQoJc2V0T25DcmVhdGVMaXN0ZW5lcjogZnVuY3Rpb24obGlzdGVuZXIsIGlkKSB7DQoJCWlmKHR5cGVvZiBpZCAhPT0gInN0cmluZyIgfHwgJC5pc051bWVyaWMoaWQpKSB0aGlzLm9uQ3JlYXRlTGlzdGVuZXJbaWRdID0gbGlzdGVuZXI7IGVsc2UgcHVzaCh0aGlzLm9uQ3JlYXRlTGlzdGVuZXIsIGxpc3RlbmVyKTsNCg0KCQlTR05VSUtpdC5zZXRPblJlYWR5TGlzdGVuZXIoKCkgPT4gZm9yRWFjaCh0aGlzLm9uQ3JlYXRlTGlzdGVuZXIsIChsaXN0ZW5lcikgPT4gbGlzdGVuZXIodGhpcy5pbnN0YW5jZXMpKSwgInNnbi11a3ItY3JlYXRlLWxpc3RlbmVyIik7DQoJfSwNCn07DQoNCi8qKioNCiAqIFNVS0kgKFNHTlVJS2l0IEluaXQpIGNhbGxiYWNrIGlzIHVzZWQgdG8gZGV0ZXJtaW5lIGlmIHRoZSBwYWdlIGlzIGxvYWRlZC4gSXQgY29tYmluZXMgaW50ZXJuYWwgPGI+U0dOVUlLaXQ8L2I+IGluaXQgZXZlbnRzIGFzIHdlbGwgYXMgalF1ZXJ5IGAkKGZ1bmN0aW9uKCl7fSlgIGNhbGxiYWNrLg0KICogPGJyPg0KICogPGI+Tk9URTo8L2I+IElmIDxiPjxpPlNHTkF0b208L2I+PC9pPiBpcyB1c2VkIHRoZW4sIHRoZSA8Yj48aT5TVUtJPC9iPjwvaT4gY2FsbGJhY2sgd2lsbCBiZSBjYWxsZWQgYWZ0ZXIgdGhlIDxiPjxpPkRPTTwvYj48L2k+IGlzIHJlYWR5IGFuZCB0aGUgPGk+cGFnZTwvaT4gaXMgbG9hZGVkIGFuZCByZWFkeSB0byBiZSBwcm9jZXNzZWQNCiAqIGJ5IDxiPjxpPlNHTkF0b208L2I+PC9pPiwgdXNlZnVsIGluIGNhc2VzIHdoZXJlIGFuIGV2ZW50IGlzIG5lZWQgdG8gYmUgYm91bmQgYmVmb3JlIHRoZSBldmVudHMgYm91bmQgYnkgPGI+PGk+U0dOQXRvbTwvYj48L2k+IG9yIHdoZW4gPGI+PGk+U0dOQXRvbTwvYj48L2k+IGV2ZW50cyBuZWVkIHRvIHByZXZlbnQgZnJvbSBiZWluZyBib3VuZC4NCiAqDQogKiBAcGFyYW0geyh2YWx1ZTpib29sZWFuKT0+dm9pZH0gY2FsbGJhY2sNCiAqLw0KY29uc3QgU1VLSSA9IChjYWxsYmFjaykgPT4gew0KCWNvbnN0IFNVS0lpbml0ID0gZnVuY3Rpb24oKSB7DQoJCWNvbnN0IHBsdWdpbiA9IHRoaXM7DQoJCXBsdWdpbi5vblJlYWR5TGlzdGVuZXIgPSB7fTsNCg0KCQljb25zdCBjYWxsZXJTdGFjayA9IGdldFN0YWNrKClbMF0sIGNhbGxlciA9IGAke2NhbGxlclN0YWNrLmZpbGUubmFtZX0uJHtjYWxsZXJTdGFjay5zaWduYXR1cmV9OiR7Y2FsbGVyU3RhY2subGluZX06JHtjYWxsZXJTdGFjay5jb2x1bW59YCB8fCBudWxsOw0KDQoJCWlmKGNhbGxlcikgcGx1Z2luLm9uUmVhZHlMaXN0ZW5lcltjYWxsZXJdID0gY2FsbGJhY2s7IGVsc2UgcHVzaChwbHVnaW4ub25SZWFkeUxpc3RlbmVyLCBjYWxsYmFjayk7DQoNCgkJcGx1Z2luLnRyaWdnZXIgPSAoKSA9PiB7DQoJCQlmb3JFYWNoKHBsdWdpbi5vblJlYWR5TGlzdGVuZXIsIChsaXN0ZW5lcikgPT4gbGlzdGVuZXIodHJ1ZSkpOw0KCQl9Ow0KCX07DQoNCgljb25zdCBnZXRTdGFjayA9IChzZWFyY2ggPSBudWxsKSA9PiB7DQoJCWNvbnN0IHJlZ2V4ID0gL14oPD8oXHcrKShcLihcdyspKT8+Pyk/ID8oW2EtekEtWjAtOSovPF0rKT8gP0A/KGh0dHBzPzpcL1wvW2EtelxkLV9dK1wuP1thLXpcZC1fXStbXlxzOiJdKyk6KFxkKyk6PyhcZCspPyQvOw0KCQljb25zdCBlcnJvcnMgPSBbXSwgc3RhY2sgPSAobmV3IEVycm9yKCkpLnN0YWNrOw0KDQoJCWZ1bmN0aW9uIGdldEZpbGVuYW1lQW5kRXh0ZW5zaW9uKHBhdGgpIHsNCgkJCWlmKHBhdGggIT09IHVuZGVmaW5lZCkgew0KCQkJCWNvbnN0IGZpbGVuYW1lZXh0ZW5zaW9uID0gcGF0aC5yZXBsYWNlKC9eLipbXFxcL10vLCAiIiksIGZpbGVuYW1lID0gZmlsZW5hbWVleHRlbnNpb24uc3Vic3RyaW5nKDAsIGZpbGVuYW1lZXh0ZW5zaW9uLmxhc3RJbmRleE9mKCIuIikpLCBleHQgPSBmaWxlbmFtZWV4dGVuc2lvbi5zcGxpdCgiLiIpLnBvcCgpOw0KDQoJCQkJcmV0dXJuIHsNCgkJCQkJIm5hbWUiOiBmaWxlbmFtZSwgImV4dCI6IGV4dA0KCQkJCX07DQoJCQl9DQoJCQlyZXR1cm4gew0KCQkJCSJuYW1lIjogIiIsICJleHQiOiAiIg0KCQkJfTsNCgkJfQ0KDQoJCXN0YWNrLnNwbGl0KCJcbiIpLmZvckVhY2goKHYsIGkpID0+IHsNCgkJCWNvbnN0IG1hdGNoID0gdi5tYXRjaChyZWdleCk7DQoJCQlsZXQgdmFsOw0KCQkJaWYobWF0Y2ggIT09IG51bGwpIHsNCgkJCQlpZih2LnN0YXJ0c1dpdGgoIkAiKSkgew0KCQkJCQl2YWwgPSB7DQoJCQkJCQkic2lnbmF0dXJlIjogIjxhbm9ueW1vdXM+IiwNCgkJCQkJCSJjbGFzcyI6IG1hdGNoWzJdLA0KCQkJCQkJImZ1bmN0aW9uIjogIjxhbm9ueW1vdXM+IiwNCgkJCQkJCSJ1cmwiOiBtYXRjaFs2XSwNCgkJCQkJCSJsaW5lIjogbWF0Y2hbN10sDQoJCQkJCQkiY29sdW1uIjogbWF0Y2hbOF0sDQoJCQkJCQkic3RyIjogdiwNCgkJCQkJCSJmaWxlIjogZ2V0RmlsZW5hbWVBbmRFeHRlbnNpb24obWF0Y2hbNl0pLA0KCQkJCQl9Ow0KCQkJCX0gZWxzZSB7DQoJCQkJCXZhbCA9IHsNCgkJCQkJCSJzaWduYXR1cmUiOiBtYXRjaFsxXSwgImNsYXNzIjogbWF0Y2hbMl0sICJmdW5jdGlvbiI6IG1hdGNoWzRdLCAidXJsIjogbWF0Y2hbNl0sICJsaW5lIjogbWF0Y2hbN10sICJjb2x1bW4iOiBtYXRjaFs4XSwgInN0ciI6IHYsICJmaWxlIjogZ2V0RmlsZW5hbWVBbmRFeHRlbnNpb24obWF0Y2hbNl0pLA0KCQkJCQl9Ow0KCQkJCX0NCgkJCX0NCgkJCWlmKHNlYXJjaCAhPT0gdW5kZWZpbmVkICYmIHNlYXJjaCAhPT0gbnVsbCkgew0KCQkJCWlmKHYuaW5kZXhPZihzZWFyY2gpICE9PSAtMSkgZXJyb3JzLnB1c2godmFsKTsNCgkJCX0gZWxzZSB7DQoJCQkJaWYodmFsICE9PSB1bmRlZmluZWQgJiYgdmFsICE9PSAiIiAmJiB2YWwuc2lnbmF0dXJlICE9PSAiZ2V0U3RhY2siICYmIHZhbC5zaWduYXR1cmUgIT09ICJTVUtSaW5pdCIgJiYgdmFsLnNpZ25hdHVyZSAhPT0gIlNVS1IiICYmIHZhbC5zaWduYXR1cmUgIT09ICJ3aW5kb3cuU1VLUiIpIGVycm9ycy5wdXNoKHZhbCk7DQoJCQl9DQoJCX0pOw0KCQlpZihzZWFyY2ggIT09IHVuZGVmaW5lZCAmJiBzZWFyY2ggIT09IG51bGwpIHJldHVybiAoZXJyb3JzLmxlbmd0aCA+IDApID8gZXJyb3JzWzBdIDogbnVsbDsgZWxzZSByZXR1cm4gZXJyb3JzOw0KCX07DQoNCglTVUtJSW5zdGFuY2VzLmluc3RhbmNlID0gbmV3IFNVS0lpbml0KCk7DQp9Ow0KDQovKioqDQogKiBTVUtSIChTR05VSUtpdCBSZWFkeSkgY2FsbGJhY2sgaXMgdXNlZCB0byBkZXRlcm1pbmUgaWYgdGhlIHBhZ2UgaXMgbG9hZGVkIGFuZCByZWFkeSB0byB1c2UuIEl0IGNvbWJpbmVzIGludGVybmFsIDxiPlNHTlVJS2l0PC9iPiByZWFkeSBldmVudHMgYXMgd2VsbCBhcyBqUXVlcnkgYCQoZnVuY3Rpb24oKXt9KWAgY2FsbGJhY2suDQogKiA8YnI+DQogKiA8Yj5OT1RFOjwvYj4gSWYgPGI+PGk+U0dOQXRvbTwvYj48L2k+IGlzIHVzZWQgdGhlbiwgdGhlIDxiPjxpPlNVS1I8L2I+PC9pPiBjYWxsYmFjayB3aWxsIGJlIGNhbGxlZCBhZnRlciB0aGUgPGI+PGk+RE9NPC9iPjwvaT4gaXMgcmVhZHkgYW5kIHRoZSA8aT5wYWdlPC9pPiBpcyBsb2FkZWQgYW5kIHByb2Nlc3NlZCBieSA8Yj48aT5TR05BdG9tPC9iPjwvaT4uDQogKg0KICogQHBhcmFtIHsodmFsdWU6Ym9vbGVhbik9PnZvaWR9IGNhbGxiYWNrDQogKi8NCmNvbnN0IFNVS1IgPSAoY2FsbGJhY2spID0+IHsNCgljb25zdCBTVUtSaW5pdCA9IGZ1bmN0aW9uKCkgew0KCQljb25zdCBwbHVnaW4gPSB0aGlzOw0KCQlwbHVnaW4ub25SZWFkeUxpc3RlbmVyID0ge307DQoNCgkJY29uc3QgY2FsbGVyU3RhY2sgPSBnZXRTdGFjaygpWzBdLCBjYWxsZXIgPSBgJHtjYWxsZXJTdGFjay5maWxlLm5hbWV9LiR7Y2FsbGVyU3RhY2suc2lnbmF0dXJlfToke2NhbGxlclN0YWNrLmxpbmV9OiR7Y2FsbGVyU3RhY2suY29sdW1ufWAgfHwgbnVsbDsNCg0KCQlpZihjYWxsZXIpIHBsdWdpbi5vblJlYWR5TGlzdGVuZXJbY2FsbGVyXSA9IGNhbGxiYWNrOyBlbHNlIHB1c2gocGx1Z2luLm9uUmVhZHlMaXN0ZW5lciwgY2FsbGJhY2spOw0KDQoJCXBsdWdpbi50cmlnZ2VyID0gKCkgPT4gew0KCQkJZm9yRWFjaChwbHVnaW4ub25SZWFkeUxpc3RlbmVyLCAobGlzdGVuZXIpID0+IGxpc3RlbmVyKHRydWUpKTsNCgkJfTsNCgl9Ow0KDQoJY29uc3QgZ2V0U3RhY2sgPSAoc2VhcmNoID0gbnVsbCkgPT4gew0KCQljb25zdCByZWdleCA9IC9eKDw/KFx3KykoXC4oXHcrKSk/Pj8pPyA/KFthLXpBLVowLTkqLzxdKyk/ID9APyhodHRwcz86XC9cL1thLXpcZC1fXStcLj9bYS16XGQtX10rW15cczoiXSspOihcZCspOj8oXGQrKT8kLzsNCgkJY29uc3QgZXJyb3JzID0gW10sIHN0YWNrID0gKG5ldyBFcnJvcigpKS5zdGFjazsNCg0KCQlmdW5jdGlvbiBnZXRGaWxlbmFtZUFuZEV4dGVuc2lvbihwYXRoKSB7DQoJCQlpZihwYXRoICE9PSB1bmRlZmluZWQpIHsNCgkJCQljb25zdCBmaWxlbmFtZWV4dGVuc2lvbiA9IHBhdGgucmVwbGFjZSgvXi4qW1xcXC9dLywgIiIpLCBmaWxlbmFtZSA9IGZpbGVuYW1lZXh0ZW5zaW9uLnN1YnN0cmluZygwLCBmaWxlbmFtZWV4dGVuc2lvbi5sYXN0SW5kZXhPZigiLiIpKSwgZXh0ID0gZmlsZW5hbWVleHRlbnNpb24uc3BsaXQoIi4iKS5wb3AoKTsNCg0KCQkJCXJldHVybiB7DQoJCQkJCSJuYW1lIjogZmlsZW5hbWUsICJleHQiOiBleHQNCgkJCQl9Ow0KCQkJfQ0KCQkJcmV0dXJuIHsNCgkJCQkibmFtZSI6ICIiLCAiZXh0IjogIiINCgkJCX07DQoJCX0NCg0KCQlzdGFjay5zcGxpdCgiXG4iKS5mb3JFYWNoKCh2LCBpKSA9PiB7DQoJCQljb25zdCBtYXRjaCA9IHYubWF0Y2gocmVnZXgpOw0KCQkJbGV0IHZhbDsNCgkJCWlmKG1hdGNoICE9PSBudWxsKSB7DQoJCQkJaWYodi5zdGFydHNXaXRoKCJAIikpIHsNCgkJCQkJdmFsID0gew0KCQkJCQkJInNpZ25hdHVyZSI6ICI8YW5vbnltb3VzPiIsDQoJCQkJCQkiY2xhc3MiOiBtYXRjaFsyXSwNCgkJCQkJCSJmdW5jdGlvbiI6ICI8YW5vbnltb3VzPiIsDQoJCQkJCQkidXJsIjogbWF0Y2hbNl0sDQoJCQkJCQkibGluZSI6IG1hdGNoWzddLA0KCQkJCQkJImNvbHVtbiI6IG1hdGNoWzhdLA0KCQkJCQkJInN0ciI6IHYsDQoJCQkJCQkiZmlsZSI6IGdldEZpbGVuYW1lQW5kRXh0ZW5zaW9uKG1hdGNoWzZdKSwNCgkJCQkJfTsNCgkJCQl9IGVsc2Ugew0KCQkJCQl2YWwgPSB7DQoJCQkJCQkic2lnbmF0dXJlIjogbWF0Y2hbMV0sICJjbGFzcyI6IG1hdGNoWzJdLCAiZnVuY3Rpb24iOiBtYXRjaFs0XSwgInVybCI6IG1hdGNoWzZdLCAibGluZSI6IG1hdGNoWzddLCAiY29sdW1uIjogbWF0Y2hbOF0sICJzdHIiOiB2LCAiZmlsZSI6IGdldEZpbGVuYW1lQW5kRXh0ZW5zaW9uKG1hdGNoWzZdKSwNCgkJCQkJfTsNCgkJCQl9DQoJCQl9DQoJCQlpZihzZWFyY2ggIT09IHVuZGVmaW5lZCAmJiBzZWFyY2ggIT09IG51bGwpIHsNCgkJCQlpZih2LmluZGV4T2Yoc2VhcmNoKSAhPT0gLTEpIGVycm9ycy5wdXNoKHZhbCk7DQoJCQl9IGVsc2Ugew0KCQkJCWlmKHZhbCAhPT0gdW5kZWZpbmVkICYmIHZhbCAhPT0gIiIgJiYgdmFsLnNpZ25hdHVyZSAhPT0gImdldFN0YWNrIiAmJiB2YWwuc2lnbmF0dXJlICE9PSAiU1VLUmluaXQiICYmIHZhbC5zaWduYXR1cmUgIT09ICJTVUtSIiAmJiB2YWwuc2lnbmF0dXJlICE9PSAid2luZG93LlNVS1IiKSBlcnJvcnMucHVzaCh2YWwpOw0KCQkJfQ0KCQl9KTsNCgkJaWYoc2VhcmNoICE9PSB1bmRlZmluZWQgJiYgc2VhcmNoICE9PSBudWxsKSByZXR1cm4gKGVycm9ycy5sZW5ndGggPiAwKSA/IGVycm9yc1swXSA6IG51bGw7IGVsc2UgcmV0dXJuIGVycm9yczsNCgl9Ow0KDQoJU1VLUkluc3RhbmNlcy5pbnN0YW5jZSA9IG5ldyBTVUtSaW5pdCgpOw0KfTsNCnJvb3QuU1VLSSA9IFNVS0k7DQpyb290LlNVS1IgPSBTVUtSOw0KDQovKioNCiAqIEB0eXBlZGVmIHtPYmplY3R9IFNHTlVJS2l0Q29uZmlnDQogKg0KICogQHByb3BlcnR5IHtTR05VS0FQSUNvbmZpZ30gYXBpDQogKiBAcHJvcGVydHkge1NHTlVLR2VvQ29kaW5nQ29uZmlnfSBnZW9jb2RpbmcNCiAqLw0KLyoqDQogKiBAdHlwZWRlZiB7T2JqZWN0fSBTR05VS0FQSUNvbmZpZw0KICoNCiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbZ2VvbmFtZXM9dW5kZWZpbmVkXSBUaGUgdXNlcm5hbWUgb2YgR2VvTmFtZXMgQVBJICh0aGlzIHdpbGwgYmUgdXNlZCBmb3IgYXV0aGVudGljYXRlIGEgcmVxdWVzdCBvbiBHZW9OYW1lcyBBUEkpLg0KICovDQovKioNCiAqIEB0eXBlZGVmIHtPYmplY3R9IFNHTlVLR2VvQ29kaW5nQ29uZmlnDQogKg0KICogQHByb3BlcnR5IHsnb3NtJ3wnZ2VvbmFtZXMnfSBbZGVmYXVsdEFQST0nb3NtJ10gVGhlIGRlZmF1bHQgR2VvTG9jYXRpb24gQVBJIHRvIHVzZSBmb3IgR2VvQ29kaW5nLg0KICovDQoNCi8qKg0KICogQHBhcmFtIHtTR05VSUtpdENvbmZpZ30gY29uZmlnDQogKg0KICogQHJldHVybiB7U0dOVUtDb25maWdJbml0fQ0KICovDQpjb25zdCBTR05VS0NvbmZpZ0luaXQgPSBmdW5jdGlvbihjb25maWcpIHsNCgljb25zdCBwbHVnaW4gPSB0aGlzOw0KCWNvbnN0IF9kZWZhdWx0cyA9IHsNCgkJInVybHMiOiB7DQoJCQkiYXBpIjogew0KCQkJCSJnZW9uYW1lcyI6ICJodHRwczovL3NlY3VyZS5nZW9uYW1lcy5vcmcvIiwgIm9zbSI6ICJodHRwczovL25vbWluYXRpbS5vcGVuc3RyZWV0bWFwLm9yZy8iDQoJCQl9LA0KCQl9DQoJfTsNCglwbHVnaW4uY29uZmlnID0gew0KCQkiYXBpIjogew0KCQkJImdlb25hbWVzIjogdW5kZWZpbmVkIC8vdXNlcm5hbWUNCgkJfSwgImdlb2NvZGluZyI6IHsNCgkJCSJkZWZhdWx0QVBJIjogIm9zbSINCgkJfSwNCgkJImkxOG4iOiBudWxsDQoJfTsNCg0KCWNvbnN0IGluaXQgPSAoKSA9PiB7DQoJCXBsdWdpbi5jb25maWcgPSBPYmplY3QuYXNzaWduKHBsdWdpbi5jb25maWcsIGNvbmZpZyk7DQoJCXBsdWdpbi5jb25maWcgPSBPYmplY3QuYXNzaWduKHBsdWdpbi5jb25maWcsIF9kZWZhdWx0cyk7DQoJfTsNCg0KCWluaXQoKTsNCglyZXR1cm4gcGx1Z2luOw0KfTsNCg0KKChjYWxsYmFjaykgPT4gew0KCWNvbnN0IGN1cnJlbnRTY3JpcHQgPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0IHx8IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInNjcmlwdFtzcmMqPVwiU0dOVUlLaXQubG9hZGVyLmpzXCJdIik7DQoJY29uc3QgaWNvbkF0dHIgICAgICAgICAgICAgICAgICA9IGN1cnJlbnRTY3JpcHQuZ2V0QXR0cmlidXRlKCJzZ24tbG9hZGVyLWljb24iKSwNCgkgICAgICBwcm9ncmVzc1NpemVBdHRyICAgICAgICAgID0gY3VycmVudFNjcmlwdC5nZXRBdHRyaWJ1dGUoInNnbi1sb2FkZXItcHJvZ3Jlc3Mtc2l6ZSIpLA0KCSAgICAgIHByb2dyZXNzQ29sb3JmdWxBdHRyICAgICAgPSBjdXJyZW50U2NyaXB0LmdldEF0dHJpYnV0ZSgic2duLWxvYWRlci1wcm9ncmVzcy1jb2xvcmZ1bCIpLA0KCSAgICAgIGluZGV0ZXJtaW5hdGVQcm9ncmVzc0F0dHIgPSBjdXJyZW50U2NyaXB0LmdldEF0dHJpYnV0ZSgic2duLWxvYWRlci1wcm9ncmVzcy1pbmRldGVybWluYXRlIik7DQoJY29uc3QgcHJvZ3Jlc3NTaXplICAgICA9ICh0eXBlb2YgcHJvZ3Jlc3NTaXplQXR0ciA9PT0gJ251bWJlcicpID8gcHJvZ3Jlc3NDb2xvcmZ1bEF0dHIgOiAxMDAsDQoJICAgICAgY29sb3JmdWxQcm9ncmVzcyA9ICh0eXBlb2YgcHJvZ3Jlc3NDb2xvcmZ1bEF0dHIgPT09ICdib29sZWFuJykgPyBwcm9ncmVzc1NpemVBdHRyIDogZmFsc2U7DQoNCgljb25zdCBjb2xvckFuaW0gPSAoY29sb3JmdWxQcm9ncmVzcykgPyAnLCBjb2xvciA2cyBlYXNlLWluLW91dCBpbmZpbml0ZScgOiAnJzsNCg0KCWNvbnN0IGNzcyA9IGAvKg0KICogQ29weXJpZ2h0IChjKSAyMDIyIFNHTmV0d29ya3MuIEFsbCByaWdodHMgcmVzZXJ2ZWQuDQogKg0KICogVGhlIHNvZnR3YXJlIGlzIGFuIGV4Y2x1c2l2ZSBjb3B5cmlnaHQgb2YgIlNHTmV0d29ya3MiIGFuZCBpcyBwcm92aWRlZCBhcyBpcyBleGNsdXNpdmVseSB3aXRoIG9ubHkgIlVTQUdFIiBhY2Nlc3MuICJNb2RpZmljYXRpb24iLCAgIkFsdGVyYXRpb24iLCAiUmUtZGlzdHJpYnV0aW9uIiBpcyBjb21wbGV0ZWx5IHByb2hpYml0ZWQuDQogKiBWSU9MQVRJTkcgVEhFIEFCT1ZFIFRFUk1TIElTIEEgUFVOSVNIQUJMRSBPRkZFTlNFIFdISUNIIE1BWSBMRUFEIFRPIExFR0FMIENPTlNFUVVFTkNFUy4NCiAqLw0KDQouaGFzLXByZWxvYWRlciwNCi5oYXMtcHJlbG9hZGVyICogew0KXHQtLXNnbi1iYWNrZ3JvdW5kOiAjZmZmOw0KXHQtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aDogNnB4Ow0KXHQtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aDogNDRweDsNClx0LS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0OiAyMnB4Ow0KXHQtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW46IDFweDsNClx0LS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtcmFkaXVzOiA2cHg7DQpcdC0tc2duLXByZWxvYWRlci1wcm9ncmVzcy10cmFjay1jb2xvcjogcmdiYSgwLDAsMCwuMSk7DQpcdC0tc2duLXByZWxvYWRlci1wcm9ncmVzcy1jb2xvcjogcmdiYSg5MywgNDksIDE0NSwgMSk7DQpcdC0tc2duLXByZWxvYWRlci10ZXh0LWNvbG9yOiBoc2xhKDAsIDAlLCAwJSwgLjQpOw0KfQ0KDQpAbWVkaWEgYWxsIGFuZCAocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspIHsNClx0Lmhhcy1wcmVsb2FkZXIsDQpcdC5oYXMtcHJlbG9hZGVyICogew0KXHQtLXNnbi1iYWNrZ3JvdW5kOiAjMDAwOw0KXHQtLXNnbi1wcmVsb2FkZXItcHJvZ3Jlc3MtdHJhY2stY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsLjEpOw0KXHQtLXNnbi1wcmVsb2FkZXItdGV4dC1jb2xvcjogaHNsYSgwLCAwJSwgMTAwJSwgLjQpOw0KXHR9DQp9DQoNCmJvZHkgew0KXHRtYXJnaW46IDA7DQpcdGRpc3BsYXk6IG5vbmU7DQp9DQoNCi5oYXMtcHJlbG9hZGVyIHsNClx0b3ZlcmZsb3c6IGhpZGRlbiAhaW1wb3J0YW50Ow0KXGRpc3BsYXk6IGJsb2NrOw0KfQ0KDQouc2dudWstcHJlbG9hZGVyLnNwaW5uZXIsDQouc2dudWstcHJlbG9hZGVyLmluZGV0ZXJtaW5hdGUsDQouc2dudWstcHJlbG9hZGVyLmRldGVybWluYXRlIHsNClx0cGFkZGluZzogMDsNClx0d2lkdGg6IDEwMCU7DQpcdGhlaWdodDogMTAwJTsNClx0YmFja2dyb3VuZC1jb2xvcjogdmFyKC0tc2duLWJhY2tncm91bmQpOw0KXHRkaXNwbGF5OiBmbGV4Ow0KXHRqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNClx0YWxpZ24taXRlbXM6IGNlbnRlcjsNClx0cG9zaXRpb246IGFic29sdXRlOw0KXHR6LWluZGV4OiA5OTk5OTk7DQp9DQoNCi5zZ251ay1wcmVsb2FkZXIuaW5kZXRlcm1pbmF0ZSwNCi5zZ251ay1wcmVsb2FkZXIuZGV0ZXJtaW5hdGUgew0KXHQtLXNnbi1wcmVsb2FkZXItcHJvZ3Jlc3Mtc2l6ZTogJHtwcm9ncmVzc1NpemV9cHg7DQpcdC0tc2duLXByZWxvYWRlci1wcm9ncmVzcy1yYWRpdXM6IGNhbGMoKHZhcigtLXNnbi1wcmVsb2FkZXItcHJvZ3Jlc3Mtc2l6ZSkgLyAyKSAtIDJweCk7DQpcdC0tc2duLXByZWxvYWRlci1wcm9ncmVzcy1jaXJjdW1mZXJlbmNlOiBjYWxjKDIgKiAzLjE0ICogdmFyKC0tc2duLXByZWxvYWRlci1wcm9ncmVzcy1yYWRpdXMpKTsNCn0NCi5zZ251ay1wcmVsb2FkZXIuZGV0ZXJtaW5hdGUgPiAucHJlbG9hZGVyLA0KLnNnbnVrLXByZWxvYWRlci5pbmRldGVybWluYXRlID4gLnByZWxvYWRlciB7DQpcdGRpc3BsYXk6IGZsZXg7DQpcdGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQpcdGp1c3RpZnktY29udGVudDogY2VudGVyOw0KXHRhbGlnbi1pdGVtczogY2VudGVyOw0KXHRjb2xvcjogdmFyKC0tc2duLXByZWxvYWRlci10ZXh0LWNvbG9yKTsNCn0NCg0KLnNnbnVrLXByZWxvYWRlciA+IC5wcmVsb2FkZXIgPiAuc2duLWxvYWRlci1wcm9ncmVzcy1pbmZvIHsNClx0ZGlzcGxheTogZmxleDsNClx0ZmxleC13cmFwOiB3cmFwOw0KXHRhbGlnbi1pdGVtczogY2VudGVyOw0KXHRqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNClx0Z2FwOiAuM3JlbTsNClx0bWFyZ2luLXRvcDogMXJlbTsNCn0NCg0KLnNnbnVrLXByZWxvYWRlciA+IC5wcmVsb2FkZXIgPiAuc2duLWxvYWRlci1wcm9ncmVzcy1pbmZvID4gLm5hbWUgew0KXHRmb250LXdlaWdodDogYm9sZDsNCn0NCg0KLnNnbnVrLXByZWxvYWRlciA+IC5wcmVsb2FkZXIgPiAuc2duLWxvYWRlci1wcm9ncmVzcy1pbmZvID4gLnByb2dyZXNzIHsNClx0ZGlzcGxheTogZmxleDsNClx0anVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQpcdGFsaWduLWl0ZW1zOiBjZW50ZXI7DQpcdGdhcDogLjJyZW07DQpcdGJhY2tncm91bmQtY29sb3I6IGluaGVyaXQ7DQp9DQoNCi5zZ251ay1wcmVsb2FkZXIgPiAucHJlbG9hZGVyID4gLnNnbi1sb2FkZXItcHJvZ3Jlc3MtaW5mbyA+IC5wcm9ncmVzczpiZWZvcmUgew0KXHRjb250ZW50OiAnKCc7DQp9DQoNCi5zZ251ay1wcmVsb2FkZXIgPiAucHJlbG9hZGVyID4gLnNnbi1sb2FkZXItcHJvZ3Jlc3MtaW5mbyA+IC5wcm9ncmVzczphZnRlciB7DQpcdGNvbnRlbnQ6ICcpJzsNCn0NCg0KLnNnbnVrLXByZWxvYWRlci5kZXRlcm1pbmF0ZSA+IC5wcmVsb2FkZXIgPiBzdmcsDQouc2dudWstcHJlbG9hZGVyLmluZGV0ZXJtaW5hdGUgPiAucHJlbG9hZGVyID4gc3ZnIHsNClx0cG9zaXRpb246IHJlbGF0aXZlOw0KXHR3aWR0aDogdmFyKC0tc2duLXByZWxvYWRlci1wcm9ncmVzcy1zaXplKTsNClx0aGVpZ2h0OiB2YXIoLS1zZ24tcHJlbG9hZGVyLXByb2dyZXNzLXNpemUpOw0KXHRmb250LXNpemU6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1wcm9ncmVzcy1zaXplKSAvIDQpOw0KfQ0KDQouc2dudWstcHJlbG9hZGVyLmRldGVybWluYXRlID4gLnByZWxvYWRlciA+IHN2ZyB7DQpcdHRyYW5zZm9ybTogcm90YXRlKC05MGRlZyk7DQp9DQoNCi5zZ251ay1wcmVsb2FkZXIuZGV0ZXJtaW5hdGUgPiAucHJlbG9hZGVyID4gc3ZnID4gY2lyY2xlLA0KLnNnbnVrLXByZWxvYWRlci5pbmRldGVybWluYXRlID4gLnByZWxvYWRlciA+IHN2ZyA+IGNpcmNsZSB7DQpcdGZpbGw6IHRyYW5zcGFyZW50Ow0KXHRzdHJva2Utd2lkdGg6IDQ7DQpcdHN0cm9rZS1saW5lY2FwOiByb3VuZDsNClx0cjogdmFyKC0tc2duLXByZWxvYWRlci1wcm9ncmVzcy1yYWRpdXMpOw0KXHRjeDogY2FsYyh2YXIoLS1zZ24tcHJlbG9hZGVyLXByb2dyZXNzLXJhZGl1cykgKyAycHgpOw0KXHRjeTogY2FsYyh2YXIoLS1zZ24tcHJlbG9hZGVyLXByb2dyZXNzLXJhZGl1cykgKyAycHgpOw0KXHRzdHJva2UtZGFzaGFycmF5OiB2YXIoLS1zZ24tcHJlbG9hZGVyLXByb2dyZXNzLWNpcmN1bWZlcmVuY2UpOw0KfQ0KDQouc2dudWstcHJlbG9hZGVyLmRldGVybWluYXRlID4gLnByZWxvYWRlciA+IHN2ZyA+IGNpcmNsZTpmaXJzdC1vZi10eXBlLA0KLnNnbnVrLXByZWxvYWRlci5pbmRldGVybWluYXRlID4gLnByZWxvYWRlciA+IHN2ZyA+IGNpcmNsZTpmaXJzdC1vZi10eXBlIHsNClx0c3Ryb2tlOiB2YXIoLS1zZ24tcHJlbG9hZGVyLXByb2dyZXNzLXRyYWNrLWNvbG9yKTsNClx0c3Ryb2tlLWRhc2hvZmZzZXQ6IDA7DQp9DQoNCi5zZ251ay1wcmVsb2FkZXIuZGV0ZXJtaW5hdGUgPiAucHJlbG9hZGVyID4gc3ZnID4gY2lyY2xlOm50aC1jaGlsZCgzKSwNCi5zZ251ay1wcmVsb2FkZXIuaW5kZXRlcm1pbmF0ZSA+IC5wcmVsb2FkZXIgPiBzdmcgPiBjaXJjbGU6bnRoLWNoaWxkKDMpIHsNClx0c3Ryb2tlOiB2YXIoLS1zZ24tcHJlbG9hZGVyLXByb2dyZXNzLWNvbG9yKTsNCn0NCg0KLnNnbnVrLXByZWxvYWRlci5kZXRlcm1pbmF0ZSA+IC5wcmVsb2FkZXIgPiBzdmcgPiB0ZXh0LA0KLnNnbnVrLXByZWxvYWRlci5pbmRldGVybWluYXRlID4gLnByZWxvYWRlciA+IHN2ZyA+IHRleHQgew0KXHR0cmFuc2Zvcm06IHJvdGF0ZSg5MGRlZyk7DQpcdGZvbnQtd2VpZ2h0OiBib2xkOw0KXHR0ZXh0LWFuY2hvcjogbWlkZGxlOw0KXHRkb21pbmFudC1iYXNlbGluZTogY2VudHJhbDsNClx0ZmlsbDogdmFyKC0tc2duLXByZWxvYWRlci10ZXh0LWNvbG9yKTsNClx0dHJhbnNpdGlvbjogb3BhY2l0eSAuNXMgbGluZWFyOw0KfQ0KDQouc2dudWstcHJlbG9hZGVyLmRldGVybWluYXRlID4gLnByZWxvYWRlciA+IHN2ZyA+IHRleHQ6Zmlyc3QtY2hpbGQsDQouc2dudWstcHJlbG9hZGVyLmRldGVybWluYXRlID4gLnByZWxvYWRlciA+IHN2ZyA+IHRleHQ6bGFzdC1jaGlsZCB7DQpcdGZvbnQtc2l6ZTogY2FsYyh2YXIoLS1zZ24tcHJlbG9hZGVyLXByb2dyZXNzLXNpemUpIC8gNyk7DQpcdG9wYWNpdHk6IC42Ow0KfQ0KDQouc2dudWstcHJlbG9hZGVyLmluZGV0ZXJtaW5hdGUgPiAucHJlbG9hZGVyID4gc3ZnIHsNClx0YW5pbWF0aW9uOiBkZXRlcm1pbmF0ZS1yb3RhdGUgMnMgbGluZWFyIGluZmluaXRlOw0KfQ0KDQouc2dudWstcHJlbG9hZGVyLmluZGV0ZXJtaW5hdGUgPiAucHJlbG9hZGVyID4gc3ZnID4gY2lyY2xlIHsNClx0c3Ryb2tlLW1pdGVybGltaXQ6IDEwOw0KfQ0KDQouc2dudWstcHJlbG9hZGVyLmluZGV0ZXJtaW5hdGUgPiAucHJlbG9hZGVyID4gc3ZnID4gY2lyY2xlOm50aC1jaGlsZCgzKSB7DQpcdHN0cm9rZS1kYXNoYXJyYXk6IDEsIHZhcigtLXNnbi1wcmVsb2FkZXItcHJvZ3Jlc3MtY2lyY3VtZmVyZW5jZSk7DQpcdHN0cm9rZS1kYXNob2Zmc2V0OiAwOw0KXHRhbmltYXRpb246IGRhc2ggMS41cyBlYXNlLWluLW91dCBpbmZpbml0ZSR7Y29sb3JBbmltfTsNCn0NCg0KLnNnbnVrLXByZWxvYWRlci5pbmRldGVybWluYXRlID4gLnByZWxvYWRlciA+IHN2ZyA+IHRleHQgew0KXHQvKmRpc3BsYXk6IG5vbmU7Ki8NClx0b3BhY2l0eTogMDsNCn0NCg0KQGtleWZyYW1lcyBkZXRlcm1pbmF0ZS1yb3RhdGUgew0KXHQxMDAlIHsNClx0XHR0cmFuc2Zvcm06IHJvdGF0ZSgzNjBkZWcpOw0KXHR9DQp9DQpAa2V5ZnJhbWVzIGRhc2ggew0KMCUgew0KXHRcdHN0cm9rZS1kYXNoYXJyYXk6IDEsIHZhcigtLXNnbi1wcmVsb2FkZXItcHJvZ3Jlc3MtY2lyY3VtZmVyZW5jZSk7DQpcdFx0c3Ryb2tlLWRhc2hvZmZzZXQ6IDA7DQpcdH0NClx0NTAlIHsNClx0XHRzdHJva2UtZGFzaGFycmF5OiBjYWxjKDQ0ICogdmFyKC0tc2duLXByZWxvYWRlci1wcm9ncmVzcy1jaXJjdW1mZXJlbmNlKSAvIDEwMCksIHZhcigtLXNnbi1wcmVsb2FkZXItcHJvZ3Jlc3MtY2lyY3VtZmVyZW5jZSk7DQpcdFx0c3Ryb2tlLWRhc2hvZmZzZXQ6IGNhbGMoMHB4IC0gKDUwICogdmFyKC0tc2duLXByZWxvYWRlci1wcm9ncmVzcy1jaXJjdW1mZXJlbmNlKSAvIDEwMCkpOw0KXHR9DQpcdDEwMCUgew0KXHRcdHN0cm9rZS1kYXNoYXJyYXk6IGNhbGMoNDQgKiB2YXIoLS1zZ24tcHJlbG9hZGVyLXByb2dyZXNzLWNpcmN1bWZlcmVuY2UpIC8gMTAwKSwgdmFyKC0tc2duLXByZWxvYWRlci1wcm9ncmVzcy1jaXJjdW1mZXJlbmNlKTsNClx0XHRzdHJva2UtZGFzaG9mZnNldDogY2FsYygwcHggLSAoOTAgKiB2YXIoLS1zZ24tcHJlbG9hZGVyLXByb2dyZXNzLWNpcmN1bWZlcmVuY2UpIC8gMTAwKSk7DQpcdH0NCn0NCkBrZXlmcmFtZXMgY29sb3Igew0KXHQxMDAlLCAwJSB7DQpcdFx0c3Ryb2tlOiAjZDYyZDIwOw0KXHR9DQpcdDQwJSB7DQpcdFx0c3Ryb2tlOiAjMDA1N2U3Ow0KXHR9DQpcdDY2JSB7DQpcdFx0c3Ryb2tlOiAjMDA4NzQ0Ow0KXHR9DQpcdDgwJSwgOTAlIHsNClx0XHRzdHJva2U6ICNmZmE3MDA7DQpcdH0NCn0NCg0KDQouc2dudWstcHJlbG9hZGVyLnNwaW5uZXIgPiAucHJlbG9hZGVyIHsNClx0cG9zaXRpb246IHJlbGF0aXZlOw0KXHRkaXNwbGF5OiBpbmxpbmUtZmxleDsNClx0anVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQpcdGFsaWduLWl0ZW1zOiBjZW50ZXI7DQp9DQoNCi5zZ251ay1wcmVsb2FkZXIuc3Bpbm5lciA+IC5wcmVsb2FkZXIgPiAuc3Bpbm5lciB7DQpcdGFuaW1hdGlvbjogcm90YXRlIDEwcyBpbmZpbml0ZSBsaW5lYXI7DQpcdHBvc2l0aW9uOiByZWxhdGl2ZTsNClx0ZGlzcGxheTogaW5saW5lLWZsZXg7DQpcdGp1c3RpZnktY29udGVudDogY2VudGVyOw0KXHRhbGlnbi1pdGVtczogY2VudGVyOw0KXHR3aWR0aDogMTAwJTsNClx0aGVpZ2h0OiAxMDAlOw0KfQ0KDQoNCi5zZ251ay1wcmVsb2FkZXIuc3Bpbm5lciA+IC5wcmVsb2FkZXIgPiBpbWcgew0KXHR3aWR0aDogY2FsYyh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikpOw0KXHRoZWlnaHQ6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSk7DQpcdG1hcmdpbjogdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbik7DQpcdGRpc3BsYXk6IGZsZXg7DQpcdGp1c3RpZnktY29udGVudDogY2VudGVyOw0KXHRhbGlnbi1pdGVtczogY2VudGVyOw0KXHRwb3NpdGlvbjogcmVsYXRpdmU7DQpcdHRvcDogNTAlOw0KXHRsZWZ0OiA1MCU7DQpcdGFuaW1hdGlvbjogc3BpbiA0cyBlYXNlLWluLW91dCBmb3J3YXJkcyBpbmZpbml0ZTsNCn0NCi5zZ251ay1wcmVsb2FkZXIuc3Bpbm5lciA+IC5wcmVsb2FkZXIgPiAuc3Bpbm5lciA+IGltZyB7DQpcdHdpZHRoOiBjYWxjKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkpOw0KXHRoZWlnaHQ6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSk7DQpcdG1hcmdpbjogdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbik7DQp9DQouc2dudWstcHJlbG9hZGVyLnNwaW5uZXIgPiAucHJlbG9hZGVyID4gLnNwaW5uZXIgPiBpIHsNClx0YW5pbWF0aW9uOiByb3RhdGUgM3MgaW5maW5pdGUgY3ViaWMtYmV6aWVyKDAuMDksIDAuNiwgMC44LCAwLjAzKTsNClx0dHJhbnNmb3JtLW9yaWdpbjogNTAlIDEwMCUgMDsNClx0cG9zaXRpb246IGFic29sdXRlOw0KXHRkaXNwbGF5OiBpbmxpbmUtZmxleDsNClx0anVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQpcdGFsaWduLWl0ZW1zOiBjZW50ZXI7DQpcdHRvcDogNTAlOw0KXHRsZWZ0OiA1MCU7DQpcdGJvcmRlcjogc29saWQgdmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSB0cmFuc3BhcmVudDsNClx0Ym9yZGVyLWJvdHRvbTogbm9uZTsNCn0NCi5zZ251ay1wcmVsb2FkZXIuc3Bpbm5lciA+IC5wcmVsb2FkZXIgPiAuc3Bpbm5lciA+IGk6bnRoLWNoaWxkKDEpIHsNClx0LW1vei1hbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4wOSwgMC4zLCAwLjEyLCAwLjAzKTsNClx0LXdlYmtpdC1hbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4wOSwgMC4zLCAwLjEyLCAwLjAzKTsNClx0YW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMDksIDAuMywgMC4xMiwgMC4wMyk7DQpcdHdpZHRoOiB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpOw0KXHRoZWlnaHQ6IHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1oZWlnaHQpOw0KXHRtYXJnaW4tdG9wOiBjYWxjKDBweCAtIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1oZWlnaHQpKTsNClx0bWFyZ2luLWxlZnQ6IGNhbGMoMHB4IC0gdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkpOw0KXHRib3JkZXItY29sb3I6ICMyMTcyYjg7DQpcdGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IGNhbGMoKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDEpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXJhZGl1cykpOw0KXHRib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogY2FsYygodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogMSkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtcmFkaXVzKSk7DQp9DQouc2dudWstcHJlbG9hZGVyLnNwaW5uZXIgPiAucHJlbG9hZGVyID4gLnNwaW5uZXIgPiBpOm50aC1jaGlsZCgyKSB7DQpcdC1tb3otYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMDksIDAuNiwgMC4yNCwgMC4wMyk7DQpcdC13ZWJraXQtYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMDksIDAuNiwgMC4yNCwgMC4wMyk7DQpcdGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAwLjYsIDAuMjQsIDAuMDMpOw0KXHR3aWR0aDogY2FsYyh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikpOw0KXHRoZWlnaHQ6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSk7DQpcdG1hcmdpbi10b3A6IGNhbGMoMHB4IC0gKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1oZWlnaHQpICsgKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkpKTsNClx0bWFyZ2luLWxlZnQ6IGNhbGMoMHB4IC0gKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1oZWlnaHQpICsgKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkpKTsNClx0Ym9yZGVyLWNvbG9yOiAjMThhMzliOw0KXHRib3JkZXItdG9wLWxlZnQtcmFkaXVzOiBjYWxjKCh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikgKiAyKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1yYWRpdXMpKTsNClx0Ym9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IGNhbGMoKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDIpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXJhZGl1cykpOw0KfQ0KLnNnbnVrLXByZWxvYWRlci5zcGlubmVyID4gLnByZWxvYWRlciA+IC5zcGlubmVyID4gaTpudGgtY2hpbGQoMykgew0KXHQtbW96LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAwLjksIDAuMzYsIDAuMDMpOw0KXHQtd2Via2l0LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAwLjksIDAuMzYsIDAuMDMpOw0KXHRhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4wOSwgMC45LCAwLjM2LCAwLjAzKTsNClx0d2lkdGg6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogMik7DQpcdGhlaWdodDogY2FsYyh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpKTsNClx0bWFyZ2luLXRvcDogY2FsYygwcHggLSAodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSkpOw0KXHRtYXJnaW4tbGVmdDogY2FsYygwcHggLSAodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSkpOw0KXHRib3JkZXItY29sb3I6ICM4MmM1NDU7DQpcdGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IGNhbGMoKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDIpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXJhZGl1cykpOw0KXHRib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogY2FsYygodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogMikgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtcmFkaXVzKSk7DQp9DQouc2dudWstcHJlbG9hZGVyLnNwaW5uZXIgPiAucHJlbG9hZGVyID4gLnNwaW5uZXIgPiBpOm50aC1jaGlsZCg0KSB7DQpcdC1tb3otYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMDksIDEuMiwgMC40OCwgMC4wMyk7DQpcdC13ZWJraXQtYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMDksIDEuMiwgMC40OCwgMC4wMyk7DQpcdGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAxLjIsIDAuNDgsIDAuMDMpOw0KXHR3aWR0aDogY2FsYyh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikgKiAzKTsNClx0aGVpZ2h0OiBjYWxjKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1oZWlnaHQpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikgKiAxLjUpOw0KXHRtYXJnaW4tdG9wOiBjYWxjKDBweCAtICh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDMpKSk7DQpcdG1hcmdpbi1sZWZ0OiBjYWxjKDBweCAtICh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDMpKSk7DQpcdGJvcmRlci1jb2xvcjogI2Y4YjczOTsNClx0Ym9yZGVyLXRvcC1sZWZ0LXJhZGl1czogY2FsYygodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogMykgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtcmFkaXVzKSk7DQpcdGJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiBjYWxjKCh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikgKiAzKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1yYWRpdXMpKTsNCn0NCi5zZ251ay1wcmVsb2FkZXIuc3Bpbm5lciA+IC5wcmVsb2FkZXIgPiAuc3Bpbm5lciA+IGk6bnRoLWNoaWxkKDUpIHsNClx0LW1vei1hbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4wOSwgMS41LCAwLjYsIDAuMDMpOw0KXHQtd2Via2l0LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAxLjUsIDAuNiwgMC4wMyk7DQpcdGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAxLjUsIDAuNiwgMC4wMyk7DQpcdHdpZHRoOiBjYWxjKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDQpOw0KXHRoZWlnaHQ6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDIpOw0KXHRtYXJnaW4tdG9wOiBjYWxjKDBweCAtICh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDQpKSk7DQpcdG1hcmdpbi1sZWZ0OiBjYWxjKDBweCAtICh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDQpKSk7DQpcdGJvcmRlci1jb2xvcjogI2YwNjA0NTsNClx0Ym9yZGVyLXRvcC1sZWZ0LXJhZGl1czogY2FsYygodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogNCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtcmFkaXVzKSk7DQpcdGJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiBjYWxjKCh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikgKiA0KSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1yYWRpdXMpKTsNCn0NCi5zZ251ay1wcmVsb2FkZXIuc3Bpbm5lciA+IC5wcmVsb2FkZXIgPiAuc3Bpbm5lciA+IGk6bnRoLWNoaWxkKDYpIHsNClx0LW1vei1hbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4wOSwgMS44LCAwLjcyLCAwLjAzKTsNClx0LXdlYmtpdC1hbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4wOSwgMS44LCAwLjcyLCAwLjAzKTsNClx0YW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMDksIDEuOCwgMC43MiwgMC4wMyk7DQpcdHdpZHRoOiBjYWxjKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDUpOw0KXHRoZWlnaHQ6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDIuNSk7DQpcdG1hcmdpbi10b3A6IGNhbGMoMHB4IC0gKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1oZWlnaHQpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogNSkpKTsNClx0bWFyZ2luLWxlZnQ6IGNhbGMoMHB4IC0gKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1oZWlnaHQpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogNSkpKTsNClx0Ym9yZGVyLWNvbG9yOiAjZWQyODYxOw0KXHRib3JkZXItdG9wLWxlZnQtcmFkaXVzOiBjYWxjKCh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikgKiA1KSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1yYWRpdXMpKTsNClx0Ym9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IGNhbGMoKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDUpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXJhZGl1cykpOw0KfQ0KLnNnbnVrLXByZWxvYWRlci5zcGlubmVyID4gLnByZWxvYWRlciA+IC5zcGlubmVyID4gaTpudGgtY2hpbGQoNykgew0KXHQtbW96LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAyLjEsIDAuODQsIDAuMDMpOw0KXHQtd2Via2l0LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAyLjEsIDAuODQsIDAuMDMpOw0KXHRhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4wOSwgMi4xLCAwLjg0LCAwLjAzKTsNClx0d2lkdGg6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogNik7DQpcdGhlaWdodDogY2FsYyh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogMyk7DQpcdG1hcmdpbi10b3A6IGNhbGMoMHB4IC0gKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1oZWlnaHQpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogNikpKTsNClx0bWFyZ2luLWxlZnQ6IGNhbGMoMHB4IC0gKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1oZWlnaHQpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogNikpKTsNClx0Ym9yZGVyLWNvbG9yOiAjYzEyNjgwOw0KXHRib3JkZXItdG9wLWxlZnQtcmFkaXVzOiBjYWxjKCh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtd2lkdGgpICsgKCh2YXIoLS1zZ24tcHJlbG9hZGVyLXN0cmlwZXMtd2lkdGgpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLW1hcmdpbikpICogMikgKiA2KSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1yYWRpdXMpKTsNClx0Ym9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IGNhbGMoKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDYpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXJhZGl1cykpOw0KfQ0KLnNnbnVrLXByZWxvYWRlci5zcGlubmVyID4gLnByZWxvYWRlciA+IC5zcGlubmVyID4gaTpudGgtY2hpbGQoOCkgew0KXHQtbW96LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAyLjQsIDAuOTYsIDAuMDMpOw0KXHQtd2Via2l0LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLjA5LCAyLjQsIDAuOTYsIDAuMDMpOw0KXHRhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4wOSwgMi40LCAwLjk2LCAwLjAzKTsNClx0d2lkdGg6IGNhbGModmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogNyk7DQpcdGhlaWdodDogY2FsYyh2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtaGVpZ2h0KSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogMy41KTsNClx0bWFyZ2luLXRvcDogY2FsYygwcHggLSAodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiA3KSkpOw0KXHRtYXJnaW4tbGVmdDogY2FsYygwcHggLSAodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLWhlaWdodCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiA3KSkpOw0KXHRib3JkZXItY29sb3I6ICM1ZDMxOTE7DQpcdGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IGNhbGMoKHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy13aWR0aCkgKyAoKHZhcigtLXNnbi1wcmVsb2FkZXItc3RyaXBlcy13aWR0aCkgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtbWFyZ2luKSkgKiAyKSAqIDcpICsgdmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXJhZGl1cykpOw0KXHRib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogY2FsYygodmFyKC0tc2duLXByZWxvYWRlci1jaXJjbGVzLXdpZHRoKSArICgodmFyKC0tc2duLXByZWxvYWRlci1zdHJpcGVzLXdpZHRoKSArIHZhcigtLXNnbi1wcmVsb2FkZXItY2lyY2xlcy1tYXJnaW4pKSAqIDIpICogNykgKyB2YXIoLS1zZ24tcHJlbG9hZGVyLWNpcmNsZXMtcmFkaXVzKSk7DQp9DQoNCkAtbW96LWtleWZyYW1lcyByb3RhdGUgew0KXHR0byB7DQpcdFx0dHJhbnNmb3JtOiByb3RhdGUoMzYwZGVnKTsNClx0fQ0KfQ0KQC13ZWJraXQta2V5ZnJhbWVzIHJvdGF0ZSB7DQpcdHRvIHsNClx0XHR0cmFuc2Zvcm06IHJvdGF0ZSgzNjBkZWcpOw0KXHR9DQp9DQpAa2V5ZnJhbWVzIHJvdGF0ZSB7DQpcdHRvIHsNClx0XHR0cmFuc2Zvcm06IHJvdGF0ZSgzNjBkZWcpOw0KXHR9DQp9DQoNCkBrZXlmcmFtZXMgcHVsc2Ugew0KXHRmcm9tIHsNClx0XHR0cmFuc2Zvcm06IHNjYWxlKC44KTsNClx0fQ0KXHR0byB7DQpcdFx0dHJhbnNmb3JtOiBzY2FsZSgxKTsNClx0fQ0KfQ0KDQpAa2V5ZnJhbWVzIHNwaW4gew0KXHQwJSB7DQpcdFx0dHJhbnNmb3JtOiByb3RhdGVZKDBkZWcpOw0KXHR9DQpcdDUwJSB7DQpcdFx0dHJhbnNmb3JtOiByb3RhdGVZKDE4MGRlZyk7DQpcdH0NClx0MTAwJSB7DQpcdFx0dHJhbnNmb3JtOiByb3RhdGVZKDM2MGRlZyk7DQpcdH0NCn0NCg0KYDsNCgljb25zdCBoZWFkID0gZG9jdW1lbnQuaGVhZCB8fCBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdLCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7DQoNCgljb25zdCBpY29uICAgICAgICAgICAgICAgICAgPSBpY29uQXR0ciwNCgkgICAgICBoYXNJbmRldGVybWluYXRlUHJvZ3Jlc3MgPSAoaW5kZXRlcm1pbmF0ZVByb2dyZXNzQXR0ciA9PT0gInRydWUiIHx8IGluZGV0ZXJtaW5hdGVQcm9ncmVzc0F0dHIgPT09ICJmYWxzZSIpLA0KCSAgICAgIGluZGV0ZXJtaW5hdGVQcm9ncmVzcyA9IChoYXNJbmRldGVybWluYXRlUHJvZ3Jlc3MgJiYgaW5kZXRlcm1pbmF0ZVByb2dyZXNzQXR0ciA9PT0gImZhbHNlIikgPyBmYWxzZSA6IHRydWU7DQoJbGV0IHByZWxvYWRlckVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwgcHJlbG9hZGVyOw0KCXByZWxvYWRlckVsZW0uY2xhc3NOYW1lID0gInNnbi1wcmVsb2FkZXIgc2dudWstcHJlbG9hZGVyIjsNCg0KCS8qKg0KCSAqIEFyYyA9IERpYW1ldGVyIC8gMg0KCSAqIFJhZGl1cyA9IEFyYyAtIDINCgkgKiBDaXJjdW1mZXJlbmNlID0gMiDDlyDPgCDDlyByYWRpdXMgKDLPgFIpID0+IDIgKiAzLjE0ICogNzAgPSA0MzkNCgkgKiBPZmZzZXQgPSBjaXJjdW1mZXJlbmNlIMOXICgoMTAwIC0gcHJvZ3Jlc3MpIC8gMTAwKSA9PiA0MzkgKiAoKDEwMCAtIDUwKSAvIDEwMCkgPSAyMTkuNQ0KCSAqDQoJICogQHR5cGUge251bWJlcn0NCgkgKi8NCgljb25zdCByYWRpdXMgICAgICAgID0gKHByb2dyZXNzU2l6ZSAvIDIpIC0gMiwNCgkgICAgICBjaXJjdW1mZXJlbmNlID0gKDIgKiAzLjE0ICogcmFkaXVzKTsNCg0KCS8qKg0KCSAqIENhbGN1bGF0ZSBvZmZzZXQgb2YgcHJvZ3Jlc3MgdXNpbmcgdGhlIGZvcm11bGE6PGJyPg0KCSAqIDxjb2RlPk9mZnNldCA9IGNpcmN1bWZlcmVuY2Ugw5cgKCgxMDAgLSBwcm9ncmVzcykgLyAxMDApPC9jb2RlPg0KCSAqDQoJICogQHBhcmFtIHtudW1iZXJ9IHByb2dyZXNzDQoJICogQHJldHVybiB7bnVtYmVyfSBUaGUgY2FsY3VsYXRlZCBvZmZzZXQuDQoJICovDQoJY29uc3QgY2FsY3VsYXRlT2Zmc2V0ID0gKHByb2dyZXNzID0gMCkgPT4gew0KCQlyZXR1cm4gKGNpcmN1bWZlcmVuY2UgKiAoKDEwMCAtIHByb2dyZXNzKSAvIDEwMCkpOw0KCX07DQoNCgljb25zdCBpbml0aWFsT2Zmc2V0ID0gY2FsY3VsYXRlT2Zmc2V0KDApOw0KDQoJaGVhZC5hcHBlbmRDaGlsZChzdHlsZSk7DQoJc3R5bGUuaWQgPSAic2duLXVpa2l0LXN0eWxlcyI7DQoJaWYoc3R5bGUuc3R5bGVTaGVldCkgew0KCQkvLyBUaGlzIGlzIHJlcXVpcmVkIGZvciBJRTggYW5kIGJlbG93Lg0KCQlzdHlsZS5zdHlsZVNoZWV0LmNzc1RleHQgPSBjc3M7DQoJfSBlbHNlIHsNCgkJc3R5bGUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoY3NzKSk7DQoJfQ0KDQoNCglpZihoYXNJbmRldGVybWluYXRlUHJvZ3Jlc3MpIHsNCgkJcHJlbG9hZGVyRWxlbS5jbGFzc0xpc3QuYWRkKCdpbmRldGVybWluYXRlJyk7DQoJCXByZWxvYWRlciA9IGBcdFx0XHQ8ZGl2IGNsYXNzPSJwcmVsb2FkZXIiPlxuYDsNCgkJcHJlbG9hZGVyICs9IGBcdFx0XHRcdDxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj5cbmA7DQoJCXByZWxvYWRlciArPSBgXHRcdFx0XHQJPHRleHQgaWQ9InNnbi1sb2FkZXItcHJvZ3Jlc3MtbG9hZGVkIiB4PSI1MCUiIHk9Ii03NSUiPjAgYnl0ZXM8L3RleHQ+XG5gOw0KCQlwcmVsb2FkZXIgKz0gYFx0XHRcdFx0CTxjaXJjbGUgcj0iNzYiPjwvY2lyY2xlPlxuYDsNCgkJcHJlbG9hZGVyICs9IGBcdFx0XHRcdAk8Y2lyY2xlIGlkPSJzZ24tbG9hZGVyLXByb2dyZXNzIiByPSI3NiIgc3Ryb2tlLWRhc2hvZmZzZXQ9IiR7aW5pdGlhbE9mZnNldH1weCI+PC9jaXJjbGU+XG5gOw0KCQlwcmVsb2FkZXIgKz0gYFx0XHRcdFx0CTx0ZXh0IGlkPSJzZ24tbG9hZGVyLXByb2dyZXNzLXBlcmNlbnRhZ2UiIHg9IjUwJSIgeT0iLTUwJSI+MCU8L3RleHQ+XG5gOw0KCQlwcmVsb2FkZXIgKz0gYFx0XHRcdFx0CTx0ZXh0IGlkPSJzZ24tbG9hZGVyLXByb2dyZXNzLXRvdGFsIiB4PSI1MCUiIHk9Ii0yNSUiPjAgYnl0ZXM8L3RleHQ+XG5gOw0KCQlwcmVsb2FkZXIgKz0gYFx0XHRcdFx0PC9zdmc+XG5gOw0KCQlwcmVsb2FkZXIgKz0gYFx0XHRcdFx0PGRpdiBjbGFzcz0ic2duLWxvYWRlci1wcm9ncmVzcy1pbmZvIj5QcmVsb2FkOiBDaGVja2luZyBmb3IgY2FjaGUuLi48L2Rpdj5cbmA7DQoJCXByZWxvYWRlciArPSBgXHRcdFx0PC9kaXY+XG5gOw0KCX0gZWxzZSB7DQoJCXByZWxvYWRlckVsZW0uY2xhc3NMaXN0LmFkZCgnc3Bpbm5lcicpOw0KCQlwcmVsb2FkZXIgPSBgXHRcdFx0PGRpdiBjbGFzcz0icHJlbG9hZGVyIj5cbmANCgkJaWYoaWNvbiAhPT0gdW5kZWZpbmVkICYmIGljb24gIT09IG51bGwgJiYgaWNvbiAhPT0gIiIpIHByZWxvYWRlciArPSBgXHRcdFx0XHQ8aW1nIHNyYz0iJHtpY29ufSIgYWx0PSJJQ09OIj5cbmA7DQoJCXByZWxvYWRlciArPSBgXHRcdFx0XHQ8ZGl2IGNsYXNzPSJzcGlubmVyIj5cbmA7DQoJCXByZWxvYWRlciArPSBgXHRcdFx0XHRcdDxpPjwvaT5cbmA7DQoJCXByZWxvYWRlciArPSBgXHRcdFx0XHRcdDxpPjwvaT5cbmA7DQoJCXByZWxvYWRlciArPSBgXHRcdFx0XHRcdDxpPjwvaT5cbmA7DQoJCXByZWxvYWRlciArPSBgXHRcdFx0XHRcdDxpPjwvaT5cbmA7DQoJCXByZWxvYWRlciArPSBgXHRcdFx0XHRcdDxpPjwvaT5cbmA7DQoJCXByZWxvYWRlciArPSBgXHRcdFx0XHRcdDxpPjwvaT5cbmA7DQoJCXByZWxvYWRlciArPSBgXHRcdFx0XHRcdDxpPjwvaT5cbmA7DQoJCXByZWxvYWRlciArPSBgXHRcdFx0XHRcdDxpPjwvaT5cbmA7DQoJCXByZWxvYWRlciArPSBgXHRcdFx0XHQ8L2Rpdj5cbmA7DQoJCXByZWxvYWRlciArPSBgXHRcdFx0PC9kaXY+XG5gOw0KCQlwcmVsb2FkZXIgKz0gYFx0XHQ8L2Rpdj5cbmA7DQoJfQ0KDQoJcHJlbG9hZGVyRWxlbS5pbm5lckhUTUwgPSBwcmVsb2FkZXI7DQoNCgl3aW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7DQoJCWRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgiaGFzLXByZWxvYWRlciIpOw0KCQlkb2N1bWVudC5ib2R5Lmluc2VydEJlZm9yZShwcmVsb2FkZXJFbGVtLCBkb2N1bWVudC5ib2R5LmZpcnN0Q2hpbGQpOw0KDQoJCWlmKHR5cGVvZiBjYWxsYmFjayA9PT0gImZ1bmN0aW9uIikgY2FsbGJhY2socHJlbG9hZGVyRWxlbSwgY2lyY3VtZmVyZW5jZSwgaW5kZXRlcm1pbmF0ZVByb2dyZXNzKTsNCgl9Ow0KfSkoKCRwcmVsb2FkZXIsIGNpcmN1bWZlcmVuY2UsIGluZGV0ZXJtaW5hdGVQcm9ncmVzcykgPT4gew0KCWNvbnN0IHNnbnVpa2l0U2NyaXB0ID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdCB8fCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJzY3JpcHRbc3JjKj1cIlNHTlVJS2l0LmxvYWRlci5qc1wiXSIpOw0KCWNvbnN0IGN1cnJlbnRTY3JpcHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2duLXByZWxvYWQtZW5kIikgfHwgc2dudWlraXRTY3JpcHQ7DQoNCgljb25zdCBwcmVsb2FkID0gWw0KCQkianMvaTE4bi9TR05pMThuLmpzIiwNCgldOw0KCWNvbnN0IHN0eWxlcyA9IFsNCgkJImNzcy9wcm8uY3NzIiwNCgldOw0KCWNvbnN0IHNjcmlwdHMgPSBbDQoJCSJjc3MvZm9udHMvRm9udEF3ZXNvbWU1UHJvL2pzL2FsbC5qcyIsDQoJCSJjc3MvZm9udHMvRm9udEF3ZXNvbWU1UHJvL2pzL3Y0LXNoaW1zLmpzIiwNCg0KCQkiYWRkb25zL0NLRWRpdG9yNS9ja2VkaXRvci5qcyIsDQoJCSJhZGRvbnMvQ29udGV4dEpTL2NvbnRleHQuanMiLA0KCQkiYWRkb25zL2RhdGVwaWNrZXIvYm9vdHN0cmFwLWRhdGVwaWNrZXIuanMiLA0KCQkiYWRkb25zL2l6aVRvYXN0L2l6aVRvYXN0LmpzIiwNCgkJImFkZG9ucy9pemlUb2FzdC9pemlUb2FzdC5lYXN5LmpzIiwNCgkJImFkZG9ucy9OYXZiYXJUcmFuc2Zvcm1JY29ucy9OYXZiYXJUcmFuc2Zvcm1JY29ucy5qcyIsDQoJCSJhZGRvbnMvbm90eS9ub3R5LmpzIiwNCgkJImFkZG9ucy9ub3R5L25vdHkuaW5pdC5qcyIsDQoJCSJhZGRvbnMvUHJpc21KUy9wcmlzbS5qcyIsDQoJCSJhZGRvbnMvU0dOTG9hZGVycy9TR05Mb2FkZXJzLmpzIiwNCgkJImFkZG9ucy9TR05Mb2FkaW5nRGlhbG9nL1NHTkxvYWRpbmdEaWFsb2cuanMiLA0KCQkiYWRkb25zL1NHTkF0b20vU0dOQXRvbS5qcyIsDQoJCSJhZGRvbnMvU0dORnVsbFBhZ2UvU0dORnVsbFBhZ2UuanMiLA0KCQkiYWRkb25zL1NHTkNhcm91c2VsL1NHTkNhcm91c2VsLmpzIiwNCgkJImFkZG9ucy9TR05HZW9EYXRhL1NHTkdlb0RhdGEuanMiLA0KCQkiYWRkb25zL1NHTlRpbWVQaWNrZXIvU0dOVGltZVBpY2tlci5qcyIsDQoJCSJhZGRvbnMvU3dlZXRBbGVydDIvc3dlZXRhbGVydDIuYWxsLmpzIiwNCgkJImFkZG9ucy9WZWxvY2l0eUpTL3ZlbG9jaXR5LmpzIiwNCg0KCQkianMvaGVscGVycy9TdHJpbmcuanMiLA0KCQkianMvaGVscGVycy9EeW5hbWljRXZlbnRzLmpzIiwNCgkJImpzL2hlbHBlcnMvZnVuY3Rpb25zL0RhdGVUaW1lL2NvbW1vbnMuanMiLA0KCQkianMvaGVscGVycy9mdW5jdGlvbnMvRGF0ZVRpbWUvc3RydG90aW1lLmpzIiwNCgkJImpzL2hlbHBlcnMvaGVscGVycy5qcyIsDQoNCgkJImpzL2FkZG9ucy9CQkNvZGVzUGFyc2VyLmpzIiwNCgkJImpzL2FkZG9ucy9TR05Db25zb2xlLmpzIiwNCgkJImpzL2FkZG9ucy9TR05TbmFja2Jhci5qcyIsDQoJCSJqcy9hZGRvbnMvU0dORGF0YVRhYmxlcy5qcyIsDQoJCSJqcy9hZGRvbnMvU0dOTXVsdGlQYWdlLmpzIiwNCgkJImpzL2FkZG9ucy9TR05Db2RlU25pcHBldC5qcyIsDQoNCgkJImpzL2NvbXBvbmVudHMvZHJvcGRvd24uanMiLA0KCQkianMvY29tcG9uZW50cy9tYXJxdWVlLmpzIiwNCgkJImpzL2NvbXBvbmVudHMvbW9kYWxzLmpzIiwNCgkJImpzL2NvbXBvbmVudHMvcG9wb3Zlci5qcyIsDQoJCSJqcy9jb21wb25lbnRzL3NoZWV0LmpzIiwNCgkJImpzL2NvbXBvbmVudHMvc2lkZWJhci5qcyIsDQoJCSJqcy9jb21wb25lbnRzL3RhYmxheW91dC5qcyIsDQoJCSJqcy9jb21wb25lbnRzL3dpbmRvd3MuanMiLA0KCQkianMvY29tcG9uZW50cy93aXphcmQuanMiLA0KCQkianMvY29tcG9uZW50cy9mb3Jtcy9zZWxlY3QuanMiLA0KCQkianMvY29tcG9uZW50cy9mb3Jtcy9pbnB1dHMuanMiLA0KCQkianMvY29tcG9uZW50cy9mb3Jtcy9kYXRldGltZS1waWNrZXIuanMiLA0KCQkianMvdXRpbGl0aWVzL2VmZmVjdHMuanMiLA0KCQkianMvdXRpbGl0aWVzL3JpcHBsZS5qcyIsDQoJCSJqcy91dGlsaXRpZXMvSW5wdXRGaWx0ZXIuanMiLA0KCQkianMvY29tbW9ucy5qcyIsDQoJXTsNCglsZXQgcHJldmlvdXNMb2FkZWRGaWxlU2l6ZSA9IDAsIGxvYWRlZEZpbGVTaXplID0gMCwgdG90YWxGaWxlU2l6ZSA9IDA7DQoJY29uc3QgZmlsZVNpemVzID0gew0KCQlsZW5ndGg6IDANCgl9Ow0KDQoJZnVuY3Rpb24gZ2V0U2NyaXB0VVJMKCkgew0KCQlyZXR1cm4gc2dudWlraXRTY3JpcHQuc3JjOw0KCX0NCg0KCWNvbnN0IHVybCA9IGdldFNjcmlwdFVSTCgpLnNwbGl0KCIvIikuc2xpY2UoMCwgLTIpLmpvaW4oIi8iKSArICIvIjsNCgkvKioNCgkgKg0KCSAqIEBwYXJhbSB7bnVtYmVyfWJ5dGVzDQoJICogQHBhcmFtIHtudW1iZXJ9ZGVjaW1hbHMNCgkgKiBAcmV0dXJuIHtzdHJpbmd9DQoJICovDQoJY29uc3QgZm9ybWF0Qnl0ZXMgPSAoYnl0ZXMsIGRlY2ltYWxzID0gMikgPT4gew0KCQlpZighK2J5dGVzKSByZXR1cm4gJzAgQnl0ZXMnOw0KDQoJCWNvbnN0IHNpemVzID0gWydCeXRlcycsICdLQicsICdNQicsICdHQicsICdUQicsICdQQicsICdFQicsICdaQicsICdZQiddOw0KCQljb25zdCBrID0gMTAyNCwNCgkJICAgICAgaSA9IE1hdGguZmxvb3IoTWF0aC5sb2coYnl0ZXMpIC8gTWF0aC5sb2coaykpOw0KCQljb25zdCBkbSA9IGRlY2ltYWxzIDwgMCA/IDAgOiBkZWNpbWFsczsNCg0KCQlyZXR1cm4gYCR7cGFyc2VGbG9hdCgoYnl0ZXMgLyBNYXRoLnBvdyhrLCBpKSkudG9GaXhlZChkbSkpfSAke3NpemVzW2ldfWA7DQoJfTsNCgljb25zdCBjYWxjdWxhdGVPZmZzZXQgPSAocHJvZ3Jlc3MgPSAwKSA9PiAoY2lyY3VtZmVyZW5jZSAqICgoMTAwIC0gcHJvZ3Jlc3MpIC8gMTAwKSk7DQoJLyoqDQoJICoNCgkgKiBAcGFyYW0geydwcmVsb2FkJywnY29tcG9uZW50JywnYWRkb24nLCdjb21tb25zJywndXRpbGl0eScsJ2hlbHBlcicsJ2xheW91dCd9IHR5cGUNCgkgKiBAcGFyYW0ge3N0cmluZ31jb21wb25lbnQNCgkgKiBAcGFyYW0ge251bWJlcn10b3RhbA0KCSAqIEByZXR1cm4ge2A8ZGl2IGNsYXNzPSJzZ24tbG9hZGVyLXByb2dyZXNzLWluZm8iPkxvYWRpbmc6ICR7c3RyaW5nfTogPGRpdiBjbGFzcz0ibmFtZSI+JHtzdHJpbmd9PC9kaXY+PGRpdiBjbGFzcz0icHJvZ3Jlc3MiPjxzcGFuIGNsYXNzPSJsb2FkZWQiPjAgS0I8L3NwYW4+IC8gPHNwYW4gY2xhc3M9InRvdGFsIj4ke3N0cmluZ308L3NwYW4+PC9kaXY+PC9kaXY+XG5gfQ0KCSAqLw0KCWNvbnN0IHNldFByb2dyZXNzSW5mbyA9ICh0eXBlLCBjb21wb25lbnQsIHRvdGFsID0gMCwgam9iID0gJ2xvYWQnKSA9PiB7DQoJCXR5cGUgPSAodHlwZSA9PT0gJ3ByZWxvYWQnKSA/ICdQcmUtbG9hZCcgOg0KCQkgICAgICAgKHR5cGUgPT09ICdjb21wb25lbnQnKSA/ICdDb21wb25lbnQnIDoNCgkJICAgICAgICh0eXBlID09PSAnYWRkb24nKSA/ICdBZGRvbicgOg0KCQkgICAgICAgKHR5cGUgPT09ICdjb21tb25zJykgPyAnQ29tbW9ucycgOg0KCQkgICAgICAgKHR5cGUgPT09ICd1dGlsaXR5JykgPyAnVXRpbGl0eScgOg0KCQkgICAgICAgKHR5cGUgPT09ICdoZWxwZXInKSA/ICdIZWxwZXInIDoNCgkJICAgICAgICh0eXBlID09PSAnbGF5b3V0JykgPyAnTGF5b3V0JyA6IHR5cGU7DQoJCWpvYiA9IChqb2IgPT09ICdpbnN0YWxsJykgPyAnSW5zdGFsbGluZycgOiAnTG9hZGluZyc7DQoNCgkJY29uc3QgJHByb2dyZXNzSW5mbyA9ICRwcmVsb2FkZXIucXVlcnlTZWxlY3RvcignLnNnbi1sb2FkZXItcHJvZ3Jlc3MtaW5mbycpLA0KCQkgICAgICAkam9iICAgICAgICAgPSAoJHByb2dyZXNzSW5mbyAhPT0gbnVsbCkgPyAkcHJvZ3Jlc3NJbmZvLnF1ZXJ5U2VsZWN0b3IoJy5qb2InKSA6IG51bGwsDQoJCSAgICAgICR0eXBlICAgICAgICAgPSAoJHByb2dyZXNzSW5mbyAhPT0gbnVsbCkgPyAkcHJvZ3Jlc3NJbmZvLnF1ZXJ5U2VsZWN0b3IoJy50eXBlJykgOiBudWxsLA0KCQkgICAgICAkbmFtZSAgICAgICAgID0gKCRwcm9ncmVzc0luZm8gIT09IG51bGwpID8gJHByb2dyZXNzSW5mby5xdWVyeVNlbGVjdG9yKCcubmFtZScpIDogbnVsbCwNCgkJICAgICAgJHByb2dyZXNzICAgICA9ICgkcHJvZ3Jlc3NJbmZvICE9PSBudWxsKSA/ICRwcm9ncmVzc0luZm8ucXVlcnlTZWxlY3RvcignLnByb2dyZXNzJykgOiBudWxsLA0KCQkgICAgICAkbG9hZGVkICAgICAgID0gKCRwcm9ncmVzcyAhPT0gbnVsbCkgPyAkcHJvZ3Jlc3MucXVlcnlTZWxlY3RvcignLmxvYWRlZCcpIDogbnVsbCwNCgkJICAgICAgJHRvdGFsICAgICAgICA9ICgkcHJvZ3Jlc3MgIT09IG51bGwpID8gJHByb2dyZXNzLnF1ZXJ5U2VsZWN0b3IoJy50b3RhbCcpIDogbnVsbCwNCgkJICAgICAgJGxvYWRlZFRleHQgICAgICAgID0gJHByZWxvYWRlci5xdWVyeVNlbGVjdG9yKCdzdmcgPiB0ZXh0I3Nnbi1sb2FkZXItcHJvZ3Jlc3MtbG9hZGVkJyksDQoJCSAgICAgICR0b3RhbFRleHQgICAgICAgID0gJHByZWxvYWRlci5xdWVyeVNlbGVjdG9yKCdzdmcgPiB0ZXh0I3Nnbi1sb2FkZXItcHJvZ3Jlc3MtdG90YWwnKTsNCg0KCQljb25zdCBmaWxlVG90YWwgPSAoZmlsZVNpemVzLmhhc093blByb3BlcnR5KGNvbXBvbmVudCkpID8gZmlsZVNpemVzW2NvbXBvbmVudF0gOiAwOw0KCQl0b3RhbCA9ICh0b3RhbCA8PSAwKSA/IGZpbGVUb3RhbCA6IHRvdGFsOw0KDQoJCWNvbnN0IHRvdGFsRm9ybWF0ID0gZm9ybWF0Qnl0ZXModG90YWwpOw0KDQoJCSRsb2FkZWRUZXh0LmlubmVySFRtbCA9ICcwIEInOw0KCQkkdG90YWxUZXh0LmlubmVySFRtbCA9IHRvdGFsRm9ybWF0Ow0KDQoJCWNvbnN0IGggPSBgPGRpdiBjbGFzcz0iam9iIj5Mb2FkaW5nOiA8L2RpdjxkaXYgY2xhc3M9InR5cGUiPiR7dHlwZX08L2Rpdj46PGRpdiBjbGFzcz0ibmFtZSI+JHtjb21wb25lbnR9PC9kaXY+PGRpdiBjbGFzcz0icHJvZ3Jlc3MiPjxzcGFuIGNsYXNzPSJsb2FkZWQiPjAgS0I8L3NwYW4+IC8gPHNwYW4gY2xhc3M9InRvdGFsIj4ke3RvdGFsRm9ybWF0fTwvc3Bhbj48L2Rpdj5cbmA7DQoJCWNvbnN0IGgyID0gYDxkaXYgY2xhc3M9InNnbi1sb2FkZXItcHJvZ3Jlc3MtaW5mbyI+JHtofTwvZGl2PlxuYDsNCg0KDQoJCWlmKCRwcm9ncmVzc0luZm8gIT09IG51bGwpIHsNCgkJCWlmKCRqb2IgPT09IG51bGwgfHwgJHR5cGUgPT09IG51bGwgfHwgJG5hbWUgPT09IG51bGwgfHwgJHRvdGFsID09PSBudWxsKSB7DQoJCQkJJHByb2dyZXNzSW5mby5pbm5lckhUTUwgPSBoOw0KCQkJfSBlbHNlIHsNCgkJCQlpZihqb2IgIT09ICRqb2IuaW5uZXJUZXh0KSB7DQoJCQkJCSRqb2IuaW5uZXJIVE1MID0gam9iOw0KCQkJCX0NCgkJCQlpZih0eXBlICE9PSAkdHlwZS5pbm5lclRleHQpIHsNCgkJCQkJJHR5cGUuaW5uZXJIVE1MID0gdHlwZTsNCgkJCQl9DQoJCQkJaWYoY29tcG9uZW50ICE9PSAkbmFtZS5pbm5lclRleHQpIHsNCgkJCQkJJG5hbWUuaW5uZXJIVE1MID0gY29tcG9uZW50Ow0KCQkJCQkkdG90YWwuaW5uZXJIVE1MID0gdG90YWxGb3JtYXQ7DQoJCQkJfQ0KCQkJCWlmKGNvbXBvbmVudCA9PT0gJG5hbWUuaW5uZXJUZXh0ICYmIHRvdGFsRm9ybWF0ICE9PSAkdG90YWwuaW5uZXJUZXh0KSB7DQoJCQkJCSR0b3RhbC5pbm5lckhUTUwgPSB0b3RhbEZvcm1hdDsNCgkJCQl9DQoJCQl9DQoJCX0gZWxzZSB7DQoJCQkkcHJlbG9hZGVyLmFwcGVuZChoMik7DQoJCX0NCgl9Ow0KDQoJY29uc3QgdXBkYXRlUHJvZ3Jlc3MgPSAobG9hZGVkLCB0b3RhbCwgY29tcG9uZW50KSA9PiB7DQoJCWNvbnN0ICRwcm9ncmVzcyAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc2duLWxvYWRlci1wcm9ncmVzcycpLA0KCQkgICAgICAkcGVyY2VudGFnZSAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Nnbi1sb2FkZXItcHJvZ3Jlc3MtcGVyY2VudGFnZScpLA0KCQkgICAgICAkcHJvZ3Jlc3NJbmZvID0gJHByZWxvYWRlci5xdWVyeVNlbGVjdG9yKCcuc2duLWxvYWRlci1wcm9ncmVzcy1pbmZvJyk7DQoJCWNvbnN0ICRsb2FkZWRUZXh0ID0gJHByZWxvYWRlci5xdWVyeVNlbGVjdG9yKCdzdmcgPiB0ZXh0I3Nnbi1sb2FkZXItcHJvZ3Jlc3MtbG9hZGVkJyksDQoJCSAgICAgICR0b3RhbFRleHQgID0gJHByZWxvYWRlci5xdWVyeVNlbGVjdG9yKCdzdmcgPiB0ZXh0I3Nnbi1sb2FkZXItcHJvZ3Jlc3MtdG90YWwnKTsNCgkJY29uc3QgJGxvYWRlZCA9ICRwcm9ncmVzc0luZm8ucXVlcnlTZWxlY3RvcignLnByb2dyZXNzID4gLmxvYWRlZCcpOw0KDQoJCWNvbnN0IGZpbGVUb3RhbCA9IChmaWxlU2l6ZXMuaGFzT3duUHJvcGVydHkoY29tcG9uZW50KSkgPyBmaWxlU2l6ZXNbY29tcG9uZW50XSA6IDA7DQoJCXRvdGFsID0gKHRvdGFsIDw9IDApID8gZmlsZVRvdGFsIDogdG90YWw7DQoNCgkJY29uc3QgY3VycmVudExvYWRlZCA9IGxvYWRlZCwNCgkJCWN1cnJlbnRQcm9ncmVzcyA9IChsb2FkZWQgLyB0b3RhbCkgKiAxMDA7DQoNCgkJaWYocHJldmlvdXNMb2FkZWRGaWxlU2l6ZSA+IDApDQoJCQlsb2FkZWQgPSAocHJldmlvdXNMb2FkZWRGaWxlU2l6ZSA8PSBsb2FkZWQpID8gbG9hZGVkIC0gcHJldmlvdXNMb2FkZWRGaWxlU2l6ZSA6IHByZXZpb3VzTG9hZGVkRmlsZVNpemUgLSBsb2FkZWQ7DQoNCgkJcHJldmlvdXNMb2FkZWRGaWxlU2l6ZSA9IGN1cnJlbnRMb2FkZWQ7DQoJCWxvYWRlZEZpbGVTaXplICs9IGxvYWRlZDsNCg0KCQljb25zdCBwZXJjZW50YWdlID0gKGxvYWRlZEZpbGVTaXplIC8gdG90YWxGaWxlU2l6ZSkgKiAxMDAsDQoJCSAgICAgIG9mZnNldCAgID0gY2FsY3VsYXRlT2Zmc2V0KHBlcmNlbnRhZ2UpLA0KCQkgICAgICBwcm9ncmVzcyA9IE1hdGgucm91bmQocGVyY2VudGFnZSk7DQoNCgkJLy9jb25zb2xlLmxvZyhjb21wb25lbnQsIGZvcm1hdEJ5dGVzKHByZXZpb3VzTG9hZGVkRmlsZVNpemUpLCBmb3JtYXRCeXRlcyhsb2FkZWQpLCBmb3JtYXRCeXRlcyhjdXJyZW50TG9hZGVkKSwgZm9ybWF0Qnl0ZXModG90YWwpKTsNCg0KCQkkcHJvZ3Jlc3Muc2V0QXR0cmlidXRlKCdzdHJva2UtZGFzaG9mZnNldCcsIGAke29mZnNldH1weGApOw0KCQkkcGVyY2VudGFnZS5pbm5lckhUTUwgPSBgJHtwcm9ncmVzc30lYDsNCgkJJGxvYWRlZC5pbm5lckhUTUwgPSBmb3JtYXRCeXRlcyhjdXJyZW50TG9hZGVkKTsNCgkJJGxvYWRlZFRleHQuaW5uZXJIVE1MID0gZm9ybWF0Qnl0ZXMobG9hZGVkRmlsZVNpemUpOw0KDQoJCWlmKGN1cnJlbnRQcm9ncmVzcyA+PSAxMDApIHsNCgkJCXByZXZpb3VzTG9hZGVkRmlsZVNpemUgPSAwOw0KCQl9DQoJfTsNCgljb25zdCBzZXRQcm9ncmVzc0luZGV0ZXJtaW5hdGUgPSAoaW5kZXRlcm1pbmF0ZSwgaGlkZUluZm8gPSBmYWxzZSkgPT4gew0KCQljb25zdCAkcHJvZ3Jlc3NJbmZvICAgPSAkcHJlbG9hZGVyLnF1ZXJ5U2VsZWN0b3IoJy5wcmVsb2FkZXIgPiAuc2duLWxvYWRlci1wcm9ncmVzcy1pbmZvJyk7DQoJCWlmKGluZGV0ZXJtaW5hdGUpIHsNCgkJCSRwcmVsb2FkZXIuY2xhc3NMaXN0LnJlbW92ZSgnZGV0ZXJtaW5hdGUnKTsNCgkJCSRwcmVsb2FkZXIuY2xhc3NMaXN0LmFkZCgnaW5kZXRlcm1pbmF0ZScpOw0KCQkJaWYoaGlkZUluZm8pIHsNCgkJCQlpZih3aW5kb3cualF1ZXJ5KQ0KCQkJCQkkKCRwcm9ncmVzc0luZm8pLmZhZGVPdXQoNTAwKTsNCgkJCQllbHNlDQoJCQkJCSRwcm9ncmVzc0luZm8uc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCgkJCX0NCgkJfSBlbHNlIHsNCgkJCWlmKHdpbmRvdy5qUXVlcnkpDQoJCQkJJCgkcHJvZ3Jlc3NJbmZvKS5mYWRlSW4oNTAwKTsNCgkJCWVsc2UNCgkJCQkkcHJvZ3Jlc3NJbmZvLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7DQoJCQkkcHJlbG9hZGVyLmNsYXNzTGlzdC5yZW1vdmUoJ2luZGV0ZXJtaW5hdGUnKTsNCgkJCSRwcmVsb2FkZXIuY2xhc3NMaXN0LmFkZCgnZGV0ZXJtaW5hdGUnKTsNCgkJfQ0KCX07DQoNCglmdW5jdGlvbiBnZXRGaWxlU2l6ZSh1cmwsIGNhbGxiYWNrKSB7DQoJCWNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOw0KCQl4aHIub3BlbigiSEVBRCIsIHVybCwgdHJ1ZSk7IC8vIE5vdGljZSAiSEVBRCIgaW5zdGVhZCBvZiAiR0VUIix0byBnZXQgb25seSB0aGUgaGVhZGVyDQoJCXhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHsNCgkJCWlmKHRoaXMucmVhZHlTdGF0ZSA9PT0gdGhpcy5ET05FKSB7DQoJCQkJY2FsbGJhY2socGFyc2VJbnQoeGhyLmdldFJlc3BvbnNlSGVhZGVyKCJDb250ZW50LUxlbmd0aCIpKSk7DQoJCQl9DQoJCX07DQoJCXhoci5zZW5kKCk7DQoJfQ0KDQoJZnVuY3Rpb24gZ2V0RmlsZW5hbWVBbmRFeHRlbnNpb24ocGF0aCkgew0KCQlpZihwYXRoICE9PSB1bmRlZmluZWQpIHsNCgkJCWNvbnN0IGZpbGVuYW1lZXh0ZW5zaW9uID0gcGF0aC5yZXBsYWNlKC9eLipbXFxcL10vLCAiIiksIGZpbGVuYW1lID0gZmlsZW5hbWVleHRlbnNpb24uc3Vic3RyaW5nKDAsIGZpbGVuYW1lZXh0ZW5zaW9uLmxhc3RJbmRleE9mKCIuIikpLCBleHQgPSBmaWxlbmFtZWV4dGVuc2lvbi5zcGxpdCgiLiIpLnBvcCgpOw0KDQoJCQlyZXR1cm4gew0KCQkJCSJuYW1lIjogZmlsZW5hbWUsICJleHQiOiBleHQNCgkJCX07DQoJCX0NCgkJcmV0dXJuIHsNCgkJCSJuYW1lIjogIiIsICJleHQiOiAiIg0KCQl9Ow0KCX0NCg0KCS8qKg0KCSAqDQoJICogQHBhcmFtIHtbXX1maWxlcw0KCSAqIEBwYXJhbSBjYWxsYmFjaw0KCSAqLw0KCWNvbnN0IGNhbGN1bGF0ZUZpbGVTaXplcyA9IChmaWxlcyA9IFtdLCBjYWxsYmFjaykgPT4gew0KCQlmaWxlcyA9IGZpbGVzIHx8IFtdOw0KCQljb25zdCBsID0gZmlsZXMubGVuZ3RoOw0KCQlpZihsID4gMCkgew0KCQkJZm9yKGxldCBpID0gMDsgaSA8IGw7IGkrKykgew0KCQkJCWNvbnN0IGNvbXBvbmVudCA9IGZpbGVzW2ldLCBzcmMgPSB1cmwgKyBjb21wb25lbnQ7DQoJCQkJZ2V0RmlsZVNpemUoc3JjLCAoc2l6ZSkgPT4gew0KCQkJCQl0b3RhbEZpbGVTaXplICs9IHNpemU7DQoJCQkJCWZpbGVTaXplc1tjb21wb25lbnRdID0gc2l6ZTsNCgkJCQkJZmlsZVNpemVzLmxlbmd0aCsrOw0KDQoJCQkJCWlmKGkgPj0gbCAtIDEpIHsNCgkJCQkJCWlmKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykgew0KCQkJCQkJCWNhbGxiYWNrKHRvdGFsRmlsZVNpemUpOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfSk7DQoJCQl9DQoJCX0NCgl9Ow0KDQoJKGFzeW5jIHByZWNhbGxiYWNrID0+IHsNCgkJY29uc3QgdGl0bGUgPSBkb2N1bWVudC50aXRsZTsNCgkJaWYodGl0bGUgIT09IHVuZGVmaW5lZCkgZG9jdW1lbnQudGl0bGUgPSAiTG9hZGluZy4uLiI7DQoNCgkJaWYod2luZG93LmpRdWVyeSkgJC5ob2xkUmVhZHkodHJ1ZSk7DQoNCgkJY29uc3QgZmlsZXN0b2xvYWQgPSBwcmVsb2FkLmxlbmd0aDsNCgkJbGV0IGZpbGVzbG9hZGVkID0gMCwgcHJvZ3Jlc3MgPSAwOw0KDQoJCWlmKGZpbGVzdG9sb2FkID4gMCkgew0KCQkJaWYoIWluZGV0ZXJtaW5hdGVQcm9ncmVzcykgew0KCQkJCWNvbnN0IGFsbEZpbGVzID0gWy4uLnByZWxvYWQsIC4uLnN0eWxlcywgLi4uc2NyaXB0c107DQoJCQkJY2FsY3VsYXRlRmlsZVNpemVzKGFsbEZpbGVzLCBhc3luYyh0b3RhbCkgPT4gew0KCQkJCQlzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsNCgkJCQkJCWNvbnN0ICR0b3RhbFRleHQgPSAkcHJlbG9hZGVyLnF1ZXJ5U2VsZWN0b3IoInN2ZyA+IHRleHQjc2duLWxvYWRlci1wcm9ncmVzcy10b3RhbCIpOw0KCQkJCQkJJHRvdGFsVGV4dC5pbm5lckhUTUwgPSBmb3JtYXRCeXRlcyh0b3RhbCk7DQoJCQkJCQlzZXRQcm9ncmVzc0luZGV0ZXJtaW5hdGUoZmFsc2UpOw0KDQoJCQkJCQlmb3IobGV0IGkgPSAwOyBpIDwgZmlsZXN0b2xvYWQ7IGkrKykgew0KCQkJCQkJCWNvbnN0IGNvbXBvbmVudCA9IHByZWxvYWRbaV0sIHNyYyA9IHVybCArIGNvbXBvbmVudCwgbmFtZSA9ICJqc18iICsgZ2V0RmlsZW5hbWVBbmRFeHRlbnNpb24oY29tcG9uZW50KS5uYW1lOw0KCQkJCQkJCWNvbnN0IG9iaiA9IHt9Ow0KCQkJCQkJCW9ialtuYW1lXSA9IGNvbXBvbmVudDsNCg0KCQkJCQkJCWlmKCFTR05VSUtpdC5pc0NvbXBvbmVudExvYWRlZChuYW1lKSkgew0KCQkJCQkJCQljb25zdCByZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsNCgkJCQkJCQkJcmVxLm9ucHJvZ3Jlc3MgPSAoZSkgPT4gew0KCQkJCQkJCQkJaWYoZS5sZW5ndGhDb21wdXRhYmxlKSB7DQoJCQkJCQkJCQkJc2V0UHJvZ3Jlc3NJbmZvKCJwcmVsb2FkIiwgbmFtZSwgZS50b3RhbCk7DQoJCQkJCQkJCQkJdXBkYXRlUHJvZ3Jlc3MoZS5sb2FkZWQsIGUudG90YWwsIG5hbWUpOw0KCQkJCQkJCQkJfSBlbHNlIGlmKGUubG9hZGVkKSB7DQoJCQkJCQkJCQkJc2V0UHJvZ3Jlc3NJbmZvKCJwcmVsb2FkIiwgbmFtZSwgMCk7DQoJCQkJCQkJCQkJdXBkYXRlUHJvZ3Jlc3MoZS5sb2FkZWQsIDAsIG5hbWUpOw0KCQkJCQkJCQkJfQ0KCQkJCQkJCQl9Ow0KCQkJCQkJCQlyZXEub3BlbigiR0VUIiwgc3JjLCB0cnVlKTsNCgkJCQkJCQkJcmVxLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKGUpIHsNCgkJCQkJCQkJCWlmKHJlcS5yZWFkeVN0YXRlID09PSA0KSB7DQoJCQkJCQkJCQkJY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7DQoJCQkJCQkJCQkJc2NyaXB0LnNldEF0dHJpYnV0ZSgic3JjIiwgc3JjKTsNCgkJCQkJCQkJCQljdXJyZW50U2NyaXB0LmFmdGVyKHNjcmlwdCk7DQoJCQkJCQkJCQkJaWYoaSA9PT0gMCkgc2NyaXB0LmlkID0gInNnbi1wcmVsb2FkLWVuZCI7DQoJCQkJCQkJCQkJc2NyaXB0Lm9ubG9hZCA9IGZ1bmN0aW9uKCkgew0KCQkJCQkJCQkJCQlmaWxlc2xvYWRlZCsrOw0KCQkJCQkJCQkJCQlTR05VSUtpdC5jb21wb25lbnQgPSBvYmo7DQoJCQkJCQkJCQkJCXNjcmlwdC5vbmxvYWQgPSBudWxsOw0KCQkJCQkJCQkJCQlmaW5pc2hMb2FkKCk7DQoJCQkJCQkJCQkJfTsNCgkJCQkJCQkJCX0NCgkJCQkJCQkJfTsNCgkJCQkJCQkJcmVxLnNlbmQoKTsNCgkJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCQlmaWxlc2xvYWRlZCsrOw0KCQkJCQkJCQlhd2FpdCBmaW5pc2hMb2FkKCk7DQoJCQkJCQkJfQ0KCQkJCQkJfQ0KCQkJCQl9LCAxMDAwKTsNCgkJCQl9KTsNCgkJCX0gZWxzZSB7DQoJCQkJZm9yKGxldCBpID0gMDsgaSA8IGZpbGVzdG9sb2FkOyBpKyspIHsNCgkJCQkJY29uc3QgY29tcG9uZW50ID0gcHJlbG9hZFtpXSwgc3JjID0gdXJsICsgY29tcG9uZW50LCBuYW1lID0gImpzXyIgKyBnZXRGaWxlbmFtZUFuZEV4dGVuc2lvbihjb21wb25lbnQpLm5hbWU7DQoJCQkJCWNvbnN0IG9iaiA9IHt9Ow0KCQkJCQlvYmpbbmFtZV0gPSBjb21wb25lbnQ7DQoNCgkJCQkJaWYoIVNHTlVJS2l0LmlzQ29tcG9uZW50TG9hZGVkKG5hbWUpKSB7DQoJCQkJCQljb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsNCgkJCQkJCXNjcmlwdC5zcmMgPSBzcmM7DQoJCQkJCQlzY3JpcHQuYXN5bmMgPSBmYWxzZTsNCgkJCQkJCXNjcmlwdC5kZWZlciA9IGZhbHNlOw0KCQkJCQkJY3VycmVudFNjcmlwdC5hZnRlcihzY3JpcHQpOw0KCQkJCQkJaWYoaSA9PT0gMCkgc2NyaXB0LmlkID0gInNnbi1wcmVsb2FkLWVuZCI7DQoJCQkJCQlzY3JpcHQub25sb2FkID0gZnVuY3Rpb24oKSB7DQoJCQkJCQkJZmlsZXNsb2FkZWQrKzsNCgkJCQkJCQlTR05VSUtpdC5jb21wb25lbnQgPSBvYmo7DQoJCQkJCQkJc2NyaXB0Lm9ubG9hZCA9IG51bGw7DQoJCQkJCQkJZmluaXNoTG9hZCgpOw0KCQkJCQkJfTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCWZpbGVzbG9hZGVkKys7DQoJCQkJCQlhd2FpdCBmaW5pc2hMb2FkKCk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCX0gZWxzZSBpZighaW5kZXRlcm1pbmF0ZVByb2dyZXNzKSB7DQoJCQljb25zdCBhbGxGaWxlcyA9IFsuLi5wcmVsb2FkLCAuLi5zdHlsZXMsIC4uLnNjcmlwdHNdOw0KCQkJY2FsY3VsYXRlRmlsZVNpemVzKGFsbEZpbGVzLCBhc3luYyh0b3RhbCkgPT4gew0KCQkJCXNldFRpbWVvdXQoYXN5bmMgKCkgPT4gew0KCQkJCQljb25zdCAkdG90YWxUZXh0ID0gJHByZWxvYWRlci5xdWVyeVNlbGVjdG9yKCJzdmcgPiB0ZXh0I3Nnbi1sb2FkZXItcHJvZ3Jlc3MtdG90YWwiKTsNCgkJCQkJJHRvdGFsVGV4dC5pbm5lckhUTUwgPSBmb3JtYXRCeXRlcyh0b3RhbCk7DQoJCQkJCWF3YWl0IGZpbmlzaExvYWQoKTsNCgkJCQl9LCAxMDAwKTsNCgkJCX0pOw0KCQl9IGVsc2Ugew0KCQkJYXdhaXQgZmluaXNoTG9hZCgpOw0KCQl9DQoNCgkJYXN5bmMgZnVuY3Rpb24gZmluaXNoTG9hZCgpIHsNCgkJCXByb2dyZXNzID0gKGZpbGVzdG9sb2FkID4gMCkgPyBNYXRoLnJvdW5kKChmaWxlc2xvYWRlZCAqIDEwMCkgLyBmaWxlc3RvbG9hZCkgOiAxMDA7DQoNCgkJCWF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gew0KCQkJCWlmKGZpbGVzbG9hZGVkID49IGZpbGVzdG9sb2FkKSB7DQoJCQkJCXJlc29sdmUoKTsNCgkJCQl9DQoJCQl9KS50aGVuKGZ1bmN0aW9uKCkgew0KCQkJCWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImhlYWQgPiB0aXRsZSIpLmlubmVySFRNTCA9IHRpdGxlOw0KCQkJCWlmKHR5cGVvZiBwcmVjYWxsYmFjayA9PT0gImZ1bmN0aW9uIiAmJiBwcm9ncmVzcyA9PT0gMTAwKSBwcmVjYWxsYmFjaygpOw0KCQkJfSk7DQoJCX0NCg0KCQl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigib2ZmbGluZSIsIChlKSA9PiB7DQoJCQljb25zdCBnZXRJMThuU3RyaW5nID0gKGssIG0pID0+IG07DQoJCQljb25zdCAkYm9keSA9ICQoImJvZHkiKTsNCgkJCWxldCBvZmZsaW5lRXJyb3JNc2cgPSAoU0dOVUlLaXQucmVhZHkpID8NCgkJCSAgICAgICAgICAgICAgICAgICAgICBnZXRJMThuU3RyaW5nKCJzZ25fdWlraXRfZXJyb3JfdXNlcl9vZmZsaW5lX21zZyIsIGBTb3JyeSEgWW91IGFyZSBjdXJyZW50bHkgb2ZmbGluZS4gWW91J2xsIGJlIGFibGUgdG8gYWNjZXNzIHRoZSBhcHBsaWNhdGlvbiBvbmNlIHlvdXIgaW50ZXJuZXQgY29ubmVjdGlvbiBpcyByZXN0b3JlZC5gKSA6DQoJCQkgICAgICAgICAgICAgICAgICAgICAgZ2V0STE4blN0cmluZygic2duX3Vpa2l0X3VzZXJfb2ZmbGluZV9sb2FkaW5nX2ludGVycnVwdGVkX21zZyIsIGBTb3JyeSEgSW5pdGlhbCBsb2FkaW5nIGlzIGludGVycnVwdGVkLiBUaGUgYXBwbGljYXRpb24gd2lsbCBjb250aW51ZSB0byBsb2FkIG9uY2UgeW91ciBpbnRlcm5ldCBjb25uZWN0aW9uIGlzIHJlc3RvcmVkLmApOw0KCQkJaWYocHJvZ3Jlc3MgPCAxMDApIG9mZmxpbmVFcnJvck1zZyA9IGdldEkxOG5TdHJpbmcoInNnbl91aWtpdF91c2VyX29mZmxpbmVfcHJlbG9hZF9mYWlsZWRfbXNnIiwgYEhvb3JheSEgWW91ciBpbnRlcm5ldCBjb25uZWN0aW9uIGlzIHJlc3RvcmVkLCBidXQgaXQgaGFzIGJyb2tlbiB0aGUgYXBwbGljYXRpb24ncyBwcmVsb2FkIHByb2Nlc3MsIHBsZWFzZSByZWxvYWQgdGhlIHBhZ2UgdG8gZml4IGl0LmApOw0KCQkJY29uc3Qgb2ZmbGluZUVycm9ySGVhZGluZyA9IGdldEkxOG5TdHJpbmcoInR4dF9ub19pbnRlcm5ldCIsIGBObyBJbnRlcm5ldCFgKTsNCg0KCQkJbGV0IG92ZXJsYXlFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQoJCQlvdmVybGF5RWxlbS5jbGFzc05hbWUgPSAib3ZlcmxheSBibGFja291dCI7DQoJCQlsZXQgcHJlbG9hZGVyID0gYFx0XHQ8ZGl2IGNsYXNzPSJvZmZsaW5lLW1zZyI+XG5gOw0KCQkJcHJlbG9hZGVyICs9IGBcdFx0XHQ8aDIgY2xhc3M9InRpdGxlIGVycm9yIj4ke29mZmxpbmVFcnJvckhlYWRpbmd9PC9oMj5cbmA7DQoJCQlwcmVsb2FkZXIgKz0gYFx0XHRcdDxkaXYgY2xhc3M9Im1zZyI+JHtvZmZsaW5lRXJyb3JNc2d9PC9kaXY+XG5gOw0KCQkJcHJlbG9hZGVyICs9IGBcdFx0PC9kaXY+XG5gOw0KDQoJCQlvdmVybGF5RWxlbS5pbm5lckhUTUwgPSBwcmVsb2FkZXI7DQoJCQkkKCIuc2duLXByZWxvYWRlciIpLmZhZGVPdXQoMTAwMCk7DQoJCQkkYm9keS5yZW1vdmVDbGFzcygiaGFzLXByZWxvYWRlciIpLmFkZENsYXNzKCJ1c2VyLW9mZmxpbmUiKTsNCgkJCWRvY3VtZW50LmJvZHkuaW5zZXJ0QmVmb3JlKG92ZXJsYXlFbGVtLCBkb2N1bWVudC5ib2R5LmZpcnN0Q2hpbGQpOw0KDQoJCQlvdmVybGF5RWxlbSA9ICQoIi51c2VyLW9mZmxpbmUgPiAub3ZlcmxheSIpOw0KDQoJCQlpZihvdmVybGF5RWxlbS5sZW5ndGggPiAwKSB7DQoJCQkJb3ZlcmxheUVsZW0uZmFkZUluKDEwMDApOw0KCQkJfQ0KCQl9KTsNCgkJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIm9ubGluZSIsIChlKSA9PiB7DQoJCQljb25zdCBnZXRJMThuU3RyaW5nID0gKGssIG0pID0+IG07DQoJCQlsZXQgb25saW5lTXNnID0gKFNHTlVJS2l0LnJlYWR5KSA/DQoJCQkgICAgICAgICAgICAgICAgZ2V0STE4blN0cmluZygic2duX3Vpa2l0X3VzZXJfb25saW5lX21zZyIsIGBIb29yYXkhIFlvdXIgaW50ZXJuZXQgY29ubmVjdGlvbiBpcyByZXN0b3JlZCwgeW91J2xsIG5vdyBiZSBhYmxlIHRvIGFjY2VzcyB0aGUgYXBwbGljYXRpb24gc2hvcnRseS5gKSA6DQoJCQkgICAgICAgICAgICAgICAgZ2V0STE4blN0cmluZygic2duX3Vpa2l0X3VzZXJfb25saW5lX2xvYWRpbmdfaW50ZXJydXB0ZWRfbXNnIiwgYEhvb3JheSEgWW91ciBpbnRlcm5ldCBjb25uZWN0aW9uIGlzIHJlc3RvcmVkLCB0aGUgYXBwbGljYXRpb24gd2lsbCByZXN1bWUgdG8gbG9hZCBzaG9ydGx5LmApOw0KCQkJaWYocHJvZ3Jlc3MgPCAxMDApIG9ubGluZU1zZyA9IGdldEkxOG5TdHJpbmcoInNnbl91aWtpdF91c2VyX29ubGluZV9wcmVsb2FkX2ZhaWxlZF9tc2ciLCBgSG9vcmF5ISBZb3VyIGludGVybmV0IGNvbm5lY3Rpb24gaXMgcmVzdG9yZWQsIGJ1dCBpdCBoYXMgYnJva2VuIHRoZSBhcHBsaWNhdGlvbidzIHByZWxvYWQgcHJvY2VzcywgcGxlYXNlIHJlbG9hZCB0aGUgcGFnZSB0byBmaXggaXQuYCk7DQoJCQljb25zdCBvbmxpbmVIZWFkaW5nID0gZ2V0STE4blN0cmluZygidHh0X2ludGVybmV0X2Nvbm5lY3Rpb25fcmVzdG9yZWQiLCBgSW50ZXJuZXQgQ29ubmVjdGlvbiBSZXN0b3JlZCFgKTsNCg0KCQkJY29uc3QgJG92ZXJsYXlFbGVtID0gJCgiLnVzZXItb2ZmbGluZSA+IC5vdmVybGF5Iik7DQoJCQljb25zdCAkaGVhZGluZyA9ICRvdmVybGF5RWxlbS5maW5kKCIudGl0bGUiKSwgJG1zZyA9ICRvdmVybGF5RWxlbS5maW5kKCIubXNnIik7DQoJCQlsZXQgTVNHX1RJTUVPVVQgPSAxMDAwMDsNCgkJCWlmKHR5cGVvZiAkLlNHTlNuYWNrYmFyID09PSAiZnVuY3Rpb24iKSB7DQoJCQkJTVNHX1RJTUVPVVQgPSA1MDsNCgkJCQkkLlNHTlNuYWNrYmFyKG9ubGluZU1zZykuc2hvdygpOw0KCQkJfSBlbHNlIHsNCgkJCQkkaGVhZGluZy5odG1sKG9ubGluZUhlYWRpbmcpLnJlbW92ZUNsYXNzKCJlcnJvciIpLmFkZENsYXNzKCJzdWNjZXNzIik7DQoJCQkJJG1zZy5odG1sKG9ubGluZU1zZyk7DQoJCQl9DQoNCgkJCWlmKCRvdmVybGF5RWxlbS5sZW5ndGggPiAwKSB7DQoJCQkJc2V0VGltZW91dCgoKSA9PiB7DQoJCQkJCSQoIi5zZ24tcHJlbG9hZGVyIikuZmFkZUluKDEwMDApOw0KCQkJCQkkb3ZlcmxheUVsZW0uZmFkZU91dCgxMDAwLCAoKSA9PiB7DQoJCQkJCQkkb3ZlcmxheUVsZW0ucmVtb3ZlKCk7DQoJCQkJCQlkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoInVzZXItb2ZmbGluZSIpOw0KCQkJCQkJJCgiYm9keSIpLmFkZENsYXNzKCJoYXMtcHJlbG9hZGVyIik7DQoJCQkJCX0pOw0KCQkJCX0sIE1TR19USU1FT1VUKTsNCgkJCX0NCg0KCQkJaWYodHlwZW9mIHByZWNhbGxiYWNrID09PSAiZnVuY3Rpb24iICYmIHByb2dyZXNzID09PSAxMDApIHByZWNhbGxiYWNrKCk7DQoJCX0pOw0KCX0pKGZ1bmN0aW9uKCkgew0KCQkoYXN5bmMgY2FsbGJhY2sgPT4gew0KCQkJbGV0IHNjcmlwdHNMb2FkZWQgPSAwLCBzdHlsZXNMb2FkZWQgPSAwLCBsb2FkZWQgPSAwLCBsYXN0U2NyaXB0ID0gY3VycmVudFNjcmlwdDsNCgkJCWNvbnN0IHRvdGFsU2NyaXB0cyA9IHNjcmlwdHMubGVuZ3RoLCB0b3RhbFN0eWxlcyA9IHN0eWxlcy5sZW5ndGgsIHRvdGFsID0gdG90YWxTY3JpcHRzICsgdG90YWxTdHlsZXM7DQoNCgkJCWNvbnN0IGxvYWRTY3JpcHQgPSBpID0+IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCgkJCQlpZihpID09PSBzY3JpcHRzLmxlbmd0aCkgcmV0dXJuOw0KDQoJCQkJY29uc3QgY29tcG9uZW50ID0gc2NyaXB0c1tpXSwgc3JjID0gdXJsICsgY29tcG9uZW50LCBmaWxlbmFtZSA9IGdldEZpbGVuYW1lQW5kRXh0ZW5zaW9uKGNvbXBvbmVudCkubmFtZSwNCgkJCQkgICAgICBuYW1lID0gKGNvbXBvbmVudC5pbmRleE9mKCdEYXRlVGltZS9jb21tb25zJykgIT09IC0xKSA/IGBkYXRlX3RpbWVfJHtmaWxlbmFtZX1gIDogYCR7ZmlsZW5hbWV9YCwgY29tcG9uZW50TmFtZSA9IGBqc18ke25hbWV9YDsNCgkJCQljb25zdCBvYmogPSB7fTsNCgkJCQlvYmpbY29tcG9uZW50TmFtZV0gPSBjb21wb25lbnQ7DQoNCgkJCQljb25zdCB0eXBlID0gKGNvbXBvbmVudC5pbmRleE9mKCdjc3MvJykgIT09IC0xKSA/ICdsYXlvdXQnIDoNCgkJCQkgICAgICAgICAgICAgKGNvbXBvbmVudC5pbmRleE9mKCdqcy9oZWxwZXJzJykgIT09IC0xKSA/ICdoZWxwZXInIDoNCgkJCQkgICAgICAgICAgICAgKGNvbXBvbmVudC5pbmRleE9mKCdqcy9jb21tb25zJykgIT09IC0xKSA/ICdjb21tb25zJyA6DQoJCQkJICAgICAgICAgICAgIChjb21wb25lbnQuaW5kZXhPZignanMvdXRpbGl0aWVzJykgIT09IC0xKSA/ICd1dGlsaXR5JyA6DQoJCQkJICAgICAgICAgICAgIChjb21wb25lbnQuaW5kZXhPZignanMvYWRkb25zJykgIT09IC0xKSA/ICdjb21wb25lbnQnIDoNCgkJCQkgICAgICAgICAgICAgKGNvbXBvbmVudC5pbmRleE9mKCdhZGRvbnMnKSAhPT0gLTEpID8gJ2FkZG9uJyA6ICdjb21wb25lbnQnOw0KDQoJCQkJaWYoIVNHTlVJS2l0LmlzQ29tcG9uZW50TG9hZGVkKGNvbXBvbmVudE5hbWUpKSB7DQoJCQkJCWlmKCFpbmRldGVybWluYXRlUHJvZ3Jlc3MpIHsNCgkJCQkJCXNldFByb2dyZXNzSW5kZXRlcm1pbmF0ZShmYWxzZSk7DQoJCQkJCQljb25zdCByZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsNCgkJCQkJCXJlcS5vbnByb2dyZXNzID0gKGUpID0+IHsNCgkJCQkJCQlpZihlLmxlbmd0aENvbXB1dGFibGUpIHsNCgkJCQkJCQkJc2V0UHJvZ3Jlc3NJbmZvKHR5cGUsIG5hbWUsIGUudG90YWwpOw0KCQkJCQkJCQl1cGRhdGVQcm9ncmVzcyhlLmxvYWRlZCwgZS50b3RhbCwgbmFtZSk7DQoJCQkJCQkJfSBlbHNlIGlmKGUubG9hZGVkKSB7DQoJCQkJCQkJCXNldFByb2dyZXNzSW5mbyh0eXBlLCBuYW1lLCAwKTsNCgkJCQkJCQkJdXBkYXRlUHJvZ3Jlc3MoZS5sb2FkZWQsIDAsIG5hbWUpOw0KCQkJCQkJCX0NCgkJCQkJCX07DQoJCQkJCQlyZXEub3BlbignR0VUJywgc3JjLCB0cnVlKTsNCgkJCQkJCXJlcS5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbihlKSB7DQoJCQkJCQkJaWYocmVxLnJlYWR5U3RhdGUgPT09IDQpIHsNCgkJCQkJCQkJY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7DQoJCQkJCQkJCXNjcmlwdC5zZXRBdHRyaWJ1dGUoJ3NyYycsIHNyYyk7DQoJCQkJCQkJCWxhc3RTY3JpcHQuYWZ0ZXIoc2NyaXB0KTsNCgkJCQkJCQkJbGFzdFNjcmlwdCA9IGxhc3RTY3JpcHQubmV4dEVsZW1lbnRTaWJsaW5nIHx8IGN1cnJlbnRTY3JpcHQ7DQoNCgkJCQkJCQkJc2NyaXB0Lm9ubG9hZCA9IGZ1bmN0aW9uKCkgew0KCQkJCQkJCQkJU0dOVUlLaXQuY29tcG9uZW50ID0gb2JqOw0KCQkJCQkJCQkJc2NyaXB0Lm9ubG9hZCA9IG51bGw7DQoJCQkJCQkJCQlzY3JpcHRzTG9hZGVkKys7DQoJCQkJCQkJCQlsb2FkZWQrKzsNCg0KCQkJCQkJCQkJaWYoc2NyaXB0c0xvYWRlZCA9PT0gdG90YWxTY3JpcHRzKSByZXNvbHZlKGkpOyBlbHNlIHJlc29sdmUobG9hZFNjcmlwdCgrK2kpKTsNCgkJCQkJCQkJfTsNCgkJCQkJCQl9DQoJCQkJCQl9Ow0KCQkJCQkJcmVxLnNlbmQoKTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCWNvbnN0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOw0KCQkJCQkJc2NyaXB0LnNyYyA9IHNyYzsNCgkJCQkJCWxhc3RTY3JpcHQuYWZ0ZXIoc2NyaXB0KTsNCgkJCQkJCWxhc3RTY3JpcHQgPSBsYXN0U2NyaXB0Lm5leHRFbGVtZW50U2libGluZyB8fCBjdXJyZW50U2NyaXB0Ow0KDQoJCQkJCQlzY3JpcHQub25sb2FkID0gYXN5bmMgZnVuY3Rpb24oKSB7DQoJCQkJCQkJU0dOVUlLaXQuY29tcG9uZW50ID0gb2JqOw0KCQkJCQkJCXNjcmlwdC5vbmxvYWQgPSBudWxsOw0KCQkJCQkJCXNjcmlwdHNMb2FkZWQrKzsNCgkJCQkJCQlsb2FkZWQrKzsNCg0KCQkJCQkJCWlmKHNjcmlwdHNMb2FkZWQgPT09IHRvdGFsU2NyaXB0cykgcmVzb2x2ZShpKTsgZWxzZSByZXNvbHZlKGxvYWRTY3JpcHQoKytpKSk7DQoJCQkJCQl9Ow0KCQkJCQl9DQoJCQkJfSBlbHNlIHsNCgkJCQkJc2NyaXB0c0xvYWRlZCsrOw0KCQkJCQlsb2FkZWQrKzsNCg0KCQkJCQlpZihzY3JpcHRzTG9hZGVkID09PSB0b3RhbFNjcmlwdHMpIHJlc29sdmUoaSk7IGVsc2UgcmVzb2x2ZShsb2FkU2NyaXB0KCsraSkpOw0KCQkJCX0NCgkJCX0pOw0KDQoJCQljb25zdCBsb2FkU3R5bGUgPSBpID0+IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCgkJCQlpZihpID09PSBzdHlsZXMubGVuZ3RoKSByZXR1cm47DQoNCgkJCQljb25zdCBjb21wb25lbnQgPSBzdHlsZXNbaV0sIHNyYyA9IHVybCArIGNvbXBvbmVudCwgbmFtZSA9IGdldEZpbGVuYW1lQW5kRXh0ZW5zaW9uKGNvbXBvbmVudCkubmFtZSwgY29tcG9uZW50TmFtZSA9IGBjc3NfJHtuYW1lfWA7DQoJCQkJY29uc3Qgb2JqID0ge307DQoJCQkJb2JqW2NvbXBvbmVudE5hbWVdID0gY29tcG9uZW50Ow0KCQkJCWNvbnN0IHR5cGUgPSAnbGF5b3V0JzsNCg0KCQkJCWlmKCFTR05VSUtpdC5pc0NvbXBvbmVudExvYWRlZChjb21wb25lbnROYW1lKSkgew0KCQkJCQlpZighaW5kZXRlcm1pbmF0ZVByb2dyZXNzKSB7DQoJCQkJCQlzZXRQcm9ncmVzc0luZGV0ZXJtaW5hdGUoZmFsc2UpOw0KCQkJCQkJY29uc3QgcmVxID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7DQoJCQkJCQlyZXEub25wcm9ncmVzcyA9IChlKSA9PiB7DQoJCQkJCQkJaWYoZS5sZW5ndGhDb21wdXRhYmxlKSB7DQoJCQkJCQkJCXNldFByb2dyZXNzSW5mbyh0eXBlLCBuYW1lLCBlLnRvdGFsKTsNCgkJCQkJCQkJdXBkYXRlUHJvZ3Jlc3MoZS5sb2FkZWQsIGUudG90YWwsIG5hbWUpOw0KCQkJCQkJCX0gZWxzZSBpZihlLmxvYWRlZCkgew0KCQkJCQkJCQlzZXRQcm9ncmVzc0luZm8odHlwZSwgbmFtZSwgMCk7DQoJCQkJCQkJCXVwZGF0ZVByb2dyZXNzKGUubG9hZGVkLCAwLCBuYW1lKTsNCgkJCQkJCQl9DQoJCQkJCQl9Ow0KCQkJCQkJcmVxLm9wZW4oJ0dFVCcsIHNyYywgdHJ1ZSk7DQoJCQkJCQlyZXEub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oZSkgew0KCQkJCQkJCWlmKHJlcS5yZWFkeVN0YXRlID09PSA0KSB7DQoJCQkJCQkJCWNvbnN0IHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGluaycpOw0KCQkJCQkJCQlzdHlsZS5zZXRBdHRyaWJ1dGUoJ3JlbCcsICdzdHlsZXNoZWV0Jyk7DQoJCQkJCQkJCXN0eWxlLnNldEF0dHJpYnV0ZSgnaHJlZicsIHNyYyk7DQoJCQkJCQkJCWN1cnJlbnRTY3JpcHQuYWZ0ZXIoc3R5bGUpOw0KDQoJCQkJCQkJCXN0eWxlLm9ubG9hZCA9IGFzeW5jIGZ1bmN0aW9uKCkgew0KCQkJCQkJCQkJU0dOVUlLaXQuY29tcG9uZW50ID0gb2JqOw0KCQkJCQkJCQkJc3R5bGUub25sb2FkID0gbnVsbDsNCgkJCQkJCQkJCXN0eWxlc0xvYWRlZCsrOw0KCQkJCQkJCQkJbG9hZGVkKys7DQoNCgkJCQkJCQkJCWlmKHN0eWxlc0xvYWRlZCA9PT0gdG90YWxTdHlsZXMpIHJlc29sdmUoaSk7IGVsc2UgcmVzb2x2ZShsb2FkU3R5bGUoKytpKSk7DQoJCQkJCQkJCX07DQoJCQkJCQkJfQ0KCQkJCQkJfTsNCgkJCQkJCXJlcS5zZW5kKCk7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQljb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxpbmsiKTsNCgkJCQkJCXN0eWxlLnJlbCA9ICJzdHlsZXNoZWV0IjsNCgkJCQkJCXN0eWxlLmhyZWYgPSBzcmM7DQoJCQkJCQljdXJyZW50U2NyaXB0LmFmdGVyKHN0eWxlKTsNCgkJCQkJCXN0eWxlLm9ubG9hZCA9IGFzeW5jIGZ1bmN0aW9uKCkgew0KCQkJCQkJCVNHTlVJS2l0LmNvbXBvbmVudCA9IG9iajsNCgkJCQkJCQlzdHlsZS5vbmxvYWQgPSBudWxsOw0KCQkJCQkJCXN0eWxlc0xvYWRlZCsrOw0KCQkJCQkJCWxvYWRlZCsrOw0KDQoJCQkJCQkJaWYoc3R5bGVzTG9hZGVkID09PSB0b3RhbFN0eWxlcykgcmVzb2x2ZShpKTsgZWxzZSByZXNvbHZlKGxvYWRTdHlsZSgrK2kpKTsNCgkJCQkJCX07DQoJCQkJCX0NCgkJCQl9IGVsc2Ugew0KCQkJCQlzdHlsZXNMb2FkZWQrKzsNCgkJCQkJbG9hZGVkKys7DQoNCgkJCQkJaWYoc3R5bGVzTG9hZGVkID09PSB0b3RhbFN0eWxlcykgcmVzb2x2ZShpKTsgZWxzZSByZXNvbHZlKGxvYWRTdHlsZSgrK2kpKTsNCgkJCQl9DQoJCQl9KTsNCg0KCQkJKCgpID0+IHsNCgkJCQljb25zdCBzdGFydExvYWQgPSBuZXcgUHJvbWlzZShhc3luYyBmdW5jdGlvbihyZXNvbHZlKSB7DQoJCQkJCWF3YWl0IGxvYWRTdHlsZSgwKTsNCgkJCQkJYXdhaXQgbG9hZFNjcmlwdCgwKTsNCgkJCQkJaWYobG9hZGVkID09PSB0b3RhbCkgcmVzb2x2ZSgpOw0KCQkJCX0pOw0KDQoJCQkJc3RhcnRMb2FkLnRoZW4oKCkgPT4gew0KCQkJCQlzZXRQcm9ncmVzc0luZGV0ZXJtaW5hdGUodHJ1ZSwgdHJ1ZSk7DQoJCQkJCXNldFRpbWVvdXQoZmluaXNoTG9hZCwgMTAwMCk7DQoJCQkJfSk7DQoJCQl9KSgpOw0KDQoJCQlhc3luYyBmdW5jdGlvbiBmaW5pc2hMb2FkKCkgew0KCQkJCWNvbnN0IHByb2dyZXNzID0gTWF0aC5yb3VuZCgobG9hZGVkICogMTAwKSAvIHRvdGFsKTsNCg0KCQkJCWF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gew0KCQkJCQlpZihsb2FkZWQgPT09IHRvdGFsKSB7DQoJCQkJCQlyZXNvbHZlKCk7DQoJCQkJCX0NCgkJCQl9KS50aGVuKGZ1bmN0aW9uKCkgew0KCQkJCQlpZih0eXBlb2YgY2FsbGJhY2sgPT09ICJmdW5jdGlvbiIpIGNhbGxiYWNrKGxvYWRlZCwgdG90YWwsIHByb2dyZXNzKTsNCgkJCQl9KTsNCgkJCX0NCgkJfSkoKGxvYWRlZCwgdG90YWwsIHByb2dyZXNzKSA9PiB7DQoJCQlpZihwcm9ncmVzcyA9PT0gMTAwKSB7DQoJCQkJU0dOVUlLaXQuaW5pdCA9IHRydWU7DQoNCgkJCQljb25zdCBzdHlsZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJzdHlsZSNzZ24tdWlraXQtc3R5bGVzIik7DQoJCQkJY29uc3QgbGVmdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInN0eWxlW2RhdGEtY2tlPVwidHJ1ZVwiXSIpOw0KCQkJCWlmKGxlZnQgIT09IG51bGwpIGxlZnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChsZWZ0KTsNCgkJCQlpZihzdHlsZXMgIT09IG51bGwpIHN0eWxlcy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHN0eWxlcyk7DQoNCgkJCQlpZih0eXBlb2Ygd2luZG93LmpRdWVyeSAhPT0gInVuZGVmaW5lZCIpIHsNCgkJCQkJJC5ob2xkUmVhZHkoZmFsc2UpOw0KCQkJCQlqUXVlcnkucmVhZHkoKTsNCgkJCQl9DQoJCQl9DQoJCX0pOw0KCX0pOw0KDQoJKCgpID0+IHsNCgkJbGV0IGlzUHJpbWFyeUZ1bmN0aW9uc0ZpbmFsaXplZCA9IGZhbHNlLA0KCQkgICAgaXNTVUtJVHJpZ2dlcmVkICAgICAgICAgICAgID0gZmFsc2UsDQoJCSAgICBpc1NVS1JUcmlnZ2VyZWQgICAgICAgICAgICAgPSBmYWxzZSwNCgkJICAgIGlzUHJlbG9hZGVySGlkZGVuICAgICAgICAgICA9IGZhbHNlLA0KCQkgICAgaXNGaW5hbGl6ZWQgICAgICAgICAgICAgICAgID0gKGlzUHJpbWFyeUZ1bmN0aW9uc0ZpbmFsaXplZCAmJiBpc1NVS0lUcmlnZ2VyZWQgJiYgaXNTVUtSVHJpZ2dlcmVkKSwNCgkJICAgIGlzUmVhZHkgICAgICAgICAgICAgICAgICAgICA9IChpc0ZpbmFsaXplZCAmJiBpc1ByZWxvYWRlckhpZGRlbik7DQoNCgkJY29uc3QgZmluYWxpemUgPSAoaG9sZFJlYWR5ID0gZmFsc2UsIGhvbGRQcmVsb2FkZXIgPSBmYWxzZSkgPT4gew0KCQkJY29uc3QgJGJvZHkgPSAkKCJib2R5Iik7DQoNCgkJCWNvbnN0IGZpbmFsaXplTG9hZGVyID0gKHRyaWdnZXJTVUtJID0gZmFsc2UsIHRyaWdnZXJTVUtSID0gdHJ1ZSkgPT4gew0KDQoJCQkJaWYodHJpZ2dlclNVS0kgJiYgIWlzU1VLSVRyaWdnZXJlZCkgew0KCQkJCQlpc1NVS0lUcmlnZ2VyZWQgPSB0cnVlOw0KCQkJCQlTVUtJSW5zdGFuY2VzLnNldE9uQ2hhbmdlTGlzdGVuZXIoKGluc3RhbmNlLCBpbnN0YW5jZXMpID0+IHsNCgkJCQkJCWZvckVhY2goaW5zdGFuY2VzLCBpbnN0ID0+IHsNCgkJCQkJCQlpbnN0LnRyaWdnZXIoKTsNCgkJCQkJCX0pOw0KCQkJCQl9KTsNCgkJCQl9DQoJCQkJaWYoaXNQcmltYXJ5RnVuY3Rpb25zRmluYWxpemVkKSB7DQoJCQkJCWlmKCFob2xkUmVhZHkpIHsNCgkJCQkJCWlmKHRyaWdnZXJTVUtSKSB7DQoJCQkJCQkJaXNTVUtSVHJpZ2dlcmVkID0gdHJ1ZTsNCgkJCQkJCQlTVUtSSW5zdGFuY2VzLnNldE9uQ2hhbmdlTGlzdGVuZXIoKGluc3RhbmNlLCBpbnN0YW5jZXMpID0+IHsNCgkJCQkJCQkJZm9yRWFjaChpbnN0YW5jZXMsIGluc3QgPT4gew0KCQkJCQkJCQkJaW5zdC50cmlnZ2VyKCk7DQoJCQkJCQkJCX0pOw0KCQkJCQkJCX0pOw0KCQkJCQkJfQ0KDQoJCQkJCQlTR05VSUtpdC5yZWFkeSA9IHRydWU7DQoJCQkJCQl3aW5kb3cuU0dOVUlLaXRSZWFkeSA9IHRydWU7DQoJCQkJCQlpc1JlYWR5ID0gaXNGaW5hbGl6ZWQ7DQoJCQkJCX0NCgkJCQkJaWYoU0dOVUlLaXQucmVhZHkpIHsNCgkJCQkJCWlmKCFob2xkUHJlbG9hZGVyKSB7DQoJCQkJCQkJJGJvZHkuY2hpbGRyZW4oIi5zZ24tcHJlbG9hZGVyIikuZmFkZU91dCgyMDAwLCBmdW5jdGlvbigpIHsNCgkJCQkJCQkJJGJvZHkuY2hpbGRyZW4oIi5zZ24tcHJlbG9hZGVyIikucmVtb3ZlKCk7DQoJCQkJCQkJCSRib2R5LnJlbW92ZUNsYXNzKCJoYXMtcHJlbG9hZGVyIik7DQoJCQkJCQkJfSk7DQoJCQkJCQkJaXNQcmVsb2FkZXJIaWRkZW4gPSB0cnVlOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfQ0KCQkJfTsNCg0KCQkJLyogY29uc3QgZmluYWxpemVBbmRUcmlnZ2VyU1VLUiA9ICh0cmlnZ2VyU1VLUiA9IHRydWUpID0+IHsNCgkJCSBpZihpc1ByaW1hcnlGdW5jdGlvbnNGaW5hbGl6ZWQpIHsNCgkJCSBpZighaG9sZFJlYWR5ICYmIHRyaWdnZXJTVUtSKSB7DQoJCQkgaXNTVUtSVHJpZ2dlcmVkID0gdHJ1ZTsNCgkJCSBTVUtSSW5zdGFuY2VzLnNldE9uQ2hhbmdlTGlzdGVuZXIoKGluc3RhbmNlLCBpbnN0YW5jZXMpID0+IHsNCgkJCSBmb3JFYWNoKGluc3RhbmNlcywgaW5zdCA9PiB7DQoJCQkgaW5zdC50cmlnZ2VyKCk7DQoJCQkgfSk7DQoJCQkgfSk7DQoJCQkgfQ0KCQkJIGlmKCFob2xkUmVhZHkpIHsNCgkJCSBTR05VSUtpdC5yZWFkeSA9IHRydWU7DQoJCQkgd2luZG93LlNHTlVJS2l0UmVhZHkgPSB0cnVlOw0KCQkJIGlzUmVhZHkgPSBpc0ZpbmFsaXplZDsNCgkJCSB9DQoJCQkgaWYoU0dOVUlLaXQucmVhZHkpIHsNCgkJCSBpZighaG9sZFByZWxvYWRlcikgew0KCQkJICRib2R5LmNoaWxkcmVuKCIuc2duLXByZWxvYWRlciIpLmZhZGVPdXQoMjAwMCwgZnVuY3Rpb24oKSB7DQoJCQkgJGJvZHkuY2hpbGRyZW4oIi5zZ24tcHJlbG9hZGVyIikucmVtb3ZlKCk7DQoJCQkgJGJvZHkucmVtb3ZlQ2xhc3MoImhhcy1wcmVsb2FkZXIiKTsNCgkJCSB9KTsNCgkJCSBpc1ByZWxvYWRlckhpZGRlbiA9IHRydWU7DQoJCQkgfQ0KCQkJIH0NCgkJCSB9DQoJCQkgfTsgKi8NCg0KCQkJaWYoIWlzUHJpbWFyeUZ1bmN0aW9uc0ZpbmFsaXplZCkgew0KCQkJCWlmKHR5cGVvZiBTR05BdG9tICE9PSAidW5kZWZpbmVkIikgew0KCQkJCQkvKioqDQoJCQkJCSAqIEB0eXBlIHtPYmplY3Q8U0dOQXRvbT59DQoJCQkJCSAqLw0KCQkJCQljb25zdCBzZ25hdG9tcyA9IFNHTkF0b20uZ2V0SW5zdGFuY2UoKTsNCg0KCQkJCQlzZ25hdG9tcy5zZXRPbkNyZWF0ZUxpc3RlbmVyKChzZ25hdG9tcykgPT4gew0KCQkJCQkJaWYoc2duYXRvbXMubGVuZ3RoID4gMCkgew0KCQkJCQkJCWZvcihjb25zdCBndWlkIGluIHNnbmF0b21zKSB7DQoJCQkJCQkJCWNvbnN0IHNnbmF0b20gPSBzZ25hdG9tc1tndWlkXTsNCg0KCQkJCQkJCQlpZihzZ25hdG9tIGluc3RhbmNlb2YgU0dOQXRvbSkgew0KCQkJCQkJCQkJc2duYXRvbS5TR05BdG9tU3RhdGVzLnNldE9uUmVhZHlMaXN0ZW5lcigoaXNSZWFkeSkgPT4gew0KCQkJCQkJCQkJCWlmKGlzUmVhZHkpIHsNCgkJCQkJCQkJCQkJY29uc3QgbmF2aWdhdG9yID0gc2duYXRvbS5jb3JlLm5hdmlnYXRvcjsNCgkJCQkJCQkJCQkJbmF2aWdhdG9yLnNldE9uUGFnZUxvYWRMaXN0ZW5lcigodXJsLCBjb2RlKSA9PiB7DQoJCQkJCQkJCQkJCQlpZihjb2RlID09PSAyMDAgfHwgY29kZSA9PT0gMjAxIHx8IGNvZGUgPT09IDIwMikgew0KCQkJCQkJCQkJCQkJCWlzUHJpbWFyeUZ1bmN0aW9uc0ZpbmFsaXplZCA9IHRydWU7DQoJCQkJCQkJCQkJCQkJaXNGaW5hbGl6ZWQgPSAoaXNQcmltYXJ5RnVuY3Rpb25zRmluYWxpemVkICYmIGlzU1VLSVRyaWdnZXJlZCAmJiBpc1NVS1JUcmlnZ2VyZWQpOw0KCQkJCQkJCQkJCQkJCWlzUmVhZHkgPSAoaXNGaW5hbGl6ZWQgJiYgaXNQcmVsb2FkZXJIaWRkZW4pOw0KCQkJCQkJCQkJCQkJCWlmKCFob2xkUmVhZHkpIHsNCgkJCQkJCQkJCQkJCQkJZmluYWxpemVMb2FkZXIoKTsNCgkJCQkJCQkJCQkJCQl9DQoJCQkJCQkJCQkJCQl9DQoJCQkJCQkJCQkJCX0pOw0KCQkJCQkJCQkJCX0NCgkJCQkJCQkJCX0pOw0KCQkJCQkJCQl9DQoJCQkJCQkJfQ0KCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQlpZighaXNTVUtJVHJpZ2dlcmVkKQ0KCQkJCQkJCQlmaW5hbGl6ZUxvYWRlcih0cnVlLCBmYWxzZSk7DQoJCQkJCQkJaXNQcmltYXJ5RnVuY3Rpb25zRmluYWxpemVkID0gdHJ1ZTsNCgkJCQkJCQlpc0ZpbmFsaXplZCA9IChpc1ByaW1hcnlGdW5jdGlvbnNGaW5hbGl6ZWQgJiYgaXNTVUtJVHJpZ2dlcmVkICYmIGlzU1VLUlRyaWdnZXJlZCk7DQoJCQkJCQkJaXNSZWFkeSA9IChpc0ZpbmFsaXplZCAmJiBpc1ByZWxvYWRlckhpZGRlbik7DQoJCQkJCQkJaWYoIWhvbGRSZWFkeSkgew0KCQkJCQkJCQlmaW5hbGl6ZUxvYWRlcigpOw0KCQkJCQkJCX0NCgkJCQkJCX0NCgkJCQkJfSk7DQoJCQkJfSBlbHNlIHsNCgkJCQkJaWYoIWlzU1VLSVRyaWdnZXJlZCkNCgkJCQkJCWZpbmFsaXplTG9hZGVyKHRydWUsIGZhbHNlKTsNCgkJCQkJaXNQcmltYXJ5RnVuY3Rpb25zRmluYWxpemVkID0gdHJ1ZTsNCgkJCQkJaXNGaW5hbGl6ZWQgPSAoaXNQcmltYXJ5RnVuY3Rpb25zRmluYWxpemVkICYmIGlzU1VLSVRyaWdnZXJlZCAmJiBpc1NVS1JUcmlnZ2VyZWQpOw0KCQkJCQlpc1JlYWR5ID0gKGlzRmluYWxpemVkICYmIGlzUHJlbG9hZGVySGlkZGVuKTsNCgkJCQkJaWYoIWhvbGRSZWFkeSAmJiAhaXNGaW5hbGl6ZWQpIHsNCgkJCQkJCWZpbmFsaXplTG9hZGVyKCk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9IGVsc2Ugew0KCQkJCWlmKCFpc1NVS0lUcmlnZ2VyZWQpDQoJCQkJCWZpbmFsaXplTG9hZGVyKHRydWUsIGZhbHNlKTsNCgkJCQlpc0ZpbmFsaXplZCA9IChpc1ByaW1hcnlGdW5jdGlvbnNGaW5hbGl6ZWQgJiYgaXNTVUtJVHJpZ2dlcmVkICYmIGlzU1VLUlRyaWdnZXJlZCk7DQoJCQkJaXNSZWFkeSA9IChpc0ZpbmFsaXplZCAmJiBpc1ByZWxvYWRlckhpZGRlbik7DQoJCQkJaWYoIWhvbGRSZWFkeSAmJiAhaXNGaW5hbGl6ZWQpIHsNCgkJCQkJZmluYWxpemVMb2FkZXIoKTsNCgkJCQl9DQoJCQl9DQoJCX07DQoNCgkJbGV0IHRpbWVvdXQ7DQoJCVNHTlVJS2l0LnNldE9uQ2hhbmdlTGlzdGVuZXIoKHByb3AsIHZhbHVlKSA9PiB7DQoJCQljbGVhclRpbWVvdXQodGltZW91dCk7DQoJCQlpZihwcm9wICE9PSAicmVhZHkiICYmIHByb3AgIT09ICJjb21wb25lbnRzIikgew0KCQkJCWxldCBob2xkUmVhZHkgICAgID0gKHByb3AgPT09ICJob2xkUmVhZHkiKSA/IHZhbHVlIDogU0dOVUlLaXQuaG9sZFJlYWR5LA0KCQkJCSAgICBob2xkUHJlbG9hZGVyID0gKHByb3AgPT09ICJob2xkUHJlbG9hZGVyIikgPyB2YWx1ZSA6IFNHTlVJS2l0LmhvbGRQcmVsb2FkZXIsDQoJCQkJICAgIGlzSW5pdCAgICAgICAgPSAocHJvcCA9PT0gImluaXQiKSA/IHZhbHVlIDogU0dOVUlLaXQuaW5pdDsNCgkJCQl0aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7DQoJCQkJCWlmKGlzSW5pdCAmJiBTR05VSUtpdC5wZW5kaW5nRXZlbnRzLm9uSW5pdCA8PSAwKSB7DQoJCQkJCQljbGVhclRpbWVvdXQodGltZW91dCk7DQoJCQkJCQlmaW5hbGl6ZShob2xkUmVhZHksIGhvbGRQcmVsb2FkZXIpOw0KCQkJCQl9DQoJCQkJfSwgMTApOw0KDQoJCQl9DQoJCX0sICJzZ24tdWstcHJvcC1jaGFuZ2UtbGlzdGVuZXIiKTsNCgl9KSgpOw0KfSk7DQoNCi8qKioNCiAqIFJldHJpZXZlIGFuIGluc3RhbmNlIG9mIDxiPlNHTmkxOG48L2I+IHdoZW4gaXQncyByZWFkeS4NCiAqDQogKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayBUaGUgY2FsbGJhY2sgdG8gdXNlIHdoZW4gPGI+U0dOaTE4bjwvYj4gaXMgcmVhZHkuDQogKg0KICogQHJldHVybiB7UHJvbWlzZTxTR05pMThuPn0NCiAqLw0KYXN5bmMgZnVuY3Rpb24gZ2V0U0dOSTE4bkluc3RhbmNlKGNhbGxiYWNrKSB7DQoJcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7DQoJCWNvbnN0IHRpbWVvdXRIYW5kbGVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsNCgkJCWlmKGNoZWNrSW50ZXJ2YWxIYW5kbGVyKSBjbGVhckludGVydmFsKGNoZWNrSW50ZXJ2YWxIYW5kbGVyKTsNCgkJfSwgMTAwMDApOw0KDQoJCWNvbnN0IGNoZWNrSW50ZXJ2YWxIYW5kbGVyID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7DQoJCQlpZih0eXBlb2Ygd2luZG93LlNHTlVJS2l0UmVhZHkgIT09ICJ1bmRlZmluZWQiKSB7DQoJCQkJaWYodGltZW91dEhhbmRsZXIpIGNsZWFyVGltZW91dCh0aW1lb3V0SGFuZGxlcik7DQoJCQkJY2xlYXJJbnRlcnZhbChjaGVja0ludGVydmFsSGFuZGxlcik7DQoNCgkJCQlpZih0eXBlb2YgU0dOaTE4biAhPT0gInVuZGVmaW5lZCIpIHsNCgkJCQkJY29uc3QgYyA9IG5ldyBTR05pMThuKCk7DQoNCgkJCQkJcmVzb2x2ZShjKTsNCgkJCQl9DQoJCQl9DQoJCX0sIDEwMCk7DQoJfSk7DQp9DQoNCg";

module.exports = {
	SGNUIKitLoader
};